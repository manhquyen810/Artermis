import{a as I}from"./chunk-2DI3RHO4.js";import{a as j}from"./chunk-2UXGFGK3.js";import{a as m,c as R,d as V}from"./chunk-O4VJ5OXY.js";import{b as G,f as W,g as z}from"./chunk-BDII35IB.js";import{a as P}from"./chunk-K3W6YFKH.js";import{d as F}from"./chunk-EDXSOKK5.js";import{p as r}from"./chunk-DID2YGL7.js";import{Db as A,cb as E}from"./chunk-Z4VHWOB5.js";import{c as _}from"./chunk-E2KBL4LX.js";import{Db as l,Dc as C,Ea as u,Ed as Y,La as x,Ma as f,Mc as S,Na as y,Oc as k,Tb as T,Zb as v,cd as D,dd as a,ed as d,gd as M,kc as p,rd as L,xc as s,yc as o,yd as b,zc as w,zd as g}from"./chunk-5LC5EQRR.js";var B=h=>[h,250];function N(h,O){if(h&1&&(a(0,`
                    `),s(1,"b"),a(2),o(),a(3," "),w(4,"br"),a(5,`
                    `),s(6,"span"),a(7),b(8,"artemisTranslate"),o(),a(9,`
                `)),h&2){let t=O.model,e=k();l(2),d(t.name),l(5),M("",g(8,3,e.tooltipTranslation),": ",t.value,"")}}var st=(()=>{class h{service=u(I);translateService=u(_);graphType;currentSpan;statisticsView;entityId;LEFT=!1;RIGHT=!0;SpanType=m;chartName;chartTime;barChartLabels=[];dataForSpanType;ngxData=[];ngxColor={name:"Statistics",selectable:!0,group:G.Ordinal,domain:[V.DARK_BLUE]};tooltipTranslation;yScaleMax;yAxisTickFormatting=j;currentPeriod=0;faArrowLeft=A;faArrowRight=E;constructor(){this.translateService.onLangChange.subscribe(()=>{this.onSystemLanguageChange()})}ngOnChanges(t){this.currentSpan=t.currentSpan?.currentValue,this.barChartLabels=[],this.currentPeriod=0,this.chartName=`statistics.${this.graphType.toString().toLowerCase()}`,this.tooltipTranslation=`statistics.${this.graphType.toString().toLowerCase()}Title`,this.initializeChart()}initializeChart(){this.createLabels(),this.statisticsView===R.ARTEMIS?this.service.getChartData(this.currentSpan,this.currentPeriod,this.graphType).subscribe(t=>{this.dataForSpanType=t,this.pushToData()}):this.service.getChartDataForContent(this.currentSpan,this.currentPeriod,this.graphType,this.statisticsView,this.entityId).subscribe(t=>{this.dataForSpanType=t,this.pushToData()})}createLabels(){let t=r(),e,i;switch(this.currentSpan){case m.DAY:for(let n=0;n<24;n++)this.barChartLabels[n]=`${n}:00-${n+1}:00`;this.chartTime=t.add(this.currentPeriod,"days").format("DD.MM.YYYY");break;case m.WEEK:this.barChartLabels=this.getWeekdays(),e=r().add(this.currentPeriod,"weeks").subtract(6,"days").format("DD.MM.YYYY"),i=r().add(this.currentPeriod,"weeks").format("DD.MM.YYYY"),this.chartTime=e+" - "+i;break;case m.MONTH:e=r().subtract(1-this.currentPeriod,"months"),i=r().subtract(-this.currentPeriod,"months"),this.barChartLabels=this.getLabelsForMonth(i.diff(e,"days")),this.chartTime=t.add(this.currentPeriod,"months").subtract(Math.floor(this.barChartLabels.length/2)-1,"days").format("MMMM YYYY");break;case m.QUARTER:e=r().subtract(11+12*-this.currentPeriod,"weeks"),i=this.currentPeriod!==0?r().subtract(12*-this.currentPeriod,"weeks"):r();let c;for(let n=0;n<12;n++)c=r().subtract(11+12*-this.currentPeriod-n,"weeks").isoWeekday(1).isoWeek(),this.barChartLabels[n]=this.translateService.instant("calendar_week")+" "+c;this.chartTime=e.isoWeekday(1).format("DD.MM.YYYY")+" - "+i.isoWeekday(7).format("DD.MM.YYYY");break;case m.YEAR:this.barChartLabels=this.getMonths(),this.chartTime=t.add(this.currentPeriod,"years").subtract(5,"months").format("YYYY");break}}getMonths(){let t=r().month(),e=[this.translateService.instant("months.january"),this.translateService.instant("months.february"),this.translateService.instant("months.march"),this.translateService.instant("months.april"),this.translateService.instant("months.may"),this.translateService.instant("months.june"),this.translateService.instant("months.july"),this.translateService.instant("months.august"),this.translateService.instant("months.september"),this.translateService.instant("months.october"),this.translateService.instant("months.november"),this.translateService.instant("months.december")],i=e.slice(t+1,e.length),c=e.slice(0,t+1);return i.concat(c)}getLabelsForMonth(t){let e=[];for(let i=0;i<t;i++)e.push(r().subtract(-this.currentPeriod,"months").subtract(t-1-i,"days").format("DD.MM"));return e}getWeekdays(){let t=r().day(),e=[this.translateService.instant("weekdays.monday"),this.translateService.instant("weekdays.tuesday"),this.translateService.instant("weekdays.wednesday"),this.translateService.instant("weekdays.thursday"),this.translateService.instant("weekdays.friday"),this.translateService.instant("weekdays.saturday"),this.translateService.instant("weekdays.sunday")],i=e.slice(t,e.length),c=e.slice(0,t);return i.concat(c)}switchTimeSpan(t){t?this.currentPeriod+=1:this.currentPeriod-=1,this.initializeChart()}pushToData(){this.ngxData=this.dataForSpanType.map((t,e)=>({name:this.barChartLabels[e],value:t})),this.yScaleMax=Math.max(3,...this.dataForSpanType)}onSystemLanguageChange(){this.createLabels(),this.ngxData.forEach((t,e)=>{t.name=this.barChartLabels[e]}),this.ngxData=[...this.ngxData]}static \u0275fac=function(e){return new(e||h)};static \u0275cmp=T({type:h,selectors:[["jhi-statistics-graph"]],inputs:{graphType:"graphType",currentSpan:"currentSpan",statisticsView:"statisticsView",entityId:"entityId"},features:[x],decls:30,vars:18,consts:[["containerRef",""],["tooltipTemplate",""],[1,"row","d-flex","justify-content-center"],[1,"row"],["size","2x","role","button",1,"col-1","d-flex","justify-content-end","align-items-center","px-0",3,"click","icon"],[1,"chart","col-10","px-0"],[3,"view","results","scheme","xAxis","yAxis","showDataLabel","yScaleMax","yAxisTickFormatting","animations","roundEdges"],["size","2x","role","button",1,"col-1","d-flex","justify-content-start","align-items-center","px-0",3,"click","icon"],[1,"col-xl-9","offset-xl-2","text-center","mt-3","mb-5"]],template:function(e,i){if(e&1){let c=C();s(0,"div",2),a(1,`
    `),s(2,"div"),a(3,`
        `),s(4,"h3"),a(5),b(6,"artemisTranslate"),o(),a(7,`
    `),o(),a(8,`
    `),s(9,"div",3),a(10,`
        `),s(11,"fa-icon",4),S("click",function(){return f(c),y(i.switchTimeSpan(i.LEFT))}),o(),a(12,`
        `),s(13,"div",5,0),a(15,`
            `),s(16,"ngx-charts-bar-vertical",6),a(17,`
                `),v(18,N,10,5,"ng-template",null,1,Y),a(20,`
            `),o(),a(21,`
        `),o(),a(22,`
        `),s(23,"fa-icon",7),S("click",function(){return f(c),y(i.switchTimeSpan(i.RIGHT))}),o(),a(24,`
    `),o(),a(25,`
`),o(),a(26,`
`),s(27,"h4",8),a(28),o(),a(29,`
`)}if(e&2){let c=D(14);l(5),d(g(6,14,i.chartName)),l(6),p("icon",i.faArrowLeft),l(5),p("view",L(16,B,c.offsetWidth))("results",i.ngxData)("scheme",i.ngxColor)("xAxis",!0)("yAxis",!0)("showDataLabel",!0)("yScaleMax",i.yScaleMax)("yAxisTickFormatting",i.yAxisTickFormatting)("animations",!1)("roundEdges",!1),l(7),p("icon",i.faArrowRight),l(5),d(i.chartTime)}},dependencies:[F,z,W,P],styles:["[_nghost-%COMP%]  .textDataLabel{font-weight:bolder;font-size:small!important;alignment-baseline:middle;text-anchor:start}@media (min-width: 1420px){[_nghost-%COMP%]  .textDataLabel{transform:rotate(0);font-size:medium!important;alignment-baseline:baseline;text-anchor:middle}}"]})}return h})();export{st as a};
//# sourceMappingURL=chunk-4PW2JSSH.js.map
