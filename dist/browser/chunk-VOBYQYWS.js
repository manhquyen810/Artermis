import{a as pe}from"./chunk-LZCUSXEX.js";import{a as se}from"./chunk-NPMFKF37.js";import{a as le}from"./chunk-S5MKSB5U.js";import{a as w}from"./chunk-U6AELCVK.js";import{a as L}from"./chunk-QGGSPP32.js";import{a as K}from"./chunk-KYCCMZSV.js";import{a as re}from"./chunk-QA7Y7QBM.js";import{d as ae}from"./chunk-AR57MWOI.js";import{c as oe}from"./chunk-5MVJAZRV.js";import{c as U}from"./chunk-JNO6DNVW.js";import{K as B}from"./chunk-VZRSC3LP.js";import{K as O,c as V,h as F,m as I}from"./chunk-WA5GEAJB.js";import{a as y}from"./chunk-K3W6YFKH.js";import{c as ne}from"./chunk-JXJXC4DZ.js";import{d as me}from"./chunk-EDXSOKK5.js";import{b as W}from"./chunk-R5BZWVRQ.js";import{p as P}from"./chunk-DID2YGL7.js";import{k as q}from"./chunk-CXQURQM5.js";import{Ob as ie}from"./chunk-Z4VHWOB5.js";import{a as S}from"./chunk-U54OSGNH.js";import{Db as a,Dc as b,Ea as T,Id as te,L as G,La as H,Ma as h,Mc as v,Na as g,Oc as p,Rc as j,Tb as _,Va as J,Yc as X,Zb as C,Zc as Y,_c as Z,dd as t,ed as N,fd as A,gd as $,kc as l,ld as E,mc as k,md as R,nd as M,sc as s,sd as ee,xc as r,yc as m,yd as d,zc as x,zd as u}from"./chunk-5LC5EQRR.js";var Ke=(()=>{class i{ratingService=T(pe);accountService=T(W);rating;disableRating=!1;previousResultId;result;ngOnInit(){this.loadRating()}ngOnChanges(e){e.result&&e.result.currentValue?.id!==this.previousResultId&&(this.previousResultId=e.result.currentValue?.id,this.loadRating())}loadRating(){!this.result?.id||!this.result.participation||!this.accountService.isOwnerOfParticipation(this.result.participation)||this.ratingService.getRating(this.result.id).subscribe(e=>{this.rating=e??0})}onRate(e){if(this.disableRating||!this.result)return;let n=this.rating;this.rating=e.newValue,this.disableRating=!0;let o;n?o=this.ratingService.updateRating(this.rating,this.result.id):o=this.ratingService.createRating(this.rating,this.result.id),o.subscribe(f=>this.rating=f).add(()=>this.disableRating=!1)}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=_({type:i,selectors:[["jhi-rating"]],inputs:{result:"result"},features:[H],decls:10,vars:7,consts:[[3,"id"],["jhiTranslate","artemisApp.rating.label"],["checkedColor","gold","uncheckedColor","grey",3,"rate","value","size","readOnly","totalStars"]],template:function(n,o){n&1&&(r(0,"div",0),t(1,`
    `),r(2,"b"),t(3,`
        `),x(4,"span",1),t(5,`
    `),m(),t(6,`
    `),r(7,"star-rating",2),v("rate",function(D){return o.onRate(D)}),m(),t(8,`
`),m(),t(9,`
`)),n&2&&(k("non-clickable",o.disableRating),l("id","rating"),a(7),l("value",o.rating||0)("size","24")("readOnly",!1)("totalStars",5))},dependencies:[S,se],styles:[".non-clickable[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{cursor:default}"]})}return i})();var z=class{resultId;complaintText;complaintType;examId};function Ce(i,c){if(i&1&&(t(0,`
                    `),r(1,"p"),t(2),d(3,"artemisTranslate"),d(4,"artemisTranslate"),m(),t(5,`
                `)),i&2){let e=p(2);a(2),$(`
                        `,u(3,2,e.exercise.teamMode?"artemisApp.moreFeedback.descriptionTeam":"artemisApp.moreFeedback.description"),`
                        `,u(4,4,"artemisApp.moreFeedback.info"),`
                    `)}}function fe(i,c){if(i&1&&(t(0,`
                        `),x(1,"span",3),t(2,`
                    `)),i&2){let e=p(2);a(),l("jhiTranslate",e.complaintType===e.ComplaintType.MORE_FEEDBACK?"artemisApp.moreFeedback.beDescriptiveTeam":"artemisApp.complaint.beDescriptiveTeam")}}function Te(i,c){if(i&1&&(t(0,`
                        `),x(1,"span",3),t(2,`
                    `)),i&2){let e=p(2);a(),l("jhiTranslate",e.complaintType===e.ComplaintType.MORE_FEEDBACK?"artemisApp.moreFeedback.beDescriptive":"artemisApp.complaint.beDescriptive")}}function _e(i,c){i&1&&(t(0,`
                    `),x(1,"p",9),t(2,`
                `))}function he(i,c){if(i&1){let e=b();t(0,`
    `),r(1,"div",0),t(2,`
        `),r(3,"div",1),t(4,`
            `),r(5,"div",2),t(6,`
                `),x(7,"h3",3),t(8,`
                `),C(9,Ce,6,6),m(),t(10,`
        `),m(),t(11,`
        `),r(12,"div",1),t(13,`
            `),r(14,"div",2),t(15,`
                `),r(16,"p"),t(17,`
                    `),C(18,fe,3,1)(19,Te,3,1),m(),t(20,`
                `),C(21,_e,3,0),r(22,"div",4),t(23,`
                    `),r(24,"textarea",5),M("ngModelChange",function(o){h(e);let f=p();return R(f.complaintText,o)||(f.complaintText=o),g(o)}),t(25," "),m(),t(26,`
                    `),x(27,"jhi-textarea-counter",6),t(28,`
                `),m(),t(29,`
                `),r(30,"div",1),t(31,`
                    `),r(32,"div",7),t(33,`
                        `),r(34,"button",8),v("click",function(){h(e);let o=p();return g(o.createComplaint())}),t(35),d(36,"artemisTranslate"),d(37,"artemisTranslate"),m(),t(38,`
                    `),m(),t(39,`
                `),m(),t(40,`
            `),m(),t(41,`
        `),m(),t(42,`
    `),m(),t(43,`
`)}if(i&2){let e=p();a(7),l("jhiTranslate",e.complaintType===e.ComplaintType.COMPLAINT?"artemisApp.complaint.title":"artemisApp.moreFeedback.title"),a(2),s(e.complaintType!==e.ComplaintType.COMPLAINT?9:-1),a(9),s(e.exercise.teamMode?18:-1),a(),s(e.exercise.teamMode?-1:19),a(2),s(e.examId?-1:21),a(3),l("maxLength",e.maxComplaintTextLimit),E("ngModel",e.complaintText),a(3),l("maxLength",e.maxComplaintTextLimit)("content",e.complaintText)("visible",!0),a(7),l("disabled",!e.complaintText||e.complaintTextLength()>e.maxComplaintTextLimit),a(),A(`
                            `,e.complaintType===e.ComplaintType.COMPLAINT?u(36,12,"artemisApp.complaint.submit"):u(37,14,"artemisApp.moreFeedback.button"),`
                        `)}}var de=(()=>{class i{complaintService=T(L);alertService=T(ne);exercise;resultId;examId;complaintType;isCurrentUserSubmissionAuthor=!1;onSubmit=new J;maxComplaintsPerCourse=1;maxComplaintTextLimit;complaintText;course;ComplaintType=w;ngOnInit(){this.course=q(this.exercise),this.maxComplaintTextLimit=this.course?.maxComplaintTextLimit??0,this.exercise.course?this.maxComplaintsPerCourse=this.exercise.teamMode?this.exercise.course.maxTeamComplaints:this.exercise.course.maxComplaints:this.maxComplaintTextLimit=Math.max(2e3,this.maxComplaintTextLimit)}createComplaint(){let e=new z;if(e.resultId=this.resultId,e.complaintType=this.complaintType,e.complaintText=this.complaintText,e.examId=this.examId,e.complaintText!==void 0&&this.maxComplaintTextLimit<e.complaintText.length){this.alertService.error("artemisApp.complaint.exceededComplaintTextLimit",{maxComplaintTextLimit:this.maxComplaintTextLimit});return}this.complaintService.create(e).subscribe({next:()=>{this.onSubmit.emit()},error:n=>{n?.error?.errorKey==="tooManyComplaints"?this.alertService.error("artemisApp.complaint.tooManyComplaints",{maxComplaintNumber:this.maxComplaintsPerCourse}):oe(this.alertService,n)}})}complaintTextLength(){return document.querySelector("#complainTextArea").value.length}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=_({type:i,selectors:[["jhi-complaint-form"]],inputs:{exercise:"exercise",resultId:"resultId",examId:"examId",complaintType:"complaintType",isCurrentUserSubmissionAuthor:"isCurrentUserSubmissionAuthor"},outputs:{onSubmit:"onSubmit"},decls:1,vars:1,consts:[[1,"col-12","mt-4"],[1,"row"],[1,"col-12","col-md-6"],[3,"jhiTranslate"],[1,"d-flex","flex-column"],["id","complainTextArea","rows","4",1,"col-12","px-1",3,"ngModelChange","maxLength","ngModel"],[3,"maxLength","content","visible"],[1,"col-6"],["id","submit-complaint",1,"btn","btn-primary",3,"click","disabled"],["jhiTranslate","artemisApp.complaint.exclusivityDisclaimer"]],template:function(n,o){n&1&&C(0,he,44,16),n&2&&s(o.isCurrentUserSubmissionAuthor?0:-1)},dependencies:[S,O,V,F,I,y,le],styles:[".info-icon[_ngcontent-%COMP%]{color:#ffc107}"]})}return i})();function ge(i,c){if(i&1&&(t(0,`
            `),x(1,"span",3),t(2,`
        `)),i&2){let e=p();a(),l("jhiTranslate",e.complaint.complaintType===e.ComplaintType.COMPLAINT?"artemisApp.complaint.acceptedLong":"artemisApp.moreFeedback.acceptedLong")}}function be(i,c){i&1&&(t(0,`
            `),x(1,"span",4),t(2,`
        `))}var ue=(()=>{class i{complaint;maxComplaintTextLimit;ComplaintType=w;static \u0275fac=function(n){return new(n||i)};static \u0275cmp=_({type:i,selectors:[["jhi-complaint-request"]],inputs:{complaint:"complaint",maxComplaintTextLimit:"maxComplaintTextLimit"},decls:17,vars:17,consts:[[1,"mt-4"],[3,"ngbTooltip"],["id","complainTextArea","rows","4",1,"col-12","px-1",3,"ngModelChange","maxLength","ngModel","readOnly","disabled"],[1,"badge","bg-success",3,"jhiTranslate"],["jhiTranslate","artemisApp.complaint.rejectedLong",1,"badge","bg-danger"]],template:function(n,o){n&1&&(r(0,"div"),t(1,`
    `),r(2,"p",0),t(3),d(4,"artemisTranslate"),d(5,"artemisTranslate"),r(6,"span",1),d(7,"artemisDate"),t(8),d(9,"artemisTimeAgo"),m(),t(10,`
        `),C(11,ge,3,1)(12,be,3,0),m(),t(13,`
    `),r(14,"textarea",2),M("ngModelChange",function(D){return R(o.complaint.complaintText,D)||(o.complaint.complaintText=D),D}),m(),t(15,`
`),m(),t(16,`
`)),n&2&&(a(3),A(`
        `,o.complaint.complaintType===o.ComplaintType.COMPLAINT?u(4,9,"artemisApp.complaint.alreadySubmittedSubmissionAuthor"):u(5,11,"artemisApp.moreFeedback.alreadySubmittedSubmissionAuthor"),`
        `),a(3),l("ngbTooltip",u(7,13,o.complaint.submittedTime)),a(2),N(u(9,15,o.complaint.submittedTime)),a(3),s(o.complaint.accepted===!0?11:-1),a(),s(o.complaint.accepted===!1?12:-1),a(2),l("maxLength",o.maxComplaintTextLimit),E("ngModel",o.complaint.complaintText),l("readOnly",!0)("disabled",!0))},dependencies:[B,S,O,V,F,I,y,U,K],encapsulation:2})}return i})();function ve(i,c){if(i&1){let e=b();t(0,`
    `),r(1,"div"),t(2,`
        `),r(3,"p",0),t(4),d(5,"artemisTranslate"),d(6,"artemisTranslate"),r(7,"span",1),d(8,"artemisDate"),t(9),d(10,"artemisTimeAgo"),m(),t(11,`:
        `),m(),t(12,`
        `),r(13,"textarea",2),M("ngModelChange",function(o){h(e);let f=p();return R(f.complaint.complaintResponse.responseText,o)||(f.complaint.complaintResponse.responseText=o),g(o)}),m(),t(14,`
    `),m(),t(15,`
`)}if(i&2){let e=p();a(4),A(`
            `,e.complaint.complaintType===e.ComplaintType.COMPLAINT?u(5,7,"artemisApp.complaint.responseExists"):u(6,9,"artemisApp.moreFeedback.responseExists"),`
            `),a(3),l("ngbTooltip",u(8,11,e.complaint.complaintResponse.submittedTime)),a(2),N(u(10,13,e.complaint.complaintResponse.submittedTime)),a(4),E("ngModel",e.complaint.complaintResponse.responseText),l("readOnly",!0)("disabled",!0)("maxLength",e.maxComplaintResponseTextLimit)}}var xe=(()=>{class i{complaint;maxComplaintResponseTextLimit;ComplaintType=w;static \u0275fac=function(n){return new(n||i)};static \u0275cmp=_({type:i,selectors:[["jhi-complaint-response"]],inputs:{complaint:"complaint",maxComplaintResponseTextLimit:"maxComplaintResponseTextLimit"},decls:1,vars:1,consts:[[1,"col-12","mt-4"],[3,"ngbTooltip"],["id","complainResponseTextArea","rows","4",1,"col-12","px-1",3,"ngModelChange","ngModel","readOnly","disabled","maxLength"]],template:function(n,o){n&1&&C(0,ve,16,15),n&2&&s(o.complaint.accepted!==void 0&&o.complaint.complaintResponse?0:-1)},dependencies:[B,O,V,F,I,y,U,K],encapsulation:2})}return i})();var ye=["complaintScrollpoint"],Se=(i,c)=>({maxComplaintNumber:i,allowedComplaints:c});function we(i,c){if(i&1&&(t(0,`
                    `),x(1,"span",1),t(2,`
                `)),i&2){let e,n=p(3);a(),l("jhiTranslate","artemisApp.complaint."+(n.exercise.teamMode?"descriptionTeamExtended":"descriptionExtended"))("translateValues",ee(2,Se,(e=n.course==null?null:n.course.maxComplaints)!==null&&e!==void 0?e:0,n.remainingNumberOfComplaints))}}function Ae(i,c){i&1&&(t(0,`
                    `),x(1,"span",2),t(2,`
                `)),i&2&&(a(),l("jhiTranslate","artemisApp.complaint.descriptionExam"))}function Ee(i,c){if(i&1&&(t(0,`
                    `),x(1,"fa-icon",3),d(2,"artemisTranslate"),t(3,`
                `)),i&2){let e=p(3);a(),j("title",u(2,2,"artemisApp.complaint.info")),l("icon",e.faInfoCircle)}}function Re(i,c){if(i&1&&(t(0,`
            `),r(1,"p"),t(2,`
                `),C(3,we,3,5)(4,Ae,3,1)(5,Ee,4,4),m(),t(6,`
        `)),i&2){let e=p(2);a(3),s(!e.isExamMode&&e.remainingNumberOfComplaints>=0?3:-1),a(),s(e.isExamMode?4:-1),a(),s(e.isExamMode?-1:5)}}function Me(i,c){if(i&1){let e=b();t(0,`
                    `),r(1,"button",5),d(2,"artemisTranslate"),v("click",function(){h(e);let o=p(3);return g(o.openComplaintForm(o.ComplaintType.COMPLAINT))}),m(),t(3,`
                `)}if(i&2){let e=p(3);a(),k("not-allowed",!e.isExamMode&&e.remainingNumberOfComplaints===0||!e.timeOfComplaintValid),j("title",!e.isExamMode&&e.remainingNumberOfComplaints===0||!e.timeOfComplaintValid?u(2,4,"artemisApp.complaint.complaintNotAllowedTooltip"):""),l("disabled",!e.isExamMode&&e.remainingNumberOfComplaints===0||!e.timeOfComplaintValid)}}function Ve(i,c){if(i&1){let e=b();t(0,`
                    `),r(1,"button",6),d(2,"artemisTranslate"),v("click",function(){h(e);let o=p(3);return g(o.openComplaintForm(o.ComplaintType.MORE_FEEDBACK))}),m(),t(3,`
                `)}if(i&2){let e=p(3);a(),k("not-allowed",!e.timeOfFeedbackRequestValid),j("title",e.timeOfFeedbackRequestValid?"":u(2,4,"artemisApp.moreFeedback.notAllowedTooltip")),l("disabled",!e.timeOfFeedbackRequestValid)}}function Fe(i,c){if(i&1&&(t(0,`
            `),r(1,"div",4),t(2,`
                `),C(3,Me,4,6)(4,Ve,4,6),m(),t(5,`
        `)),i&2){let e=p(2);a(3),s(e.isExamMode||e.course!=null&&e.course.maxComplaints&&e.course.maxComplaints>0?3:-1),a(),s(!e.isExamMode&&(e.course!=null&&e.course.requestMoreFeedbackEnabled)?4:-1)}}function Ie(i,c){if(i&1){let e=b();t(0,`
            `),r(1,"div",7),t(2,`
                `),r(3,"jhi-complaint-form",8),v("onSubmit",function(){h(e);let o=p(2);return g(o.loadPotentialComplaint())}),m(),t(4,`
            `),m(),t(5,`
        `)}if(i&2){let e=p(2);a(3),l("exercise",e.exercise)("resultId",e.result.id)("examId",e.exam==null?null:e.exam.id)("complaintType",e.formComplaintType)("isCurrentUserSubmissionAuthor",e.isCorrectUserToFileAction)}}function Oe(i,c){if(i&1&&(t(0,`
            `),r(1,"div",7),t(2,`
                `),x(3,"jhi-complaint-request",9),t(4,`
                `),x(5,"jhi-complaint-response",10),t(6,`
            `),m(),t(7,`
        `)),i&2){let e=p(2);a(3),l("complaint",e.complaint)("maxComplaintTextLimit",e.course==null?null:e.course.maxComplaintTextLimit),a(2),l("complaint",e.complaint)("maxComplaintResponseTextLimit",e.course==null?null:e.course.maxComplaintResponseTextLimit)}}function Le(i,c){if(i&1&&(t(0,`
    `),r(1,"div"),t(2,`
        `),C(3,Re,7,3)(4,Fe,6,2)(5,Ie,6,5),x(6,"div",null,0),t(8,`
        `),C(9,Oe,8,4),m(),t(10,`
`)),i&2){let e,n=p();a(3),s((e=n.course==null?null:n.course.complaintsEnabled)!==null&&e!==void 0&&e?3:-1),a(),s(n.isCorrectUserToFileAction&&!n.complaint?4:-1),a(),s(!n.complaint&&n.formComplaintType?5:-1),a(4),s(n.complaint?9:-1)}}var $t=(()=>{class i{cdr=T(te);complaintService=T(L);serverDateService=T(re);accountService=T(W);courseService=T(ae);exercise;participation;result;exam;testRun=!1;complaintScrollpoint;submission;complaint;course;formComplaintType;remainingNumberOfComplaints=0;isCorrectUserToFileAction=!1;isExamMode;showSection=!1;timeOfFeedbackRequestValid=!1;timeOfComplaintValid=!1;ComplaintType=w;faInfoCircle=ie;ngOnInit(){this.course=q(this.exercise),this.isExamMode=this.exam!=null,this.participation&&this.result?.completionDate&&(this.result.participation=this.participation,this.participation.submissions&&this.participation.submissions.length>0&&(this.submission=this.participation.submissions.sort((e,n)=>n.id-e.id)[0]),this.course?.complaintsEnabled&&this.courseService.getNumberOfAllowedComplaintsInCourse(this.course.id,this.exercise.teamMode).subscribe(e=>{this.remainingNumberOfComplaints=e}),this.loadPotentialComplaint(),this.accountService.identity().then(e=>{e?.id&&(this.participation?.student?this.isCorrectUserToFileAction=this.participation.student.id===e.id:this.participation.team?.students&&(this.isCorrectUserToFileAction=!!this.participation.team.students.find(n=>n.id===e.id)))}),this.timeOfFeedbackRequestValid=this.isTimeOfFeedbackRequestValid(),this.timeOfComplaintValid=this.isTimeOfComplaintValid(),this.showSection=this.getSectionVisibility())}loadPotentialComplaint(){this.complaintService.findBySubmissionId(this.submission.id).pipe(G(e=>!!e.body)).subscribe(e=>{this.complaint=e.body})}getSectionVisibility(){return this.isExamMode?this.isWithinExamReviewPeriod():!!(this.course?.complaintsEnabled||this.course?.requestMoreFeedbackEnabled)}isTimeOfComplaintValid(){if(!this.isExamMode){if(this.course?.maxComplaintTimeDays){let e=L.getIndividualComplaintDueDate(this.exercise,this.course.maxComplaintTimeDays,this.result,this.participation);return!!e&&P().isBefore(e)}return!1}return this.isWithinExamReviewPeriod()}isTimeOfFeedbackRequestValid(){if(!this.isExamMode&&this.course?.maxRequestMoreFeedbackTimeDays){let e=L.getIndividualComplaintDueDate(this.exercise,this.course.maxRequestMoreFeedbackTimeDays,this.result,this.participation);return!!e&&P().isBefore(e)}return!1}isWithinExamReviewPeriod(){return this.testRun?!0:this.exam.examStudentReviewStart&&this.exam.examStudentReviewEnd?this.serverDateService.now().isBetween(P(this.exam.examStudentReviewStart),P(this.exam.examStudentReviewEnd)):!1}openComplaintForm(e){this.formComplaintType=e,this.cdr.detectChanges(),this.scrollToComplaint()}scrollToComplaint(){this.complaintScrollpoint?.nativeElement.scrollIntoView({behavior:"smooth",block:"end"})}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=_({type:i,selectors:[["jhi-complaint-student-view"]],viewQuery:function(n,o){if(n&1&&X(ye,5),n&2){let f;Y(f=Z())&&(o.complaintScrollpoint=f.first)}},inputs:{exercise:"exercise",participation:"participation",result:"result",exam:"exam",testRun:"testRun"},decls:1,vars:1,consts:[["complaintScrollpoint",""],[3,"jhiTranslate","translateValues"],[3,"jhiTranslate"],[1,"info-icon",3,"icon","title"],[1,"mt-4"],["id","complain","jhiTranslate","artemisApp.complaint.moreInfo",1,"btn","btn-primary",3,"click","disabled","title"],["id","more-feedback","jhiTranslate","artemisApp.moreFeedback.button",1,"btn","btn-primary","ms-1",3,"click","disabled","title"],[1,"row"],[1,"flex-grow-1",3,"onSubmit","exercise","resultId","examId","complaintType","isCurrentUserSubmissionAuthor"],[1,"col-12","col-md-6",3,"complaint","maxComplaintTextLimit"],[1,"col-12","col-md-6",3,"complaint","maxComplaintResponseTextLimit"]],template:function(n,o){n&1&&C(0,Le,11,4),n&2&&s(o.complaint||o.showSection?0:-1)},dependencies:[S,me,de,ue,xe,y],styles:[".info-icon[_ngcontent-%COMP%]{color:#ffc107}"]})}return i})();export{Ke as a,$t as b};
//# sourceMappingURL=chunk-VOBYQYWS.js.map
