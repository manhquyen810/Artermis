import{a as n,b as B}from"./chunk-W3K7VYWC.js";import{A as o,f as d,g as f}from"./chunk-5AQXEKLE.js";import{a as h,b as g}from"./chunk-O26CMRR4.js";import{a as b}from"./chunk-JHBUBEY6.js";import{a as r}from"./chunk-G4I63THF.js";import{l as m,x as S}from"./chunk-5GXY5RYT.js";import{a as l}from"./chunk-HKBU2OOC.js";import{Ea as a,L as u,La as p,Tb as c,ra as s}from"./chunk-5LC5EQRR.js";var k=(()=>{class e{FeatureToggle=l;ButtonType=h;submissionService=a(B);participationWebsocketService=a(b);exercise;participation;btnSize=g.SMALL;participationBuildCanBeTriggered;lastResultIsManual;participationHasLatestSubmissionWithoutResult;isRetrievingBuildStatus;isBuilding;showForSuccessfulSubmissions=!1;submissionSubscription;resultSubscription;personalParticipation;ngOnChanges(i){if(f(i)){if(d(this.exercise)){let t=!!this.participation.results&&m(S(this.participation.results,["id"],["desc"]));this.lastResultIsManual=!!t&&o(t)}this.participationBuildCanBeTriggered=!!this.participation.initializationState&&[r.INITIALIZED,r.INACTIVE,r.FINISHED].includes(this.participation.initializationState),this.participationBuildCanBeTriggered&&(this.setupSubmissionSubscription(),this.setupResultSubscription())}}ngOnDestroy(){this.submissionSubscription&&this.submissionSubscription.unsubscribe(),this.resultSubscription&&this.resultSubscription.unsubscribe()}setupSubmissionSubscription(){this.submissionSubscription&&this.submissionSubscription.unsubscribe(),this.submissionSubscription=this.submissionService.getLatestPendingSubmissionByParticipationId(this.participation.id,this.exercise.id,this.personalParticipation).pipe(s(({submissionState:i})=>{switch(i){case n.HAS_NO_PENDING_SUBMISSION:this.isBuilding=!1,this.participationHasLatestSubmissionWithoutResult=!1;break;case n.IS_BUILDING_PENDING_SUBMISSION:this.isBuilding=!0;break;case n.HAS_FAILED_SUBMISSION:this.participationHasLatestSubmissionWithoutResult=!0,this.isBuilding=!1;break}})).subscribe()}setupResultSubscription(){this.resultSubscription&&this.resultSubscription.unsubscribe(),this.resultSubscription=this.participationWebsocketService.subscribeForLatestResultOfParticipation(this.participation.id,this.personalParticipation,this.exercise.id).pipe(u(i=>!!i),s(i=>{this.lastResultIsManual=!!i&&o(i)})).subscribe()}triggerWithType(i){return this.isRetrievingBuildStatus=!0,this.submissionService.triggerBuild(this.participation.id,i).pipe(s(()=>this.isRetrievingBuildStatus=!1))}triggerFailed(i=!1){return this.isRetrievingBuildStatus=!0,this.submissionService.triggerFailedBuild(this.participation.id,i).pipe(s(()=>this.isRetrievingBuildStatus=!1))}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=c({type:e,selectors:[["ng-component"]],inputs:{exercise:"exercise",participation:"participation",btnSize:"btnSize"},features:[p],decls:0,vars:0,template:function(t,I){},encapsulation:2})}return e})();export{k as a};
//# sourceMappingURL=chunk-5A2TLSYI.js.map
