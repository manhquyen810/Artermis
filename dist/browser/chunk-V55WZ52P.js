import{a as S}from"./chunk-JCAGYDTX.js";import{b as x,c as E,d as v,e as $}from"./chunk-PUNMJFMR.js";import{b as u}from"./chunk-EELXLOHY.js";import{b as d}from"./chunk-R5BZWVRQ.js";import{L as b,O as h}from"./chunk-IOA4DPXY.js";import{Ea as m,ra as R,ya as l,z as p}from"./chunk-5LC5EQRR.js";var I=(()=>{class a{http=m(h);accountService=m(d);RESOURCE_URL="api/text";save(t,e,s,r,i){let n=a.prepareFeedbacksAndTextblocksForRequest(s,r,i);return this.http.put(`${this.RESOURCE_URL}/participations/${t}/results/${e}/text-assessment`,n,{observe:"response"}).pipe(p(o=>this.convertResultEntityResponseTypeFromServer(o)))}submit(t,e,s,r,i){let n=a.prepareFeedbacksAndTextblocksForRequest(s,r,i);return this.http.post(`${this.RESOURCE_URL}/participations/${t}/results/${e}/submit-text-assessment`,n,{observe:"response"}).pipe(p(o=>this.convertResultEntityResponseTypeFromServer(o)))}addTextAssessmentEvent(t){let e=Object.assign({},t);return this.http.post(this.RESOURCE_URL+"/event-insights/text-assessment/events",e,{observe:"response"}).pipe(p(s=>Object.assign({},s)))}getNumberOfTutorsInvolvedInAssessment(t,e){return this.http.get(`${this.RESOURCE_URL}/event-insights/text-assessment/courses/${t}/text-exercises/${e}/tutors-involved`)}updateAssessmentAfterComplaint(t,e,s,r,i,n){let o=`${this.RESOURCE_URL}/participations/${i}/submissions/${r}/text-assessment-after-complaint`,c={feedbacks:t,textBlocks:e,complaintResponse:s,assessmentNote:n};return this.http.put(o,c,{observe:"response"}).pipe(p(U=>this.convertResultEntityResponseTypeFromServer(U)))}saveExampleAssessment(t,e,s,r){let i=`${this.RESOURCE_URL}/exercises/${t}/example-submissions/${e}/example-text-assessment`,n=a.prepareFeedbacksAndTextblocksForRequest(s,r);return this.http.put(i,n,{observe:"response"}).pipe(p(o=>this.convertResultEntityResponseTypeFromServer(o)))}cancelAssessment(t,e){return this.http.post(`${this.RESOURCE_URL}/participations/${t}/submissions/${e}/cancel-assessment`,void 0)}deleteAssessment(t,e,s){return this.http.delete(`${this.RESOURCE_URL}/participations/${t}/text-submissions/${e}/results/${s}`)}getFeedbackDataForExerciseSubmission(t,e=0,s){let r=new b;return s&&s>0?r=r.set("resultId",s.toString()):r=r.set("correction-round",e.toString()),this.http.get(`${this.RESOURCE_URL}/text-submissions/${t}/for-assessment`,{observe:"response",params:r}).pipe(R(i=>{let n=i.body;n.exercise&&this.accountService.setAccessRightsForExercise(n.exercise);let o=n.submissions.last(),c;s?c=v(o,s):c=E(o,e),a.reconnectResultsParticipation(n,o,c)}),p(i=>i.body))}getExampleResult(t,e){return this.http.get(`${this.RESOURCE_URL}/exercises/${t}/submissions/${e}/example-result`)}deleteExampleAssessment(t,e){return this.http.delete(`${this.RESOURCE_URL}/exercises/${t}/example-submissions/${e}/example-text-assessment/feedback`)}static prepareFeedbacksAndTextblocksForRequest(t,e,s){t=t.map(i=>(i=Object.assign({},i),delete i.result,i));let r=e.map(i=>({id:i.id,type:i.type,startIndex:i.startIndex,endIndex:i.endIndex,text:i.text}));return{feedbacks:t,textBlocks:r,assessmentNote:s}}convertResultEntityResponseTypeFromServer(t){let e=a.convertItemFromServer(t.body);return e.completionDate=u(e.completionDate),e.submission&&(e.submission.submissionDate=u(e.submission.submissionDate)),e.participation&&(e.participation.initializationDate=u(e.participation.initializationDate),e.participation.individualDueDate=u(e.participation.individualDueDate),e.participation.exercise&&this.accountService.setAccessRightsForExercise(e.participation.exercise)),t.clone({body:e})}static convertItemFromServer(t){return Object.assign({},t)}static matchBlocksWithFeedbacks(t,e){return t.map(s=>new S(s,e.find(({reference:r})=>s.id===r)))}static reconnectResultsParticipation(t,e,s){$(e,x(e)),e.participation=t,t.results=e.results,s.submission=e,s.participation=t,s.feedbacks=s.feedbacks||[]}static \u0275fac=function(e){return new(e||a)};static \u0275prov=l({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();export{I as a};
//# sourceMappingURL=chunk-V55WZ52P.js.map
