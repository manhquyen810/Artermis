import{a as _}from"./chunk-MY22ELD7.js";import{a as r,b as F}from"./chunk-W3K7VYWC.js";import{b as v}from"./chunk-22YQSX6Z.js";import{a as O}from"./chunk-5M3YV54C.js";import{g as U,j as d,l as t,s as E,t as l}from"./chunk-5AQXEKLE.js";import{f as N}from"./chunk-DXTZ4GAW.js";import{a as C}from"./chunk-JHBUBEY6.js";import{b as D}from"./chunk-EELXLOHY.js";import{p as n}from"./chunk-DID2YGL7.js";import{c as B}from"./chunk-CXQURQM5.js";import{Ea as p,L as a,La as b,Tb as f,Va as h,dd as R,kc as I,pd as P,ra as u,z as S,zc as w}from"./chunk-5LC5EQRR.js";import{a as m,b as g}from"./chunk-3E746U5Y.js";var $=(()=>{class o{participationWebsocketService=p(C);submissionService=p(F);exercise;participation;short=!0;showUngradedResults=!1;showBadge=!1;showIcon=!0;isInSidebarCard=!1;showCompletion=!0;showProgressBar=!1;showProgressBarBorder=!1;showResult=new h;personalParticipation=!0;onParticipationChange=new h;result;isBuilding;isQueued;estimatedCompletionDate;buildStartDate;showProgressBarInResult=!1;missingResultInfo=t.NONE;resultSubscription;submissionSubscription;ngOnChanges(i){U(i)&&(this.result=d(this.participation,this.showUngradedResults,!0),this.missingResultInfo=t.NONE,this.subscribeForNewResults(),this.exercise?.type===B.PROGRAMMING&&this.subscribeForNewSubmissions(),this.submissionService.getIsLocalCIProfile()&&(this.showProgressBarInResult=this.showProgressBar),this.result&&this.showResult.emit())}ngOnDestroy(){this.resultSubscription&&(this.participationWebsocketService.unsubscribeForLatestResultOfParticipation(this.participation.id,this.exercise),this.resultSubscription.unsubscribe()),this.submissionSubscription&&(this.submissionService.unsubscribeForLatestSubmissionOfParticipation(this.participation.id),this.submissionSubscription.unsubscribe())}subscribeForNewResults(){this.resultSubscription&&this.resultSubscription.unsubscribe(),this.resultSubscription=this.participationWebsocketService.subscribeForLatestResultOfParticipation(this.participation.id,this.personalParticipation,this.exercise?this.exercise.id:void 0).pipe(a(i=>!!i),a(i=>this.showUngradedResults||i.rated===!0||l(i)),S(i=>g(m({},i),{completionDate:D(i.completionDate),participation:this.participation})),u(i=>{l(i)&&E(i)||i.rated?this.result=i:i.rated===!1&&this.showUngradedResults?this.result=i:this.result=d(this.participation,this.showUngradedResults,!1),this.onParticipationChange.emit(),i&&this.showResult.emit()})).subscribe()}subscribeForNewSubmissions(){this.submissionSubscription&&this.submissionSubscription.unsubscribe(),this.submissionSubscription=this.submissionService.getLatestPendingSubmissionByParticipationId(this.participation.id,this.exercise.id,this.personalParticipation).pipe(a(({submission:i})=>this.shouldUpdateSubmissionState(i)),u(({submissionState:i,buildTimingInfo:e,submission:s})=>this.updateSubmissionState(i,e,s?.submissionDate))).subscribe()}generateMissingResultInfoForFailedProgrammingExerciseSubmission(){return this.exercise.allowOfflineIde?t.FAILED_PROGRAMMING_SUBMISSION_OFFLINE_IDE:t.FAILED_PROGRAMMING_SUBMISSION_ONLINE_IDE}shouldUpdateSubmissionState(i){return this.showUngradedResults||!i||!this.exercise.dueDate||i.type==="INSTRUCTOR"||i.type==="TEST"||n(i.submissionDate).isBefore(N(this.exercise,this.participation))}updateSubmissionState(i,e,s){this.isQueued=i===r.IS_QUEUED,this.isBuilding=i===r.IS_BUILDING_PENDING_SUBMISSION,this.submissionService.getIsLocalCIProfile()&&this.updateBuildTimingInfo(i,e,s),i===r.HAS_FAILED_SUBMISSION?this.missingResultInfo=this.generateMissingResultInfoForFailedProgrammingExerciseSubmission():this.missingResultInfo=t.NONE}updateBuildTimingInfo(i,e,s){i===r.IS_QUEUED?this.submissionService.fetchQueueReleaseDateEstimationByParticipationId(this.participation.id).subscribe(c=>{c&&!this.isBuilding&&(this.estimatedCompletionDate=c,this.buildStartDate=s)}):i===r.IS_BUILDING_PENDING_SUBMISSION&&e&&n(e?.estimatedCompletionDate).isAfter(n())?(this.estimatedCompletionDate=e?.estimatedCompletionDate,this.buildStartDate=e?.buildStartDate):(this.estimatedCompletionDate=void 0,this.buildStartDate=void 0)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=f({type:o,selectors:[["jhi-updating-result"]],inputs:{exercise:"exercise",participation:"participation",short:"short",showUngradedResults:"showUngradedResults",showBadge:"showBadge",showIcon:"showIcon",isInSidebarCard:"isInSidebarCard",showCompletion:"showCompletion",showProgressBar:"showProgressBar",showProgressBarBorder:"showProgressBarBorder",personalParticipation:"personalParticipation"},outputs:{showResult:"showResult",onParticipationChange:"onParticipationChange"},features:[P([O,_]),b],decls:2,vars:16,consts:[["id","result",3,"exercise","result","participation","isBuilding","isQueued","short","showUngradedResults","showBadge","showIcon","missingResultInfo","isInSidebarCard","showCompletion","estimatedCompletionDate","buildStartDate","showProgressBar","showProgressBarBorder"]],template:function(e,s){e&1&&(w(0,"jhi-result",0),R(1,`
`)),e&2&&I("exercise",s.exercise)("result",s.result)("participation",s.participation)("isBuilding",s.isBuilding)("isQueued",s.isQueued)("short",s.short)("showUngradedResults",s.showUngradedResults)("showBadge",s.showBadge)("showIcon",s.showIcon)("missingResultInfo",s.missingResultInfo)("isInSidebarCard",s.isInSidebarCard)("showCompletion",s.showCompletion)("estimatedCompletionDate",s.estimatedCompletionDate)("buildStartDate",s.buildStartDate)("showProgressBar",s.showProgressBarInResult)("showProgressBarBorder",s.showProgressBarBorder)},dependencies:[v],encapsulation:2})}return o})();export{$ as a};
//# sourceMappingURL=chunk-4NYYKXW4.js.map
