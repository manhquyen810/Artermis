import{a as ve}from"./chunk-LPGL4A37.js";import{b as be}from"./chunk-5XX2X5VF.js";import{a as le}from"./chunk-M2R22ST2.js";import{a as ue,b as me}from"./chunk-43HC4K73.js";import{b as he}from"./chunk-A4MOLMZQ.js";import{a as de}from"./chunk-NT3333UE.js";import{a as pe,b as Ce}from"./chunk-VOBYQYWS.js";import{a as _e}from"./chunk-23SCGJT4.js";import{a as xe}from"./chunk-ZXG3EZUM.js";import{a as fe}from"./chunk-TOVMCMTA.js";import{a as ce}from"./chunk-FNJRUM5G.js";import{a as ae}from"./chunk-HSP5ZR73.js";import{a as re}from"./chunk-NUC4ZXFE.js";import{b as Y}from"./chunk-OI2L2OHD.js";import{a as oe}from"./chunk-QZKVSIAC.js";import{a as se}from"./chunk-JRBFEQNN.js";import{a as ne}from"./chunk-BNRTXX46.js";import{o as ee,t as ie}from"./chunk-5AQXEKLE.js";import{j as Qt,k as Zt,l as te}from"./chunk-3JSWSN6W.js";import{e as K}from"./chunk-DXTZ4GAW.js";import{q as Jt}from"./chunk-Z2YUBN6N.js";import{a as qt,b as Xt,f as Kt}from"./chunk-GERFCPB6.js";import{a as $t,d as zt}from"./chunk-O26CMRR4.js";import{a as Gt}from"./chunk-JHBUBEY6.js";import{a as Yt}from"./chunk-2CSD5TLZ.js";import{e as Nt}from"./chunk-CK7FH6VF.js";import{b as O,e as D,h as Vt}from"./chunk-PUNMJFMR.js";import{c as jt}from"./chunk-5MVJAZRV.js";import{a as H}from"./chunk-PZ7IDTIM.js";import{K as Et}from"./chunk-VZRSC3LP.js";import{K as gt,c as Ct,h as vt,m as Tt}from"./chunk-WA5GEAJB.js";import{r as Wt}from"./chunk-VK7JPHFE.js";import{c as Lt}from"./chunk-BNDLMKXK.js";import{a as V}from"./chunk-K3W6YFKH.js";import{c as Ht}from"./chunk-JXJXC4DZ.js";import{d as N}from"./chunk-EDXSOKK5.js";import{b as Bt}from"./chunk-R5BZWVRQ.js";import{p as M}from"./chunk-DID2YGL7.js";import{k as Dt}from"./chunk-CXQURQM5.js";import{Ba as yt,Bc as It,Cd as Mt,O as St,Oc as Pt,_b as Rt,eb as At,nb as wt,sd as Ot,wd as Ft,y as kt}from"./chunk-Z4VHWOB5.js";import{a as Ut}from"./chunk-U54OSGNH.js";import{f as ft,i as _t}from"./chunk-M6Z6DKZQ.js";import{c as L}from"./chunk-E2KBL4LX.js";import{n as bt,x as ht}from"./chunk-IOA4DPXY.js";import{Ac as $,Bb as at,Bc as z,Db as s,Dc as I,Ea as h,J as it,Ma as T,Mc as y,Na as g,Oc as a,Sc as rt,Tb as B,U as nt,Za as E,Zb as x,_ as st,cd as ct,dd as e,ed as q,f as j,fd as P,kc as c,ld as lt,ma as ot,md as dt,nd as pt,pd as ut,qd as mt,rd as X,sc as u,td as xt,uc as W,vc as G,wb as R,wc as U,xc as l,yc as d,yd as _,z as et,zc as m,zd as C}from"./chunk-5LC5EQRR.js";import{a as Z,b as tt}from"./chunk-3E746U5Y.js";var b=function(i){return i.POSITIVE="positive",i.NEGATIVE="negative",i.NEUTRAL="neutral",i.BLANK="blank",i}(b||{}),F=class{text;textBlock;feedback;constructor(r,t){this.textBlock=r,this.feedback=t,this.text=Xt(qt(r.text??""))}get length(){return this.endIndex-this.startIndex}get startIndex(){return this.textBlock.startIndex}get endIndex(){return this.textBlock.endIndex}get feedbackType(){return!this.feedback||Qt.isEmpty(this.feedback)?b.BLANK:this.feedback.credits>0?b.POSITIVE:this.feedback.credits<0?b.NEGATIVE:b.NEUTRAL}get cssClass(){return this.feedbackType&&this.feedbackType!==b.BLANK?`text-with-feedback ${this.feedbackType}-feedback`:""}get icon(){switch(this.feedbackType){case b.POSITIVE:return Ot;case b.NEGATIVE:return Pt;case b.NEUTRAL:return At;default:return}}get circleIcon(){switch(this.feedbackType){case b.POSITIVE:return yt;case b.NEGATIVE:return Mt;case b.NEUTRAL:return St;default:return}}get iconCssClass(){return this.feedbackType?`feedback-icon ${this.feedbackType}-feedback`:""}get feedbackCssClass(){switch(this.feedbackType){case b.POSITIVE:return"alert alert-success";case b.NEGATIVE:return"alert alert-danger";case b.NEUTRAL:return"alert alert-secondary";default:return""}}};function Se(i,r){if(i&1&&(e(0,`
                    `),m(1,"fa-icon",2),e(2,`
                `)),i&2){let t=a(3).$implicit;s(),c("icon",t.icon)}}function ye(i,r){if(i&1&&(e(0,`
            `),l(1,"span",1),e(2,`
                `),G(3,Se,3,1,null,null,W),d(),e(5,`
        `)),i&2){let t=a(2).$implicit,n=a();s(),c("ngClass",t.iconCssClass)("title",n.creditsTranslationForTextResultBlock(t)),s(2),U(n.repeatForEachCredit(t))}}function Ae(i,r){if(i&1&&(e(0,`
                        `),m(1,"fa-icon",2),e(2,`
                    `)),i&2){let t=a(3).$implicit;s(),c("icon",t.circleIcon)}}function we(i,r){if(i&1&&(e(0,`
            `),l(1,"div",3),e(2,`
                `),l(3,"span",4),e(4,`
                    `),x(5,Ae,3,1),e(6),d(),e(7,`
                `),m(8,"span",5),e(9,`
            `),d(),e(10,`
        `)),i&2){let t=a(2),n=t.$implicit,o=t.$index,p=a();s(),c("ngClass",n.feedbackCssClass),s(4),u(n.circleIcon?5:-1),s(),P(`
                    \xA0`,p.creditsTranslationForTextResultBlock(n),`:
                `),s(2),rt("id","text-feedback-",o,""),c("innerHTML",p.buildFeedbackTextForReview(n.feedback),R)}}function Re(i,r){if(i&1&&(e(0,`
                        `),m(1,"fa-icon",2),e(2,`
                    `)),i&2){let t=a(3).$implicit;s(),c("icon",t.circleIcon)}}function Ie(i,r){if(i&1&&(e(0,`
            `),l(1,"div",6),e(2,`
                `),l(3,"span",4),e(4,`
                    `),x(5,Re,3,1),e(6),d(),e(7,`
                `),m(8,"span",7),e(9,`
                `),m(10,"fa-icon",8),_(11,"artemisTranslate"),e(12,`
            `),d(),e(13,`
        `)),i&2){let t=a(2).$implicit,n=a();s(5),u(t.circleIcon?5:-1),s(),P(`
                    \xA0`,n.creditsTranslationForTextResultBlock(t),`:
                `),s(2),c("innerHTML",n.buildFeedbackTextForReview(t.feedback),R),s(2),c("icon",n.faExclamationTriangle)("ngbTooltip",C(11,5,"artemisApp.assessment.subsequentFeedback"))}}function Pe(i,r){if(i&1&&(e(0,`
        `),x(1,ye,6,2)(2,we,11,6)(3,Ie,14,7)),i&2){let t=a().$implicit;s(),u(t.icon?1:-1),s(),u(t.feedback&&t.feedback.isSubsequent===void 0?2:-1),s(),u(t.feedback&&t.feedback.isSubsequent?3:-1)}}function Oe(i,r){if(i&1&&(e(0,`
    `),m(1,"span",0),e(2,`
    `),x(3,Pe,4,3)),i&2){let t=r.$implicit;s(),c("ngClass",t.cssClass)("innerHTML",t.text,R),s(2),u(t.feedback?3:-1)}}var Te=(()=>{class i{translateService=h(L);localeConversionService=h(Yt);submissionText;textResults;submission;faExclamationTriangle=Ft;buildFeedbackTextForReview=Zt;SHA1_REGEX=/^[a-f0-9]{40}$/i;set result(t){!t||!t.submission||!t.submission||(this.submission=t.submission,this.submissionText=this.submission.text||"",this.convertTextToResultBlocks(t.feedbacks))}course;convertTextToResultBlocks(t=[]){te(t);let[n,o]=t.reduce(([f,w],v)=>this.SHA1_REGEX.test(v.reference)?[f,[...w,v]]:[[...f,v],w],[[],[]]),p=n.map(this.feedbackToTextResultBlock,this),k=o.map(this.textBlockToTextResultBlock,this),J=[...p,...k].filter(f=>f!==void 0).sort((f,w)=>w.startIndex-f.startIndex),S=J.pop(),A=0,Q=this.submissionText.length;for(this.textResults=[];A<Q;)if(S&&S.startIndex===A)this.textResults.push(S),A=S.endIndex,S=J.pop();else{let f=S?S.startIndex:Q,w=this.submissionText.slice(A,f),v=new Y;v.startIndex=A,v.endIndex=f,v.text=w;let Ee=new F(v);this.textResults.push(Ee),A=f}}feedbackToTextResultBlock(t){let n=t.reference;if(!n)return;let o=this.submissionText.indexOf(n),p=new Y;return p.text=n,p.startIndex=o,p.endIndex=o+n.length,new F(p,t)}textBlockToTextResultBlock(t){if(this.submission.blocks){let n=this.submission.blocks.find(o=>o.id===t.reference);if(n)return new F(n,t)}}repeatForEachCredit(t){if(!t.feedback||t.feedback.credits===0)return[];let n=Math.ceil(Math.abs(t.feedback.credits||0));return new Array(n).fill(1)}creditsTranslationForTextResultBlock(t){let n=Math.abs(t.feedback.credits||0)===1;return this.translateService.instant(`artemisApp.assessment.detail.points.${n?"one":"many"}`,{points:this.localeConversionService.toLocaleString(t.feedback?.credits||0,this.course?.accuracyOfScores)})}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=B({type:i,selectors:[["jhi-text-result"]],inputs:{result:"result",course:"course"},decls:2,vars:0,consts:[[1,"white-space",3,"ngClass","innerHTML"],[3,"ngClass","title"],[3,"icon"],[1,"feedback-text","mt-1",3,"ngClass"],[1,"feedback-points"],[3,"innerHTML","id"],[1,"feedback-text","mt-1","alert","alert-secondary"],[3,"innerHTML"],[1,"float-end",3,"icon","ngbTooltip"]],template:function(n,o){n&1&&G(0,Oe,4,3,null,null,W),n&2&&U(o.textResults)},dependencies:[bt,N,Et,V],styles:[".text-with-feedback[_ngcontent-%COMP%]{text-decoration-line:underline;padding:2px 4px;border-radius:4px}.text-with-feedback.positive-feedback[_ngcontent-%COMP%]{text-decoration-style:double;text-decoration-color:var(--textblock-assessment-text-feedback-positive-active-decoration);color:var(--textblock-assessment-text-feedback-positive-color);background-color:var(--textblock-assessment-text-feedback-positive-background)}.text-with-feedback.negative-feedback[_ngcontent-%COMP%]{text-decoration-style:wavy;text-decoration-color:var(--textblock-assessment-text-feedback-negative-active-decoration);color:var(--textblock-assessment-text-feedback-negative-color);background-color:var(--textblock-assessment-text-feedback-negative-background)}.text-with-feedback.neutral-feedback[_ngcontent-%COMP%]{text-decoration-style:dashed;text-decoration-color:var(--textblock-assessment-text-feedback-neutral-active-decoration);color:var(--textblock-assessment-text-feedback-neutral-color);background-color:var(--textblock-assessment-text-feedback-neutral-background)}.text-with-feedback[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{font-weight:600}.feedback-icon.positive-feedback[_ngcontent-%COMP%]{color:var(--textblock-assessment-text-feedback-positive-color)}.feedback-icon.negative-feedback[_ngcontent-%COMP%]{color:var(--textblock-assessment-text-feedback-negative-color)}.feedback-points[_ngcontent-%COMP%]{font-weight:700}.white-space[_ngcontent-%COMP%]{white-space:pre-wrap}"]})}return i})();var Me=(i,r,t)=>["/courses",i,"exercises","text-exercises",r,"participate",t],ge=i=>({count:i}),De=()=>[];function Be(i,r){if(i&1){let t=I();e(0,`
                            `),l(1,"jhi-button",7),y("click",function(){T(t);let o=a(4);return g(o.showHistory=!o.showHistory)}),d(),e(2,`
                        `)}if(i&2){let t=a(4);s(),c("icon",t.faTimeline)("title",t.showHistory?"entity.action.hideTimeline":"entity.action.viewTimeline")}}function Le(i,r){if(i&1&&(e(0,`
                            `),m(1,"jhi-button",8),e(2,`
                        `)),i&2){let t=a(4);s(),c("title","entity.action.continueSubmission")("routerLink",xt(2,Me,t.course==null?null:t.course.id,t.textExercise==null?null:t.textExercise.id,t.result.participation==null?null:t.result.participation.id))}}function He(i,r){if(i&1&&(e(0,`
                        `),x(1,Be,3,2)(2,Le,3,6)),i&2){let t=a(3);s(),u(((t.sortedHistoryResults==null?null:t.sortedHistoryResults.length)||0)>1?1:-1),s(),u(t.isActive||!t.textExercise.dueDate?2:-1)}}function Ve(i,r){if(i&1){let t=I();e(0,`
                            `),l(1,"jhi-request-feedback-button",9),y("generatingFeedback",function(){T(t);let o=a(4);return g(o.isGeneratingFeedback=!0)}),d(),e(2,`
                        `)}if(i&2){let t=a(4);s(),c("exercise",t.textExercise)("pendingChanges",t.submission.text!==t.answer)("hasAthenaResultForLatestSubmission",t.hasAthenaResultForLatestSubmission)("isGeneratingFeedback",t.isGeneratingFeedback)("isSubmitted",t.submission.submitted||!1)}}function Ne(i,r){if(i&1&&(e(0,`
                        `),x(1,Ve,3,5)),i&2){let t=a(3);s(),u(t.textExercise.allowFeedbackRequests&&(!t.textExercise.dueDate||!t.hasExerciseDueDatePassed(t.textExercise,t.participation))?1:-1)}}function je(i,r){if(i&1){let t=I();e(0,`
                        `),l(1,"jhi-button",10),y("onClick",function(){T(t);let o=a(3);return g(o.submit())}),d(),e(2,`
                    `)}if(i&2){let t=a(3);s(),c("title",t.isAllowedToSubmitAfterDueDate?"entity.action.submitDueDateMissed":"entity.action.submit")("disabled",!t.isActive||!t.submission)("isLoading",t.isSaving)("btnType",t.isAllowedToSubmitAfterDueDate?t.ButtonType.WARNING:t.ButtonType.PRIMARY)("tooltip",t.submitButtonTooltip)}}function We(i,r){if(i&1&&(e(0,`
                    `),x(1,He,3,2)(2,Ne,2,1)(3,je,3,5)),i&2){let t=a(2);s(),u(t.isReadOnlyWithShowResult?1:2),s(2),u(t.isReadOnlyWithShowResult?-1:3)}}function Ge(i,r){if(i&1&&(e(0,`
        `),l(1,"jhi-header-participation-page",3),e(2,`
            `),l(3,"span",4),e(4),_(5,"artemisTranslate"),l(6,"span",5),e(7),d(),e(8,`
            `),d(),e(9,`
            `),$(10,6),e(11,`
                `),x(12,We,4,2),z(),e(13,`
        `),d(),e(14,`
    `)),i&2){let t=a();s(),c("exercise",t.textExercise)("participation",t.participation),s(3),P(`
                `,C(5,5,"artemisApp.textSubmission.textEditor"),`:
                `),s(3),q(t.examMode?t.textExercise.exerciseGroup==null?null:t.textExercise.exerciseGroup.title:t.textExercise==null?null:t.textExercise.title),s(5),u(t.isOwnerOfParticipation?12:-1)}}function Ue(i,r){if(i&1&&(e(0,`
                `),l(1,"div",11),e(2,`
                    `),m(3,"jhi-result-history",12),e(4,`
                `),d(),e(5,`
            `)),i&2){let t=a(2);s(3),c("results",t.sortedHistoryResults)("exercise",t.textExercise)("selectedResultId",t.submission.latestResult==null?null:t.submission.latestResult.id)}}function $e(i,r){if(i&1&&(e(0,`
            `),x(1,Ue,6,3)),i&2){let t=a();s(),u(t.showHistory?1:-1)}}function ze(i,r){if(i&1&&(e(0,`
                    `),l(1,"div",21),e(2,`
                        `),m(3,"jhi-team-participate-info-box",22),e(4,`
                    `),d(),e(5,`
                `)),i&2){let t=a(2);s(3),c("exercise",t.textExercise)("participation",t.participation)("typing$",t.textEditorInputObservable)("dockedToRightSide",!0)}}function qe(i,r){if(i&1){let t=I();e(0,`
                            `),l(1,"jhi-team-submission-sync",24),y("receiveSubmission",function(o){T(t);let p=a(3);return g(p.onReceiveSubmissionFromTeam(o))}),d(),e(2,`
                        `)}if(i&2){let t=a(3);s(),c("exerciseType",t.textExercise.type)("submissionObservable",t.submissionObservable)("participation",t.participation)}}function Xe(i,r){if(i&1){let t=I();e(0,`
                        `),l(1,"textarea",23,0),pt("ngModelChange",function(o){T(t);let p=a(2);return dt(p.answer,o)||(p.answer=o),g(o)}),y("keydown.tab",function(o){T(t);let p=ct(2),k=a(2);return g(k.onTextEditorTab(p,o))})("input",function(o){T(t);let p=a(2);return g(p.onTextEditorInput(o))}),d(),e(3,`
                        `),x(4,qe,3,3)}if(i&2){let t=a(2);s(),c("maxLength",t.MAX_CHARACTER_COUNT),lt("ngModel",t.answer),c("readOnly",!t.isActive||!t.submission||!t.isOwnerOfParticipation||t.isReadOnlyWithShowResult)("disabled",!t.isActive||!t.submission||!t.isOwnerOfParticipation)("hidden",t.submission&&!t.submission.submitted&&t.isExamSummary()),s(3),u(t.textExercise!=null&&t.textExercise.teamMode?4:-1)}}function Ke(i,r){if(i&1&&(e(0,`
                            `),l(1,"div",25),e(2,`
                                `),l(3,"div",26),e(4,`
                                    `),l(5,"b",27),e(6,"Submission:"),d(),e(7,`
                                    `),m(8,"hr"),e(9,`
                                    `),m(10,"jhi-text-result",28),e(11,`
                                    `),m(12,"hr"),e(13,`
                                    `),l(14,"i",27),e(15,"Assessment pending"),d(),e(16,`
                                `),d(),e(17,`
                            `),d(),e(18,`
                        `)),i&2){let t=a(3);s(5),c("jhiTranslate","artemisApp.textExercise.submission"),s(5),c("result",t.result)("course",t.course),s(4),c("jhiTranslate","artemisApp.textExercise.assessmentPending")}}function Ye(i,r){i&1&&(e(0,`
                                        `),l(1,"div",29),e(2),_(3,"artemisTranslate"),_(4,"uppercase"),d(),e(5,`
                                    `)),i&2&&(s(2),q(C(4,3,C(3,1,"artemisApp.result.preliminary"))))}function Je(i,r){if(i&1&&(e(0,`
                                    `),m(1,"jhi-additional-feedback",30),e(2,`
                                `)),i&2){let t=a(4);s(),c("feedback",t.unreferencedFeedback||mt(3,De))("additional",!0)("course",t.course)}}function Qe(i,r){if(i&1&&(e(0,`
                                    `),m(1,"jhi-rating",31),e(2,`
                                `)),i&2){let t=a(4);s(),c("result",t.result)}}function Ze(i,r){if(i&1&&(e(0,`
                            `),l(1,"div",25),e(2,`
                                `),l(3,"div",26),e(4,`
                                    `),l(5,"b"),e(6),_(7,"artemisTranslate"),_(8,"artemisTranslate"),d(),e(9,`
                                    `),x(10,Ye,6,5),m(11,"hr"),e(12,`
                                    `),m(13,"jhi-text-result",28),e(14,`
                                    `),m(15,"hr"),e(16,`
                                `),d(),e(17,`
                                `),x(18,Je,3,4)(19,Qe,3,1),d(),e(20,`
                        `)),i&2){let t=a(3);s(6),P(`
                                        `,t.isOwnerOfParticipation?C(7,6,"artemisApp.textExercise.assessedSubmission"):C(8,8,"artemisApp.textExercise.assessedSubmissionInstructor"),`:
                                    `),s(4),u(t.isAthenaAIResult(t.result)?10:-1),s(3),c("result",t.result)("course",t.course),s(5),u(t.unreferencedFeedback&&t.unreferencedFeedback.length>0?18:-1),s(),u(t.isOwnerOfParticipation?19:-1)}}function ti(i,r){if(i&1&&(e(0,`
                        `),x(1,Ke,19,4)(2,Ze,21,10)),i&2){let t=a(2);s(),u(!(t.result==null||t.result.feedbacks==null)&&t.result.feedbacks.length?2:1)}}function ei(i,r){if(i&1&&(e(0,`
                        `),m(1,"jhi-complaint-student-view",32),e(2,`
                    `)),i&2){let t=a(2);s(),c("exercise",t.textExercise)("result",t.resultWithComplaint?t.resultWithComplaint:t.result)("participation",t.participation)}}function ii(i,r){if(i&1&&(e(0,`
                    `),l(1,"p",33),e(2,`
                        `),m(3,"span",34),_(4,"htmlForMarkdown"),e(5,`
                    `),d(),e(6,`
                `)),i&2){let t=a(2);s(3),c("innerHTML",C(4,1,t.textExercise.problemStatement),R)}}function ni(i,r){if(i&1&&(e(0,`
            `),m(1,"jhi-exercise-chatbot-button",35),e(2,`
        `)),i&2){let t=a(2);s(),c("mode",t.ChatServiceMode.TEXT_EXERCISE)}}function si(i,r){if(i&1&&(e(0,`
        `),l(1,"jhi-resizeable-container",13),e(2,`
            `),e(3,`
            `),l(4,"div",14),e(5,`
                `),x(6,ze,6,4),l(7,"div",15),e(8,`
                    `),l(9,"div"),e(10,`
                        `),l(11,"span",16),e(12,`
                        `),d(),e(13,`
                        `),l(14,"span",17),e(15,`
                        `),d(),e(16,`
                    `),d(),e(17,`
                    `),x(18,Xe,5,6)(19,ti,3,1)(20,ei,3,3),d(),e(21,`
            `),d(),e(22,`
            `),e(23,`
            `),e(24,`
            `),m(25,"fa-icon",18),e(26,`\xA0
            `),m(27,"span",19),e(28,`
            `),$(29,20),e(30,`
                `),x(31,ii,7,3),z(),e(32,`

            `),e(33,`
        `),d(),e(34,`
        `),x(35,ni,3,1)),i&2){let t=a();s(),c("isExerciseParticipation",!0)("expandProblemStatement",t.expandProblemStatement()&&!t.isReadOnlyWithShowResult)("collapsed",t.isReadOnlyWithShowResult),s(5),u(t.textExercise!=null&&t.textExercise.teamMode&&t.isActive?6:-1),s(5),c("hidden",t.submission&&!t.submission.submitted&&t.isExamSummary())("translateValues",X(13,ge,t.wordCount)),s(3),c("hidden",t.submission&&!t.submission.submitted&&t.isExamSummary())("translateValues",X(15,ge,t.characterCount)),s(4),u(t.result&&!t.isAutomaticResult||t.isReadOnlyWithShowResult?19:18),s(2),u(t.textExercise&&t.result&&t.participation&&!t.examMode&&!t.isAutomaticResult?20:-1),s(5),c("icon",t.farListAlt),s(6),u(t.textExercise.problemStatement?31:-1),s(4),u(!t.textExercise.exerciseGroup&&(!(t.irisSettings==null||t.irisSettings.irisTextExerciseChatSettings==null)&&t.irisSettings.irisTextExerciseChatSettings.enabled)?35:-1)}}var kn=(()=>{class i{route=h(ft);textSubmissionService=h(ae);textService=h(xe);alertService=h(Ht);participationWebsocketService=h(Gt);stringCountService=h(ce);accountService=h(Bt);profileService=h(Lt);irisSettingsService=h(oe);translateService=h(L);ButtonType=$t;MAX_CHARACTER_COUNT=3e4;Result=ne;hasExerciseDueDatePassed=K;ChatServiceMode=be;isAthenaAIResult=ie;participationId=E();displayHeader=E(!0);expandProblemStatement=E(!0);inputExercise=E();inputSubmission=E();inputParticipation=E();isExamSummary=E(!1);textExercise;participation;result;resultWithComplaint;submission;course;isSaving=!1;textEditorInput=new j;textEditorInputObservable=this.textEditorInput.asObservable();submissionChange=new j;submissionObservable=this.buildSubmissionObservable();isAlwaysActive;isAllowedToSubmitAfterDueDate;answer;isAfterAssessmentDueDate;examMode=!1;isGeneratingFeedback=!1;irisSettings;isAfterPublishDate;isOwnerOfParticipation;isReadOnlyWithShowResult=!1;farListAlt=Jt;faChevronDown=It;faCircleNotch=kt;faTimeline=Rt;faEye=wt;onTextEditorTab=Kt;participationUpdateListener;sortedHistoryResults;hasAthenaResultForLatestSubmission=!1;showHistory=!1;submissionId;ngOnInit(){if(this.inputValuesArePresent())this.setupComponentWithInputValues();else{let t=this.participationId()!==void 0?this.participationId():Number(this.route.snapshot.paramMap.get("participationId"));if(this.submissionId=Number(this.route.snapshot.paramMap.get("submissionId"))||void 0,Number.isNaN(t))return this.alertService.error("artemisApp.textExercise.error");this.route.params?.subscribe(()=>{this.submissionId=Number(this.route.snapshot.paramMap.get("submissionId"))||void 0,this.updateParticipation(this.participation,this.submissionId)}),this.textService.get(t).subscribe({next:n=>this.updateParticipation(n,this.submissionId),error:n=>jt(this.alertService,n)}),this.isReadOnlyWithShowResult=!!this.submissionId}this.participationUpdateListener?.unsubscribe(),this.participationUpdateListener=this.participationWebsocketService.subscribeForParticipationChanges().pipe(ot(1)).subscribe(t=>{let n=t.results;n&&((n?.length||0)>(this.participation?.results?.length||0)||n?.last()?.completionDate===void 0)&&n?.last()?.assessmentType===H.AUTOMATIC_ATHENA&&n.last()?.successful!==void 0&&(this.isGeneratingFeedback=!1,n.last()?.successful===!1?this.alertService.error("artemisApp.exercise.athenaFeedbackFailed"):(this.alertService.success("artemisApp.exercise.athenaFeedbackSuccessful"),this.hasAthenaResultForLatestSubmission=!0)),this.updateParticipation(this.participation)}),this.profileService.getProfileInfo().subscribe(t=>{t?.activeProfiles?.includes(Wt)&&!this.examMode&&this.route.params.subscribe(n=>{this.irisSettingsService.getCombinedExerciseSettings(n.exerciseId).subscribe(o=>{this.irisSettings=o})})})}inputValuesArePresent(){return!!(this.inputExercise()||this.inputSubmission()||this.inputParticipation())}setupComponentWithInputValues(){this.inputExercise()!==void 0&&(this.textExercise=this.inputExercise()),this.inputSubmission()!==void 0&&(this.submission=this.inputSubmission()),this.inputParticipation()!==void 0&&(this.participation=this.inputParticipation()),this.submission?.text&&(this.answer=this.submission.text)}updateParticipation(t,n=void 0){if(t)this.participation=t;else return;if(this.textExercise=this.participation.exercise,this.examMode=!!this.textExercise.exerciseGroup,this.textExercise.studentParticipations=[this.participation],this.checkIfSubmitAlwaysEnabled(),this.isAfterAssessmentDueDate=!!this.textExercise.course&&(!this.textExercise.assessmentDueDate||M().isAfter(this.textExercise.assessmentDueDate)),this.isAfterPublishDate=!!this.textExercise.exerciseGroup?.exam?.publishResultsDate&&M().isAfter(this.textExercise.exerciseGroup.exam.publishResultsDate),this.course=Dt(this.textExercise),this.participation.results?.length&&(this.participation.results=this.participation.results.map(o=>(o.participation=this.participation,o)),this.sortedHistoryResults=this.participation.results.sort((o,p)=>(o.id??0)-(p.id??0))),this.participation.submissions?.length){if(n){let o=this.participation.submissions.find(p=>p.id===n);o?this.submission=o:this.submission=this.participation.submissions.sort((p,k)=>(p.id??0)-(k.id??0)).last()}else this.submission=this.participation.submissions.sort((o,p)=>(o.id??0)-(p.id??0)).last();D(this.submission,O(this.submission)),this.participation.results&&(this.submission?.results?(this.result=this.submission.latestResult,this.hasAthenaResultForLatestSubmission=this.submission.latestResult.assessmentType===H.AUTOMATIC_ATHENA):this.result=this.sortedHistoryResults.last(),this.result.participation=this.participation),this.resultWithComplaint=Vt(this.submission),this.submission?.text?this.answer=this.submission.text:this.answer=""}this.isOwnerOfParticipation=this.accountService.isOwnerOfParticipation(this.participation)}ngOnDestroy(){if(!this.canDeactivate()&&this.textExercise.id){let t=new le;this.submission&&(t=this.submission),t.text=this.answer,this.submission.id&&this.textSubmissionService.update(t,this.textExercise.id).subscribe(n=>{this.submission=n.body,D(this.submission,O(this.submission)),this.submission.participation.submissions=[this.submission],this.participationWebsocketService.addParticipation(this.submission.participation,this.textExercise)})}this.participationUpdateListener?.unsubscribe(),this.participation&&this.participationWebsocketService.unsubscribeForLatestResultOfParticipation(this.participation.id,this.textExercise)}checkIfSubmitAlwaysEnabled(){let t=this.textExercise.dueDate&&this.participation.initializationDate&&M(this.participation.initializationDate).isAfter(this.textExercise.dueDate),n=!this.result&&(!this.textExercise.dueDate||t);this.isAllowedToSubmitAfterDueDate=!!t&&!M().isAfter(this.participation.individualDueDate),this.isAlwaysActive=!!n}get isAutomaticResult(){return this.result?.assessmentType===H.AUTOMATIC_ATHENA}get isActive(){return!!(!this.examMode&&(!this.result||this.isAutomaticResult)&&(this.isAlwaysActive||this.textExercise&&this.textExercise.dueDate&&!K(this.textExercise,this.participation)))}get submitButtonTooltip(){return this.isAllowedToSubmitAfterDueDate?"entity.action.submitDueDateMissedTooltip":this.isActive&&!this.textExercise.dueDate?"entity.action.submitNoDueDateTooltip":this.isActive?"entity.action.submitTooltip":"entity.action.dueDateMissedTooltip"}get unreferencedFeedback(){return this.result?ee(this.result.feedbacks):void 0}get wordCount(){return this.stringCountService.countWords(this.answer)}get characterCount(){return this.stringCountService.countCharacters(this.answer)}canDeactivate(){return this.submission?this.submission.text===this.answer:!0}unloadNotification(t){return this.canDeactivate()?!0:(t.preventDefault(),this.translateService.instant("pendingChanges"))}submit(){if(this.isSaving||!this.submission)return;this.isSaving=!0,this.submission=this.submissionForAnswer(this.answer);let t=this.submission;this.hasAthenaResultForLatestSubmission?(t.id=void 0,t.results=void 0):D(t,O(this.submission)),this.textSubmissionService.update(t,this.textExercise.id).subscribe({next:n=>{if(this.submission=n.body,this.participation.team){let p=this.submission.participation;p.team=this.participation.team}D(this.submission,O(this.submission)),this.submissionChange.next(this.submission),this.submission.participation.submissions=[this.submission];let o=this.participation.results;this.participation=this.submission.participation,this.participation.results=o,this.participation.exercise=this.textExercise,this.participationWebsocketService.addParticipation(this.participation,this.textExercise),this.textExercise.studentParticipations=[this.participation],this.result=O(this.submission),this.result&&(this.result.participation=this.participation),this.isSaving=!1,this.isAllowedToSubmitAfterDueDate?this.alertService.warning("entity.action.submitDueDateMissedAlert"):(this.alertService.success("entity.action.submitSuccessfulAlert"),this.hasAthenaResultForLatestSubmission=!1)},error:n=>{this.alertService.error(n.error.message),this.isSaving=!1}})}buildSubmissionObservable(){let t=this.textEditorInput.asObservable().pipe(nt(2e3),st()).pipe(et(o=>this.submissionForAnswer(o))),n=this.submissionChange.asObservable();return it(t,n)}submissionForAnswer(t){return tt(Z({},this.submission),{text:t,language:this.textService.predictLanguage(t)})}onReceiveSubmissionFromTeam(t){t.participation.exercise=this.textExercise,t.participation.submissions=[t];let n=t.participation;n.team=this.participation.team,this.updateParticipation(n)}onTextEditorInput(t){this.textEditorInput.next(t.target.value)}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=B({type:i,selectors:[["jhi-text-editor"]],hostBindings:function(n,o){n&1&&y("beforeunload",function(k){return o.unloadNotification(k)},!1,at)},inputs:{participationId:[1,"participationId"],displayHeader:[1,"displayHeader"],expandProblemStatement:[1,"expandProblemStatement"],inputExercise:[1,"inputExercise"],inputSubmission:[1,"inputSubmission"],inputParticipation:[1,"inputParticipation"],isExamSummary:[1,"isExamSummary"]},features:[ut([Nt])],decls:10,vars:4,consts:[["textEditor",""],[3,"id"],[1,"mb-2"],[1,"d-block","mb-4",3,"exercise","participation"],["pagetitle",""],[1,"font-weight-normal"],["submitbutton","",1,"btn-group","gap-1"],["id","toggleTimeline",3,"click","icon","title"],["id","Continue",3,"title","routerLink"],[3,"generatingFeedback","exercise","pendingChanges","hasAthenaResultForLatestSubmission","isGeneratingFeedback","isSubmitted"],["id","submit",3,"onClick","title","disabled","isLoading","btnType","tooltip"],["id","result-history",1,"row","mb-2"],[3,"results","exercise","selectedResultId"],[3,"isExerciseParticipation","expandProblemStatement","collapsed"],["left-body","",1,"text-editor-grid","ps-2","pb-2","w-100"],[1,"grid-area-main"],["id","word-count","jhiTranslate","artemisApp.textExercise.wordCount",1,"badge","bg-primary","mb-2",3,"hidden","translateValues"],["id","character-count","jhiTranslate","artemisApp.textExercise.characterCount",1,"badge","bg-primary","mb-2",3,"hidden","translateValues"],["right-header","",3,"icon"],["id","problem-statement","right-header","","jhiTranslate","artemisApp.exercise.problemStatement"],["right-body",""],[1,"grid-area-team-info","pb-4","ps-md-2"],[3,"exercise","participation","typing$","dockedToRightSide"],["id","text-editor",1,"text-editor-textarea",3,"ngModelChange","keydown.tab","input","maxLength","ngModel","readOnly","disabled","hidden"],[3,"receiveSubmission","exerciseType","submissionObservable","participation"],[1,"row"],[1,"col-md-12","col-lg-10","col-xl-8"],[3,"jhiTranslate"],[3,"result","course"],[1,"badge","bg-warning"],[1,"col-xl-8","alert","unreferencedFeedback",3,"feedback","additional","course"],[1,"col-md-12","col-lg-10","col-xl-8","mt-2","alert","alert-info",3,"result"],[3,"exercise","result","participation"],[1,"markdown-preview","mb-3"],[3,"innerHTML"],[3,"mode"]],template:function(n,o){n&1&&(l(0,"div",1),e(1,`
    `),x(2,Ge,15,7),l(3,"div",2),e(4,`
        `),x(5,$e,2,1),d(),e(6,`

    `),e(7,`
    `),x(8,si,36,17),d(),e(9,`
`)),n&2&&(c("id","exercise-"+(o.textExercise==null?null:o.textExercise.id)),s(2),u(o.displayHeader()?2:-1),s(3),u(o.isReadOnlyWithShowResult?5:-1),s(3),u(o.textExercise?8:-1))},dependencies:[de,zt,_t,re,he,fe,me,Ut,gt,Ct,vt,Tt,ue,Te,_e,pe,Ce,N,ve,ht,V,se],styles:['.text-editor-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;grid-template-areas:"problem-statement" "team-info" "main"}@media (min-width: 768px){.text-editor-grid[_ngcontent-%COMP%]{grid-template-columns:1fr min-content;grid-template-areas:"problem-statement team-info" "main              team-info"}}.text-editor-grid[_ngcontent-%COMP%]   .grid-area-problem-statement[_ngcontent-%COMP%]{grid-area:problem-statement}.text-editor-grid[_ngcontent-%COMP%]   .grid-area-team-info[_ngcontent-%COMP%]{justify-self:flex-start}.text-editor-grid[_ngcontent-%COMP%]   .grid-area-main[_ngcontent-%COMP%]{grid-area:main}.text-editor-textarea[_ngcontent-%COMP%]{width:100%;max-width:750px;height:50vh;padding:10px 12px;border:1px solid var(--text-editor-border-color);border-radius:2px;background-color:var(--text-editor-background);color:var(--text-editor-color)}.text-editor-textarea[_ngcontent-%COMP%]:focus{outline:none;border:1px solid var(--artemis-dark);background-color:var(--text-editor-focus-background);box-shadow:0 0 20px #0000c80a}div.positive-feedback[_ngcontent-%COMP%]{color:var(--textblock-assessment-text-feedback-positive-color);background-color:var(--textblock-assessment-text-feedback-positive-background)}div.negative-feedback[_ngcontent-%COMP%]{color:var(--textblock-assessment-text-feedback-negative-color);background-color:var(--textblock-assessment-text-feedback-negative-background)}div.neutral-feedback[_ngcontent-%COMP%]{color:var(--textblock-assessment-text-feedback-neutral-color);background-color:var(--textblock-assessment-text-feedback-neutral-background)}div.missed-feedback[_ngcontent-%COMP%]{color:var(--textblock-assessment-text-feedback-neutral-color);background-color:#add8e6}']})}return i})();export{kn as a};
//# sourceMappingURL=chunk-GAL3C3KF.js.map
