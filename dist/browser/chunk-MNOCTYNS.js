import{a as H,b as K}from"./chunk-E7BX3X6N.js";import{c as x}from"./chunk-OPXCTAUV.js";import{q as M}from"./chunk-DOLVNMRR.js";import{a as R}from"./chunk-OTCBNILH.js";import{a as L,b as w}from"./chunk-O26CMRR4.js";import{c as p}from"./chunk-5MVJAZRV.js";import{c as D}from"./chunk-JXJXC4DZ.js";import{Bb as A,Da as b,Qa as F,f as T,fa as z,jd as B}from"./chunk-Z4VHWOB5.js";import{f as v,h as y}from"./chunk-M6Z6DKZQ.js";import{c as I}from"./chunk-E2KBL4LX.js";import{Bb as h,Ea as r,F as u,Mc as S,Qa as f,Tb as C,Xb as g,z as l}from"./chunk-5LC5EQRR.js";import{a as d,b as m}from"./chunk-3E746U5Y.js";var Z=(()=>{class s extends H{router=r(y);activatedRoute=r(v);standardizedCompetencyService=r(K);alertService=r(D);translateService=r(I);sortService=r(R);selectedCompetencies=[];selectedCompetency;sourceString="";courseId;sources=[];isLoading=!1;isSubmitted=!1;getIcon=M;ButtonType=L;ButtonSize=w;documentationType="StandardizedCompetencies";faBan=z;faFileImport=b;faMinimize=T;faMaximize=B;faTrash=A;faSort=F;ngOnInit(){this.isLoading=!0;let e=this.standardizedCompetencyService.getAllForTreeView(),o=this.standardizedCompetencyService.getSources();u([e,o]).subscribe({next:([t,n])=>{let c=t.body.map(i=>this.convertToKnowledgeAreaForImport(i));this.dataSource.data=c,this.treeControl.dataNodes=c,c.forEach(i=>{this.addSelfAndDescendantsToMap(i),this.addSelfAndDescendantsToSelectArray(i)}),this.sources=n.body},error:t=>p(this.alertService,t),complete:()=>{this.isLoading=!1}}),this.courseId=Number(this.activatedRoute.snapshot.paramMap.get("courseId"))}openCompetencyDetails(e){let o=this.sources.find(t=>t.id===e.sourceId);this.sourceString=o?x(o):"",this.selectedCompetency=e}closeCompetencyDetails(){this.sourceString="",this.selectedCompetency=void 0}toggleSelect(e){e.selected?this.selectedCompetencies.push(e):this.selectedCompetencies=this.selectedCompetencies.filter(o=>o.id!==e.id)}deselectCompetency(e){e.selected=!1,e.id&&(this.selectedCompetencies=this.selectedCompetencies.filter(o=>o.id!==e.id))}importCompetencies(e){if(!this.selectedCompetencies.length)return;let o=this.selectedCompetencies.map(t=>t.id);this.isLoading=!0,e.importStandardizedCompetencies(o,this.courseId).pipe(l(t=>t.body.length)).subscribe({next:t=>{this.isSubmitted=!0,this.alertService.success("artemisApp.standardizedCompetency.courseImport.success",{count:t}),this.router.navigate(["../"],{relativeTo:this.activatedRoute})},error:t=>p(this.alertService,t),complete:()=>{this.isLoading=!1}})}cancel(){this.router.navigate(["../"],{relativeTo:this.activatedRoute})}sortSelected(e){this.selectedCompetencies=this.sortService.sortByProperty(this.selectedCompetencies,e.predicate,e.ascending)}canDeactivate(){return this.isSubmitted||!this.isLoading&&this.selectedCompetencies.length===0}get canDeactivateWarning(){return this.translateService.instant("pendingChanges")}convertToKnowledgeAreaForImport(e,o=!0,t=0,n=!1){let a=e.children?.map(i=>this.convertToKnowledgeAreaForImport(i,o,t+1)),c=e.competencies?.map(i=>this.convertToStandardizedCompetencyForImport(i,e.title,o,n));return m(d({},e),{children:a,competencies:c,level:t,isVisible:o})}convertToStandardizedCompetencyForImport(e,o,t=!0,n=!1){return m(d({},e),{isVisible:t,knowledgeAreaTitle:o,selected:n})}unloadNotification(e){return this.canDeactivate()?!0:(e.preventDefault(),this.canDeactivateWarning)}static \u0275fac=(()=>{let e;return function(t){return(e||(e=f(s)))(t||s)}})();static \u0275cmp=C({type:s,selectors:[["ng-component"]],hostBindings:function(o,t){o&1&&S("beforeunload",function(a){return t.unloadNotification(a)},!1,h)},features:[g],decls:0,vars:0,template:function(o,t){},encapsulation:2})}return s})();export{Z as a};
//# sourceMappingURL=chunk-MNOCTYNS.js.map
