import{a as nt}from"./chunk-HSP5ZR73.js";import{a as st}from"./chunk-LXDP326M.js";import{g as at}from"./chunk-VJKFYSDP.js";import{a as rt}from"./chunk-5FAM7LIP.js";import{c as it}from"./chunk-CCVWGTN5.js";import{a as ot,e as Ce}from"./chunk-FAFORKWV.js";import{d as tt}from"./chunk-RNPAFOPW.js";import{o as Qe,s as Xe}from"./chunk-VZRSC3LP.js";import{j as y}from"./chunk-5GXY5RYT.js";import{a as et}from"./chunk-K3W6YFKH.js";import{d as $}from"./chunk-EDXSOKK5.js";import{p as $e}from"./chunk-DID2YGL7.js";import{c as R,j as Ke}from"./chunk-CXQURQM5.js";import{Bc as Ye,P as qe,pa as Je,wd as Ze}from"./chunk-Z4VHWOB5.js";import{a as me}from"./chunk-U54OSGNH.js";import{n as ce}from"./chunk-IOA4DPXY.js";import{Db as u,Dc as J,Ea as A,La as H,Ma as W,Mc as L,Na as U,Oc as b,Rc as re,Tb as V,Va as Oe,Vb as Ae,Yc as Be,Za as q,Zb as j,Zc as Ne,_a as Le,_c as Re,dd as o,ed as ae,f as se,kc as F,mc as oe,rd as Ge,sc as x,sd as le,uc as He,vc as Ve,wb as Ie,wc as De,xc as f,yc as h,yd as We,zc as C,zd as Ue}from"./chunk-5LC5EQRR.js";var T=typeof window<"u"?window:null,ye=T===null,Z=ye?void 0:T.document,k="addEventListener",z="removeEventListener",Fe="getBoundingClientRect",Y="_a",P="_b",I="_c",de="horizontal",O=function(){return!1},Et=ye?"calc":["","-webkit-","-moz-","-o-"].filter(function(n){var a=Z.createElement("div");return a.style.cssText="width:"+n+"calc(9px)",!!a.style.length}).shift()+"calc",ct=function(n){return typeof n=="string"||n instanceof String},lt=function(n){if(ct(n)){var a=Z.querySelector(n);if(!a)throw new Error("Selector "+n+" did not match a DOM element");return a}return n},_=function(n,a,e){var t=n[a];return t!==void 0?t:e},ue=function(n,a,e,t){if(a){if(t==="end")return 0;if(t==="center")return n/2}else if(e){if(t==="start")return 0;if(t==="center")return n/2}return n},Mt=function(n,a){var e=Z.createElement("div");return e.className="gutter gutter-"+a,e},jt=function(n,a,e){var t={};return ct(a)?t[n]=a:t[n]=Et+"("+a+"% - "+e+"px)",t},Tt=function(n,a){var e;return e={},e[n]=a+"px",e},kt=function(n,a){if(a===void 0&&(a={}),ye)return{};var e=n,t,i,c,d,p,g;Array.from&&(e=Array.from(e));var D=lt(e[0]),v=D.parentNode,E=getComputedStyle?getComputedStyle(v):null,Ee=E?E.flexDirection:null,he=_(a,"sizes")||e.map(function(){return 100/e.length}),ge=_(a,"minSize",100),Se=Array.isArray(ge)?ge:e.map(function(){return ge}),be=_(a,"maxSize",1/0),ft=Array.isArray(be)?be:e.map(function(){return be}),ht=_(a,"expandToMin",!1),Q=_(a,"gutterSize",10),ee=_(a,"gutterAlign","center"),ve=_(a,"snapOffset",30),gt=Array.isArray(ve)?ve:e.map(function(){return ve}),xe=_(a,"dragInterval",1),G=_(a,"direction",de),we=_(a,"cursor",G===de?"col-resize":"row-resize"),St=_(a,"gutter",Mt),Me=_(a,"elementStyle",jt),bt=_(a,"gutterStyle",Tt);G===de?(t="width",i="clientX",c="left",d="right",p="clientWidth"):G==="vertical"&&(t="height",i="clientY",c="top",d="bottom",p="clientHeight");function X(l,s,r,m){var w=Me(t,s,r,m);Object.keys(w).forEach(function(S){l.style[S]=w[S]})}function vt(l,s,r){var m=bt(t,s,r);Object.keys(m).forEach(function(w){l.style[w]=m[w]})}function te(){return g.map(function(l){return l.size})}function je(l){return"touches"in l?l.touches[0][i]:l[i]}function Te(l){var s=g[this.a],r=g[this.b],m=s.size+r.size;s.size=l/this.size*m,r.size=m-l/this.size*m,X(s.element,s.size,this[P],s.i),X(r.element,r.size,this[I],r.i)}function xt(l){var s,r=g[this.a],m=g[this.b];this.dragging&&(s=je(l)-this.start+(this[P]-this.dragOffset),xe>1&&(s=Math.round(s/xe)*xe),s<=r.minSize+r.snapOffset+this[P]?s=r.minSize+this[P]:s>=this.size-(m.minSize+m.snapOffset+this[I])&&(s=this.size-(m.minSize+this[I])),s>=r.maxSize-r.snapOffset+this[P]?s=r.maxSize+this[P]:s<=this.size-(m.maxSize-m.snapOffset+this[I])&&(s=this.size-(m.maxSize+this[I])),Te.call(this,s),_(a,"onDrag",O)(te()))}function ke(){var l=g[this.a].element,s=g[this.b].element,r=l[Fe](),m=s[Fe]();this.size=r[t]+m[t]+this[P]+this[I],this.start=r[c],this.end=r[d]}function wt(l){if(!getComputedStyle)return null;var s=getComputedStyle(l);if(!s)return null;var r=l[p];return r===0?null:(G===de?r-=parseFloat(s.paddingLeft)+parseFloat(s.paddingRight):r-=parseFloat(s.paddingTop)+parseFloat(s.paddingBottom),r)}function ze(l){var s=wt(v);if(s===null||Se.reduce(function(S,M){return S+M},0)>s)return l;var r=0,m=[],w=l.map(function(S,M){var N=s*S/100,ie=ue(Q,M===0,M===l.length-1,ee),ne=Se[M]+ie;return N<ne?(r+=ne-N,m.push(0),ne):(m.push(N-ne),N)});return r===0?l:w.map(function(S,M){var N=S;if(r>0&&m[M]-r>0){var ie=Math.min(r,m[M]-r);r-=ie,N=S-ie}return N/s*100})}function Ct(){var l=this,s=g[l.a].element,r=g[l.b].element;l.dragging&&_(a,"onDragEnd",O)(te()),l.dragging=!1,T[z]("mouseup",l.stop),T[z]("touchend",l.stop),T[z]("touchcancel",l.stop),T[z]("mousemove",l.move),T[z]("touchmove",l.move),l.stop=null,l.move=null,s[z]("selectstart",O),s[z]("dragstart",O),r[z]("selectstart",O),r[z]("dragstart",O),s.style.userSelect="",s.style.webkitUserSelect="",s.style.MozUserSelect="",s.style.pointerEvents="",r.style.userSelect="",r.style.webkitUserSelect="",r.style.MozUserSelect="",r.style.pointerEvents="",l.gutter.style.cursor="",l.parent.style.cursor="",Z.body.style.cursor=""}function Ft(l){if(!("button"in l&&l.button!==0)){var s=this,r=g[s.a].element,m=g[s.b].element;s.dragging||_(a,"onDragStart",O)(te()),l.preventDefault(),s.dragging=!0,s.move=xt.bind(s),s.stop=Ct.bind(s),T[k]("mouseup",s.stop),T[k]("touchend",s.stop),T[k]("touchcancel",s.stop),T[k]("mousemove",s.move),T[k]("touchmove",s.move),r[k]("selectstart",O),r[k]("dragstart",O),m[k]("selectstart",O),m[k]("dragstart",O),r.style.userSelect="none",r.style.webkitUserSelect="none",r.style.MozUserSelect="none",r.style.pointerEvents="none",m.style.userSelect="none",m.style.webkitUserSelect="none",m.style.MozUserSelect="none",m.style.pointerEvents="none",s.gutter.style.cursor=we,s.parent.style.cursor=we,Z.body.style.cursor=we,ke.call(s),s.dragOffset=je(l)-s.end}}he=ze(he);var B=[];g=e.map(function(l,s){var r={element:lt(l),size:he[s],minSize:Se[s],maxSize:ft[s],snapOffset:gt[s],i:s},m;if(s>0&&(m={a:s-1,b:s,dragging:!1,direction:G,parent:v},m[P]=ue(Q,s-1===0,!1,ee),m[I]=ue(Q,!1,s===e.length-1,ee),Ee==="row-reverse"||Ee==="column-reverse")){var w=m.a;m.a=m.b,m.b=w}if(s>0){var S=St(s,G,r.element);vt(S,Q,s),m[Y]=Ft.bind(m),S[k]("mousedown",m[Y]),S[k]("touchstart",m[Y]),v.insertBefore(S,r.element),m.gutter=S}return X(r.element,r.size,ue(Q,s===0,s===e.length-1,ee),s),s>0&&B.push(m),r});function Pe(l){var s=l.i===B.length,r=s?B[l.i-1]:B[l.i];ke.call(r);var m=s?r.size-l.minSize-r[I]:l.minSize+r[P];Te.call(r,m)}g.forEach(function(l){var s=l.element[Fe]()[t];s<l.minSize&&(ht?Pe(l):l.minSize=s)});function yt(l){var s=ze(l);s.forEach(function(r,m){if(m>0){var w=B[m-1],S=g[w.a],M=g[w.b];S.size=s[m-1],M.size=r,X(S.element,S.size,w[P],S.i),X(M.element,M.size,w[I],M.i)}})}function _t(l,s){B.forEach(function(r){if(s!==!0?r.parent.removeChild(r.gutter):(r.gutter[z]("mousedown",r[Y]),r.gutter[z]("touchstart",r[Y])),l!==!0){var m=Me(t,r.a.size,r[P]);Object.keys(m).forEach(function(w){g[r.a].element.style[w]="",g[r.b].element.style[w]=""})}})}return{setSizes:yt,getSizes:te,collapse:function(s){Pe(g[s])},destroy:_t,parent:v,pairs:B}},mt=kt;var pe=class{from;to;constructor(a,e){this.from=a,this.to=e}};var K=class{start;length;constructor(a,e){this.start=a,this.length=e}};var Pt=(n,a)=>({active:n,clickable:a}),Ot=n=>({hover:n});function Lt(n,a){if(n&1&&(o(0,`
            `),f(1,"div",2),o(2,`
                `),C(3,"fa-icon",3),o(4,`
                `),f(5,"span",4),o(6),h(),o(7,`
            `),h(),o(8,`
        `)),n&2){let e=b();u(3),F("icon",e.faChevronDown),u(3),ae(e.getActiveFile())}}function It(n,a){if(n&1){let e=J();o(0,`
                `),f(1,"li",6),L("mouseenter",function(){let i=W(e),c=i.$implicit,d=i.$index,p=b(2);return U(p.triggerMouseEnter(c,d))})("click",function(){let i=W(e),c=i.$implicit,d=i.$index,p=b(2);return U(p.handleFileSelect(c,d,!0))}),o(2,`
                    `),f(3,"span"),o(4),h(),o(5,`
                `),h(),o(6,`
            `)}if(n&2){let e=a.$implicit,t=a.$index,i=b(2);u(),F("ngClass",Ge(4,Ot,t===i.hoveredFileIndex)),u(2),oe("split-pane-header-file-with-match",e.hasMatch),u(),ae(e.file)}}function At(n,a){n&1&&(o(0,`
                `),C(1,"li",7),o(2,`
            `))}function Ht(n,a){if(n&1){let e=J();o(0,`
        `),f(1,"ul",5),L("mouseleave",function(){W(e);let i=b();return U(i.toggleShowFiles(!0,!1))}),o(2,`
            `),Ve(3,It,7,6,null,null,He),j(5,At,3,0),h(),o(6,`
    `)}if(n&2){let e=b();u(3),De(e.files),u(2),x(e.hasFiles()?-1:5)}}var fe=(()=>{class n{files;studentLogin;fileSelectedSubject=q();isLockFilesEnabled=q();showFilesSubject=q();dropdownHoverSubject=q();selectFile=new Oe;showFiles=!1;activeFileIndex=0;fileSelectSubscription;showFilesSubscription;dropdownHoverSubscription;faChevronDown=Ye;hoveredFileIndex;ngOnInit(){this.subscribeToFileSelection(),this.subscribeToShowFiles(),this.subscribeToDropdownHover()}subscribeToFileSelection(){this.fileSelectSubscription=this.fileSelectedSubject().subscribe(e=>{this.isLockFilesEnabled()&&this.handleLockedFileSelection(e.file,e.idx)})}handleLockedFileSelection(e,t){let i=this.files[t]?.file===e.file?t:this.getIndexOf(e);i>=0?this.handleFileSelect(e,i,!1):this.showFiles=!1}subscribeToShowFiles(){this.showFilesSubscription=this.showFilesSubject()?.subscribe(e=>{(this.isLockFilesEnabled()||!this.isLockFilesEnabled()&&!e)&&this.toggleShowFiles(!1,e)})}subscribeToDropdownHover(){this.dropdownHoverSubscription=this.dropdownHoverSubject()?.subscribe(e=>{this.isLockFilesEnabled()&&this.handleDropdownHover(e.file,e.idx)})}handleDropdownHover(e,t){let i=this.files[t]?.file===e.file?t:this.getIndexOf(e);this.hoveredFileIndex=i>=0?i:-1}ngOnChanges(e){if(e.files){let t=e.files.currentValue;this.activeFileIndex=0,this.hasFiles()&&this.selectFile.emit(t[0].file)}}ngOnDestroy(){this.fileSelectSubscription?.unsubscribe(),this.showFilesSubscription?.unsubscribe(),this.dropdownHoverSubscription?.unsubscribe()}hasActiveFile(){return this.hasFiles()&&this.activeFileIndex<this.files.length}getActiveFile(){return this.files[this.activeFileIndex].file}handleFileSelect(e,t,i){i&&(this.fileSelectedSubject().next({idx:t,file:e}),e.hasMatch=!0),this.activeFileIndex=t,this.showFiles=!1,this.selectFile.emit(e.file)}hasFiles(){return!!this.files?.length}toggleShowFiles(e,t){this.hasFiles()&&(this.showFiles=t!==void 0?t:!this.showFiles,e&&this.showFilesSubject().next(this.showFiles))}triggerMouseEnter(e,t){let i=this.dropdownHoverSubject();i&&i.next({idx:t,file:e})}getIndexOf(e){return this.files.findIndex(t=>t.file===e.file)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=V({type:n,selectors:[["jhi-split-pane-header"]],inputs:{files:"files",studentLogin:"studentLogin",fileSelectedSubject:[1,"fileSelectedSubject"],isLockFilesEnabled:[1,"isLockFilesEnabled"],showFilesSubject:[1,"showFilesSubject"],dropdownHoverSubject:[1,"dropdownHoverSubject"]},outputs:{selectFile:"selectFile"},features:[H],decls:12,vars:9,consts:[["ngbDropdown","",1,"split-pane-header"],["data-toggle","dropdown",1,"split-pane-header-top",3,"click","ngClass"],[1,"split-pane-header-file-name"],[1,"file-arrow-down",3,"icon"],[1,"split-pane-header-selected-file"],[1,"split-pane-header-files",3,"mouseleave"],["ngbDropdownItem","",1,"split-pane-header-file",3,"mouseenter","click","ngClass"],["jhiTranslate","artemisApp.plagiarism.noFilesFound"]],template:function(t,i){t&1&&(f(0,"div",0),o(1,`
    `),f(2,"div",1),L("click",function(){return i.toggleShowFiles(!0)}),o(3,`
        `),j(4,Lt,9,2),f(5,"div"),o(6),We(7,"artemisTranslate"),h(),o(8,`
    `),h(),o(9,`
    `),j(10,Ht,7,1),h(),o(11,`
`)),t&2&&(u(2),F("ngClass",le(6,Pt,i.showFiles,i.hasFiles())),u(2),x(i.hasActiveFile()?4:-1),u(2),ae(i.studentLogin||Ue(7,4,"artemisApp.plagiarism.unknownStudent")),u(4),x(i.showFiles?10:-1))},dependencies:[Xe,ce,$,Qe,me,et],styles:[".split-pane-header[_ngcontent-%COMP%]{z-index:1;position:absolute;top:0;left:0;width:100%;background-color:var(--bs-body-bg);border-bottom:1px solid var(--body-bg)}.split-pane-header-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;overflow:hidden;padding:.25rem .5rem}.split-pane-header-top.active[_ngcontent-%COMP%]   .file-arrow-down[_ngcontent-%COMP%]{display:inline-block;transform:rotate(180deg)}.split-pane-header-selected-file[_ngcontent-%COMP%]{margin-left:.5rem;white-space:nowrap;text-overflow:ellipsis}.split-pane-header-file[_ngcontent-%COMP%]{cursor:pointer;padding:.25rem .5rem}.split-pane-header-file[_ngcontent-%COMP%]:hover{background-color:#87cefa}.split-pane-header-file-with-match[_ngcontent-%COMP%]{font-weight:700}.split-pane-header-file-name[_ngcontent-%COMP%]{white-space:nowrap}.split-pane-header-files[_ngcontent-%COMP%]{list-style:none;margin:.5rem 0;padding:0;max-height:300px;overflow:scroll}.dropdown-item.hover[_ngcontent-%COMP%]{background-color:var(--data-table-dropdown-item-selected-background-color)}"]})}return n})();function Vt(n,a){if(n&1&&(o(0,`
    `),C(1,"jhi-modeling-editor",1),o(2,`
`)),n&2){let e=b();u(),F("umlModel",e.submissionModel)("diagramType",e.exercise.diagramType)("readOnly",!0)}}function Dt(n,a){n&1&&(o(0,`
    `),f(1,"div",2),o(2,`
        `),f(3,"div",3),o(4,`
            `),f(5,"span",4),o(6,"Loading..."),h(),o(7,`
        `),h(),o(8,`
    `),h(),o(9,`
`))}var dt=(()=>{class n{modelingSubmissionService=A(st);exercise;plagiarismSubmission;hideContent;loading;submissionModel;ngOnChanges(e){if(e.plagiarismSubmission){let t=e.plagiarismSubmission.currentValue;this.hideContent||(this.loading=!0,this.modelingSubmissionService.getSubmissionWithoutLock(t.submissionId).subscribe({next:i=>{this.loading=!1,this.submissionModel=JSON.parse(i.model)},error:()=>{this.loading=!1}}))}}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=V({type:n,selectors:[["jhi-modeling-submission-viewer"]],inputs:{exercise:"exercise",plagiarismSubmission:"plagiarismSubmission",hideContent:"hideContent"},features:[H],decls:4,vars:3,consts:[[3,"studentLogin"],[3,"umlModel","diagramType","readOnly"],[1,"plagiarism-submission-loader"],["role","status",1,"spinner-border","text-primary"],[1,"sr-only"]],template:function(t,i){t&1&&(C(0,"jhi-split-pane-header",0),o(1,`
`),j(2,Vt,3,3)(3,Dt,10,0)),t&2&&(re("studentLogin",i.plagiarismSubmission==null?null:i.plagiarismSubmission.studentLogin),u(2),x(i.loading?-1:2),u(),x(i.loading?3:-1))},dependencies:[fe,it],styles:["[_nghost-%COMP%]{height:100%}.plagiarism-submission-loader[_ngcontent-%COMP%]{align-items:center;display:flex;height:100%;justify-content:center}"]})}return n})();var Bt=(n,a)=>({"no-file":n,"is-code":a});function Nt(n,a){if(n&1&&(o(0,`
    `),f(1,"div",1),o(2,`
        `),f(3,"div",2),o(4,`
            `),C(5,"fa-icon",3),o(6,`
            `),C(7,"span",4),o(8,`
        `),h(),o(9,`
    `),h(),o(10,`
`)),n&2){let e=b();u(5),F("icon",e.faExclamationTriangle)}}function Rt(n,a){if(n&1&&(o(0,`
    `),f(1,"div",5),o(2,`
        `),C(3,"span",6),o(4,`
    `),h(),o(5,`
`)),n&2){let e=b();u(),F("innerHTML",e.fileContent||" ",Ie)("ngClass",le(2,Bt,!e.fileContent,e.isProgrammingExercise))}}function Gt(n,a){n&1&&(o(0,`
    `),f(1,"div",7),o(2,`
        `),f(3,"div",8),o(4,`
            `),f(5,"span",9),o(6,"Loading..."),h(),o(7,`
        `),h(),o(8,`
    `),h(),o(9,`
`))}function Wt(n,a){if(n&1){let e=J();o(0,`
    `),f(1,"div",10),o(2,`
        `),C(3,"span",11),o(4,`
        `),f(5,"a",12),L("click",function(){W(e);let i=b();return U(i.downloadCurrentFile())}),h(),o(6,`
    `),h(),o(7,`
`)}}var ut=(()=>{class n{repositoryService=A(at);textSubmissionService=A(nt);exercise;matches;plagiarismSubmission;hideContent;fileSelectedSubject;isLockFilesEnabled;showFilesSubject;dropdownHoverSubject;currentFile;fileContent;files;isProgrammingExercise;loading;tokenStart='<span class="plagiarism-match">';tokenEnd="</span>";binaryFile;cannotLoadFiles=!1;faExclamationTriangle=Ze;ngOnChanges(e){if(e.plagiarismSubmission){let t=e.plagiarismSubmission.currentValue;this.hideContent||(this.loading=!0,this.exercise.type===R.PROGRAMMING?this.loadProgrammingExercise(t):this.loadTextExercise(t))}}loadProgrammingExercise(e){let t=[Ce.PARTICIPATION,{id:e.submissionId}];this.repositoryService.getRepositoryContentForPlagiarismView(t).subscribe({next:i=>{this.cannotLoadFiles=!1,this.isProgrammingExercise=!0,this.loading=!1,this.files=this.programmingExerciseFilesWithMatches(i)},error:()=>{this.cannotLoadFiles=!0,this.loading=!1}})}programmingExerciseFilesWithMatches(e){return this.filterFiles(e).map(t=>({file:t,hasMatch:this.hasMatch(t)})).sort(n.compareFileWithHasMatch)}static compareFileWithHasMatch(e,t){return e.hasMatch===t.hasMatch?e.file.localeCompare(t.file):e.hasMatch?-1:1}loadTextExercise(e){this.isProgrammingExercise=!1,this.textSubmissionService.getTextSubmission(e.submissionId).subscribe({next:t=>{this.loading=!1,this.fileContent=this.insertMatchTokens(t.text||"")},error:()=>{this.loading=!1}})}filterFiles(e){return Object.keys(e).filter(t=>e[t]===ot.FILE)}handleFileSelect(e){this.currentFile=e,this.loading=!0;let t=e.split(".").last();if(tt.includes(t)){this.binaryFile=!1;let i=[Ce.PARTICIPATION,{id:this.plagiarismSubmission.submissionId}];this.repositoryService.getFileForPlagiarismView(e,i).subscribe({next:({fileContent:c})=>{this.loading=!1,this.fileContent=this.insertMatchTokens(c)},error:()=>{this.loading=!1}})}else this.binaryFile=!0,this.loading=!1}downloadCurrentFile(){this.repositoryService.downloadFile(this.currentFile,this.exercise.shortName+"_"+this.plagiarismSubmission.studentLogin+"_"+this.currentFile)}getMatchesForCurrentFile(){return this.matches.get(this.currentFile||"none")||[]}hasMatch(e){return this.matches.has(e)}insertMatchTokens(e){let t=this.getMatchesForCurrentFile().filter(i=>i.from&&i.to).sort((i,c)=>{let d=i.from.line-c.from.line;return d===0?i.from.column-c.from.column:d});return t.length?this.exercise?.type===R.PROGRAMMING?this.buildFileContentWithHighlightedMatchesAsWholeLines(e,t):this.buildFileContentWithHighlightedMatches(e,t):y(e)}buildFileContentWithHighlightedMatchesAsWholeLines(e,t){let i=e.split(`
`),c="",d=new Set;for(let p of t)for(let g=p.from.line-1;g<p.to.line;g++)d.add(g);for(let p=0;p<i.length;p++)d.has(p)?c+=this.tokenStart+y(i[p])+this.tokenEnd:c+=y(i[p]),p!=i.length-1&&(c+=`
`);return c}buildFileContentWithHighlightedMatches(e,t){let i=e.split(`
`),c="";if(!(t[0].from.line==1&&t[0].from.column==0)){for(let d=0;d<t[0].from.line-1;d++)c+=y(i[d])+`
`;c+=y(i[t[0].from.line-1].slice(0,t[0].from.column-1))}for(let d=0;d<t.length;d++)c+=this.buildFileContentPartForMatch(t,d,i);return c}buildFileContentPartForMatch(e,t,i){let c=e[t],d=c.from.line-1,p=c.to.line-1,g=c.from.column>0?c.from.column-1:0,D=c.to.column+c.to.length,v=this.tokenStart;if(d===p)v+=y(i[d].slice(g,D))+this.tokenEnd;else{let E=d;for(g>0&&(v+=y(i[d].slice(g)),E+=1);E<p;E++)v.trim()!=this.tokenStart&&(v+=`
`),v+=y(i[E]);v+=`
`+y(i[p].slice(0,D))+this.tokenEnd}if(t===e.length-1){v+=y(i[p].slice(D));for(let E=p+1;E<i.length;E++)v+=`
`+y(i[E])}else if(e[t+1].from.line===c.to.line)v+=y(i[p].slice(D,e[t+1].from.column-1));else{v+=y(i[p].slice(D))+`
`;for(let E=p+1;E<e[t+1].from.line-1;E++)v+=y(i[E])+`
`;v+=y(i[e[t+1].from.line-1].slice(0,e[t+1].from.column-1))}return v}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=V({type:n,selectors:[["jhi-text-submission-viewer"]],inputs:{exercise:"exercise",matches:"matches",plagiarismSubmission:"plagiarismSubmission",hideContent:"hideContent",fileSelectedSubject:"fileSelectedSubject",isLockFilesEnabled:"isLockFilesEnabled",showFilesSubject:"showFilesSubject",dropdownHoverSubject:"dropdownHoverSubject"},features:[H],decls:6,vars:10,consts:[[3,"selectFile","files","isLockFilesEnabled","fileSelectedSubject","showFilesSubject","dropdownHoverSubject","studentLogin"],[1,"text-submission-viewer","text-warning"],[1,"text-submission-viewer-warning"],[1,"icon",3,"icon"],["jhiTranslate","artemisApp.plagiarism.cannotLoadFiles"],[1,"text-submission-viewer",3,"innerHTML","ngClass"],["jhiTranslate","artemisApp.plagiarism.noFileSelected"],[1,"plagiarism-submission-loader"],["role","status",1,"spinner-border","text-primary"],[1,"sr-only"],[1,"binaryFileDialogue"],["jhiTranslate","artemisApp.plagiarism.binaryFileNotRendered",1,"me-1"],["jhiTranslate","entity.action.download",1,"text-primary",3,"click"]],template:function(t,i){t&1&&(f(0,"jhi-split-pane-header",0),L("selectFile",function(d){return i.handleFileSelect(d)}),h(),o(1,`
`),j(2,Nt,11,1)(3,Rt,6,5)(4,Gt,10,0)(5,Wt,8,0)),t&2&&(re("studentLogin",i.plagiarismSubmission==null?null:i.plagiarismSubmission.studentLogin),F("files",i.files)("isLockFilesEnabled",i.isLockFilesEnabled)("fileSelectedSubject",i.fileSelectedSubject)("showFilesSubject",i.showFilesSubject)("dropdownHoverSubject",i.dropdownHoverSubject),u(2),x(i.cannotLoadFiles?2:-1),u(),x(!i.loading&&!i.binaryFile&&!i.cannotLoadFiles?3:-1),u(),x(i.loading&&!i.cannotLoadFiles?4:-1),u(),x(i.binaryFile&&!i.cannotLoadFiles?5:-1))},dependencies:[fe,$,me,ce],styles:[`.text-submission-viewer{height:100%;overflow-y:auto;padding:.5rem;white-space:pre-wrap;word-wrap:normal}.text-submission-viewer.no-file{opacity:.5}.text-submission-viewer.is-code{font-family:monospace;white-space:pre}.text-submission-viewer-warning{display:flex;justify-content:center}.text-submission-viewer-warning .icon{margin-right:.5rem}.plagiarism-match{color:#1e90ff;font-weight:700}.plagiarism-submission-loader{align-items:center;display:flex;height:100%;justify-content:center}.binaryFileDialogue{text-align:center;margin-top:3rem}
`],encapsulation:2})}return n})();function Ut(n,a){if(n&1&&(o(0,`
                `),C(1,"jhi-modeling-submission-viewer",5),o(2,`
            `)),n&2){let e=b(2);u(),F("exercise",e.exercise)("plagiarismSubmission",e.getModelingSubmissionA())("hideContent",!1)}}function $t(n,a){if(n&1&&(o(0,`
                `),C(1,"jhi-text-submission-viewer",6),o(2,`
            `)),n&2){let e=b(2);u(),F("fileSelectedSubject",e.fileSelectedSubject)("exercise",e.exercise)("matches",e.matchesA)("plagiarismSubmission",e.getTextSubmissionA())("isLockFilesEnabled",e.isLockFilesEnabled)("hideContent",!1)("dropdownHoverSubject",e.dropdownHoverSubject)("showFilesSubject",e.showFilesSubject)}}function Qt(n,a){if(n&1&&(o(0,`
            `),j(1,Ut,3,3)(2,$t,3,8)),n&2){let e=b();u(),x(e.isModelingExercise?1:-1),u(),x(e.isProgrammingOrTextExercise?2:-1)}}function Xt(n,a){if(n&1&&(o(0,`
                `),C(1,"jhi-modeling-submission-viewer",5),o(2,`
            `)),n&2){let e=b(2);u(),F("exercise",e.exercise)("plagiarismSubmission",e.getModelingSubmissionB())("hideContent",e.forStudent&&e.dayjs(e.exercise.dueDate).isAfter(e.dayjs()))}}function qt(n,a){if(n&1&&(o(0,`
                `),C(1,"jhi-text-submission-viewer",6),o(2,`
            `)),n&2){let e=b(2);u(),F("fileSelectedSubject",e.fileSelectedSubject)("exercise",e.exercise)("matches",e.matchesB)("plagiarismSubmission",e.getTextSubmissionB())("isLockFilesEnabled",e.isLockFilesEnabled)("hideContent",e.forStudent&&e.dayjs(e.exercise.dueDate).isAfter(e.dayjs()))("dropdownHoverSubject",e.dropdownHoverSubject)("showFilesSubject",e.showFilesSubject)}}function Jt(n,a){if(n&1&&(o(0,`
            `),j(1,Xt,3,3)(2,qt,3,8)),n&2){let e=b();u(),x(e.isModelingExercise?1:-1),u(),x(e.isProgrammingOrTextExercise?2:-1)}}var pt=(()=>{class n{elementRef=A(Le);static \u0275fac=function(t){return new(t||n)};static \u0275dir=Ae({type:n,selectors:[["","jhiPane",""]]})}return n})(),mn=(()=>{class n{plagiarismCasesService=A(rt);comparison;exercise;splitControlSubject;sortByStudentLogin;forStudent;panes;plagiarismComparison;fileSelectedSubject=new se;showFilesSubject=new se;dropdownHoverSubject=new se;split;isModelingExercise;isProgrammingOrTextExercise;matchesA;matchesB;isLockFilesEnabled=!1;dayjs=$e;faLock=qe;faUnlock=Je;ngAfterViewInit(){let e=this.panes.map(t=>t.elementRef.nativeElement);this.split=mt(e,{minSize:100,sizes:[50,50],gutterSize:8})}ngOnInit(){this.splitControlSubject.subscribe(e=>this.handleSplitControl(e))}ngOnChanges(e){if(e.exercise){let t=e.exercise.currentValue;this.isModelingExercise=t.type===R.MODELING,this.isProgrammingOrTextExercise=t.type===R.PROGRAMMING||t.type===R.TEXT}e.comparison&&this.plagiarismCasesService.getPlagiarismComparisonForSplitView(Ke(this.exercise),e.comparison.currentValue.id).subscribe(t=>{this.plagiarismComparison=t.body,this.sortByStudentLogin&&this.sortByStudentLogin===this.plagiarismComparison.submissionB.studentLogin&&this.swapSubmissions(this.plagiarismComparison),this.isProgrammingOrTextExercise&&this.parseTextMatches(this.plagiarismComparison)})}ngOnDestroy(){this.fileSelectedSubject.complete(),this.showFilesSubject.complete(),this.dropdownHoverSubject.complete()}swapSubmissions(e){let t=e.submissionA;e.submissionA=e.submissionB,e.submissionB=t,e?.matches&&e.matches.forEach(i=>{let c=i.startA;i.startA=i.startB,i.startB=c})}parseTextMatches(e){if(e.matches){let t=e.matches.map(c=>new K(c.startA,c.length)).sort((c,d)=>c.start-d.start),i=e.matches.map(c=>new K(c.startB,c.length)).sort((c,d)=>c.start-d.start);this.matchesA=this.mapMatchesToElements(t,e.submissionA),this.matchesB=this.mapMatchesToElements(i,e.submissionB)}else this.matchesA=new Map,this.matchesB=new Map}mapMatchesToElements(e,t){let i=t.elements?.sort((d,p)=>d.id-p.id),c=new Map;return e.forEach(d=>{if(d.length===0)return;let p=i[d.start]?.file||"none";c.has(p)||c.set(p,[]),c.get(p).push(new pe(i[d.start],i[d.start+d.length-1]))}),c}getModelingSubmissionA(){return this.plagiarismComparison.submissionA}getModelingSubmissionB(){return this.plagiarismComparison.submissionB}getTextSubmissionA(){return this.plagiarismComparison.submissionA}getTextSubmissionB(){return this.plagiarismComparison.submissionB}handleSplitControl(e){switch(e){case"left":{this.split.collapse(1);return}case"right":{this.split.collapse(0);return}case"even":this.split.setSizes([50,50])}}toggleLockFiles(){this.isLockFilesEnabled=!this.isLockFilesEnabled}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=V({type:n,selectors:[["jhi-plagiarism-split-view"]],viewQuery:function(t,i){if(t&1&&Be(pt,5),t&2){let c;Ne(c=Re())&&(i.panes=c)}},inputs:{comparison:"comparison",exercise:"exercise",splitControlSubject:"splitControlSubject",sortByStudentLogin:"sortByStudentLogin",forStudent:"forStudent"},features:[H],decls:19,vars:5,consts:[[1,"plagiarism-split-view"],["jhiPane","",1,"plagiarism-split-pane"],[1,"split-pane-header-color"],["data-qa","lock-files-toggle-button",1,"btn","btn-sm",3,"click"],["aria-label","Synchronize files while navigating on both sides",3,"icon"],[3,"exercise","plagiarismSubmission","hideContent"],[3,"fileSelectedSubject","exercise","matches","plagiarismSubmission","isLockFilesEnabled","hideContent","dropdownHoverSubject","showFilesSubject"]],template:function(t,i){t&1&&(f(0,"div",0),o(1,`
    `),f(2,"div",1),o(3,`
        `),j(4,Qt,3,2),h(),o(5,`
    `),f(6,"div",2),o(7,`
        `),f(8,"button",3),L("click",function(){return i.toggleLockFiles()}),o(9,`
            `),C(10,"fa-icon",4),o(11,`
        `),h(),o(12,`
    `),h(),o(13,`
    `),f(14,"div",1),o(15,`
        `),j(16,Jt,3,2),h(),o(17,`
`),h(),o(18,`
`)),t&2&&(u(4),x(i.plagiarismComparison?4:-1),u(4),oe("active",i.isLockFilesEnabled),u(2),F("icon",i.isLockFilesEnabled?i.faLock:i.faUnlock),u(6),x(i.plagiarismComparison?16:-1))},dependencies:[pt,dt,ut,$],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-grow:1;overflow:hidden}.plagiarism-split-view[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-grow:1;height:100%;overflow:hidden}.plagiarism-split-view[_ngcontent-%COMP%]   .plagiarism-split-pane[_ngcontent-%COMP%]{padding-top:30px;position:relative}.split-pane-header-color[_ngcontent-%COMP%]{background-color:var(--bs-body-bg)}"]})}return n})();export{mn as a};
//# sourceMappingURL=chunk-V26L24NP.js.map
