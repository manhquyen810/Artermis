import{a as Xe,b as Ge}from"./chunk-RF2AUYNN.js";import{a as Ue}from"./chunk-DRT3JEBM.js";import{a as ze}from"./chunk-A2A6JFSH.js";import{c as Le}from"./chunk-MD6Z63OB.js";import{a as We}from"./chunk-SLVT6IA5.js";import{a as Be}from"./chunk-QU4DXSXD.js";import{A as Fe,C as He,D as oe,a as De,h as Ne,s as je}from"./chunk-RTOKZMYN.js";import{d as Oe,e as Ve}from"./chunk-5QODR5GQ.js";import{c as Me}from"./chunk-DXTZ4GAW.js";import{a as we,b as Pe}from"./chunk-5MVJAZRV.js";import{K as R}from"./chunk-VZRSC3LP.js";import{c as be}from"./chunk-5SKDOIBQ.js";import{r as Re}from"./chunk-VK7JPHFE.js";import{c as ke}from"./chunk-BNDLMKXK.js";import{C as ie}from"./chunk-5GXY5RYT.js";import{a as ne}from"./chunk-K3W6YFKH.js";import{c as Ae}from"./chunk-JXJXC4DZ.js";import{d as V}from"./chunk-EDXSOKK5.js";import{Ba as M,tb as Ie,wd as O,y as ye}from"./chunk-Z4VHWOB5.js";import{a as D}from"./chunk-U54OSGNH.js";import{f as Ee}from"./chunk-M6Z6DKZQ.js";import{c as Se}from"./chunk-E2KBL4LX.js";import{n as ve}from"./chunk-IOA4DPXY.js";import{Ad as Te,Cb as ae,Db as a,Dc as F,Ea as f,Ed as te,La as X,Ma as I,Mc as w,Na as k,Oc as m,P as U,Qd as re,Rc as q,Tb as A,U as pe,Va as E,Yc as ge,Zb as _,Zc as Ce,_c as fe,ab as xe,cd as J,dd as i,ed as Y,f as W,fd as _e,kc as u,oa as de,ra as j,rd as Z,s as S,sc as x,sd as he,t as me,uc as $,vc as Q,wb as G,wc as K,xc as o,ya as ue,yc as c,yd as P,z as y,zc as p,zd as ee}from"./chunk-5LC5EQRR.js";import{a as B,b as z}from"./chunk-3E746U5Y.js";var H=class t extends Ne{static ID="task.action";static TEXT=`[Task Short Description](testCaseName)
`;static IDENTIFIER="[task]";static GLOBAL_TASK_REGEX=new RegExp(`${we(t.IDENTIFIER)}(.*)`,"g");constructor(){super(t.ID,"artemisApp.programmingExercise.problemStatement.taskCommand",void 0,void 0)}run(l){this.replaceTextAtCurrentSelection(l,`${this.getOpeningIdentifier()}${t.TEXT}`),l.focus()}getOpeningIdentifier(){return t.IDENTIFIER}};var $e=(()=>{class t extends je{disposableCompletionProvider;static ID="test-case.action";static DEFAULT_INSERT_TEXT="testCaseName()";constructor(){super(t.ID,"artemisApp.programmingExercise.problemStatement.testCaseCommand",void 0,void 0)}register(e,n){super.register(e,n),this.disposableCompletionProvider=this.registerCompletionProviderForCurrentModel(e,()=>Promise.resolve(this.values),(s,r)=>new Ve(s.value,"Test",s.value,Oe.Default,r))}dispose(){super.dispose(),this.disposableCompletionProvider?.dispose()}executeInCurrentEditor(e){super.executeInCurrentEditor(e)}run(e,n){this.replaceTextAtCurrentSelection(e,n?.selectedItem?.value??t.DEFAULT_INSERT_TEXT),e.focus()}getOpeningIdentifier(){return"("}}return t})();var N=function(t){return t.INVALID_TEST_CASES="invalidTestCases",t.REPEATED_TEST_CASES="repeatedTestCases",t}(N||{});var Ye=/\[[^[\]]+]\(((?:[^(),]+(?:\([^()]*\)[^(),]*)?(?:,[^(),]+(?:\([^()]*\)[^(),]*)?)*)?)\)/,Ze="artemisApp.programmingExercise.testCaseAnalysis.invalidTestCase",et="artemisApp.programmingExercise.testCaseAnalysis.repeatedTestCase",Qe=(()=>{class t{translateService=f(Se);analyzeProblemStatement=(e,n,s)=>{let r=Pe(e,n),{invalidTestCases:d,missingTestCases:C,repeatedTestCases:h,invalidTestCaseAnalysis:b}=this.analyzeTestCases(r,s),se=this.mergeAnalysis(b);return{invalidTestCases:d,missingTestCases:C,repeatedTestCases:h,completeAnalysis:se,numOfTasks:r.length}};analyzeTestCases=(e,n)=>{let s=this.extractRegexFromTasks(e,Ye),r=s.map(([g,T])=>[g,ie(T.filter(v=>!n.map(L=>L.toLowerCase()).includes(v.toLowerCase()))),N.INVALID_TEST_CASES]).filter(([,g])=>g.length),d=n.filter(g=>!s.some(([,T])=>T.map(v=>v.toLowerCase()).includes(g.toLowerCase()))),C=r.flatMap(([,g])=>g),b=[...s.reduce((g,[T,v])=>(v.forEach(L=>{g.set(L,(g.get(L)||[]).concat(T))}),g),new Map).entries()].filter(([,g])=>g.length>1).flatMap(([g,T])=>ie(T).map(v=>[v,[g],N.REPEATED_TEST_CASES])),se=ie(b.flatMap(([,g])=>g));return r.push(...b),{missingTestCases:d,invalidTestCases:C,repeatedTestCases:se,invalidTestCaseAnalysis:r}};mergeAnalysis=(...e)=>{let n=(s,[r,d,C])=>{let h=s.get(r),b=h?.[C]??[];return s.set(r,z(B({lineNumber:r},h),{[C]:[...b,...d]})),s};return e.flat().map(([s,r,d])=>[s,r.map(C=>this.translateService.instant(this.getTranslationByIssueType(d),{id:C})),d]).reduce(n,new Map)};getTranslationByIssueType=e=>{switch(e){case N.INVALID_TEST_CASES:return Ze;case N.REPEATED_TEST_CASES:return et}};extractRegexFromTasks(e,n){let s=r=>r.flat().filter(Boolean);return e.filter(([,r])=>!!r).map(([r,d])=>{let C=d.match(n);return C&&C.length>1?[r,C[1]]:[r,void 0]}).filter(([,r])=>!!r).map(([r,d])=>{let C=s(d.split(/,(?![^(]*?\))/).map(h=>h.trim()));return[r,C]})}static \u0275fac=function(n){return new(n||t)};static \u0275prov=ue({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var tt=(t,l)=>({number:t,limit:l});function it(t,l){if(t&1&&(i(0,`
    `),o(1,"div",1),i(2,`
        `),p(3,"fa-icon",2),i(4,`
        `),p(5,"span",3),i(6,`
    `),c(),i(7,`
`)),t&2){let e=m(),n=J(3);a(3),u("icon",e.faExclamationTriangle)("ngbTooltip",n)}}function nt(t,l){if(t&1&&(i(0,`
    `),o(1,"div",4),i(2,`
        `),p(3,"fa-icon",5),i(4,`
        `),p(5,"span",6),i(6,`
    `),c(),i(7,`
`)),t&2){let e=m();a(3),u("icon",e.faCheckCircle)}}function st(t,l){if(t&1&&(i(0,`
            `),o(1,"div",8),i(2,`
                `),p(3,"span",9),i(4,`
            `),c(),i(5,`
        `)),t&2){let e=m(2);a(3),u("translateValues",he(1,tt,e.numOfTasks,e.advisedMaxNumOfTasks))}}function at(t,l){if(t&1&&(i(0,`
    `),o(1,"div",7),i(2,`
        `),_(3,st,6,4),c(),i(4,`
`)),t&2){let e=m();a(3),x(e.numOfTasks>e.advisedMaxNumOfTasks?3:-1)}}var Ke=(()=>{class t{faExclamationTriangle=O;faCheckCircle=M;advisedMaxNumOfTasks=15;numOfTasks;static \u0275fac=function(n){return new(n||t)};static \u0275cmp=A({type:t,selectors:[["jhi-task-count-warning"]],inputs:{advisedMaxNumOfTasks:"advisedMaxNumOfTasks",numOfTasks:"numOfTasks"},decls:5,vars:1,consts:[["tasksTooltipContent",""],["id","instruction_analysis_num-of-tasks-issues",1,"editable-instruction-container__status__item"],[1,"text-warning","me-1",3,"icon","ngbTooltip"],["jhiTranslate","artemisApp.programmingExercise.tasksAnalysis.issues",1,"text-info"],["id","instruction_analysis_num-of-tasks-ok",1,"editable-instruction-container__status__item"],[1,"text-success","me-1",3,"icon"],["jhiTranslate","artemisApp.programmingExercise.tasksAnalysis.ok",1,"text-info"],[1,"text-start","w-100"],[1,"text-start"],["jhiTranslate","artemisApp.programmingExercise.tasksAnalysis.numOfTasks",3,"translateValues"]],template:function(n,s){n&1&&(_(0,it,8,2)(1,nt,8,1)(2,at,5,1,"ng-template",null,0,te),i(4,`
`)),n&2&&x(s.numOfTasks>s.advisedMaxNumOfTasks?0:1)},dependencies:[V,R,D],encapsulation:2})}return t})();var le=t=>({number:t});function rt(t,l){if(t&1&&(i(0,`
        `),o(1,"div",3),i(2,`
            `),p(3,"fa-icon",4),i(4,`
            `),p(5,"span",5),i(6,`
        `),c(),i(7,`
    `)),t&2){let e=m(),n=J(5);a(3),u("icon",e.faExclamationTriangle)("ngbTooltip",n)}}function ot(t,l){if(t&1&&(i(0,`
        `),o(1,"div",6),i(2,`
            `),p(3,"fa-icon",7),i(4,`
            `),p(5,"span",8),i(6,`
        `),c(),i(7,`
    `)),t&2){let e=m();a(3),u("icon",e.faCheckCircle)}}function ct(t,l){if(t&1&&(i(0,`
                            `),o(1,"li"),i(2),c(),i(3,`
                        `)),t&2){let e=l.$implicit;a(2),Y(e)}}function lt(t,l){if(t&1&&(i(0,`
                `),o(1,"div"),i(2,`
                    `),o(3,"span",10),P(4,"artemisTranslate"),i(5),c(),i(6,`
                    `),o(7,"ul"),i(8,`
                        `),Q(9,ct,4,1,null,null,$),c(),i(11,`
                `),c(),i(12,`
            `)),t&2){let e=m(2);a(3),u("innerHTML",Te(4,2,"artemisApp.programmingExercise.testCaseAnalysis.invalidTestCases",Z(5,le,e.invalidTestCases.length)),G),a(2),_e("There are ",e.invalidTestCases.length," test cases that are part of the problem statement but can't be found in your test repository:"),a(4),K(e.invalidTestCases)}}function mt(t,l){if(t&1&&(i(0,`
                            `),o(1,"li"),i(2),c(),i(3,`
                        `)),t&2){let e=l.$implicit;a(2),Y(e)}}function pt(t,l){if(t&1&&(i(0,`
                `),o(1,"div",11),i(2,`
                    `),p(3,"span",12),i(4,`
                    `),o(5,"ul"),i(6,`
                        `),Q(7,mt,4,1,null,null,$),c(),i(9,`
                `),c(),i(10,`
            `)),t&2){let e=m(2);a(3),u("translateValues",Z(1,le,e.missingTestCases.length)),a(4),K(e.missingTestCases)}}function dt(t,l){if(t&1&&(i(0,`
                            `),o(1,"li"),i(2),c(),i(3,`
                        `)),t&2){let e=l.$implicit;a(2),Y(e)}}function ut(t,l){if(t&1&&(i(0,`
                `),o(1,"div",11),i(2,`
                    `),p(3,"span",13),i(4,`
                    `),o(5,"ul"),i(6,`
                        `),Q(7,dt,4,1,null,null,$),c(),i(9,`
                `),c(),i(10,`
            `)),t&2){let e=m(2);a(3),u("translateValues",Z(1,le,e.repeatedTestCases.length)),a(4),K(e.repeatedTestCases)}}function xt(t,l){if(t&1&&(i(0,`
        `),o(1,"div",9),i(2,`
            `),_(3,lt,13,7)(4,pt,11,3)(5,ut,11,3),c(),i(6,`
    `)),t&2){let e=m();a(3),x(e.invalidTestCases.length?3:-1),a(),x(e.missingTestCases.length?4:-1),a(),x(e.repeatedTestCases.length?5:-1)}}var qe=(()=>{class t{analysisService=f(Qe);exerciseTestCases;problemStatement;taskRegex;problemStatementAnalysis=new E;delayedAnalysisSubject=new W;analysisSubscription;invalidTestCases=[];missingTestCases=[];repeatedTestCases=[];numOfTasks=0;faCheckCircle=M;faExclamationTriangle=O;ngOnInit(){this.analysisSubscription=this.delayedAnalysisSubject.pipe(pe(500),y(()=>{let{completeAnalysis:e,missingTestCases:n,invalidTestCases:s,repeatedTestCases:r,numOfTasks:d}=this.analysisService.analyzeProblemStatement(this.problemStatement,this.taskRegex,this.exerciseTestCases);return this.missingTestCases=n,this.invalidTestCases=s,this.repeatedTestCases=r,this.numOfTasks=d,e}),j(e=>this.emitAnalysis(e))).subscribe(),this.analyzeTasks()}ngOnChanges(e){(e.problemStatement||e.exerciseTestCases)&&this.analyzeTasks()}ngOnDestroy(){this.analysisSubscription.unsubscribe()}analyzeTasks(){this.exerciseTestCases&&this.problemStatement&&this.taskRegex&&this.delayedAnalysisSubject.next()}emitAnalysis(e){this.problemStatementAnalysis.emit(e)}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=A({type:t,selectors:[["jhi-programming-exercise-instruction-instructor-analysis"]],inputs:{exerciseTestCases:"exerciseTestCases",problemStatement:"problemStatement",taskRegex:"taskRegex"},outputs:{problemStatementAnalysis:"problemStatementAnalysis"},features:[X],decls:10,vars:2,consts:[["testCasesTooltipContent",""],[1,"editable-instruction-container__status__container"],[3,"numOfTasks"],["id","instruction_analysis_test-case-issues",1,"editable-instruction-container__status__item"],[1,"text-warning","me-1",3,"icon","ngbTooltip"],["jhiTranslate","artemisApp.programmingExercise.testCaseAnalysis.issues",1,"text-info"],["id","instruction_analysis_test-case-ok",1,"editable-instruction-container__status__item"],[1,"text-success","me-1",3,"icon"],["jhiTranslate","artemisApp.programmingExercise.testCaseAnalysis.ok",1,"text-info"],[1,"text-start","w-100"],[3,"innerHTML"],[1,"text-start"],["jhiTranslate","artemisApp.programmingExercise.testCaseAnalysis.missingTestCases",3,"translateValues"],["jhiTranslate","artemisApp.programmingExercise.testCaseAnalysis.repeatedTestCases",3,"translateValues"]],template:function(n,s){n&1&&(o(0,"div",1),i(1,`
    `),_(2,rt,8,2)(3,ot,8,1)(4,xt,7,3,"ng-template",null,0,te),i(6,`
    `),p(7,"jhi-task-count-warning",2),i(8,`
`),c(),i(9,`
`)),n&2&&(a(2),x(s.invalidTestCases.length+s.missingTestCases.length+s.repeatedTestCases.length>0?2:3),a(5),u("numOfTasks",s.numOfTasks))},dependencies:[V,R,D,Ke,ne],encapsulation:2})}return t})();var Je=(()=>{class t extends De{artemisIntelligenceService;exerciseId;resultSignal;static ID="artemisIntelligence.consistencyCheck.action";element;constructor(e,n,s){super(t.ID,"artemisApp.markdownEditor.artemisIntelligence.commands.consistencyCheck"),this.artemisIntelligenceService=e,this.exerciseId=n,this.resultSignal=s}run(e){this.consistencyCheck(e,this.artemisIntelligenceService,this.exerciseId,this.resultSignal)}}return t})();function gt(t,l){if(t&1){let e=F();i(0,`
        `),o(1,"jhi-markdown-editor-monaco",1),w("onPreviewSelect",function(){I(e);let s=m();return k(s.generateHtml())})("markdownChange",function(s){I(e);let r=m();return k(r.updateProblemStatement(s))}),i(2,`
            `),p(3,"jhi-programming-exercise-instructions",2),i(4,`
        `),c(),i(5,`
    `)}if(t&2){let e=m();a(),u("domainActions",e.domainActions)("artemisIntelligenceActions",e.artemisIntelligenceActions())("initialEditorHeight",e.initialEditorHeight)("useDefaultMarkdownEditorOptions",!1)("enableResize",e.enableResize)("markdown",e.exercise.problemStatement)("showDefaultPreview",!1),a(2),u("participation",e.participation)("exercise",e.exercise)("generateHtmlEvents",e.generateHtmlSubject.asObservable())("personalParticipation",!1)}}function Ct(t,l){if(t&1&&(i(0,`
                `),p(1,"fa-icon",5),i(2,`
            `)),t&2){let e=m(2);a(),u("icon",e.faSave)}}function ft(t,l){if(t&1&&(i(0,`
                `),p(1,"fa-icon",6),i(2,`
            `)),t&2){let e=m(2);a(),u("icon",e.faCircleNotch)}}function _t(t,l){if(t&1){let e=F();i(0,`
        `),o(1,"button",3),w("click",function(s){I(e);let r=m();return k(r.saveInstructions(s))}),i(2,`
            `),_(3,Ct,3,1)(4,ft,3,1),p(5,"span",4),i(6,`
        `),c(),i(7,`
    `)}if(t&2){let e=m();a(),u("disabled",e.savingInstructions||!e.unsavedChangesValue)("ngClass",e.savingInstructions||!e.unsavedChangesValue?"btn-light":"btn-primary"),a(2),x(e.savingInstructions?-1:3),a(),x(e.savingInstructions?4:-1)}}function ht(t,l){if(t&1&&(i(0,`
                    `),o(1,"div"),i(2,`
                        `),p(3,"fa-icon",9),P(4,"artemisTranslate"),i(5,`
                        `),p(6,"span",10),i(7,`
                    `),c(),i(8,`
                `)),t&2){let e=m(2);a(3),q("ngbTooltip",ee(4,2,"artemisApp.programmingExercise.editable.savedTooltip")),u("icon",e.faCheckCircle)}}function Tt(t,l){if(t&1&&(i(0,`
                    `),o(1,"div"),i(2,`
                        `),p(3,"fa-icon",11),P(4,"artemisTranslate"),i(5,`
                        `),p(6,"span",12),i(7,`
                    `),c(),i(8,`
                `)),t&2){let e=m(2);a(3),q("ngbTooltip",ee(4,2,"artemisApp.programmingExercise.editable.unsavedTooltip")),u("icon",e.faExclamationTriangle)}}function vt(t,l){if(t&1&&(i(0,`
                    `),o(1,"div"),i(2,`
                        `),p(3,"fa-icon",13),P(4,"artemisTranslate"),i(5,`
                        `),p(6,"span",14),i(7,`
                    `),c(),i(8,`
                `)),t&2){let e=m(2);a(3),q("ngbTooltip",ee(4,2,"artemisApp.programmingExercise.editable.savingTooltip")),u("icon",e.faCircleNotch)}}function Et(t,l){if(t&1){let e=F();i(0,`
                `),o(1,"jhi-programming-exercise-instruction-instructor-analysis",15),w("problemStatementAnalysis",function(s){I(e);let r=m(2);return k(r.onAnalysisUpdate(s))}),c(),i(2,`
            `)}if(t&2){let e=m(2);a(),u("exerciseTestCases",e.exerciseTestCases)("problemStatement",e.exercise.problemStatement||"")("taskRegex",e.taskRegex)}}function bt(t,l){if(t&1&&(i(0,`
        `),o(1,"div",7),i(2,`
            `),o(3,"div",8),i(4,`
                `),_(5,ht,9,4)(6,Tt,9,4)(7,vt,9,4),c(),i(8,`
            `),_(9,Et,3,3),c(),i(10,`
    `)),t&2){let e=m();a(5),x(!e.unsavedChangesValue&&!e.savingInstructions?5:-1),a(),x(e.unsavedChangesValue&&!e.savingInstructions?6:-1),a(),x(e.savingInstructions?7:-1),a(2),x(e.exercise!=null&&e.exercise.id?9:-1)}}function St(t,l){if(t&1){let e=F();i(0,`
        `),o(1,"div",16),i(2,`
            `),o(3,"button",17),w("click",function(){I(e);let s=m();return k(s.dismissConsistencyCheck())}),c(),i(4,`
            `),p(5,"h4",18),i(6,`
            `),p(7,"div",19),i(8,`
        `),c(),i(9,`
    `)}if(t&2){let e=m();a(7),u("innerHtml",e.renderedConsistencyCheckResultMarkdown(),G)}}var Gi=(()=>{class t{activatedRoute=f(Ee);programmingExerciseService=f(We);alertService=f(Ae);programmingExerciseParticipationService=f(Be);testCaseService=f(Le);profileService=f(ke);artemisIntelligenceService=f(Fe);participationValue;programmingExercise;exerciseTestCases=[];taskRegex=H.GLOBAL_TASK_REGEX;testCaseAction=new $e;domainActions=[new Ue,new H,this.testCaseAction];courseId;exerciseId;irisEnabled=be(this.profileService.getProfileInfo().pipe(y(e=>e.activeProfiles.includes(Re))),{initialValue:!1});artemisIntelligenceActions=re(()=>this.irisEnabled()?[new Xe(this.artemisIntelligenceService,Ge.PROBLEM_STATEMENT,this.courseId),...this.exerciseId?[new Je(this.artemisIntelligenceService,this.exerciseId,this.renderedConsistencyCheckResultMarkdown)]:[]]:[]);savingInstructions=!1;unsavedChangesValue=!1;renderedConsistencyCheckResultMarkdown=xe("");showConsistencyCheck=re(()=>!!this.renderedConsistencyCheckResultMarkdown());testCaseSubscription;forceRenderSubscription;markdownEditorMonaco;showStatus=!0;editMode=!0;enableResize=!0;initialEditorHeight;showSaveButton=!1;templateParticipation;forceRender;get exercise(){return this.programmingExercise}get participation(){return this.participationValue}participationChange=new E;hasUnsavedChanges=new E;exerciseChange=new E;instructionChange=new E;generateHtmlSubject=new W;set participation(e){this.participationValue=e,this.participationChange.emit(this.participationValue)}set exercise(e){this.programmingExercise&&e.problemStatement!==this.programmingExercise.problemStatement&&(this.unsavedChanges=!0),this.programmingExercise=e,this.exerciseChange.emit(this.programmingExercise)}set unsavedChanges(e){this.unsavedChangesValue=e,e&&this.hasUnsavedChanges.emit(e)}faSave=Ie;faCheckCircle=M;faExclamationTriangle=O;faCircleNotch=ye;MarkdownEditorHeight=He;ngOnInit(){this.courseId=Number(this.activatedRoute.snapshot.paramMap.get("courseId")),this.exerciseId=Number(this.activatedRoute.snapshot.paramMap.get("exerciseId"))}ngOnChanges(e){Me(e)&&this.setupTestCaseSubscription()}ngOnDestroy(){this.testCaseSubscription&&this.testCaseSubscription.unsubscribe(),this.forceRenderSubscription&&this.forceRenderSubscription.unsubscribe()}ngAfterViewInit(){this.forceRender&&(this.forceRenderSubscription=this.forceRender.subscribe(()=>this.generateHtml()))}saveInstructions(e){return e.stopPropagation(),this.savingInstructions=!0,this.programmingExerciseService.updateProblemStatement(this.exercise.id,this.exercise.problemStatement).pipe(j(()=>{this.unsavedChanges=!1}),U(()=>(this.alertService.error("artemisApp.editor.errors.problemStatementCouldNotBeUpdated"),S(void 0)))).subscribe(()=>{this.savingInstructions=!1})}saveOnControlAndS(e){navigator.userAgent.includes("Mac")||(e.preventDefault(),this.saveInstructions(e))}saveOnCommandAndS(e){navigator.userAgent.includes("Mac")&&(e.preventDefault(),this.saveInstructions(e))}updateProblemStatement(e){this.exercise.problemStatement!==e&&(this.exercise=z(B({},this.exercise),{problemStatement:e}),this.unsavedChanges=!0),this.instructionChange.emit(e)}dismissConsistencyCheck(){this.renderedConsistencyCheckResultMarkdown.set("")}generateHtml(){this.generateHtmlSubject.next()}setupTestCaseSubscription(){this.testCaseSubscription&&this.testCaseSubscription.unsubscribe(),this.editMode&&(this.testCaseSubscription=this.testCaseService.subscribeForTestCases(this.exercise.id).pipe(de(e=>{if(e){let n=e.filter(s=>s.active).map(s=>s.testName).sort();return S(n)}else if(this.exercise.templateParticipation)return this.loadTestCasesFromTemplateParticipationResult(this.exercise.templateParticipation.id);return S()}),j(e=>{this.exerciseTestCases=e;let n=this.exerciseTestCases.map(s=>({value:s,id:s}));this.testCaseAction.setValues(n)}),U(()=>S())).subscribe())}loadTestCasesFromTemplateParticipationResult=e=>this.programmingExerciseParticipationService.getLatestResultWithFeedback(e).pipe(y(n=>n?.feedbacks?n:me(()=>new Error("no result available"))),y(({feedbacks:n})=>n.map(s=>s.text??s.testCase?.testName).sort()),U(()=>S([])));onAnalysisUpdate=e=>{let n=this.mapAnalysisToWarnings(e);this.markdownEditorMonaco?.monacoEditor?.setAnnotations(n)};mapAnalysisToWarnings=e=>Array.from(e.values()).flatMap(({lineNumber:n,invalidTestCases:s,repeatedTestCases:r})=>this.mapIssuesToAnnotations(n,s,r));mapIssuesToAnnotations=(e,n,s)=>{let r=C=>({row:e,column:0,text:" - "+C.join(`
 - `),type:"warning"}),d=[];return n&&d.push(r(n)),s&&d.push(r(s)),d};static \u0275fac=function(n){return new(n||t)};static \u0275cmp=A({type:t,selectors:[["jhi-programming-exercise-editable-instructions"]],viewQuery:function(n,s){if(n&1&&ge(oe,5),n&2){let r;Ce(r=fe())&&(s.markdownEditorMonaco=r.first)}},hostBindings:function(n,s){n&1&&w("keydown.control.s",function(d){return s.saveOnControlAndS(d)},!1,ae)("keydown.meta.s",function(d){return s.saveOnCommandAndS(d)},!1,ae)},inputs:{showStatus:"showStatus",editMode:"editMode",enableResize:"enableResize",initialEditorHeight:"initialEditorHeight",showSaveButton:"showSaveButton",templateParticipation:"templateParticipation",forceRender:"forceRender",exercise:"exercise",participation:"participation"},outputs:{participationChange:"participationChange",hasUnsavedChanges:"hasUnsavedChanges",exerciseChange:"exerciseChange",instructionChange:"instructionChange"},features:[X],decls:8,vars:4,consts:[[1,"editable-instruction-container"],[1,"overflow-hidden","flex-grow-1",3,"onPreviewSelect","markdownChange","domainActions","artemisIntelligenceActions","initialEditorHeight","useDefaultMarkdownEditorOptions","enableResize","markdown","showDefaultPreview"],["id","previewMonaco",1,"editable-instruction-container__instructions",3,"participation","exercise","generateHtmlEvents","personalParticipation"],["id","save-instructions-button",1,"btn","editable-instruction-container__save",3,"click","disabled","ngClass"],["jhiTranslate","entity.action.save"],[1,"me-2",3,"icon"],["animation","spin",1,"me-2",3,"icon"],[1,"card-footer","text-nowrap","editable-instruction-container__status"],[1,"instructions-status"],[1,"text-success","me-1",3,"icon","ngbTooltip"],["jhiTranslate","artemisApp.programmingExercise.editable.saved",1,"text-info"],[1,"text-warning","me-1",3,"icon","ngbTooltip"],["jhiTranslate","artemisApp.programmingExercise.editable.unsaved",1,"text-info"],[1,"me-1",3,"icon","ngbTooltip"],["jhiTranslate","artemisApp.programmingExercise.editable.saving",1,"text-info"],[1,"editable-instruction-container__status__testcase",3,"problemStatementAnalysis","exerciseTestCases","problemStatement","taskRegex"],["role","alert",1,"alert","alert-warning","alert-dismissible","text-start","fade","show","mt-4"],["type","button","aria-label","Close",1,"btn-close",3,"click"],["jhiTranslate","artemisApp.programmingExercise.artemisIntelligence.consistencyCheckAlert.title",1,"alert-heading"],[3,"innerHtml"]],template:function(n,s){n&1&&(o(0,"div",0),i(1,`
    `),i(2,`
    `),_(3,gt,6,11)(4,_t,8,4)(5,bt,11,4)(6,St,10,1),c(),i(7,`
`)),n&2&&(a(3),x(s.exercise?3:-1),a(),x(s.editMode?4:-1),a(),x(s.showStatus?5:-1),a(),x(s.showConsistencyCheck()?6:-1))},dependencies:[oe,ze,ve,V,D,R,qe,ne],styles:[`.editable-instruction-container{position:relative;display:flex;flex-flow:column nowrap;flex:1 1 auto;height:100%}.editable-instruction-container .tooltip-inner{width:500px}.editable-instruction-container__instructions{height:100%}.editable-instruction-container__editor{display:flex;flex-flow:column nowrap;flex:1 1 auto;height:100%;overflow:hidden}.editable-instruction-container .markdown-editor{border-left:var(--border-color) 1px solid;border-right:var(--border-color) 1px solid;border-bottom:var(--border-color) 1px solid}.editable-instruction-container .markdown-editor-wrapper{background-color:var(--markdown-preview-editor-background)!important}.editable-instruction-container .markdown-editor-wrapper .nav{position:sticky;top:0;z-index:1;background-color:var(--markdown-preview-editor-background)}.editable-instruction-container .instructions__content__markdown{background-color:var(--markdown-preview-editor-background)}.editable-instruction-container .card-second-header{padding:10px 15px;background-color:var(--markdown-preview-editor-background)}.editable-instruction-container__save{position:absolute;z-index:2;top:0;right:0;padding-top:0;padding-bottom:0}.editable-instruction-container__status{display:grid;grid-template-columns:repeat(2,minmax(max-content,1fr))}.editable-instruction-container__status>:not(:first-child){border-left:1px solid rgba(0,0,0,.125)}.editable-instruction-container__status__container{display:flex;text-align:center}.editable-instruction-container__status__container>:not(:first-child){border-left:1px solid rgba(0,0,0,.125);flex:1}.editable-instruction-container__status__item{flex:1}
`],encapsulation:2})}return t})();export{Gi as a};
//# sourceMappingURL=chunk-MGAZNMUZ.js.map
