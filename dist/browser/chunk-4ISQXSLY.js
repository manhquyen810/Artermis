import{a as U}from"./chunk-5WJSNL65.js";import{a as V,b as B}from"./chunk-CCVWGTN5.js";import{a as y,b as z,c as j,d as L}from"./chunk-MD22LTSS.js";import{A as l,C as m,F as N,a as D}from"./chunk-RKZRHQUL.js";import{b as S,j as R}from"./chunk-3JSWSN6W.js";import{a as T}from"./chunk-K3W6YFKH.js";import{d as w}from"./chunk-EDXSOKK5.js";import{Db as c,Ea as M,La as v,Oc as C,Tb as I,Va as F,Xb as _,Zb as x,dd as o,ed as P,kc as k,mc as O,sc as h,xc as u,yc as g,zc as b}from"./chunk-5LC5EQRR.js";import{j as f}from"./chunk-3E746U5Y.js";function Y(i,r){let e={};for(let t of i.feedbacks){let n=t.referenceType,s=t.referenceId;if(n in l){let p=y(r,s);if(!p){e[s]={name:"",type:""};continue}let E=p.name,a;switch(p.type){case l.Class:a="class";break;case l.Package:a="package";break;case l.Interface:a="interface";break;case l.AbstractClass:a="abstract class";break;case l.Enumeration:a="enum";break;case l.ClassAttribute:a="attribute";break;case l.ClassMethod:a="method";break;case l.ActivityInitialNode:a="initial node";break;case l.ActivityFinalNode:a="final node";break;case l.ActivityObjectNode:a="object";break;case l.ActivityActionNode:a="action";break;case l.ActivityForkNode:a="fork node";break;case l.ActivityMergeNode:a="merge node";break;default:a="";break}e[s]={type:a,name:E}}else if(n in m){let p=z(r,s);if(!p){e[s]={name:"",type:""};continue}let E=y(r,p.source.element)?.name??"?",a=y(r,p.target.element)?.name??"?",G=p.type,A="association",d;switch(G){case m.ClassBidirectional:d=" <-> ";break;case m.ClassUnidirectional:d=" --> ";break;case m.ClassAggregation:d=" --\u25C7 ";break;case m.ClassInheritance:d=" --\u25B7 ";break;case m.ClassDependency:d=" \u254C\u254C> ";break;case m.ClassComposition:d=" --\u25C6 ";break;case m.ActivityControlFlow:d=" --> ",A="control flow";break;default:d=" --- "}e[s]={type:A,name:E+d+a}}else e[s]={type:`${n}`,name:""}}return e}function H(i,r){if(!i)return i;if(!r||!r.elements)return[];let e=Object.values(r.elements).map(t=>t.id);return r.relationships&&(e=e.concat(Object.values(r.relationships).map(t=>t.id))),i.filter(t=>e.includes(t.referenceId))}function W(i,r){if(i&1&&(o(0,`
                `),u(1,"span"),o(2),g(),o(3,`
            `)),i&2){let e=C(2);c(2),P(e.title)}}function $(i,r){if(i&1&&(o(0,`
                `),b(1,"jhi-score-display",7),o(2,`
            `)),i&2){let e=C(2);c(),k("score",e.totalScore)("maxPoints",e.maxScore)("maxBonusPoints",e.maxBonusPoints)("course",e.course)}}function q(i,r){if(i&1&&(o(0,`
        `),u(1,"div",5),o(2,`
            `),x(3,W,4,1),b(4,"span",6),o(5,`
            `),x(6,$,3,4),g(),o(7,`
    `)),i&2){let e=C();c(3),h(e.title?3:-1),c(3),h(e.displayPoints?6:-1)}}function J(i,r){if(i&1&&(o(0,`
            `),u(1,"div",8),o(2,`
                `),b(3,"fa-icon",9),o(4,`
            `),g(),o(5,`
        `)),i&2){let e=C();c(3),k("icon",e.faGripLinesVertical)}}function K(i,r){if(i&1&&(o(0,`
        `),u(1,"div",10),o(2,`
            `),b(3,"fa-icon",9),o(4,`
        `),g(),o(5,`
    `)),i&2){let e=C();c(3),k("icon",e.faGripLines)}}function Q(i,r){if(i&1&&(o(0,`
        `),b(1,"jhi-modeling-explanation-editor",11),o(2,`
    `)),i&2){let e=C();c(),k("explanation",e.explanation)("readOnly",!0)}}var ue=(()=>{class i extends V{artemisTranslatePipe=M(T);maxScore;maxBonusPoints=0;totalScore;title;enablePopups=!0;displayPoints=!0;highlightDifferences;feedbackChanged=new F;selectionChanged=new F;highlightedElements;elementCounts;course;set resultFeedbacks(e){this.feedbacks=e,this.referencedFeedbacks=this.feedbacks.filter(t=>t.reference!=null),this.updateApollonAssessments(this.referencedFeedbacks)}feedbacks;elementFeedback;referencedFeedbacks=[];unreferencedFeedbacks=[];firstCorrectionRoundColor="#3e8acc";secondCorrectionRoundColor="#ffa561";constructor(){super()}ngAfterViewInit(){return f(this,null,function*(){this.feedbacks&&(this.referencedFeedbacks=this.feedbacks.filter(e=>e.reference!=null),this.unreferencedFeedbacks=this.feedbacks.filter(e=>e.reference==null&&e.type===S.MANUAL_UNREFERENCED)),this.initializeApollonEditor(),this.highlightedElements&&(yield this.updateHighlightedElements(this.highlightedElements)),this.elementCounts&&(yield this.updateElementCounts(this.elementCounts)),yield this.applyStateConfiguration(),this.setupInteract()})}ngOnDestroy(){this.apollonEditor&&this.apollonEditor.destroy()}ngOnChanges(e){return f(this,null,function*(){e.umlModel&&e.umlModel.currentValue&&this.apollonEditor&&(this.apollonEditor.model=e.umlModel.currentValue,this.handleFeedback()),e.feedbacks&&e.feedbacks.currentValue&&this.umlModel&&(this.feedbacks=e.feedbacks.currentValue,this.handleFeedback()),e.highlightedElements&&(this.highlightedElements=e.highlightedElements.currentValue),(e.highlightedElements||e.highlightDifferences)&&this.apollonEditor&&(yield this.updateApollonAssessments(this.referencedFeedbacks),yield this.applyStateConfiguration())})}initializeApollonEditor(){this.apollonEditor&&this.apollonEditor.destroy(),this.handleFeedback(),this.apollonEditor=new L(this.editorContainer.nativeElement,{mode:N.Assessment,readonly:this.readOnly,model:this.umlModel,type:this.diagramType||D.ClassDiagram,enablePopups:this.enablePopups}),this.apollonEditor.subscribeToSelectionChange(e=>{this.readOnly&&this.selectionChanged.emit(e)}),this.readOnly||this.apollonEditor.subscribeToAssessmentChange(e=>{this.referencedFeedbacks=this.generateFeedbackFromAssessment(e),this.feedbackChanged.emit(this.referencedFeedbacks)})}applyStateConfiguration(){return f(this,null,function*(){this.highlightedElements&&(yield this.updateHighlightedElements(this.highlightedElements))})}generateFeedbackFromAssessment(e){let t=new Map;for(let n of e){let s=this.elementFeedback.get(n.modelElementId);s?(s.credits!==n.score&&s.gradingInstruction&&(s.gradingInstruction=void 0),s.credits=n.score,s.text=n.feedback,n.dropInfo&&n.dropInfo.instruction?.id&&(s.gradingInstruction=n.dropInfo.instruction),s.gradingInstruction&&n.dropInfo==null&&(s.gradingInstruction=void 0)):s=R.forModeling(n.score,n.feedback,n.modelElementId,n.elementType,n.dropInfo),t.set(n.modelElementId,s)}return this.elementFeedback=t,[...this.elementFeedback.values()]}handleFeedback(){this.referencedFeedbacks=H(this.feedbacks,this.umlModel),this.updateElementFeedbackMapping(this.referencedFeedbacks),this.updateApollonAssessments(this.referencedFeedbacks)}updateElementFeedbackMapping(e){if(this.elementFeedback||(this.elementFeedback=new Map),!!e)for(let t of e)this.elementFeedback.set(t.referenceId,t)}updateHighlightedElements(e){return f(this,null,function*(){if(e||(e=new Map),this.apollonEditor!=null){yield this.apollonEditor.nextRender;let t=this.apollonEditor.model;for(let n of Object.values(t.elements))n.highlight=e.get(n.id);for(let n of Object.values(t.relationships))n.highlight=e.get(n.id);this.apollonEditor.model=t}})}updateElementCounts(e){return f(this,null,function*(){if(!e)return;let t=new Map;if(e.forEach(n=>t.set(n.elementId,n.numberOfOtherElements)),this.apollonEditor!=null){yield this.apollonEditor.nextRender;let n=this.apollonEditor.model;for(let s of Object.values(n.elements))s.assessmentNote=this.calculateNote(t.get(s.id));for(let s of Object.values(n.relationships))s.assessmentNote=this.calculateNote(t.get(s.id));this.apollonEditor.model=n}})}updateApollonAssessments(e){return f(this,null,function*(){!e||!this.umlModel||(e.forEach(t=>{j(this.umlModel,{modelElementId:t.referenceId,elementType:t.referenceType,score:t.credits,feedback:t.text||void 0,label:this.calculateLabel(t),labelColor:this.calculateLabelColor(t),correctionStatus:this.calculateCorrectionStatusForFeedback(t),dropInfo:this.calculateDropInfo(t)})}),this.apollonEditor&&(yield this.apollonEditor.nextRender,this.apollonEditor.model=this.umlModel))})}calculateLabel(e){let t=this.artemisTranslatePipe.transform("artemisApp.assessment.diffView.correctionRoundDiffFirst"),n=this.artemisTranslatePipe.transform("artemisApp.assessment.diffView.correctionRoundDiffSecond");if(this.highlightDifferences)return e.copiedFeedbackId?t:n}calculateLabelColor(e){return this.highlightDifferences?e.copiedFeedbackId?this.firstCorrectionRoundColor:this.secondCorrectionRoundColor:""}calculateNote(e){if(e)return this.artemisTranslatePipe.transform("artemisApp.modelingAssessment.impactWarning",{affectedSubmissionsCount:e})}calculateCorrectionStatusForFeedback(e){let t=e.correctionStatus?this.artemisTranslatePipe.transform("artemisApp.exampleSubmission.feedback."+e.correctionStatus):e.correctionStatus;e.correctionStatus&&e.correctionStatus!=="CORRECT"&&(t+=" \u26A0\uFE0F");let n;switch(e.correctionStatus){case"CORRECT":n="CORRECT";break;case void 0:n="NOT_VALIDATED";break;default:n="INCORRECT"}return{description:t,status:n}}calculateDropInfo(e){if(e.gradingInstruction){let t={};return t.instruction=e.gradingInstruction,t.removeMessage=this.artemisTranslatePipe.transform("artemisApp.assessment.messages.removeAssessmentInstructionLink"),t.tooltipMessage=this.artemisTranslatePipe.transform("artemisApp.exercise.assessmentInstruction")+e.gradingInstruction.instructionDescription,t.feedbackHint=this.artemisTranslatePipe.transform("artemisApp.assessment.feedbackHint"),t}}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=I({type:i,selectors:[["jhi-modeling-assessment"]],inputs:{maxScore:"maxScore",maxBonusPoints:"maxBonusPoints",totalScore:"totalScore",title:"title",enablePopups:"enablePopups",displayPoints:"displayPoints",highlightDifferences:"highlightDifferences",highlightedElements:"highlightedElements",elementCounts:"elementCounts",course:"course",resultFeedbacks:"resultFeedbacks"},outputs:{feedbackChanged:"feedbackChanged",selectionChanged:"selectionChanged"},features:[_,v],decls:14,vars:6,consts:[["resizeContainer",""],["editorContainer",""],[1,"modeling-assessment"],["id","apollon-assessment-row",1,"apollon-row"],[1,"apollon-container"],[1,"card-header","bg-primary","text-white"],[1,"flex-fill"],[3,"score","maxPoints","maxBonusPoints","course"],[1,"draggable-right"],[3,"icon"],[1,"draggable-bottom"],[3,"explanation","readOnly"]],template:function(t,n){t&1&&(u(0,"div",2,0),o(2,`
    `),x(3,q,8,2),u(4,"div",3),o(5,`
        `),b(6,"div",4,1),o(8,`
        `),x(9,J,6,1),g(),o(10,`
    `),x(11,K,6,1)(12,Q,3,2),g(),o(13,`
`)),t&2&&(O("resizable",n.resizeOptions),c(3),h(n.title||n.displayPoints?3:-1),c(6),h(n.resizeOptions&&n.resizeOptions.horizontalResize?9:-1),c(2),h(n.resizeOptions&&n.resizeOptions.verticalResize?11:-1),c(),h(n.explanation?12:-1))},dependencies:[U,w,B],styles:[".modeling-assessment[_ngcontent-%COMP%]{position:relative;display:flex;flex-flow:column nowrap;height:100%}.modeling-assessment[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%;font-size:1rem;font-weight:500}.resizable[_ngcontent-%COMP%]{display:flex}.resizable[_ngcontent-%COMP%]   .draggable-right[_ngcontent-%COMP%], .resizable[_ngcontent-%COMP%]   .draggable-bottom[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-width:15px}.apollon-container[_ngcontent-%COMP%]{height:100%;width:100%}.apollon-row[_ngcontent-%COMP%]{display:flex;height:100%}@media print{.modeling-assessment[_ngcontent-%COMP%]{height:auto!important;max-height:100vh!important}}"]})}return i})();export{Y as a,H as b,ue as c};
//# sourceMappingURL=chunk-4ISQXSLY.js.map
