import{a as b}from"./chunk-ASDUDRMA.js";import"./chunk-SKB5UJGX.js";import{a as T}from"./chunk-SLVT6IA5.js";import{f as o}from"./chunk-FAFORKWV.js";import{a as S}from"./chunk-QU4DXSXD.js";import"./chunk-22YQSX6Z.js";import"./chunk-R56P6PAY.js";import"./chunk-65Z25AP3.js";import"./chunk-5M3YV54C.js";import"./chunk-RYZEETVB.js";import"./chunk-VTF2OQPK.js";import"./chunk-BNRTXX46.js";import"./chunk-VPHPBAVR.js";import"./chunk-N4VVKRBU.js";import"./chunk-5AQXEKLE.js";import"./chunk-3JSWSN6W.js";import"./chunk-7XNS72RJ.js";import"./chunk-KYCCMZSV.js";import"./chunk-DXTZ4GAW.js";import"./chunk-2UXGFGK3.js";import"./chunk-O4VJ5OXY.js";import"./chunk-BDII35IB.js";import"./chunk-LARBQRTJ.js";import"./chunk-OTNXTVPX.js";import"./chunk-Z2YUBN6N.js";import"./chunk-OTCBNILH.js";import"./chunk-6EYB5QBP.js";import"./chunk-GERFCPB6.js";import"./chunk-QA7Y7QBM.js";import"./chunk-ZPITQMA6.js";import"./chunk-2CUFQLAH.js";import"./chunk-Z6NSEM73.js";import"./chunk-CK7FH6VF.js";import"./chunk-PUNMJFMR.js";import"./chunk-R75LTV62.js";import"./chunk-XBLNBTXN.js";import"./chunk-G3JOQOSD.js";import"./chunk-G4I63THF.js";import"./chunk-PZ7IDTIM.js";import"./chunk-CT44YL7Q.js";import"./chunk-JNO6DNVW.js";import"./chunk-EELXLOHY.js";import"./chunk-VZRSC3LP.js";import"./chunk-5SKDOIBQ.js";import"./chunk-WA5GEAJB.js";import"./chunk-VK7JPHFE.js";import"./chunk-BNDLMKXK.js";import"./chunk-BQNBT6PW.js";import"./chunk-5GXY5RYT.js";import"./chunk-K3W6YFKH.js";import"./chunk-JXJXC4DZ.js";import"./chunk-EDXSOKK5.js";import"./chunk-R5BZWVRQ.js";import{p}from"./chunk-DID2YGL7.js";import{c as x}from"./chunk-CXQURQM5.js";import"./chunk-S4QLGR2R.js";import"./chunk-Z4VHWOB5.js";import"./chunk-XUCCGZJR.js";import"./chunk-HKBU2OOC.js";import"./chunk-5ZXXURLP.js";import"./chunk-NOBD5HSR.js";import"./chunk-U54OSGNH.js";import{f}from"./chunk-M6Z6DKZQ.js";import"./chunk-3Y6745HG.js";import"./chunk-E2KBL4LX.js";import"./chunk-PZTBTDSR.js";import"./chunk-IOA4DPXY.js";import{Db as n,Ea as r,Oc as d,Tb as c,Zb as h,dd as m,kc as l,ra as a,sc as u,zc as y}from"./chunk-5LC5EQRR.js";import"./chunk-3E746U5Y.js";function C(e,g){if(e&1&&(m(0,`
    `),y(1,"jhi-commits-info",0),m(2,`
`)),e&2){let i=d();n(),l("participationId",i.participation.id)("commits",i.commits)("isRepositoryView",!0)}}var j=(()=>{class e{route=r(f);programmingExerciseParticipationService=r(S);programmingExerciseService=r(T);PROGRAMMING=x.PROGRAMMING;dayjs=p;participation;exerciseId;repositoryType;repositoryId;paramSub;commits;commitsInfoSubscription;participationSub;exercise;isTestRepository=!1;ngOnDestroy(){this.paramSub?.unsubscribe(),this.commitsInfoSubscription?.unsubscribe(),this.participationSub?.unsubscribe()}ngOnInit(){this.paramSub=this.route.params.subscribe(i=>{this.exerciseId=Number(i.exerciseId),this.repositoryType=i.repositoryType??o.USER,this.repositoryId=Number(i.repositoryId),this.repositoryId&&this.repositoryType===o.USER?this.loadStudentParticipation():this.loadDifferentParticipation()})}loadDifferentParticipation(){this.participationSub=this.programmingExerciseService.findWithTemplateAndSolutionParticipation(this.exerciseId,!0).pipe(a(i=>{this.exercise=i.body,this.repositoryType==="TEMPLATE"?(this.participation=this.exercise.templateParticipation,this.participation.programmingExercise=this.exercise,this.participation.results=this.participation.submissions?.filter(t=>t.results&&t.results?.length>0).map(t=>(t.results[0].participation=this.participation,t.results[0]))):this.repositoryType==="SOLUTION"?(this.participation=this.exercise.solutionParticipation,this.participation.programmingExercise=this.exercise,this.participation.results=this.participation.submissions?.filter(t=>t.results&&t.results?.length>0).map(t=>(t.results[0].participation=this.participation,t.results[0]))):this.repositoryType==="TESTS"?(this.isTestRepository=!0,this.participation=this.exercise.templateParticipation):this.repositoryType==="AUXILIARY"&&(this.participation=this.exercise.templateParticipation)})).subscribe({next:()=>{this.handleCommits()}})}loadStudentParticipation(){this.participationSub=this.programmingExerciseParticipationService.getStudentParticipationWithAllResults(this.repositoryId).pipe(a(i=>{this.participation=i,this.participation.results?.forEach(t=>{t.participation=i})})).subscribe({next:()=>{this.handleCommits()}})}handleCommits(){this.repositoryType===o.USER?this.handleParticipationCommits():this.repositoryType===o.AUXILIARY?this.handleAuxiliaryRepositoryCommits():this.handleTemplateSolutionTestRepositoryCommits()}handleParticipationCommits(){this.commitsInfoSubscription=this.programmingExerciseParticipationService.retrieveCommitHistoryForParticipation(this.participation.id).subscribe(i=>{this.commits=this.sortCommitsByTimestampDesc(i),this.setCommitResults()})}handleAuxiliaryRepositoryCommits(){this.commitsInfoSubscription=this.programmingExerciseParticipationService.retrieveCommitHistoryForAuxiliaryRepository(this.exerciseId,this.repositoryId).subscribe(i=>{this.commits=this.sortCommitsByTimestampDesc(i)})}handleTemplateSolutionTestRepositoryCommits(){this.commitsInfoSubscription=this.programmingExerciseParticipationService.retrieveCommitHistoryForTemplateSolutionOrTests(this.exerciseId,this.repositoryType).subscribe(i=>{this.commits=this.sortCommitsByTimestampDesc(i),this.isTestRepository||this.setCommitResults()})}setCommitResults(){this.commits.forEach(i=>{this.participation.results?.forEach(t=>{let s=t.submission;s&&s.commitHash===i.hash&&(i.result=t)})})}sortCommitsByTimestampDesc(i){return i.sort((t,s)=>p(s.timestamp).isAfter(p(t.timestamp))?1:-1)}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=c({type:e,selectors:[["jhi-commit-history"]],decls:1,vars:1,consts:[[3,"participationId","commits","isRepositoryView"]],template:function(t,s){t&1&&h(0,C,3,3),t&2&&u(s.participation&&s.commits?0:-1)},dependencies:[b],encapsulation:2})}return e})();export{j as CommitHistoryComponent};
//# sourceMappingURL=commit-history.component-HKFBOI33.js.map
