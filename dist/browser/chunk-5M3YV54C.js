import{c as M,p as T,q as D,r as G,s as N,t as o,z as _}from"./chunk-5AQXEKLE.js";import{a as y}from"./chunk-7XNS72RJ.js";import{a as I,d as C,e as F}from"./chunk-CK7FH6VF.js";import{a as b}from"./chunk-G3JOQOSD.js";import{b as l}from"./chunk-G4I63THF.js";import{f as g}from"./chunk-CT44YL7Q.js";import{a as P,b as E}from"./chunk-EELXLOHY.js";import{p as A}from"./chunk-DID2YGL7.js";import{c as u,k as m}from"./chunk-CXQURQM5.js";import{a as v}from"./chunk-NOBD5HSR.js";import{c as h}from"./chunk-E2KBL4LX.js";import{O as R}from"./chunk-IOA4DPXY.js";import{Ea as c,ra as S,ya as f,z as p}from"./chunk-5LC5EQRR.js";var Z=(()=>{class a{http=c(R);translateService=c(h);csvDownloadService=c(y);exerciseResourceUrl="api/assessment/exercises";resultResourceUrl="api/assessment/results";participationResourceUrl="api/assessment/participations";MAX_VALUE_PROGRAMMING_RESULT_INTS=255;find(t){return this.http.get(`${this.resultResourceUrl}/${t}`,{observe:"response"}).pipe(p(e=>this.convertResultResponseDatesFromServer(e)))}getResultString(t,e,r){return t&&e?this.getResultStringDefinedParameters(t,e,r):(v("Tried to generate a result string, but either the result or exercise was undefined"),"")}getResultStringDefinedParameters(t,e,r){let i=g(t.score,m(e)),s=g(t.score*e.maxPoints/100,m(e));return e.type!==u.PROGRAMMING?o(t)?this.getResultStringNonProgrammingExerciseWithAIFeedback(t,i,s,r):this.getResultStringNonProgrammingExercise(i,s,r):this.getResultStringProgrammingExercise(t,e,i,s,r)}getResultStringNonProgrammingExerciseWithAIFeedback(t,e,r,i){let s="";return t&&o(t)&&t.successful===void 0?this.translateService.instant("artemisApp.result.resultString.automaticAIFeedbackInProgress"):t&&o(t)&&t.successful===!1?this.translateService.instant("artemisApp.result.resultString.automaticAIFeedbackFailed"):(s=this.getResultStringNonProgrammingExercise(e,r,i),`${s} (${this.translateService.instant("artemisApp.result.preliminary")})`)}getResultStringNonProgrammingExercise(t,e,r){return r?this.translateService.instant("artemisApp.result.resultString.short",{relativeScore:t}):this.translateService.instant("artemisApp.result.resultString.nonProgramming",{relativeScore:t,points:e})}getResultStringProgrammingExercise(t,e,r,i,s){let n;T(t)?n=this.translateService.instant("artemisApp.result.resultString.automaticAIFeedbackFailed"):N(t)?n=this.translateService.instant("artemisApp.result.resultString.automaticAIFeedbackInProgress"):D(t)?n=this.translateService.instant("artemisApp.result.resultString.automaticAIFeedbackTimedOut"):G(t)?n=this.translateService.instant("artemisApp.result.resultString.automaticAIFeedbackSuccessful"):t.submission&&t.submission.buildFailed?n=this.translateService.instant("artemisApp.result.resultString.buildFailed"):t.testCaseCount?n=this.translateService.instant("artemisApp.result.resultString.buildSuccessfulTests",{numberOfTestsPassed:t.passedTestCaseCount>=this.MAX_VALUE_PROGRAMMING_RESULT_INTS?`${this.MAX_VALUE_PROGRAMMING_RESULT_INTS}+`:t.passedTestCaseCount,numberOfTestsTotal:t.testCaseCount>=this.MAX_VALUE_PROGRAMMING_RESULT_INTS?`${this.MAX_VALUE_PROGRAMMING_RESULT_INTS}+`:t.testCaseCount}):n=this.translateService.instant("artemisApp.result.resultString.buildSuccessfulNoTests");let d=this.getBaseResultStringProgrammingExercise(t,r,i,n,s);return _(t)&&M(t,e)&&(d+=" ("+this.translateService.instant("artemisApp.result.preliminary")+")"),d}getBaseResultStringProgrammingExercise(t,e,r,i,s){return o(t)?i:s?t.testCaseCount?this.translateService.instant("artemisApp.result.resultString.short",{relativeScore:e}):this.translateService.instant("artemisApp.result.resultString.programmingShort",{relativeScore:e,buildAndTestMessage:i}):t.codeIssueCount&&t.codeIssueCount>0?this.translateService.instant("artemisApp.result.resultString.programmingCodeIssues",{relativeScore:e,buildAndTestMessage:i,numberOfIssues:t.codeIssueCount>=this.MAX_VALUE_PROGRAMMING_RESULT_INTS?`${this.MAX_VALUE_PROGRAMMING_RESULT_INTS}+`:t.codeIssueCount,points:r}):this.translateService.instant("artemisApp.result.resultString.programming",{relativeScore:e,buildAndTestMessage:i,points:r})}getResultsForExerciseWithPointsPerGradingCriterion(t,e){let r=b(e);return this.http.get(`${this.exerciseResourceUrl}/${t}/results-with-points-per-criterion`,{params:r,observe:"response"}).pipe(p(i=>this.convertResultsWithPointsResponse(i)))}getFeedbackDetailsForResult(t,e){return this.http.get(`${this.participationResourceUrl}/${t}/results/${e.id}/details`,{observe:"response"}).pipe(p(r=>((r.body??[]).forEach(s=>s.result=e),r)))}convertResultDatesFromClient(t){return Object.assign({},t,{completionDate:P(t.completionDate),submission:void 0})}convertArrayResponse(t){return t.body&&t.body.forEach(e=>this.convertResultDatesFromServer(e)),t}convertResultsWithPointsResponse(t){return t.body&&t.body.forEach(e=>{this.convertResultDatesFromServer(e.result);let r=new Map;e.pointsPerCriterion&&Object.entries(e.pointsPerCriterion).forEach(([i,s])=>{r.set(+i,s)}),e.pointsPerCriterion=r}),t}convertResultDatesFromServer(t){t.completionDate=E(t.completionDate),F.convertParticipationDatesFromServer(t.participation),C.convertSubmissionDateFromServer(t.submission)}convertResultResponseDatesFromServer(t){return t.body&&this.convertResultDatesFromServer(t.body),t}getResultsWithPointsPerGradingCriterion(t){return this.getResultsForExerciseWithPointsPerGradingCriterion(t.id,{withSubmissions:t.type===u.MODELING}).pipe(S(e=>e.body.map(r=>{let i=r.result;return r.result=a.processReceivedResult(t,i),r})))}static processReceivedResult(t,e){return e.participation&&(e.participation.results=[e],e.participation.exercise=t,e.submission&&(e.participation.submissions=[e.submission])),e.durationInMinutes=a.durationInMinutes(e.completionDate,e.participation?.initializationDate??t.releaseDate),e}static durationInMinutes(t,e){return A(t).diff(e,"minutes")}triggerDownloadCSV(t,e){let r="data:text/csv;charset=utf-8,"+t.join(`
`);this.csvDownloadService.downloadCSV(r,e)}static evaluateBadge(t,e){return(t.type===l.STUDENT||t.type===l.PROGRAMMING)&&I(t)?{class:"bg-secondary",text:"artemisApp.result.practice",tooltip:"artemisApp.result.practiceTooltip"}:e.rated?{class:"bg-success",text:"artemisApp.result.graded",tooltip:"artemisApp.result.gradedTooltip"}:{class:"bg-info",text:"artemisApp.result.notGraded",tooltip:"artemisApp.result.notGradedTooltip"}}static \u0275fac=function(e){return new(e||a)};static \u0275prov=f({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();export{Z as a};
//# sourceMappingURL=chunk-5M3YV54C.js.map
