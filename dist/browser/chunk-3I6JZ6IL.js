import{b as K}from"./chunk-GGF54D4U.js";import{a as J}from"./chunk-VJKFYSDP.js";import{a as q}from"./chunk-FLFES4R7.js";import{a as $}from"./chunk-SLVT6IA5.js";import{e as u,f as s}from"./chunk-FAFORKWV.js";import{h as H,i as Z}from"./chunk-5AQXEKLE.js";import{b as Q}from"./chunk-O26CMRR4.js";import{a as z}from"./chunk-JHBUBEY6.js";import{e as j}from"./chunk-CK7FH6VF.js";import{h as N}from"./chunk-CT44YL7Q.js";import{K as U}from"./chunk-VZRSC3LP.js";import{c as k}from"./chunk-JXJXC4DZ.js";import{d as W}from"./chunk-EDXSOKK5.js";import{c as Y}from"./chunk-CXQURQM5.js";import{Ba as w,wd as B}from"./chunk-Z4VHWOB5.js";import{a as X}from"./chunk-U54OSGNH.js";import{f as F,h as M}from"./chunk-M6Z6DKZQ.js";import{i as D}from"./chunk-IOA4DPXY.js";import{Db as h,Ea as n,Ed as G,L as d,La as v,Oc as g,P as f,Tb as E,Yc as _,Zb as A,Zc as y,_c as L,cd as O,dd as a,kc as b,ra as o,s as R,sc as S,t as m,z as T,zc as x}from"./chunk-5LC5EQRR.js";var p=function(t){return t.CLEAR="CLEAR",t.INITIALIZING="INITIALIZING",t.FETCHING_FAILED="FETCHING_FAILED",t.CREATING_ASSIGNMENT_REPO="CREATING_ASSIGNMENT_REPO",t.DELETING_ASSIGNMENT_REPO="DELETING_ASSIGNMENT_REPO",t}(p||{}),Ii=(()=>{class t{codeEditorContainer;router=n(M);exerciseService=n($);courseExerciseService=n(q);domainService=n(J);location=n(D);participationService=n(j);route=n(F);alertService=n(k);ButtonSize=Q;LOADING_STATE=p;PROGRAMMING=Y.PROGRAMMING;paramSub;exercise;course;selectedParticipation;selectedRepository;selectedRepositoryId;selectedAuxiliaryRepositoryName;domainChangeSubscription;loadingState=p.CLEAR;ngOnInit(){this.paramSub&&this.paramSub.unsubscribe(),this.paramSub=this.route.params.subscribe(i=>{let e=Number(i.exerciseId),l=i.repositoryType,c=Number(i.repositoryId);this.loadingState=p.INITIALIZING,this.loadExercise(e).pipe(f(()=>m(()=>new Error("exerciseNotFound"))),o(r=>{this.exercise=r,this.course=r.course??r.exerciseGroup.exam.course}),o(()=>{if(l===s.TESTS)this.saveChangesAndSelectDomain([u.TEST_REPOSITORY,this.exercise]);else if(l===s.AUXILIARY){let r=this.exercise.auxiliaryRepositories?.find(C=>C.id===c);r&&(this.selectedAuxiliaryRepositoryName=r.name,this.saveChangesAndSelectDomain([u.AUXILIARY_REPOSITORY,r]))}else{let r=this.getNextAvailableParticipation(c);if(r){if(this.selectParticipationDomainById(r.id),r.id!==c){let C=this.router.url.substring(0,this.router.url.lastIndexOf("/"));this.location.replaceState(C+`/${r.id}`)}}else m(()=>new Error("participationNotFound"))}}),o(()=>{this.domainChangeSubscription||(this.domainChangeSubscription=this.subscribeToDomainChange())})).subscribe({next:()=>{this.loadingState=p.CLEAR},error:r=>{this.loadingState=p.FETCHING_FAILED,this.onError(r.message)}})})}ngOnDestroy(){this.domainChangeSubscription&&this.domainChangeSubscription.unsubscribe(),this.paramSub&&this.paramSub.unsubscribe()}getNextAvailableParticipation(i){let e=[this.exercise.templateParticipation,this.exercise.solutionParticipation,this.exercise.studentParticipations&&this.exercise.studentParticipations.length?this.exercise.studentParticipations[0]:void 0].filter(Boolean);return[e.find(({id:c})=>c===i),...e].filter(Boolean).find(({repositoryUri:c})=>!!c)}subscribeToDomainChange(){return this.domainService.subscribeDomainChange().pipe(d(i=>!!i),T(i=>i),o(([i,e])=>{this.applyDomainChange(i,e)})).subscribe()}applyDomainChange(i,e){this.codeEditorContainer!=null&&this.codeEditorContainer.initializeProperties(),i===u.AUXILIARY_REPOSITORY?(this.selectedRepository=s.AUXILIARY,this.selectedRepositoryId=e.id):i===u.PARTICIPATION?this.setSelectedParticipation(e.id):(this.selectedParticipation=this.exercise.templateParticipation,this.selectedRepository=s.TESTS)}setSelectedParticipation(i){let e=this.exercise;i===this.exercise.templateParticipation.id?(this.selectedRepository=s.TEMPLATE,this.selectedParticipation=this.exercise.templateParticipation,this.selectedParticipation.programmingExercise=e):i===this.exercise.solutionParticipation.id?(this.selectedRepository=s.SOLUTION,this.selectedParticipation=this.exercise.solutionParticipation,this.selectedParticipation.programmingExercise=e):this.exercise.studentParticipations?.length&&i===this.exercise.studentParticipations[0].id?(this.selectedRepository=s.ASSIGNMENT,this.selectedParticipation=this.exercise.studentParticipations[0],this.selectedParticipation.exercise=e):this.onError("participationNotFound")}repositoryUri(i){return i?.repositoryUri}loadExercise(i){return this.exercise&&this.exercise.id===i?R(this.exercise):this.exerciseService.findWithTemplateAndSolutionParticipationAndResults(i).pipe(T(({body:e})=>e))}selectParticipationDomainById(i){i===this.exercise.templateParticipation.id?(this.exercise.templateParticipation.programmingExercise=this.exercise,this.saveChangesAndSelectDomain([u.PARTICIPATION,this.exercise.templateParticipation])):i===this.exercise.solutionParticipation.id?(this.exercise.solutionParticipation.programmingExercise=this.exercise,this.saveChangesAndSelectDomain([u.PARTICIPATION,this.exercise.solutionParticipation])):this.exercise.studentParticipations?.length&&i===this.exercise.studentParticipations[0].id?(this.exercise.studentParticipations[0].exercise=this.exercise,this.saveChangesAndSelectDomain([u.PARTICIPATION,this.exercise.studentParticipations[0]])):this.onError("participationNotFound")}saveChangesAndSelectDomain(i){this.codeEditorContainer!=null&&this.codeEditorContainer.actions.onSave(),this.domainService.setDomain(i)}selectTemplateParticipation(){this.router.navigate(["../..",s.TEMPLATE,this.exercise.templateParticipation.id],{relativeTo:this.route})}selectSolutionParticipation(){this.router.navigate(["../..",s.SOLUTION,this.exercise.solutionParticipation.id],{relativeTo:this.route})}selectAssignmentParticipation(){this.router.navigate(["../..",s.USER,this.exercise.studentParticipations[0].id],{relativeTo:this.route})}selectTestRepository(){this.router.navigate(["../..",s.TESTS,"test"],{relativeTo:this.route})}selectAuxiliaryRepository(i){this.router.navigate(["../..",s.AUXILIARY,i],{relativeTo:this.route})}createAssignmentParticipation(){return this.loadingState=p.CREATING_ASSIGNMENT_REPO,this.courseExerciseService.startExercise(this.exercise.id).pipe(f(()=>m(()=>new Error("participationCouldNotBeCreated"))),o(i=>{this.exercise.studentParticipations=[i],this.loadingState=p.CLEAR})).subscribe({error:i=>this.onError(i.message)})}deleteAssignmentParticipation(){this.loadingState=p.DELETING_ASSIGNMENT_REPO,this.selectedRepository===s.ASSIGNMENT&&this.selectTemplateParticipation();let i=this.exercise.studentParticipations[0].id;this.exercise.studentParticipations=[],this.participationService.delete(i,{deleteBuildPlan:!0,deleteRepository:!0}).pipe(f(()=>m(()=>new Error("participationCouldNotBeDeleted"))),o(()=>{this.loadingState=p.CLEAR})).subscribe({error:e=>this.onError(e.message)})}onError(i){this.alertService.error(`artemisApp.editor.errors.${i}`)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=E({type:t,selectors:[["ng-component"]],viewQuery:function(e,l){if(e&1&&_(K,5),e&2){let c;y(c=L())&&(l.codeEditorContainer=c.first)}},decls:0,vars:0,template:function(e,l){},encapsulation:2})}return t})();function ii(t,P){if(t&1&&(a(0,`
    `),x(1,"fa-icon",1),a(2,`
`)),t&2){let i=g(),e=O(3);h(),b("icon",i.faExclamationTriangle)("ngbTooltip",e)}}function ei(t,P){if(t&1&&(a(0,`
    `),x(1,"fa-icon",2),a(2,`
`)),t&2){let i=g();h(),b("icon",i.faCheckCircle)}}function ti(t,P){t&1&&(a(0,`
        `),x(1,"div",3),a(2,`
    `))}function ri(t,P){t&1&&(a(0,`
        `),x(1,"div",4),a(2,`
    `))}function si(t,P){if(t&1&&(a(0,`
    `),A(1,ti,3,0)(2,ri,3,0)),t&2){let i=g();h(),S(i.issues.includes(i.ProgrammingExerciseIssues.TEMPLATE_PASSING)?1:-1),h(),S(i.issues.includes(i.ProgrammingExerciseIssues.SOLUTION_FAILING)?2:-1)}}var I=function(t){return t.TEMPLATE_PASSING="TEMPLATE_PASSING",t.SOLUTION_FAILING="SOLUTION_FAILING",t}(I||{}),wi=(()=>{class t{participationWebsocketService=n(z);ProgrammingExerciseIssues=I;templateParticipation;solutionParticipation;exercise;templateParticipationSubscription;solutionParticipationSubscription;issues=[];faExclamationTriangle=B;faCheckCircle=w;ngOnChanges(i){H(i)&&(this.templateParticipationSubscription&&this.templateParticipationSubscription.unsubscribe(),this.templateParticipationSubscription=this.participationWebsocketService.subscribeForLatestResultOfParticipation(this.templateParticipation.id,!1,this.exercise.id).pipe(d(e=>!!e),o(e=>this.templateParticipation.results=[e]),o(()=>this.findIssues())).subscribe()),Z(i)&&(this.solutionParticipationSubscription&&this.solutionParticipationSubscription.unsubscribe(),this.solutionParticipationSubscription=this.participationWebsocketService.subscribeForLatestResultOfParticipation(this.solutionParticipation.id,!1,this.exercise.id).pipe(d(e=>!!e),o(e=>this.solutionParticipation.results=[e]),o(()=>this.findIssues())).subscribe()),this.findIssues()}findIssues(){let i=N(this.templateParticipation.results),e=N(this.solutionParticipation.results);this.issues=[i&&i.score>0?I.TEMPLATE_PASSING:void 0,e&&!e.successful?I.SOLUTION_FAILING:void 0].filter(Boolean)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=E({type:t,selectors:[["jhi-programming-exercise-instructor-exercise-status"]],inputs:{templateParticipation:"templateParticipation",solutionParticipation:"solutionParticipation",exercise:"exercise"},features:[v],decls:5,vars:1,consts:[["tooltipContent",""],["size","2x","placement","bottom auto",1,"text-warning",3,"icon","ngbTooltip"],["size","2x",1,"text-success",3,"icon"],["jhiTranslate","artemisApp.programmingExercise.status.templateFulfillsTest"],["jhiTranslate","artemisApp.programmingExercise.status.solutionFailsTest"]],template:function(e,l){e&1&&(A(0,ii,3,2)(1,ei,3,1)(2,si,3,2,"ng-template",null,0,G),a(4,`
`)),e&2&&S(l.issues.length?0:1)},dependencies:[W,U,X],encapsulation:2})}return t})();export{Ii as a,wi as b};
//# sourceMappingURL=chunk-3I6JZ6IL.js.map
