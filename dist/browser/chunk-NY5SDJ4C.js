import{b as g}from"./chunk-W3K7VYWC.js";import{a as S}from"./chunk-65Z25AP3.js";import{a as f}from"./chunk-N4VVKRBU.js";import{j as h}from"./chunk-3JSWSN6W.js";import{a as p}from"./chunk-JHBUBEY6.js";import{a as m}from"./chunk-7VLYAOO4.js";import{Ea as n,L as u,f as b,ra as a,ya as l,z as c}from"./chunk-5LC5EQRR.js";var y=(()=>{class o{submissionService=n(g);participationWebsocketService=n(p);orionConnectorService=n(m);buildLogService=n(f);buildFinished=new b;resultSubscription;buildLogSubscription;latestResult;buildAndTestExercise(t){let e=t.studentParticipations[0].id;this.submissionService.triggerBuild(e).subscribe(),this.listenOnBuildOutputAndForwardChanges(t)}listenOnBuildOutputAndForwardChanges(t,e){let r=e?e.id:t.studentParticipations[0].id;return this.orionConnectorService.onBuildStarted(t.problemStatement),this.resultSubscription&&this.resultSubscription.unsubscribe(),this.buildLogSubscription&&this.buildLogSubscription.unsubscribe(),this.resultSubscription=this.participationWebsocketService.subscribeForLatestResultOfParticipation(r,!0).pipe(u(Boolean),c(i=>i),u(i=>!this.latestResult||this.latestResult.id<i.id),a(i=>{this.latestResult=i,!i.submission||i.submission.buildFailed?this.forwardBuildLogs(r,t.programmingLanguage,t.projectType):(i.feedbacks.filter(s=>h.isTestCaseFeedback(s)).forEach(s=>this.orionConnectorService.onTestResult(!!s.positive,s.testCase.testName,s.detailText)),this.orionConnectorService.onBuildFinished(),this.buildFinished.next()),this.participationWebsocketService.unsubscribeForLatestResultOfParticipation(r,t)})).subscribe(),this.buildFinished}forwardBuildLogs(t,e,r){this.buildLogSubscription=this.buildLogService.getBuildLogs(t).pipe(c(i=>new S(...i)),a(i=>{let d=i.extractErrors(e,r);this.orionConnectorService.onBuildFailed(d),this.buildFinished.next()})).subscribe()}static \u0275fac=function(e){return new(e||o)};static \u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();export{y as a};
//# sourceMappingURL=chunk-NY5SDJ4C.js.map
