import{a as et,b as it,c as ot,d as at}from"./chunk-5XX2X5VF.js";import{a as nt,b as rt,c as st}from"./chunk-6I3MUES2.js";import{a as tt,b as M}from"./chunk-NOW2PQV7.js";import{a as dt}from"./chunk-RGQYMQQL.js";import{a as Z}from"./chunk-JRBFEQNN.js";import{a as J}from"./chunk-O26CMRR4.js";import{c as V,d as y,g as S,h as I,j as k}from"./chunk-2CUFQLAH.js";import{f as K}from"./chunk-MKPB4JKY.js";import{d as Y}from"./chunk-EDXSOKK5.js";import{Bc as Q,eb as q,m as $}from"./chunk-Z4VHWOB5.js";import{a as X}from"./chunk-U54OSGNH.js";import{a as j,f as N,h as U}from"./chunk-M6Z6DKZQ.js";import{d as R,n as G}from"./chunk-IOA4DPXY.js";import{Bb as A,Db as s,Dc as v,Ea as a,L as B,Ma as x,Mc as p,Na as _,Oc as d,Tb as w,Yc as D,Zb as f,Zc as W,_c as L,dd as n,j as O,kc as h,oa as z,rd as P,s as T,sc as u,wb as E,xc as l,yc as c,yd as F,zc as g,zd as H}from"./chunk-5LC5EQRR.js";import{h as ct}from"./chunk-3E746U5Y.js";var b=ct(dt());var lt=(()=>{class o{document=a(R);router=a(U);dialog=a(M);dialogData=a(tt);initialWidth=400;initialHeight=600;fullWidthFactor=.93;fullHeightFactor=.85;isMobile=!1;fullSize=!1;ButtonType=J;navigationSubscription;constructor(){this.navigationSubscription=this.router.events.subscribe(t=>{t instanceof j&&this.dialog.closeAll()})}onResize(){this.setPositionAndScale()}ngAfterViewInit(){(0,b.default)(".chat-widget").resizable({edges:{left:!0,right:!0,bottom:!0,top:".chat-widget-top-resize-area"},listeners:{move:t=>{let e=t.target,i=parseFloat(e.getAttribute("data-x"))||0,r=parseFloat(e.getAttribute("data-y"))||0;e.style.width=t.rect.width+"px",e.style.height=t.rect.height+"px";let C=this.document.querySelector(".cdk-overlay-container").getBoundingClientRect();this.fullSize=!(t.rect.width<C.width*this.fullWidthFactor||t.rect.height<C.height*this.fullHeightFactor),i+=t.deltaRect.left,r+=t.deltaRect.top,e.style.transform="translate("+i+"px,"+r+"px)",e.setAttribute("data-x",i),e.setAttribute("data-y",r)}},modifiers:[b.default.modifiers.restrictEdges({outer:".cdk-overlay-container"}),b.default.modifiers.restrictSize({min:{width:this.initialWidth,height:this.initialHeight}})],inertia:!0}).draggable({allowFrom:".chat-header",listeners:{move:t=>{let e=t.target,i=(parseFloat(e.getAttribute("data-x"))||0)+t.dx,r=(parseFloat(e.getAttribute("data-y"))||0)+t.dy;e.style.transform="translate("+i+"px, "+r+"px)",e.setAttribute("data-x",i),e.setAttribute("data-y",r)}},inertia:!0,modifiers:[b.default.modifiers.restrictRect({restriction:".cdk-overlay-container",endOnly:!0})]}),this.setPositionAndScale()}setPositionAndScale(){let t=this.document.querySelector(".cdk-overlay-container")?.getBoundingClientRect();if(!t)return;this.isMobile=t.width<600;let e,i;this.fullSize||this.isMobile?(e=t.width*(1-this.fullWidthFactor)/2,i=t.height*(1-this.fullHeightFactor)/2):(e=t.width-this.initialWidth-20,i=t.height-this.initialHeight-20);let r=this.document.querySelector(".chat-widget");r.style.transform=`translate(${e}px, ${i}px)`,r.setAttribute("data-x",String(e)),r.setAttribute("data-y",String(i)),this.fullSize||this.isMobile?(r.style.width=`${t.width*this.fullWidthFactor}px`,r.style.height=`${t.height*this.fullHeightFactor}px`):(r.style.width=`${this.initialWidth}px`,r.style.height=`${this.initialHeight}px`)}ngOnDestroy(){this.toggleScrollLock(!1)}closeChat(){this.dialog.closeAll()}toggleFullSize(){this.fullSize=!this.fullSize,this.setPositionAndScale()}toggleScrollLock(t){t?document.body.classList.add("cdk-global-scroll"):document.body.classList.remove("cdk-global-scroll")}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=w({type:o,selectors:[["jhi-chatbot-widget"]],hostBindings:function(e,i){e&1&&p("resize",function(C){return i.onResize(C)},!1,A)},decls:11,vars:3,consts:[[1,"container",3,"mouseenter","mouseleave"],[1,"chat-widget"],[3,"fullSizeToggle","closeClicked","fullSize","showCloseButton","isChatGptWrapper"],[1,"chat-widget-top-resize-area"]],template:function(e,i){e&1&&(l(0,"div",0),p("mouseenter",function(){return i.toggleScrollLock(!0)})("mouseleave",function(){return i.toggleScrollLock(!1)}),n(1,`
    `),n(2,`
    `),l(3,"div",1),n(4,`
        `),l(5,"jhi-iris-base-chatbot",2),p("fullSizeToggle",function(){return i.toggleFullSize()})("closeClicked",function(){return i.closeChat()}),c(),n(6,`
        `),g(7,"div",3),n(8,`
    `),c(),n(9,`
`),c(),n(10,`
`)),e&2&&(s(5),h("fullSize",i.fullSize)("showCloseButton",!0)("isChatGptWrapper",(i.dialogData==null?null:i.dialogData.isChatGptWrapper)||!1))},dependencies:[at],styles:[".container[_ngcontent-%COMP%]{position:relative}.chat-widget[_ngcontent-%COMP%]{position:fixed;top:-20px;left:0;width:330px;height:430px;background-color:var(--iris-chat-widget-background);box-shadow:0 0 50px #0006;border-radius:var(--bs-border-radius-lg);display:flex;flex-direction:column}.chat-widget-top-resize-area[_ngcontent-%COMP%]{position:absolute;height:5px;width:100%;z-index:10}.ng-draggable[_ngcontent-%COMP%]{cursor:grab}.ng-dragging[_ngcontent-%COMP%]{cursor:grabbing}"]})}return o})();var pt=["chatBubble"],gt=o=>({"content-overflow":o});function ut(o,m){if(o&1&&(n(0,`
                `),l(1,"div",4),n(2,`
                    `),g(3,"span",5),n(4,`
                    `),g(5,"fa-icon",6),n(6,`
                `),c(),n(7,`
            `)),o&2){let t=d(3);s(5),h("icon",t.faAngleDoubleDown)}}function mt(o,m){if(o&1&&(n(0,`
            `),g(1,"span",3),F(2,"htmlForMarkdown"),n(3,`
            `),f(4,ut,8,1)),o&2){let t=d(2);s(),h("innerHTML",H(2,2,t.newIrisMessage),E),s(3),u(t.isOverflowing?4:-1)}}function ft(o,m){if(o&1){let t=v();n(0,`
            `),n(1,`
            `),l(2,"img",7),p("click",function(){x(t);let i=d(2);return _(i.handleButtonClick())}),c(),n(3,`
        `)}}function bt(o,m){if(o&1){let t=v();n(0,`
            `),l(1,"jhi-iris-logo",8),p("click",function(){x(t);let i=d(2);return _(i.handleButtonClick())}),c(),n(2,`
        `)}if(o&2){let t=d(2);s(),h("size",t.IrisLogoSize.MEDIUM)("look",t.IrisLogoLookDirection.LEFT)}}function Ct(o,m){if(o&1&&(n(0,`
            `),g(1,"fa-icon",9),n(2,`
        `)),o&2){let t=d(2);s(),h("icon",t.faCircle)}}function xt(o,m){if(o&1){let t=v();n(0,`
    `),l(1,"div",1,0),p("click",function(){x(t);let i=d();return _(i.handleButtonClick())}),n(3,`
        `),f(4,mt,5,4),c(),n(5,`
    `),l(6,"div",2),n(7,`
        `),f(8,ft,4,0)(9,bt,3,2)(10,Ct,3,1),c(),n(11,`
`)}if(o&2){let t=d();s(),h("ngClass",P(5,gt,t.isOverflowing))("@expandAnimation",t.newIrisMessage?"visible":"hidden"),s(3),u(t.newIrisMessage?4:-1),s(4),u(t.isChatGptWrapper?8:9),s(2),u(t.hasNewMessages?10:-1)}}var Xt=(()=>{class o{dialog=a(M);overlay=a(K);chatService=a(ot);route=a(N);mode;isChatGptWrapper=!1;dialogRef=null;chatOpen=!1;isOverflowing=!1;hasNewMessages=!1;newIrisMessage;CHAT_BUBBLE_TIMEOUT=1e4;numNewMessagesSubscription;paramsSubscription;latestIrisMessageSubscription;faCircle=q;faChevronDown=Q;faAngleDoubleDown=$;chatBubble;IrisLogoLookDirection=rt;IrisLogoSize=nt;ngOnInit(){this.paramsSubscription=this.route.params.subscribe(t=>{let e=this.mode==it.LECTURE?t.lectureId:t.exerciseId,i=parseInt(e,10);this.chatService.switchTo(this.mode,i)}),this.numNewMessagesSubscription=this.chatService.numNewMessages.subscribe(t=>{this.hasNewMessages=t>0}),this.latestIrisMessageSubscription=this.chatService.newIrisMessage.pipe(B(t=>!!t),z(t=>t.content&&t.content.length>0?T(t.content[0].textContent):O)).subscribe(t=>{this.newIrisMessage=t,setTimeout(()=>this.checkOverflow(),0),setTimeout(()=>{this.newIrisMessage=void 0,this.isOverflowing=!1},this.CHAT_BUBBLE_TIMEOUT)})}ngOnDestroy(){this.dialogRef&&this.dialogRef.close(),this.numNewMessagesSubscription?.unsubscribe(),this.paramsSubscription.unsubscribe(),this.latestIrisMessageSubscription.unsubscribe(),this.newIrisMessage=void 0,this.isOverflowing=!1}handleButtonClick(){this.chatOpen&&this.dialogRef?(this.dialog.closeAll(),this.chatOpen=!1):(this.openChat(),this.chatOpen=!0)}checkOverflow(){let t=this.chatBubble?.nativeElement;this.isOverflowing=!!t&&t.scrollHeight>t.clientHeight}openChat(){this.chatOpen=!0,this.newIrisMessage=void 0,this.isOverflowing=!1,this.dialogRef=this.dialog.open(lt,{hasBackdrop:!1,scrollStrategy:this.overlay.scrollStrategies.noop(),position:{bottom:"0px",right:"0px"},disableClose:!0,data:{isChatGptWrapper:this.isChatGptWrapper}}),this.dialogRef.afterClosed().subscribe(()=>this.handleDialogClose())}handleDialogClose(){this.chatOpen=!1,this.newIrisMessage=void 0}IrisTextMessageContent=et;static \u0275fac=function(e){return new(e||o)};static \u0275cmp=w({type:o,selectors:[["jhi-exercise-chatbot-button"]],viewQuery:function(e,i){if(e&1&&D(pt,5),e&2){let r;W(r=L())&&(i.chatBubble=r.first)}},inputs:{mode:"mode",isChatGptWrapper:"isChatGptWrapper"},decls:1,vars:1,consts:[["chatBubble",""],[1,"message-bubble",3,"click","ngClass"],[1,"chatbot-button"],[3,"innerHTML"],[1,"read-more"],["jhiTranslate","artemisApp.iris.chatBubble.seeFull"],[1,"read-more-icon",3,"icon"],["src","public/images/chatgpt-temp/ChatGPT_logo.svg","alt","Iris Logo",1,"iris-logo",2,"height","70px",3,"click"],[3,"click","size","look"],["size","xl",1,"unread-indicator",3,"icon"]],template:function(e,i){e&1&&f(0,xt,12,7),e&2&&u(i.chatOpen?-1:0)},dependencies:[G,X,Y,st,Z],styles:['.chatbot-button[_ngcontent-%COMP%]{position:absolute;bottom:20px;right:30px;z-index:9999;cursor:pointer;transition:all .1s ease-in-out}.chatbot-button[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.message-bubble[_ngcontent-%COMP%]{--r: 13px;position:absolute;z-index:50;bottom:100px;right:80px;width:350px;height:150px;background-color:var(--iris-client-chat-background);cursor:pointer;transition:all .1s ease-in-out;overflow-y:hidden;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;padding:10px;display:flex;border-radius:var(--r);border-bottom-right-radius:0;box-shadow:0 1px 2px #0003}.message-bubble[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.message-bubble[_ngcontent-%COMP%]:hover   .read-more[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{text-decoration:underline}.content-overflow[_ngcontent-%COMP%]:before{content:"";bottom:0;left:0;width:100%;height:100%;position:absolute;background:linear-gradient(0deg,var(--iris-chat-bubble-fade) 2%,transparent)}.read-more[_ngcontent-%COMP%]{position:absolute;bottom:5px;left:50%;transform:translate(-50%);padding:5px 10px;width:150px;font-size:14px;z-index:100;color:var(--link-color);transition:all .2s ease}.read-more[_ngcontent-%COMP%]:focus-visible{outline:2px solid var(--link-color);outline-offset:2px}.hidden[_ngcontent-%COMP%]{display:none}.btn-circle[_ngcontent-%COMP%]{width:40px;height:40px;padding:0;border-radius:50%}.unread-indicator[_ngcontent-%COMP%]{position:absolute;top:-10px;right:10px;width:10px;height:10px;color:var(--red)}'],data:{animation:[V("expandAnimation",[I("hidden",S({opacity:0,transform:"scale(0)",transformOrigin:"bottom right"})),I("visible",S({opacity:1,transform:"scale(1)",transformOrigin:"bottom right"})),k("hidden => visible",y("300ms ease-out")),k("visible => hidden",y("300ms ease-in"))])]}})}return o})();export{Xt as a};
//# sourceMappingURL=chunk-LPGL4A37.js.map
