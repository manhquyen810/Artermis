import{a as D,b as N}from"./chunk-RUZE5GXG.js";import{a as Pe}from"./chunk-FNJRUM5G.js";import{a as re}from"./chunk-MASKPWNP.js";import{a as Oe}from"./chunk-V55WZ52P.js";import{a as L,b as Ie,c as Ve,d as De}from"./chunk-GITU5WHL.js";import{a as te}from"./chunk-JCAGYDTX.js";import{a as y,b as ee}from"./chunk-OI2L2OHD.js";import{b as V,j as G}from"./chunk-3JSWSN6W.js";import{k as Fe,l as Me}from"./chunk-DXTZ4GAW.js";import{a as Se}from"./chunk-2QXIMOEO.js";import{K as Ce,q as ue,r as ke,s as _e}from"./chunk-VZRSC3LP.js";import{K as fe,c as de,h as me,m as pe,o as xe}from"./chunk-WA5GEAJB.js";import{a as Ae}from"./chunk-K3W6YFKH.js";import{c as Re}from"./chunk-JXJXC4DZ.js";import{d as Ee}from"./chunk-EDXSOKK5.js";import{b as ye}from"./chunk-R5BZWVRQ.js";import{k as Be}from"./chunk-CXQURQM5.js";import{Bb as Te,Oc as ve,Q as be,Y as ge,kb as he,wd as we}from"./chunk-Z4VHWOB5.js";import{a as J}from"./chunk-NOBD5HSR.js";import{a as Z}from"./chunk-U54OSGNH.js";import{f as j}from"./chunk-M6Z6DKZQ.js";import{Cb as ie,Db as s,Dc as h,Ea as b,La as ae,Ma as d,Mc as k,Na as m,Oc as l,Sc as K,Tb as w,Va as C,Yc as $,Zb as g,Zc as z,_c as q,dd as n,ed as I,fd as P,kc as f,lc as le,ld as Y,mc as H,md as W,nd as X,rd as oe,sc as _,uc as R,vc as A,wc as E,xc as c,yc as a,yd as F,zc as v,zd as M}from"./chunk-5LC5EQRR.js";import{j as ce}from"./chunk-3E746U5Y.js";var Ft=(()=>{class i{alertService=b(Re);accountService=b(ye);assessmentsService=b(Oe);structuredGradingCriterionService=b(L);exercise;userId;textBlockRefs;unusedTextBlockRefs;submission;getCourseFromExercise=Be;ngOnInit(){return ce(this,null,function*(){let e=yield this.accountService.identity();this.userId=e?.id})}computeTotalScore(e){let o=Me(this.exercise),t=this.structuredGradingCriterionService.computeTotalScore(e);return Fe(t,o)}handleSaveOrSubmitSuccessWithAlert(e,o){this.alertService.success(o)}handleError(e){let o=e.headers?.get("X-artemisApp-message")||e.message;this.alertService.error(o)}sortAndSetTextBlockRefs(e,o,t,r){let p=e.sort((Q,T)=>Q.block.startIndex-T.block.startIndex),u=0,Ne=r?.text?.length||0;for(let Q=0;Q<=p.length;Q++){let T=p[Q],O=T?T.block.startIndex:Ne;if(!T&&u>O)J("Illegal State: previous index cannot be greater than the last index!");else if(u>O){let B=o.pop();if(!B)J("Overlapping Text Blocks with nothing? previousRef: "+B+" ref: "+T);else if([T,B].every(S=>S.block?.type===y.AUTOMATIC))J("Overlapping AUTOMATIC Text Blocks! previousRef: "+B+" ref: "+T);else if([T,B].every(S=>S.block?.type===y.MANUAL)){let S=T;S.feedback||(S=B),S.block.startIndex!=B.block.startIndex&&S.block.endIndex!=O&&i.addTextBlockByIndices(B.block.startIndex,O,r,o),T=S}else switch(y.MANUAL){case B.block.type:t.push(T),T=B;break;case T.block.type:t.push(B),i.addTextBlockByIndices(B.block.startIndex,O,r,o);break}}else u<O&&(i.addTextBlockByIndices(u,O,r,o),u=O);T&&(o.push(T),u=T.block.endIndex)}}static addTextBlockByIndices(e,o,t,r){if(e>=o)return;let p=te.new();p.block&&(p.block.startIndex=e,p.block.endIndex=o,p.block.setTextFromSubmission(t)),r.push(p)}recalculateTextBlockRefs(){setTimeout(()=>{let e=[...this.textBlockRefs,...this.unusedTextBlockRefs].filter(({block:o,feedback:t})=>o.type===y.AUTOMATIC||!!t);this.textBlockRefs=[],this.unusedTextBlockRefs=[],this.sortAndSetTextBlockRefs(e,this.textBlockRefs,this.unusedTextBlockRefs,this.submission)})}get textBlocksWithFeedback(){return[...this.textBlockRefs,...this.unusedTextBlockRefs].filter(({block:e,feedback:o})=>e?.type===y.AUTOMATIC||!!o).map(({block:e})=>e)}static \u0275fac=function(o){return new(o||i)};static \u0275cmp=w({type:i,selectors:[["ng-component"]],decls:0,vars:0,template:function(o,t){},encapsulation:2})}return i})();function Ue(i,x){if(i&1&&(n(0,`
                                `),c(1,"span"),n(2),a(),n(3,`
                            `)),i&2){let e=l().$implicit;s(2),I(e.usageCount)}}function Qe(i,x){i&1&&n(0,`
                                \u221E
                            `)}function He(i,x){if(i&1){let e=h();n(0,`
    `),c(1,"li"),n(2,`
        `),c(3,"a",0),k("click",function(){let t=d(e).$implicit,r=l();return m(r.updateAssessmentWithDropdown(t))}),n(4,`
            `),c(5,"table",1),n(6,`
                `),c(7,"tbody"),n(8,`
                    `),c(9,"tr"),n(10,`
                        `),c(11,"td",2),n(12),a(),n(13,`
                        `),c(14,"td"),n(15,`
                            `),c(16,"span",3),n(17),a(),n(18,`
                        `),a(),n(19,`
                        `),c(20,"td",4),n(21,`
                            `),g(22,Ue,4,1)(23,Qe,1,0),v(24,"jhi-help-icon",5),n(25,`
                        `),a(),n(26,`
                    `),a(),n(27,`
                `),a(),n(28,`
            `),a(),n(29,`
        `),a(),n(30,`
    `),a(),n(31,`
`)}if(i&2){let e=x.$implicit,o=l();s(3),le("background-color",o.getInstrColour(e)),s(9),P("",e.credits,"P"),s(5),I(e.instructionDescription),s(5),_(e.usageCount?22:23)}}var We=(()=>{class i{didChange=new C;criterion;feedback=new G;updateAssessmentWithDropdown(e){this.feedback.gradingInstruction=e,this.feedback.credits=e.credits,this.feedback.correctionStatus=void 0,this.didChange.emit()}getInstrColour(e){if(e.credits===0)return"var(--sgi-assessment-layout-zero-background)";if(e.credits<0)return"var(--sgi-assessment-layout-negative-background)";if(e.credits>0)return"var(--sgi-assessment-layout-positive-background)"}static \u0275fac=function(o){return new(o||i)};static \u0275cmp=w({type:i,selectors:[["jhi-textblock-feedback-dropdown"]],inputs:{criterion:"criterion",feedback:"feedback"},outputs:{didChange:"didChange"},decls:2,vars:0,consts:[[1,"dropdown-item",3,"click"],[1,"table","layout-table"],[1,"td-score","fw-bold"],[1,"td-instruction"],[1,"td-usage-count"],["text","artemisApp.exercise.usageCountHint"]],template:function(o,t){o&1&&A(0,He,32,5,null,null,R),o&2&&E(t.criterion.structuredGradingInstructions)},dependencies:[Se],styles:[".dropdown-item[_ngcontent-%COMP%]{padding:0}a[_ngcontent-%COMP%]:hover{text-decoration:none!important;color:var(--bs-body-color)}.table[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(caption) > *[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{padding:.25rem .3rem}.layout-table[_ngcontent-%COMP%]{margin-bottom:0}.layout-table[_ngcontent-%COMP%]   .td-score[_ngcontent-%COMP%]{min-width:44px;width:44px;padding-right:0!important}.layout-table[_ngcontent-%COMP%]   .td-usage-count[_ngcontent-%COMP%]{width:37px}.layout-table[_ngcontent-%COMP%]   .td-instruction[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;white-space:break-spaces;width:max-content;max-width:30vw}"]})}return i})();var Ke=["detailText"];function $e(i,x){if(i&1&&(n(0,`
        `),v(1,"jhi-feedback-suggestion-badge",14),n(2,`
    `)),i&2){let e=l();s(),f("feedback",e.feedback)("useDefaultText",!0)}}function ze(i,x){if(i&1){let e=h();n(0,`
                `),c(1,"fa-icon",16),F(2,"artemisTranslate"),k("click",function(){d(e);let t=l(2);return m(t.dismiss())}),a(),n(3,`
            `)}if(i&2){let e=l(2);s(),f("icon",e.faTimes)("ngbTooltip",M(2,2,"artemisApp.textAssessment.feedbackEditor.dismissFeedback"))}}function qe(i,x){if(i&1){let e=h();n(0,`
                `),c(1,"jhi-confirm-icon",17),F(2,"artemisTranslate"),F(3,"artemisTranslate"),k("confirmEvent",function(){d(e);let t=l(2);return m(t.dismiss())}),a(),n(4,`
            `)}if(i&2){let e=l(2);s(),f("initialIcon",e.faTimes)("confirmIcon",e.faTrash)("initialTooltip",M(2,4,"artemisApp.textAssessment.feedbackEditor.dismissFeedback"))("confirmTooltip",M(3,6,"artemisApp.textAssessment.feedbackEditor.dismissFeedbackConfirmation"))}}function Ye(i,x){if(i&1&&(n(0,`
        `),c(1,"div",15),n(2,`
            `),g(3,ze,4,4)(4,qe,5,8),a(),n(5,`
    `)),i&2){let e=l();s(3),_(e.canDismiss?3:4)}}function Xe(i,x){if(i&1&&(n(0,`
                `),c(1,"div",18),n(2,`
                    `),c(3,"span",19),n(4),a(),n(5,`
                    `),v(6,"fa-icon",20),F(7,"artemisTranslate"),n(8,`
                `),a(),n(9,`
            `)),i&2){let e=l();s(4),I(e.feedback.gradingInstruction.feedback),s(2),f("icon",e.faQuestionCircle)("ngbTooltip",M(7,3,"artemisApp.assessment.feedbackHint"))}}function Je(i,x){if(i&1&&(n(0,`
            `),c(1,"div",21),n(2,`
                `),v(3,"jhi-grading-instruction-link-icon",22),n(4,`
            `),a(),n(5,`
        `)),i&2){let e=l();s(3),f("feedback",e.feedback)}}function Ze(i,x){if(i&1){let e=h();n(0,`
                            `),c(1,"ul",25),n(2,`
                                `),c(3,"jhi-textblock-feedback-dropdown",26),k("didChange",function(){d(e);let t=l(2);return m(t.didChange())}),a(),n(4,`
                            `),a(),n(5,`
                        `)}if(i&2){let e=l(2);s(3),f("criterion",e.criteria[0])("feedback",e.feedback)}}function et(i,x){if(i&1&&(n(0,`
                                            `),c(1,"a",29),n(2),v(3,"fa-icon",30),n(4," "),a(),n(5,`
                                        `)),i&2){let e=l().$implicit,o=l(3);s(2),P(" ",e.title,"\xA0"),s(),f("icon",o.faAngleRight)}}function tt(i,x){if(i&1&&(n(0,`
                                            `),c(1,"a",29),n(2,`(No title)
                                                `),v(3,"fa-icon",30),n(4,`
                                            `),a(),n(5,`
                                        `)),i&2){let e=l(4);s(3),f("icon",e.faAngleRight)}}function nt(i,x){if(i&1){let e=h();n(0,`
                                    `),c(1,"li"),n(2,`
                                        `),g(3,et,6,2)(4,tt,6,1),c(5,"ul",28),n(6,`
                                            `),c(7,"jhi-textblock-feedback-dropdown",26),k("didChange",function(){d(e);let t=l(3);return m(t.didChange())}),a(),n(8,`
                                        `),a(),n(9,`
                                    `),a(),n(10,`
                                `)}if(i&2){let e=x.$implicit,o=l(3);s(3),_(e.title?3:4),s(4),f("criterion",e)("feedback",o.feedback)}}function it(i,x){if(i&1&&(n(0,`
                            `),c(1,"ul",27),n(2,`
                                `),A(3,nt,11,3,null,null,R),a(),n(5,`
                        `)),i&2){let e=l(2);s(3),E(e.criteria)}}function ot(i,x){if(i&1&&(n(0,`
                    `),c(1,"div",23),n(2,`
                        `),v(3,"button",24),n(4,`
                        `),n(5,`
                        `),g(6,Ze,6,2)(7,it,6,0),a(),n(8,`
                `)),i&2){let e=l();s(6),_(e.criteria.length===1?6:7)}}function rt(i,x){if(i&1&&(n(0,`
                `),c(1,"span",31),n(2),F(3,"artemisTranslate"),a(),n(4,`
            `)),i&2){let e=l(2);s(2),P("",M(3,1,"artemisApp.exampleSubmission.feedback."+e.feedback.correctionStatus)," ")}}function st(i,x){if(i&1&&(n(0,`
                `),c(1,"span",32),n(2),F(3,"artemisTranslate"),a(),n(4,`
            `)),i&2){let e=l(2);s(2),P("",M(3,1,"artemisApp.exampleSubmission.feedback."+e.feedback.correctionStatus)," ")}}function ct(i,x){if(i&1&&(n(0,`
                `),v(1,"fa-icon",33),n(2,`
            `)),i&2){let e=l(2);s(),f("icon",e.faExclamationTriangle)}}function at(i,x){if(i&1&&(n(0,`
        `),c(1,"div"),n(2,`
            `),g(3,rt,5,3)(4,st,5,3)(5,ct,3,1),a(),n(6,`
    `)),i&2){let e=l();s(3),_(e.feedback.correctionStatus==="CORRECT"?3:-1),s(),_(e.feedback.correctionStatus!=="CORRECT"?4:-1),s(),_(e.feedback.correctionStatus!=="CORRECT"?5:-1)}}var se=(()=>{class i{route=b(j);structuredGradingCriterionService=b(L);textAssessmentAnalytics=b(N);FeedbackType=V;textBlock=new ee;feedback=new G;feedbackChange=new C;onClose=new C;onFocus=new C;textareaRef;confirmIconComponent;readOnly;highlightDifferences;criteria;textareaElement;Feedback=G;classes=!0;get neutralFeedbackClass(){return this.feedback.credits===0}get positiveFeedbackClass(){return this.feedback.credits>0}get negativeFeedbackClass(){return this.feedback.credits<0}faEdit=be;faQuestionCircle=he;faExclamationTriangle=we;faTimes=ve;faTrash=Te;faAngleRight=ge;constructor(){this.textAssessmentAnalytics.setComponentRoute(this.route)}ngAfterViewInit(){this.textareaElement=this.textareaRef.nativeElement,setTimeout(()=>this.textareaAutogrow())}textareaAutogrow(){this.textareaElement.style.height="0px",this.textareaElement.style.height=`${this.textareaElement.scrollHeight}px`}get canDismiss(){return this.feedback.credits===0&&(this.feedback.detailText||"").length===0}inFocus(){this.onFocus.emit()}dismiss(){this.onClose.emit(),this.textAssessmentAnalytics.sendAssessmentEvent(D.DELETE_FEEDBACK,this.feedback.type,this.textBlock.type)}escKeyup(){this.canDismiss?this.dismiss():this.confirmIconComponent.toggle()}focus(){this.textareaElement.focus()}onScoreClick(e){e.preventDefault(),this.feedback.correctionStatus=void 0}didChange(){let e=this.feedback.text;G.updateFeedbackTypeOnChange(this.feedback),this.feedbackChange.emit(this.feedback),e!==this.feedback.text&&this.textAssessmentAnalytics.sendAssessmentEvent(D.EDIT_AUTOMATIC_FEEDBACK,this.feedback.type,this.textBlock.type)}connectFeedbackWithInstruction(e){this.structuredGradingCriterionService.updateFeedbackWithStructuredGradingInstructionEvent(this.feedback,e),this.feedback.correctionStatus=void 0,this.didChange()}static \u0275fac=function(o){return new(o||i)};static \u0275cmp=w({type:i,selectors:[["jhi-text-block-feedback-editor"]],viewQuery:function(o,t){if(o&1&&($(Ke,5),$(re,5)),o&2){let r;z(r=q())&&(t.textareaRef=r.first),z(r=q())&&(t.confirmIconComponent=r.first)}},hostVars:10,hostBindings:function(o,t){o&2&&H("alert",t.classes)("alert-dismissible",t.classes)("alert-secondary",t.neutralFeedbackClass)("alert-success",t.positiveFeedbackClass)("alert-danger",t.negativeFeedbackClass)},inputs:{textBlock:"textBlock",feedback:"feedback",readOnly:"readOnly",highlightDifferences:"highlightDifferences",criteria:"criteria"},outputs:{feedbackChange:"feedbackChange",onClose:"onClose",onFocus:"onFocus"},decls:47,vars:23,consts:[["detailText",""],[1,"row"],[1,"form-group","col-md-10","m-0"],["jhiTranslate","artemisApp.assessment.detail.feedbackWithColon",1,"d-inline",3,"for"],[1,"form-group","col-md-1","text-end","m-0"],["jhiTranslate","artemisApp.exercise.score",3,"for"],[1,"row",3,"drop","dragover"],[1,"input-group"],[1,"input-group-prepend"],[1,"form-group","col-md-10"],["rows","1","id","feedback-editor-text-input",1,"form-control",3,"ngModelChange","keyup","keydown.escape","focus","placeholder","ngModel","readOnly","disabled"],[1,"form-group","col-md-1","text-end"],["type","number","step","0.5","id","feedback-editor-points-input",1,"form-control",3,"ngModelChange","keydown.escape","click","focus","ngModel","readOnly","disabled"],[3,"feedback","highlightDifferences"],[3,"feedback","useDefaultText"],[1,"close"],[3,"click","icon","ngbTooltip"],[3,"confirmEvent","initialIcon","confirmIcon","initialTooltip","confirmTooltip"],[1,"d-inline"],[1,"fw-bold"],[1,"text-secondary",3,"icon","ngbTooltip"],[1,"form-group","col-md-1","m-0"],[3,"feedback"],["ngbDropdown","",1,"dropdown"],["ngbDropdownToggle","","type","button",1,"btn","btn-primary","dropdown-toggle"],["ngbDropdownMenu",""],[3,"didChange","criterion","feedback"],["ngbDropdownMenu","",1,"dropdown-menu"],[1,"dropdown-menu","dropdown-submenu"],[1,"dropdown-item"],[1,"float-end",3,"icon"],[1,"text-success"],[1,"text-danger"],[1,"text-warning",3,"icon"]],template:function(o,t){if(o&1){let r=h();c(0,"div"),n(1,`
    `),g(2,$e,3,2)(3,Ye,6,1),c(4,"div",1),n(5,`
        `),c(6,"div",2),n(7,`
            `),v(8,"label",3),n(9,`
            `),g(10,Xe,10,5),a(),n(11,`
        `),c(12,"div",4),n(13,`
            `),v(14,"label",5),n(15,`
        `),a(),n(16,`
        `),g(17,Je,6,1),a(),n(18,`
    `),c(19,"div",6),k("drop",function(u){return d(r),m(t.connectFeedbackWithInstruction(u))})("dragover",function(u){return d(r),m(u.preventDefault())}),n(20,`
        `),c(21,"div",7),n(22,`
            `),c(23,"div",8),n(24,`
                `),g(25,ot,9,1),a(),n(26,`
            `),c(27,"div",9),n(28,`
                `),c(29,"textarea",10,0),F(31,"artemisTranslate"),F(32,"artemisTranslate"),X("ngModelChange",function(u){return d(r),W(t.feedback.detailText,u)||(t.feedback.detailText=u),m(u)}),k("keyup",function(){return d(r),m(t.textareaAutogrow())})("keydown.escape",function(){return d(r),m(t.escKeyup())})("focus",function(){return d(r),m(t.inFocus())})("ngModelChange",function(){return d(r),m(t.didChange())}),a(),n(33,`
            `),a(),n(34,`
            `),c(35,"div",11),n(36,`
                `),c(37,"input",12),X("ngModelChange",function(u){return d(r),W(t.feedback.credits,u)||(t.feedback.credits=u),m(u)}),k("keydown.escape",function(){return d(r),m(t.escKeyup())})("click",function(u){return d(r),m(t.onScoreClick(u))})("focus",function(){return d(r),m(t.inFocus())})("ngModelChange",function(){return d(r),m(t.didChange())}),a(),n(38,`
            `),a(),n(39,`
        `),a(),n(40,`
    `),a(),n(41,`
    `),n(42,`
    `),g(43,at,7,3),v(44,"jhi-assessment-correction-round-badge",13),n(45,`
`),a(),n(46,`
`)}o&2&&(s(2),_(t.Feedback.isFeedbackSuggestion(t.feedback)?2:-1),s(),_(t.readOnly?-1:3),s(5),K("for","detailText-",t.textBlock.id,""),s(2),_(t.feedback.gradingInstruction?10:-1),s(4),K("for","'score-",t.textBlock.id,""),s(3),_(t.feedback.gradingInstruction?17:-1),s(8),_(t.criteria?25:-1),s(4),f("placeholder",t.feedback.gradingInstruction?M(31,19,"artemisApp.assessment.additionalFeedbackCommentPlaceholder"):M(32,21,"artemisApp.assessment.feedbackCommentPlaceholder")),Y("ngModel",t.feedback.detailText),f("readOnly",t.readOnly)("disabled",t.readOnly),s(8),Y("ngModel",t.feedback.credits),f("readOnly",t.feedback.gradingInstruction||t.readOnly)("disabled",!!t.feedback.gradingInstruction||t.readOnly),s(6),_(t.feedback.correctionStatus!==void 0?43:-1),s(),f("feedback",t.feedback)("highlightDifferences",t.highlightDifferences))},dependencies:[Ie,Ee,Ce,re,Z,Ve,_e,ke,ue,We,fe,de,xe,me,pe,De,Ae],styles:["[_nghost-%COMP%]{display:block;width:100%}textarea.form-control[_ngcontent-%COMP%], textarea.form-control[_ngcontent-%COMP%]:focus, input.form-control[_ngcontent-%COMP%], input.form-control[_ngcontent-%COMP%]:focus{width:100%;background:var(--form-control-focus-background)}textarea[_ngcontent-%COMP%]{resize:none;overflow:hidden}input[_ngcontent-%COMP%]{text-align:right;min-width:70px}label[_ngcontent-%COMP%]{font-style:italic;width:100%}.close[_ngcontent-%COMP%]{display:inline;margin-top:-.5vh;float:right}.btn[_ngcontent-%COMP%]{position:relative;flex:none;z-index:auto}.dropdown[_ngcontent-%COMP%]{position:static;width:100%;overflow:auto}.dropdown-menu[_ngcontent-%COMP%]{position:absolute;padding:.2rem 0;cursor:pointer}.dropdown-menu[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%]{padding:.25rem .75rem}.dropdown-menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{position:relative}.dropdown-menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background-color:var(--textblock-feedback-editor-dropdown-hover)}.dropdown-menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover > .dropdown-submenu[_ngcontent-%COMP%]{display:block;position:absolute;left:100%;top:0;padding:0}a[_ngcontent-%COMP%]:hover{text-decoration:none!important;color:var(--bs-body-color)}"]})}return i})();function lt(i,x){if(i&1){let e=h();n(0,`
    `),c(1,"jhi-text-block-feedback-editor",1),k("click",function(){d(e);let t=l();return m(t.select(!1))})("onFocus",function(){d(e);let t=l();return m(t.select(!1))})("onClose",function(){d(e);let t=l();return m(t.unselect())})("feedbackChange",function(){d(e);let t=l();return m(t.feedbackDidChange())}),a(),n(2,`
`)}if(i&2){let e=l();s(),H("active",e.selected),f("textBlock",e.textBlockRef.block)("feedback",e.textBlockRef.feedback)("readOnly",e.readOnly)("highlightDifferences",e.highlightDifferences)("criteria",e.criteria)}}var ne=(()=>{class i{route=b(j);structuredGradingCriterionService=b(L);textAssessmentAnalytics=b(N);textBlockRef;selected=!1;readOnly;isMissedFeedback;highlightDifferences;criteria;didSelect=new C;didChange=new C;didDelete=new C;feedbackEditor;constructor(){this.textAssessmentAnalytics.setComponentRoute(this.route)}select(e=!0){this.readOnly||this.textBlockRef&&!this.textBlockRef.selectable||(this.didSelect.emit(this.textBlockRef),this.textBlockRef.initFeedback(),e&&(setTimeout(()=>this.feedbackEditor.focus()),!this.selected&&this.textBlockRef.feedback?.type===V.MANUAL&&this.textAssessmentAnalytics.sendAssessmentEvent(D.ADD_FEEDBACK_AUTOMATICALLY_SELECTED_BLOCK,V.MANUAL,y.AUTOMATIC)))}unselect(){this.didSelect.emit(void 0),delete this.textBlockRef.feedback,this.textBlockRef.block.type===y.MANUAL&&this.textBlockRef.deletable&&this.didDelete.emit(this.textBlockRef),this.feedbackDidChange()}feedbackDidChange(){this.didChange.emit(this.textBlockRef)}connectStructuredGradingInstructionsWithTextBlock(e){this.textBlockRef.selectable&&(this.select(),this.textBlockRef.feedback&&this.structuredGradingCriterionService.updateFeedbackWithStructuredGradingInstructionEvent(this.textBlockRef.feedback,e),this.feedbackDidChange())}static \u0275fac=function(o){return new(o||i)};static \u0275cmp=w({type:i,selectors:[["jhi-text-block-assessment-card"]],viewQuery:function(o,t){if(o&1&&$(se,5),o&2){let r;z(r=q())&&(t.feedbackEditor=r.first)}},inputs:{textBlockRef:"textBlockRef",selected:"selected",readOnly:"readOnly",isMissedFeedback:"isMissedFeedback",highlightDifferences:"highlightDifferences",criteria:"criteria"},outputs:{didSelect:"didSelect",didChange:"didChange",didDelete:"didDelete"},decls:5,vars:17,consts:[[3,"drop","dragover","click","draggable","textContent"],[1,"guided-tour-text-assessment",3,"click","onFocus","onClose","feedbackChange","textBlock","feedback","readOnly","highlightDifferences","criteria"]],template:function(o,t){o&1&&(n(0,`
`),c(1,"span",0),k("drop",function(p){return t.connectStructuredGradingInstructionsWithTextBlock(p)})("dragover",function(p){return p.preventDefault()})("click",function(){return t.select()}),a(),n(2,`
`),n(3,`
`),g(4,lt,3,7)),o&2&&(s(),H("text-with-feedback",!!t.textBlockRef.feedback)("active",t.selected)("positive-feedback",(t.textBlockRef.feedback==null?null:t.textBlockRef.feedback.credits)>0)("negative-feedback",(t.textBlockRef.feedback==null?null:t.textBlockRef.feedback.credits)<0)("neutral-feedback",(t.textBlockRef.feedback==null?null:t.textBlockRef.feedback.credits)===0)("clickable",t.textBlockRef.selectable)("highlighted",t.textBlockRef.highlighted),f("draggable",!0)("textContent",t.textBlockRef.block.text),s(3),_(t.textBlockRef.feedback||t.selected?4:-1))},dependencies:[se],styles:["span[_ngcontent-%COMP%]{white-space:pre-wrap}span[_ngcontent-%COMP%]:hover.clickable{background:var(--textblock-assessment-span-hover-background);padding:2px 4px;border-radius:4px}span.highlighted[_ngcontent-%COMP%]{color:var(--textblock-assessment-text-feedback-highlighted-color);background-color:var(--textblock-assessment-text-feedback-highlighted-background)}span.text-with-feedback[_ngcontent-%COMP%]{padding:2px 4px;border-radius:4px}span.text-with-feedback.active[_ngcontent-%COMP%]{text-decoration-line:underline}span.text-with-feedback.positive-feedback[_ngcontent-%COMP%]{color:var(--textblock-assessment-text-feedback-positive-color);background-color:var(--textblock-assessment-text-feedback-positive-background)}span.text-with-feedback.positive-feedback.active[_ngcontent-%COMP%]{text-decoration-style:double;text-decoration-color:var(--textblock-assessment-text-feedback-positive-active-decoration)}span.text-with-feedback.negative-feedback[_ngcontent-%COMP%]{color:var(--textblock-assessment-text-feedback-negative-color);background-color:var(--textblock-assessment-text-feedback-negative-background)}span.text-with-feedback.negative-feedback.active[_ngcontent-%COMP%]{text-decoration-style:wavy;text-decoration-color:var(--textblock-assessment-text-feedback-negative-active-decoration)}span.text-with-feedback.neutral-feedback[_ngcontent-%COMP%]{color:var(--textblock-assessment-text-feedback-neutral-color);background-color:var(--textblock-assessment-text-feedback-neutral-background)}span.text-with-feedback.neutral-feedback.active[_ngcontent-%COMP%]{text-decoration-style:dashed;text-decoration-color:var(--textblock-assessment-text-feedback-neutral-active-decoration)}jhi-text-block-feedback-editor[_ngcontent-%COMP%]{margin-top:1rem;border-width:0}jhi-text-block-feedback-editor.active[_ngcontent-%COMP%]{border:2px var(--textblock-assessment-textblock-feedback-editor-active-border) solid}"]})}return i})();function dt(i,x){if(i&1){let e=h();n(0,`
        `),c(1,"span",0),k("click",function(){let t=d(e),r=t.$implicit,p=t.$index,u=l();return u.calculateIndex(p),m(u.selectWord(r))}),n(2),a(),n(3,`
    `)}if(i&2){let e=x.$implicit;s(2),I(" "+e)}}var mt=/\n/g,pt=" ",je=(()=>{class i{route=b(j);textAssessmentAnalytics=b(N);textBlockRefGroup;submission;didSelectWord=new C;set words(e){this.submissionWords=e.getText(this.submission).replace(mt,`
 `).split(pt)}submissionWords;currentWordIndex;selectedWords=new Array;ready=!1;constructor(){this.textAssessmentAnalytics.setComponentRoute(this.route)}calculateIndex(e){let o=this.textBlockRefGroup.startIndex;for(let t=0;t<e;t++)o+=this.submissionWords[t].length+1,this.submissionWords[t].search(/\n+/g)!==-1&&o--;this.currentWordIndex=o}selectWord(e){this.selectedWords.length<2&&this.selectedWords.push({word:e,index:this.currentWordIndex}),this.selectedWords.length===2&&(this.ready=!0,this.selectedWords[0].index>this.selectedWords[1].index&&this.selectedWords.reverse()),this.ready&&(this.didSelectWord.emit(this.selectedWords),this.textAssessmentAnalytics.sendAssessmentEvent(D.ADD_FEEDBACK_MANUALLY_SELECTED_BLOCK,V.MANUAL,y.MANUAL))}static \u0275fac=function(o){return new(o||i)};static \u0275cmp=w({type:i,selectors:[["jhi-manual-text-selection"]],inputs:{textBlockRefGroup:"textBlockRefGroup",submission:"submission",words:"words"},outputs:{didSelectWord:"didSelectWord"},decls:6,vars:0,consts:[["tabindex","-1",1,"manual-text-selection-area",3,"click"]],template:function(o,t){o&1&&(c(0,"div"),n(1,`
    `),n(2,`
    `),A(3,dt,4,1,null,null,R),a(),n(5,`
`)),o&2&&(s(3),E(t.submissionWords))},styles:['@charset "UTF-8";.manual-text-selection-area[_ngcontent-%COMP%]{white-space:pre-wrap}span[_ngcontent-%COMP%]:hover, span[_ngcontent-%COMP%]:focus{background:var(--manual-text-selection-span-hover-background-color);padding:2px 4px;border-radius:4px;cursor:default}.indicator[_ngcontent-%COMP%]{background-color:#ffd7001a;z-index:999}.indicator__cta[_ngcontent-%COMP%]{top:20px;left:50%;position:absolute;color:#fff}.indicator__cta[_ngcontent-%COMP%]:hover{background-color:gold;color:#000}.indicator__cta-link[_ngcontent-%COMP%]{background-color:#333;border-radius:5px;bottom:0;box-shadow:2px 2px 5px #0000004d;color:#fff;cursor:pointer;left:0;padding:11px 22px 10px;position:absolute;transform:translate(-50%);white-space:nowrap}.indicator__cta-link[_ngcontent-%COMP%]:after{bottom:-11px;font-size:15px;left:50%;line-height:15px;content:"\\25bc";color:#333;position:absolute;transform:translate(-50%)}.indicator__cta-link[_ngcontent-%COMP%]:hover{background-color:gold;color:#000}.indicator__cta-link[_ngcontent-%COMP%]:hover:after{color:gold}']})}return i})();function xt(i,x){if(i&1){let e=h();n(0,`
        `),c(1,"jhi-text-block-assessment-card",0),k("didSelect",function(t){d(e);let r=l(2);return r.selectedRef=t,m(r.selectedRefChange.emit(t))})("didChange",function(){d(e);let t=l(2);return m(t.textBlockRefsChangeEmit())}),a(),n(2,`
    `)}if(i&2){let e=l().$implicit,o=l();s(),f("textBlockRef",e.singleRef)("selected",o.selectedRef===e.singleRef)("readOnly",o.readOnly)("criteria",o.criteria)}}function ft(i,x){if(i&1){let e=h();n(0,`
        `),n(1,`
        `),c(2,"jhi-manual-text-selection",1),k("didSelectWord",function(t){d(e);let r=l(2);return m(r.handleTextSelection(t))}),a(),n(3,`
    `)}if(i&2){let e=l().$implicit,o=l();s(2),f("submission",o.submission)("words",e)("textBlockRefGroup",e)}}function ut(i,x){if(i&1&&(n(0,`
    `),g(1,xt,3,4)(2,ft,4,3)),i&2){let e=x.$implicit;s(),_(e.singleRef?1:2)}}var Ge=(()=>{class i{set textBlockRefs(e){this.textBlockRefGroups=kt.fromTextBlockRefs(e)}get textBlockRefs(){return this.textBlockRefGroups.reduce((e,o)=>[...e,...o.refs],[])}selectedRef;readOnly;submission;criteria;textBlockRefsChange=new C;textBlockRefAdded=new C;selectedRefChange=new C;textBlockRefGroups;textBlockRefsChangeEmit(){this.textBlockRefsChange.emit(this.textBlockRefs)}handleTextSelection(e){let o=te.new(),t=o.block;if(t){t.startIndex=e[0].index,t.endIndex=e[1].index+e[1].word.length,t.setTextFromSubmission(this.submission);let r=this.textBlockRefs.find(p=>p.block?.id===t.id);r?(r.initFeedback(),this.selectedRefChange.emit(r)):(o.initFeedback(),this.textBlockRefAdded.emit(o))}}static \u0275fac=function(o){return new(o||i)};static \u0275cmp=w({type:i,selectors:[["jhi-manual-textblock-selection"]],inputs:{textBlockRefs:"textBlockRefs",selectedRef:"selectedRef",readOnly:"readOnly",submission:"submission",criteria:"criteria"},outputs:{textBlockRefsChange:"textBlockRefsChange",textBlockRefAdded:"textBlockRefAdded",selectedRefChange:"selectedRefChange"},decls:2,vars:0,consts:[[3,"didSelect","didChange","textBlockRef","selected","readOnly","criteria"],[3,"didSelectWord","submission","words","textBlockRefGroup"]],template:function(o,t){o&1&&A(0,ut,3,1,null,null,R),o&2&&E(t.textBlockRefGroups)},dependencies:[ne,je],encapsulation:2})}return i})(),kt=(()=>{class i{refs;constructor(e){this.refs=[e]}get hasFeedback(){return this.refs.length===1&&!!this.refs[0].feedback}get singleRef(){return this.hasFeedback?this.refs[0]:null}get startIndex(){return this.refs[0].block?.startIndex}get endIndex(){return this.refs.last()?.block?.endIndex}getText(e){let o=new ee;return o.startIndex=this.startIndex,o.endIndex=this.endIndex,o.setTextFromSubmission(e),o.text}addRef(e){this.refs.push(e)}static fromTextBlockRefs=e=>e.reduce((o,t)=>{let r=o.last();return r&&!r.hasFeedback&&!t.feedback?r.addRef(t):o.push(new i(t)),o},[])}return i})();var Le=i=>({count:i});function _t(i,x){if(i&1){let e=h();n(0,`
        `),c(1,"jhi-text-block-assessment-card",2),k("didSelect",function(t){d(e);let r=l(2);return m(r.didSelectRef(t))})("didChange",function(){d(e);let t=l(2);return m(t.textBlockRefsChangeEmit())})("didDelete",function(t){d(e);let r=l(2);return m(r.removeTextBlockRef(t))}),a(),n(2,`
    `)}if(i&2){let e=x.$implicit,o=x.$index,t=l(2);s(),K("id","text-feedback-block-",o,""),f("textBlockRef",e)("selected",t.selectedRef===e)("readOnly",t.readOnly)("highlightDifferences",t.highlightDifferences)("criteria",t.criteria)}}function Ct(i,x){if(i&1&&(n(0,`
    `),A(1,_t,3,7,null,null,R)),i&2){let e=l();s(),E(e.textBlockRefs)}}function bt(i,x){if(i&1){let e=h();n(0,`
    `),c(1,"jhi-manual-textblock-selection",3),X("textBlockRefsChange",function(t){d(e);let r=l();return W(r.textBlockRefs,t)||(r.textBlockRefs=t),m(t)})("selectedRefChange",function(t){d(e);let r=l();return W(r.selectedRef,t)||(r.selectedRef=t),m(t)}),k("textBlockRefAdded",function(t){d(e);let r=l();return m(r.addTextBlockRef(t))}),a(),n(2,`
`)}if(i&2){let e=l();s(),Y("textBlockRefs",e.textBlockRefs)("selectedRef",e.selectedRef),f("readOnly",e.readOnly)("submission",e.submission)("criteria",e.criteria)}}var xi=(()=>{class i{stringCountService=b(Pe);submission;textBlockRefs;readOnly;highlightDifferences;criteria;allowManualBlockSelection=!0;textBlockRefsChange=new C;textBlockRefsAddedRemoved=new C;autoTextBlockAssessment=!0;selectedRef;wordCount=0;characterCount=0;ngOnChanges(e){if(e.submission&&e.submission.currentValue){let{text:o}=e.submission.currentValue;this.wordCount=this.stringCountService.countWords(o),this.characterCount=this.stringCountService.countCharacters(o)}this.textBlockRefs.sort((o,t)=>o.block.startIndex-t.block.startIndex)}onAltToggle(e,o){this.allowManualBlockSelection&&(this.autoTextBlockAssessment=o)}textBlockRefsChangeEmit(){this.textBlockRefsChange.emit(this.textBlockRefs)}addTextBlockRef(e){this.textBlockRefs.push(e),this.textBlockRefsAddedRemoved.emit()}removeTextBlockRef(e){let o=this.textBlockRefs.findIndex(t=>t.block.id===e.block.id);this.textBlockRefs.splice(o,1),this.textBlockRefsAddedRemoved.emit()}didSelectRef(e){this.selectedRef=e}static \u0275fac=function(o){return new(o||i)};static \u0275cmp=w({type:i,selectors:[["jhi-text-assessment-area"]],hostBindings:function(o,t){o&1&&k("keydown.alt",function(p){return t.onAltToggle(p,!1)},!1,ie)("keyup.alt",function(p){return t.onAltToggle(p,!0)},!1,ie)},inputs:{submission:"submission",textBlockRefs:"textBlockRefs",readOnly:"readOnly",highlightDifferences:"highlightDifferences",criteria:"criteria",allowManualBlockSelection:"allowManualBlockSelection"},outputs:{textBlockRefsChange:"textBlockRefsChange",textBlockRefsAddedRemoved:"textBlockRefsAddedRemoved"},features:[ae],decls:9,vars:7,consts:[["id","text-assessment-word-count","jhiTranslate","artemisApp.textExercise.wordCount",1,"badge","bg-primary","mb-2",3,"translateValues"],["id","text-assessment-character-count","jhiTranslate","artemisApp.textExercise.characterCount",1,"badge","bg-primary","mb-2",3,"translateValues"],[3,"didSelect","didChange","didDelete","id","textBlockRef","selected","readOnly","highlightDifferences","criteria"],[3,"textBlockRefsChange","selectedRefChange","textBlockRefAdded","textBlockRefs","selectedRef","readOnly","submission","criteria"]],template:function(o,t){o&1&&(g(0,Ct,3,0)(1,bt,3,5),c(2,"div"),n(3,`
    `),v(4,"span",0),n(5,`
    `),v(6,"span",1),n(7,`
`),a(),n(8,`
`)),o&2&&(_(t.autoTextBlockAssessment?0:1),s(4),f("translateValues",oe(3,Le,t.wordCount)),s(2),f("translateValues",oe(5,Le,t.characterCount)))},dependencies:[ne,Ge,Z],styles:["[_nghost-%COMP%]{width:100%}"]})}return i})();export{Ft as a,xi as b};
//# sourceMappingURL=chunk-D4SD7QX4.js.map
