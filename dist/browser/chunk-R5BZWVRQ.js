import{p as I}from"./chunk-DID2YGL7.js";import{k as E}from"./chunk-CXQURQM5.js";import{b as y}from"./chunk-XUCCGZJR.js";import{b as v}from"./chunk-HKBU2OOC.js";import{a as g}from"./chunk-5ZXXURLP.js";import{b as m}from"./chunk-NOBD5HSR.js";import{c as f}from"./chunk-E2KBL4LX.js";import{L as o,O as A}from"./chunk-IOA4DPXY.js";import{Ea as n,P as d,_ as p,g as a,s as u,w as c,ya as l,z as h}from"./chunk-5LC5EQRR.js";var r=function(s){return s.ADMIN="ROLE_ADMIN",s.INSTRUCTOR="ROLE_INSTRUCTOR",s.EDITOR="ROLE_EDITOR",s.TA="ROLE_TA",s.USER="ROLE_USER",s}(r||{});var P=(()=>{class s{translateService=n(f);sessionStorage=n(y);http=n(A);websocketService=n(g);featureToggleService=n(v);userIdentityValue;authenticated=!1;authenticationState=new a(void 0);prefilledUsernameValue;get userIdentity(){return this.userIdentityValue}set userIdentity(e){this.userIdentityValue=e,this.authenticated=!!e,this.authenticationState.next(e),e?(this.websocketService.enableReconnect(),this.websocketService.connect(),this.featureToggleService.subscribeFeatureToggleUpdates()):(this.websocketService.disableReconnect(),this.websocketService.isConnected()&&this.websocketService.disconnect(),this.featureToggleService.unsubscribeFeatureToggleUpdates())}fetch(){return this.http.get("api/core/public/account",{observe:"response"})}save(e){return this.http.put("api/core/account",e,{observe:"response"})}authenticate(e){this.userIdentity=e}syncGroups(e){this.userIdentity.groups=e}hasAnyAuthority(e){return Promise.resolve(this.hasAnyAuthorityDirect(e))}hasAnyAuthorityDirect(e){if(!this.authenticated||!this.userIdentity||!this.userIdentity.authorities)return!1;for(let t=0;t<e.length;t++)if(this.userIdentity.authorities.includes(e[t]))return!0;return!1}hasAuthority(e){return this.authenticated?this.identity().then(t=>{let i=t.authorities;return Promise.resolve(i&&i.includes(e))},()=>Promise.resolve(!1)):Promise.resolve(!1)}hasGroup(e){return!this.authenticated||!this.userIdentity||!this.userIdentity.authorities||!this.userIdentity.groups||!e?!1:this.userIdentity.groups.some(t=>t===e)}identity(e){return e&&(this.userIdentity=void 0),this.userIdentity?Promise.resolve(this.userIdentity):c(this.fetch().pipe(h(t=>{let i=t.body;if(i){this.userIdentity=i,m({username:i.login});let T=this.userIdentity.langKey||this.sessionStorage.retrieve("locale");this.translateService.use(T)}else this.userIdentity=void 0;return this.userIdentity}),d(()=>(this.userIdentity=void 0,u(void 0)))))}isAtLeastTutorInCourse(e){return this.hasGroup(e?.instructorGroupName)||this.hasGroup(e?.editorGroupName)||this.hasGroup(e?.teachingAssistantGroupName)||this.hasAnyAuthorityDirect([r.ADMIN])}isAtLeastEditorInCourse(e){return this.hasGroup(e?.instructorGroupName)||this.hasGroup(e?.editorGroupName)||this.hasAnyAuthorityDirect([r.ADMIN])}isAtLeastInstructorInCourse(e){return this.hasGroup(e?.instructorGroupName)||this.hasAnyAuthorityDirect([r.ADMIN])}isAtLeastTutorForExercise(e){return this.isAtLeastTutorInCourse(e?.course||e?.exerciseGroup?.exam?.course)}isAtLeastEditorForExercise(e){return this.isAtLeastEditorInCourse(e?.course||e?.exerciseGroup?.exam?.course)}isAtLeastInstructorForExercise(e){return this.isAtLeastInstructorInCourse(e?.course||e?.exerciseGroup?.exam?.course)}isAdmin(){return this.hasAnyAuthorityDirect([r.ADMIN])}isAtLeastTutor(){return this.hasAnyAuthorityDirect([r.ADMIN,r.EDITOR,r.INSTRUCTOR,r.TA])}isAuthenticated(){return this.authenticated}getAuthenticationState(){return this.authenticationState.asObservable().pipe(p())}setAccessRightsForExerciseAndReferencedCourse(e){this.setAccessRightsForExercise(e);let t=E(e);t&&this.setAccessRightsForCourse(t)}setAccessRightsForCourseAndReferencedExercises(e){this.setAccessRightsForCourse(e),e.exercises&&e.exercises.forEach(t=>this.setAccessRightsForExercise(t))}setAccessRightsForExercise(e){e.isAtLeastTutor=this.isAtLeastTutorForExercise(e),e.isAtLeastEditor=this.isAtLeastEditorForExercise(e),e.isAtLeastInstructor=this.isAtLeastInstructorForExercise(e)}setAccessRightsForCourse(e){e.isAtLeastTutor=this.isAtLeastTutorInCourse(e),e.isAtLeastEditor=this.isAtLeastEditorInCourse(e),e.isAtLeastInstructor=this.isAtLeastInstructorInCourse(e)}isOwnerOfParticipation(e){if(e.student)return this.userIdentity?.login===e.student.login;if(e.team?.students)return e.team.students.some(t=>this.userIdentity?.login===t.login);throw new Error("Participation does not have any owners")}getImageUrl(){return this.isAuthenticated()&&this.userIdentity?this.userIdentity.imageUrl:void 0}setImageUrl(e){this.userIdentity!=null&&(this.userIdentity.imageUrl=e)}updateLanguage(e){return this.http.post("api/core/public/account/change-language",e)}getAndClearPrefilledUsername(){let e=this.prefilledUsernameValue;return this.prefilledUsernameValue=void 0,e}setPrefilledUsername(e){this.prefilledUsernameValue=e}deleteUserVcsAccessToken(){return this.http.delete("api/core/account/user-vcs-access-token")}addNewVcsAccessToken(e){let t=new o().set("expiryDate",e);return this.http.put("api/core/account/user-vcs-access-token",null,{observe:"response",params:t})}getVcsAccessToken(e){let t=new o().set("participationId",e);return this.http.get("api/core/account/participation-vcs-access-token",{observe:"response",params:t,responseType:"text"})}createVcsAccessToken(e){let t=new o().set("participationId",e);return this.http.put("api/core/account/participation-vcs-access-token",null,{observe:"response",params:t,responseType:"text"})}setUserAcceptedExternalLLMUsage(){this.userIdentity&&(this.userIdentity.externalLLMUsageAccepted=I())}static \u0275fac=function(t){return new(t||s)};static \u0275prov=l({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();export{r as a,P as b};
//# sourceMappingURL=chunk-R5BZWVRQ.js.map
