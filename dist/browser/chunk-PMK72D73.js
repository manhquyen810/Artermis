import{a as y}from"./chunk-36AB5BWM.js";import{b as w}from"./chunk-UHM5AJSI.js";import{c as A}from"./chunk-BNDLMKXK.js";import{c as P}from"./chunk-JXJXC4DZ.js";import{a as S,b as I}from"./chunk-R5BZWVRQ.js";import{h as f}from"./chunk-M6Z6DKZQ.js";import{Ea as s,L as V,ba as p,oa as x,r as h,s as c,w as g,ya as l,z as v}from"./chunk-5LC5EQRR.js";var E=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,u=r=>{if(typeof r!="string")throw new TypeError("Invalid argument expected string");let i=r.match(E);if(!i)throw new Error(`Invalid argument not valid semver ('${r}' received)`);return i.shift(),i},O=r=>r==="*"||r==="x"||r==="X",R=r=>{let i=parseInt(r,10);return isNaN(i)?r:i},k=(r,i)=>typeof r!=typeof i?[String(r),String(i)]:[r,i],B=(r,i)=>{if(O(r)||O(i))return 0;let[e,t]=k(R(r),R(i));return e>t?1:e<t?-1:0},d=(r,i)=>{for(let e=0;e<Math.max(r.length,i.length);e++){let t=B(r[e]||"0",i[e]||"0");if(t!==0)return t}return 0};var T=(r,i)=>{let e=u(r),t=u(i),o=e.pop(),n=t.pop(),a=d(e,t);return a!==0?a:o&&n?d(o.split("."),n.split(".")):o||n?o?-1:1:0};var m=(r,i,e)=>{F(e);let t=T(r,i);return U[e].includes(t)},U={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]},j=Object.keys(U),F=r=>{if(typeof r!="string")throw new TypeError(`Invalid operator type, expected string but got ${typeof r}`);if(j.indexOf(r)===-1)throw new Error(`Invalid operator, expected one of ${j.join("|")}`)};var L=(()=>{class r{profileService=s(A);router=s(f);isOrion=w;minVersion;isValidVersion;validateOrionVersion(){return this.isOrion?this.validate():c(!0)}validate(){if(this.isValidVersion!==void 0)return c(this.isValidVersion);let e=window.navigator.userAgent,t=this.extractVersionFromUserAgent(e);if(t.length===2){let o=t[1];return this.fetchProfileInfoAndCompareVersions(o)}else return this.router.navigateByUrl("/orion-outdated?versionString=soOldThatThereIsNoVersion"),this.isValidVersion=!1,c(this.isValidVersion)}fetchProfileInfoAndCompareVersions(e){return this.profileService.getProfileInfo().pipe(V(Boolean),p(),v(t=>(this.minVersion=t.allowedMinimumOrionVersion,this.isValidVersion=this.versionInBounds(e),this.isValidVersion)))}extractVersionFromUserAgent(e){return e.split(" ").find(t=>t.includes("Orion")||t.includes("IntelliJ")).split("/")}versionInBounds(e){return m(e,this.minVersion,">=")?!0:(this.router.navigateByUrl(`/orion-outdated?versionString=${e}`),!1)}static \u0275fac=function(t){return new(t||r)};static \u0275prov=l({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var lr=(()=>{class r{router=s(f);accountService=s(I);alertService=s(P);stateStorageService=s(y);orionVersionValidator=s(L);canActivate(e,t){let n=this.handleLTIRedirect(e,t)??t.url,a=e.data.authorities;return(e.routeConfig?.path===":courseId/programming-exercises/:exerciseId/participations/:participationId/submissions"||e.routeConfig?.path===":examId/exercise-groups/:exerciseGroupId/programming-exercises/:exerciseId/participations/:participationId")&&e.queryParams.isTmpOrSolutionProgrParticipation==="true"&&a.push(S.EDITOR),g(this.orionVersionValidator.validateOrionVersion().pipe(p(),x(q=>q?h(this.checkLogin(a,n)):c(!1))))}handleLTIRedirect(e,t){if(new RegExp(/\/courses\/\d+\/exercises\/\d+/g).test(t.url)&&e.queryParams.ltiSuccessLoginRequired){let n=e.queryParams.ltiSuccessLoginRequired;return this.alertService.success("artemisApp.lti.ltiSuccessLoginRequired",{user:n}),this.accountService.setPrefilledUsername(n),t.url.split("?")[0]}return t.url}checkLogin(e,t){let o=this.accountService;return Promise.resolve(o.identity().then(n=>!e||e.length===0?!0:n?o.hasAnyAuthority(e).then(a=>!!a):(this.stateStorageService.storeUrl(t),this.router.navigate(["accessdenied"]).then(()=>{n||this.router.navigate(["/"])}),!1)))}static \u0275fac=function(t){return new(t||r)};static \u0275prov=l({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();export{lr as a};
//# sourceMappingURL=chunk-PMK72D73.js.map
