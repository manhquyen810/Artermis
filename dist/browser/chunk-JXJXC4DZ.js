import{p as S}from"./chunk-DID2YGL7.js";import{Ba as N,G as v,Ob as k,wd as w}from"./chunk-Z4VHWOB5.js";import{a as I}from"./chunk-NOBD5HSR.js";import{b as m}from"./chunk-3Y6745HG.js";import{c as C}from"./chunk-E2KBL4LX.js";import{e as y}from"./chunk-PZTBTDSR.js";import{Ea as l,L as g,Wa as A,c as b,ka as E,vb as d,ya as f}from"./chunk-5LC5EQRR.js";import{a as h}from"./chunk-3E746U5Y.js";var x=(()=>{class s{observable;observer;constructor(){this.observable=new b(e=>{this.observer=e}).pipe(E())}broadcast(e){this.observer&&this.observer.next(e)}subscribe(e,r){return typeof e=="string"&&(e=[e]),this.observable.pipe(g(t=>{for(let i of e)if(typeof t=="string"&&t===i||typeof t!="string"&&t.name===i)return!0;return!1})).subscribe(r)}destroy(e){e.unsubscribe()}static \u0275fac=function(r){return new(r||s)};static \u0275prov=f({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var n=class s{static SUCCESS=new s(N,"success","btn-success");static DANGER=new s(v,"danger","btn-danger");static WARNING=new s(w,"warning","btn-warning");static INFO=new s(k,"info","btn-info");constructor(M,e,r){this.icon=M,this.containerClassName=e,this.buttonClassName=r}icon;containerClassName;buttonClassName},F=15e3,D=!0,q=(()=>{class s{sanitizer=l(y);ngZone=l(A);translateService=l(C);alerts=[];errorListener;httpErrorListener;conflictErrorKeysToSkip=["cannotRegisterInstructor"];constructor(){let e=l(x);this.errorListener=e.subscribe("artemisApp.error",r=>{let t=r.content;this.addErrorAlert(t.message,t.translationKey,t.translationParams)}),this.httpErrorListener=e.subscribe("artemisApp.httpError",r=>{let t=r.content;if(!t.error?.skipAlert)switch(t.status){case 0:this.addErrorAlert("Server not reachable","error.server.not.reachable");break;case 400:let i=t.headers.keys(),a=null,p=null;if(i.forEach(o=>{o.toLowerCase().endsWith("app-error")?a=t.headers.get(o):o.toLowerCase().endsWith("app-params")&&(p=t.headers.get(o))}),a&&!this.translateService.instant(a).startsWith(m)){let o=this.translateService.instant("global.menu.entities."+p);this.addErrorAlert(a,a,h({entityName:o},t.error?.params))}else if(t.error&&t.error.fieldErrors){let o=t.error.fieldErrors;for(let c of o){["Min","Max","DecimalMin","DecimalMax"].includes(c.message)&&(c.message="size");let L=c.field.replace(/\[\d*\]/g,"[]"),u=this.translateService.instant("artemisApp."+c.objectName+"."+L);this.addErrorAlert('Error on field "'+u+'"',"error."+c.message,{fieldName:u})}}else t.error&&t.error.title&&this.addErrorAlert(t.error.title,t.error.message,t.error.params);break;case 404:break;default:if(t.error&&t.error.title){if(t.status===403&&this.conflictErrorKeysToSkip.includes(t.error.errorKey))break;this.addErrorAlert(t.error.title,t.error.message,t.error.params)}}})}closeAll(){[...this.alerts].forEach(e=>e.close())}get(){return this.alerts}addAlert(e){let r={type:e.type,message:e.message,timeout:e.timeout,action:e.action,onClose:e.onClose,dismissible:e.dismissible,isOpen:!1};if(!e.disableTranslation&&(e.translationKey||e.message)){let t;e.translationKey?t=e.translationKey:t=e.message;let i=this.translateService.instant(t,e.translationParams);!i.startsWith(m)?r.message=i:(I(new Error("Unknown translation key: "+t)),e.message||(r.message=t))}if(r.message=this.sanitizer.sanitize(d.HTML,r.message??"")??"",r.timeout=r.timeout??F,r.dismissible=r.dismissible??D,r.close=()=>{r.isOpen=!1;let t=this.alerts.indexOf(r);t>=0&&(this.alerts.splice(t,1),r.onClose&&r.onClose(r))},r.action&&(r.action={label:this.sanitizer.sanitize(d.HTML,this.translateService.instant(r.action.label)??"")??"",callback:r.action.callback}),e.message){r.isOpen=!0,r.openedAt=S();let t=this.alerts.find(i=>r.message===i.message&&Math.abs(r.openedAt.diff(i.openedAt,"ms"))<=50);if(t)return t;this.alerts.unshift(r),r.timeout>0&&this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.ngZone.run(()=>{r.close()})},r.timeout)})}return r}success(e,r){return this.addAlert({type:n.SUCCESS,message:e,translationParams:r})}error(e,r){return this.addAlert({type:n.DANGER,message:e,translationParams:r})}warning(e,r){return this.addAlert({type:n.WARNING,message:e,translationParams:r})}info(e,r){return this.addAlert({type:n.INFO,message:e,translationParams:r})}addErrorAlert(e,r,t){e&&typeof e!="string"&&(e=""+e),this.addAlert({type:n.DANGER,message:e,translationKey:r,translationParams:t})}static \u0275fac=function(r){return new(r||s)};static \u0275prov=f({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();export{x as a,n as b,q as c};
//# sourceMappingURL=chunk-JXJXC4DZ.js.map
