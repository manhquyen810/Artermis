import{a as B,m as V}from"./chunk-CJVQ2B7U.js";import{a as L}from"./chunk-FZY4YCJJ.js";import{a as R}from"./chunk-QA7Y7QBM.js";import{a as F}from"./chunk-HQ6UGNQX.js";import{e as U}from"./chunk-5GXY5RYT.js";import{p as c}from"./chunk-DID2YGL7.js";import{Sc as P,Vb as y,ic as I}from"./chunk-Z4VHWOB5.js";import{a as M}from"./chunk-U54OSGNH.js";import{f as A,g as O,h as w}from"./chunk-M6Z6DKZQ.js";import{n as T}from"./chunk-IOA4DPXY.js";import{Db as d,Dc as g,Ea as o,Ma as f,Mc as D,Na as b,Oc as E,Tb as C,Zb as l,dd as a,kc as p,rd as _,sc as x,w as v,xc as n,yc as m,zc as h}from"./chunk-5LC5EQRR.js";var W=i=>({"sidebar-collapsed":i});function G(i,S){if(i&1){let e=g();a(0,`
            `),n(1,"div",3),a(2,`
                `),n(3,"router-outlet",4),D("deactivate",function(){f(e);let t=E(2);return b(t.onSubRouteDeactivate())}),m(),a(4,`
            `),m(),a(5,`
        `)}}function k(i,S){i&1&&(a(0,`
            `),n(1,"div",5),a(2,`
                `),h(3,"div",6),a(4,`
            `),m(),a(5,`
        `))}function H(i,S){if(i&1&&(a(0,`
        `),n(1,"div",1),a(2,`
            `),h(3,"jhi-sidebar",2),a(4,`
        `),m(),a(5,`

        `),l(6,G,6,0)(7,k,6,0)),i&2){let e=E();d(),p("ngClass",_(8,W,e.isCollapsed))("hidden",e.isExamStarted),d(2),p("itemSelected",e.examSelected)("courseId",e.courseId)("sidebarData",e.sidebarData)("collapseState",e.DEFAULT_COLLAPSE_STATE)("sidebarItemAlwaysShow",e.DEFAULT_SHOW_ALWAYS),d(3),x(e.examSelected?6:7)}}var j={real:{entityData:[]},test:{entityData:[]}},N={real:!1,test:!1},Y={real:!1,test:!1},ne=(()=>{class i{route=o(A);courseStorageService=o(F);serverDateService=o(R);examParticipationService=o(L);courseOverviewService=o(B);router=o(w);courseId;course;parentParamSubscription;courseUpdatesSubscription;studentExamTestExamUpdateSubscription;examStartedSubscription;studentExams;studentExamsForRealExams=new Map;expandAttemptsMap=new Map;realExamsOfCourse=[];testExamsOfCourse=[];faAngleUp=P;faAngleDown=I;faListAlt=y;sortedRealExams;sortedTestExams;examSelected=!0;accordionExamGroups=j;sidebarData;sidebarExams=[];isCollapsed=!1;isExamStarted=!1;DEFAULT_COLLAPSE_STATE=N;DEFAULT_SHOW_ALWAYS=Y;ngOnInit(){this.isCollapsed=this.courseOverviewService.getSidebarCollapseStateFromStorage("exam"),this.parentParamSubscription=this.route.parent?.params.subscribe(e=>{this.courseId=Number(e.courseId)}),this.examStartedSubscription=this.examParticipationService.examIsStarted$.subscribe(e=>{this.isExamStarted=e}),this.course=this.courseStorageService.getCourse(this.courseId),this.prepareSidebarData(),this.courseUpdatesSubscription=this.courseStorageService.subscribeToCourseUpdates(this.courseId).subscribe(e=>{this.course=e,this.updateExams(),this.prepareSidebarData()}),this.studentExamTestExamUpdateSubscription=this.examParticipationService.loadStudentExamsForTestExamsPerCourseAndPerUserForOverviewPage(this.courseId).subscribe(e=>{this.studentExams=e}),this.course?.exams&&(this.expandAttemptsMap=new Map(this.course.exams.filter(e=>e.testExam&&this.isVisible(e)).map(e=>[e.id,!1])),this.updateExams(),this.prepareSidebarData()),this.navigateToExam()}navigateToExam(){let e=this.courseOverviewService.getUpcomingExam([...this.realExamsOfCourse,...this.testExamsOfCourse]),s=this.getLastSelectedExam(),t=this.route.firstChild?.snapshot.params.examId;!t&&s?this.router.navigate([s],{relativeTo:this.route,replaceUrl:!0}):!t&&e?this.router.navigate([e.id],{relativeTo:this.route,replaceUrl:!0}):this.examSelected=!!t}updateExams(){if(this.course?.exams){let e=this.course.exams.filter(t=>this.isVisible(t)).sort((t,r)=>this.sortExamsByStartDate(t,r));e.filter(t=>t.testExam&&!this.expandAttemptsMap.has(t.id)).forEach(t=>this.expandAttemptsMap.set(t.id,!1)),this.realExamsOfCourse=e.filter(t=>!t.testExam),this.testExamsOfCourse=e.filter(t=>t.testExam);let s=this.realExamsOfCourse.map(t=>v(this.examParticipationService.getOwnStudentExam(this.courseId,t.id)).then(r=>{this.studentExamsForRealExams.set(t.id,r)}));Promise.all(s).then(()=>{this.prepareSidebarData()})}}ngOnDestroy(){this.parentParamSubscription&&this.parentParamSubscription.unsubscribe(),this.courseUpdatesSubscription&&this.courseUpdatesSubscription.unsubscribe(),this.studentExamTestExamUpdateSubscription?.unsubscribe(),this.examStartedSubscription?.unsubscribe()}isVisible(e){return e.visibleDate?c(e.visibleDate).isBefore(this.serverDateService.now()):!1}getStudentExamForExamIdOrderedByIdReverse(e){return this.studentExams?this.studentExams.filter(function(s){return s.exam?.id&&s.startedDate&&s.exam.id===e&&s.startedDate}).sort((s,t)=>t.id-s.id):[]}changeExpandAttemptList(e){let s=!this.expandAttemptsMap.get(e);this.expandAttemptsMap.set(e,s)}sortExamsByStartDate(e,s){return c(e.startDate).isBefore(s.startDate)?-1:c(e.startDate).isAfter(s.startDate)?1:0}groupExamsByRealOrTest(e,s){let t=U(j);for(let r of e){let u=this.courseOverviewService.mapExamToSidebarCardElement(r,this.studentExamsForRealExams.get(r.id));t.real.entityData.push(u)}for(let r of s){let u=this.courseOverviewService.mapExamToSidebarCardElement(r);t.test.entityData.push(u)}return t}getLastSelectedExam(){return sessionStorage.getItem("sidebar.lastSelectedItem.exam.byCourse."+this.courseId)}toggleSidebar(){this.isCollapsed=!this.isCollapsed,this.courseOverviewService.setSidebarCollapseState("exam",this.isCollapsed)}updateSidebarData(){this.sidebarData={groupByCategory:!0,sidebarType:"exam",storageId:"exam",groupedData:this.accordionExamGroups,ungroupedData:this.sidebarExams}}prepareSidebarData(){if(!this.course?.exams)return;this.sortedRealExams=this.realExamsOfCourse.sort((t,r)=>this.sortExamsByStartDate(t,r)),this.sortedTestExams=this.testExamsOfCourse.sort((t,r)=>this.sortExamsByStartDate(t,r));let e=this.courseOverviewService.mapExamsToSidebarCardElements(this.sortedRealExams,this.getAllStudentExamsForRealExams()),s=this.courseOverviewService.mapExamsToSidebarCardElements(this.sortedTestExams);this.sidebarExams=[...e,...s],this.accordionExamGroups=this.groupExamsByRealOrTest(this.sortedRealExams,this.sortedTestExams),this.updateSidebarData()}onSubRouteDeactivate(){this.route.firstChild||this.navigateToExam()}getAllStudentExamsForRealExams(){return[...this.studentExamsForRealExams.values()]}static \u0275fac=function(s){return new(s||i)};static \u0275cmp=C({type:i,selectors:[["jhi-course-exams"]],decls:4,vars:1,consts:[[1,"d-flex","justify-content-between"],["id","exam-sidebar-test",3,"ngClass","hidden"],[3,"itemSelected","courseId","sidebarData","collapseState","sidebarItemAlwaysShow"],[1,"vw-100","module-bg","rounded-3",2,"min-width","200px"],[3,"deactivate"],[1,"vw-100","module-bg","rounded-3","p-3","d-flex","justify-content-between"],["jhiTranslate","artemisApp.courseOverview.exams.selectExam",1,"col-12","text-center","my-auto"]],template:function(s,t){s&1&&(n(0,"div",0),a(1,`
    `),l(2,H,8,10),m(),a(3,`
`)),s&2&&(d(2),x(t.course?2:-1))},dependencies:[T,V,O,M],styles:[".hover-blue[_ngcontent-%COMP%]:hover{box-shadow:0 2px 4px 0 var(--primary)}.hover-green[_ngcontent-%COMP%]:hover{box-shadow:0 2px 4px 0 var(--success)}.btn-disabled[_ngcontent-%COMP%]{pointer-events:none}.hover-effect[_ngcontent-%COMP%]:has(.clickable):hover{transition:transform .2s linear;transform:scale(1.012);background-color:var(--hover-slightly-darker-body-bg)}.btn-group-disabled[_ngcontent-%COMP%]{cursor:not-allowed}"]})}return i})();export{ne as a};
//# sourceMappingURL=chunk-SD742KBS.js.map
