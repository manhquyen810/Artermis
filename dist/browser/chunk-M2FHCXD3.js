import{b as T}from"./chunk-V7PDYRDZ.js";import{a as _}from"./chunk-K3W6YFKH.js";import{c as $}from"./chunk-CXQURQM5.js";import{Db as j,Ea as L,Mc as q,Tb as A,Ya as P,Za as H,dd as E,f as C,fd as G,g as B,kc as z,xc as R,ya as D,yc as F,yd as N,zd as M}from"./chunk-5LC5EQRR.js";var J=(()=>{class i{examExerciseIdAndProblemStatementSource=new C;currentExerciseIdAndProblemStatement=this.examExerciseIdAndProblemStatementSource.asObservable();examExerciseIdForNavigationSource=new B(-1);currentExerciseIdForNavigation=this.examExerciseIdForNavigationSource.asObservable();navigateToExamExercise(t){this.examExerciseIdForNavigationSource.next(t)}updateLiveExamExercise(t,e){this.examExerciseIdAndProblemStatementSource.next({exerciseId:t,problemStatement:e})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=D({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var d=function(i){return i[i.character=0]="character",i[i.tag=1]="tag",i[i.whitespace=2]="whitespace",i[i.number=3]="number",i[i.entity=4]="entity",i}(d||{}),c=function(i){return i[i.equal=0]="equal",i[i.delete=1]="delete",i[i.insert=2]="insert",i[i.none=3]="none",i[i.replace=4]="replace",i}(c||{});var f=class{startInOld;startInNew;size;constructor(s,t,e){this.startInOld=s,this.startInNew=t,this.size=e}get endInOld(){return this.startInOld+this.size}get endInNew(){return this.startInNew+this.size}};var se=/^\s*<\/?[^>]+>\s*$/,ie=/<[^\s>]+/,ne=/^(\s|&nbsp;)+$/,re=/[\w\#@]+/,oe=["<img"];function x(i){return oe.some(s=>i!==null&&i.startsWith(s))?!1:se.test(i)}function ae(i){return i=(ie.exec(i)||[""])[0]+(i.endsWith("/>")?"/>":">"),i}function w(i){return i==="<"}function K(i){return i===">"}function b(i){return i==="&"}function Q(i){return i===";"}function p(i){return ne.test(i)}function V(i){return x(i)?ae(i):i}function I(i){return/^\d$/.test(i)}function S(i){return re.test(i)}function X(i,s,t){return i.push(s),i.length>t&&i.shift(),i.length!==t?null:i.join("")}var O=class{oldWords;newWords;startInOld;endInOld;startInNew;endInNew;options;wordIndices;constructor({oldWords:s,newWords:t,startInOld:e,endInOld:o,startInNew:a,endInNew:r,options:n}){this.oldWords=s,this.newWords=t,this.startInOld=e,this.endInOld=o,this.startInNew=a,this.endInNew=r,this.options=n,this.wordIndices=new Map}indexNewWords(){this.wordIndices=new Map;let s=[];for(let t=this.startInNew;t<this.endInNew;t++){let e=this.normalizeForIndex(this.newWords[t]),o=X(s,e,this.options.blockSize);o!==null&&(this.wordIndices.has(o)?this.wordIndices.get(o).push(t):this.wordIndices.set(o,[t]))}}normalizeForIndex(s){return s=V(s),this.options.ignoreWhitespaceDifferences&&p(s)?" ":s}findMatch(){if(this.indexNewWords(),this.removeRepeatingWords(),this.wordIndices.size===0)return null;let s=this.startInOld,t=this.startInNew,e=0,o=new Map,a=this.options.blockSize,r=[];for(let n=this.startInOld;n<this.endInOld;n++){let h=this.normalizeForIndex(this.oldWords[n]),l=X(r,h,a);if(l===null)continue;let u=new Map;if(!this.wordIndices.has(l)){o=u;continue}for(let m of this.wordIndices.get(l)){let g=(o.has(m-1)?o.get(m-1):0)+1;u.set(m,g),g>e&&(s=n-g-a+2,t=m-g-a+2,e=g)}o=u}return e!==0?new f(s,t,e+a-1):null}removeRepeatingWords(){let s=this.newWords.length+this.options.repeatingWordsAccuracy,t=Array.from(this.wordIndices.entries()).filter(e=>e[1].length>s).map(e=>e[0]);for(let e of t)this.wordIndices.delete(e)}};var W=class{action;startInOld;endInOld;startInNew;endInNew;constructor({action:s,startInOld:t,endInOld:e,startInNew:o,endInNew:a}){this.action=s,this.startInOld=t,this.endInOld=e,this.startInNew=o,this.endInNew=a}};var Y={blockSize:0,repeatingWordsAccuracy:0,ignoreWhitespaceDifferences:!1};var y=class{static state={mode:d.character,currentWord:[],words:[]};static blockLocations;static prepare(){this.state={mode:d.character,currentWord:[],words:[]},this.blockLocations=[]}static convertHtmlToListOfWords(s,t=[]){this.prepare(),this.findBlocks(s,t);let e=!!this.blockLocations.length,o=!1,a=-1,r;for(let h=0;h<s.length;h++){var n=s[h];if(e){if(a===h){a=-1,o=!1,this.state.currentWord.push(n);let u=this.state.currentWord.join("");if(r?.targetBoundaries){let m=u.slice(r?.targetBoundaries.starts,r?.targetBoundaries.ends);this.state.words.push([m,u])}else this.state.words.push([u]);this.state.currentWord=[],this.state.mode=d.character,r=void 0;continue}let l=this.blockLocations.find(u=>u.wordBoundaries.starts===h);if(l&&(r=l,this.state.currentWord.length!==0&&(this.state.words.push([this.state.currentWord.join("")]),this.state.currentWord=[]),o=!0,a=r.wordBoundaries.ends),o){this.state.currentWord.push(n),this.state.mode=d.character;continue}}switch(this.state.mode){case d.character:w(n)?this.addClearWordSwitchMode("<",d.tag):b(n)?this.addClearWordSwitchMode(n,d.entity):p(n)?this.addClearWordSwitchMode(n,d.whitespace):I(n)?this.addClearWordSwitchMode(n,d.number):S(n)&&(this.state.currentWord.length===0||S(this.state.currentWord[this.state.currentWord.length-1]))?this.state.currentWord.push(n):this.addClearWordSwitchMode(n,d.character);break;case d.tag:K(n)?(this.state.currentWord.push(n),this.state.words.push([this.state.currentWord.join("")]),this.state.currentWord=[],this.state.mode=d.character):this.state.currentWord.push(n);break;case d.number:this.state.words.push([this.state.currentWord.join("")]),this.state.currentWord=[],w(n)?this.addClearWordSwitchMode(n,d.tag):b(n)?this.addClearWordSwitchMode(n,d.entity):I(n)?this.addClearWordSwitchMode(n,d.number):p(n)?this.state.currentWord.push(n):this.addClearWordSwitchMode(n,d.character);break;case d.whitespace:w(n)?this.addClearWordSwitchMode(n,d.tag):b(n)?this.addClearWordSwitchMode(n,d.entity):I(n)?this.addClearWordSwitchMode(n,d.number):p(n)?this.state.currentWord.push(n):this.addClearWordSwitchMode(n,d.character);break;case d.entity:if(w(n))this.addClearWordSwitchMode(n,d.tag);else if(I(n))this.addClearWordSwitchMode(n,d.number);else if(p(n))this.addClearWordSwitchMode(n,d.whitespace);else if(Q(n)){let l=!0;this.state.currentWord.length!==0&&(this.state.currentWord.push(n),this.state.words.push([this.state.currentWord.join("")])),l&&(this.state.currentWord=[],this.state.mode=d.character)}else S(n)?this.state.currentWord.push(n):this.addClearWordSwitchMode(n,d.character);break}}return this.state.currentWord.length!==0&&this.state.words.push([this.state.currentWord.join("")]),this.state.words}static addClearWordSwitchMode(s,t){this.state.currentWord.length!==0&&this.state.words.push([this.state.currentWord.join("")]),this.state.currentWord=[s],this.state.mode=t}static findBlocks(s,t){t.forEach(e=>{let o=s.matchAll(e.exp);for(let a of o)if(a.index!==void 0){if(this.blockLocations.find(n=>n.wordBoundaries.starts<=(a.index||0)&&(a.index||0)<=n.wordBoundaries.ends))throw new Error("One or more block expressions result in a text sequence that overlaps. Current expression: "+e.exp.toString());let r=e.compareBy&&[...a[0].matchAll(e.compareBy)][0];r&&r.index!==void 0?this.blockLocations.push({wordBoundaries:{starts:a.index,ends:a.index+a[0].length-1},targetBoundaries:{starts:r.index,ends:r.index+r[0].length}}):this.blockLocations.push({wordBoundaries:{starts:a.index,ends:a.index+a[0].length-1}})}})}},v=y;var de=4;var U=class{content;newText;oldText;specialTagDiffStack;newWords;oldWords;orinalWordsInNew;orinalWordsInOld;matchGranularity;blockExpressions;repeatingWordsAccuracy;ignoreWhiteSpaceDifferences;orphanMatchThreshold;constructor(s,t){this.content=[],this.newText=t,this.oldText=s,this.specialTagDiffStack=[],this.newWords=[],this.orinalWordsInNew=new Map,this.oldWords=[],this.orinalWordsInOld=new Map,this.matchGranularity=0,this.blockExpressions=[],this.repeatingWordsAccuracy=1,this.ignoreWhiteSpaceDifferences=!1,this.orphanMatchThreshold=0,this.addBlockExpression=this.addBlockExpression.bind(this)}diff(){if(this.oldText===this.newText)return this.newText;this.splitInputsIntoWords(),this.matchGranularity=Math.min(de,this.oldWords.length,this.newWords.length);let s=this.operations();this.orinalWordsInOld.forEach((t,e)=>{this.oldWords[e]=t}),this.orinalWordsInNew.forEach((t,e)=>{this.newWords[e]=t});for(let t of s)this.performOperation(t);return this.content.join("")}addBlockExpression(s){this.blockExpressions.push(s)}splitInputsIntoWords(){let s=v.convertHtmlToListOfWords(this.oldText,this.blockExpressions);s.forEach((e,o)=>{e[1]&&this.orinalWordsInOld.set(o,e[1])}),this.oldWords=s.map(e=>e[0]),this.oldText="";let t=v.convertHtmlToListOfWords(this.newText,this.blockExpressions);t.forEach((e,o)=>e[1]&&this.orinalWordsInNew.set(o,e[1])),this.newWords=t.map(e=>e[0]),this.newText=""}performOperation(s){switch(s.action){case c.equal:this.processEqualOperation(s);break;case c.delete:this.processDeleteOperation(s,"diffdel");break;case c.insert:this.processInsertOperation(s,"diffins");break;case c.none:break;case c.replace:this.processReplaceOperation(s);break}}processReplaceOperation(s){this.processDeleteOperation(s,"diffmod"),this.processInsertOperation(s,"diffmod")}processInsertOperation(s,t){let e=this.newWords.filter((o,a)=>a>=s.startInNew&&a<s.endInNew);this.insertTag("ins",t,e)}processDeleteOperation(s,t){let e=this.oldWords.filter((o,a)=>a>=s.startInOld&&a<s.endInOld);this.insertTag("del",t,e)}processEqualOperation(s){let t=this.newWords.filter((e,o)=>o>=s.startInNew&&o<s.endInNew);this.content.push(t.join(""))}insertTag(s,t,e){let o,a,r,n,h;for(n="",r=0,o=e.length;!(r>=o||(a=this.consecutiveWhere(r,e,l=>!x(l)),r+=a.length,a.length!==0&&(n+=`<${s} class="${t}">${a.join("")}</${s}>`),r>=o));)h=this.consecutiveWhere(r,e,x),r+=h.length,n+=h.join("");this.content.push(n)}consecutiveWhere(s,t,e){let o,a,r,n,h,l;for(t=t.slice(s,+t.length+1||9e9),n=void 0,r=a=0,h=t.length;a<h&&(l=t[r],o=e(l),o===!0&&(n=r),o!==!1);r=++a);return n!=null?t.slice(0,+n+1||9e9):[]}operations(){let s=0,t=0,e=[],o=this.matchingBlocks();o.push(new f(this.oldWords.length,this.newWords.length,0));let a=this.removeOrphans(o);for(let r of a){let n=s===r.startInOld,h=t===r.startInNew,l;!n&&!h?l=c.replace:n&&!h?l=c.insert:n?l=c.none:l=c.delete,l!==c.none&&e.push(new W({action:l,startInOld:s,endInOld:r.startInOld,startInNew:t,endInNew:r.startInNew})),r.size!==0&&e.push(new W({action:c.equal,startInOld:r.startInOld,endInOld:r.endInOld,startInNew:r.startInNew,endInNew:r.endInNew})),s=r.endInOld,t=r.endInNew}return e}*removeOrphans(s){let t=null,e=null;for(let o of s){if(e===null){t=new f(0,0,0),e=o;continue}if(t?.endInOld===e.startInOld&&t.endInNew===e.startInNew||e.endInOld===o.startInOld&&e.endInNew===o.startInNew){yield e,e=o;continue}let a=(l,u)=>l+u.length,r=this.oldWords.slice(t?.endInOld,o.startInOld).reduce(a,0),n=this.newWords.slice(t?.endInNew,o.startInNew).reduce(a,0);this.newWords.slice(e.startInNew,e.endInNew).reduce(a,0)>Math.max(r,n)*this.orphanMatchThreshold&&(yield e),t=e,e=o}yield e}matchingBlocks(){let s=[];return this.findMatchingBlocks({startInOld:0,endInOld:this.oldWords.length,startInNew:0,endInNew:this.newWords.length,matchingBlocks:s}),s}findMatchingBlocks({startInOld:s,endInOld:t,startInNew:e,endInNew:o,matchingBlocks:a}){let r=this.findMatch({startInOld:s,endInOld:t,startInNew:e,endInNew:o});r!==null&&(s<r.startInOld&&e<r.startInNew&&this.findMatchingBlocks({startInOld:s,endInOld:r.startInOld,startInNew:e,endInNew:r.startInNew,matchingBlocks:a}),a.push(r),r.endInOld<t&&r.endInNew<o&&this.findMatchingBlocks({startInOld:r.endInOld,endInOld:t,startInNew:r.endInNew,endInNew:o,matchingBlocks:a}))}findMatch({startInOld:s,endInOld:t,startInNew:e,endInNew:o}){for(let a=this.matchGranularity;a>0;a--){let r=Y;r.blockSize=a,r.repeatingWordsAccuracy=this.repeatingWordsAccuracy,r.ignoreWhitespaceDifferences=this.ignoreWhiteSpaceDifferences;let h=new O({oldWords:this.oldWords,newWords:this.newWords,startInOld:s,endInOld:t,startInNew:e,endInNew:o,options:r}).findMatch();if(h!==null)return h}return null}},Z=U;var le=(i,s,{blocksExpression:t}={})=>{let e=new Z(i,s);return t&&t.forEach(o=>e.addBlockExpression(o)),e.diff()},ee=le;var Pe=(()=>{class i{examExerciseUpdateService=L(J);subscriptionToLiveExamExerciseUpdates;themeSubscription;updatedProblemStatementHTML;updatedProblemStatementWithHighlightedDifferencesHTML;outdatedProblemStatement;updatedProblemStatement;showHighlightedDifferences=!0;isHidden=!0;exercise=H.required();problemStatementUpdateEvent=P();ngOnInit(){this.subscriptionToLiveExamExerciseUpdates=this.examExerciseUpdateService.currentExerciseIdAndProblemStatement.subscribe(t=>{t&&this.updateExerciseProblemStatementById(t.exerciseId,t.problemStatement)})}ngOnDestroy(){this.subscriptionToLiveExamExerciseUpdates?.unsubscribe(),this.themeSubscription?.unsubscribe()}toggleHighlightedProblemStatement(t){t.stopPropagation();let e;this.showHighlightedDifferences?e=this.updatedProblemStatementHTML:e=this.updatedProblemStatementWithHighlightedDifferencesHTML,this.showHighlightedDifferences=!this.showHighlightedDifferences,this.problemStatementUpdateEvent.emit(e)}updateExerciseProblemStatementById(t,e){e!=null&&t===this.exercise().id&&(this.outdatedProblemStatement=this.exercise().problemStatement,this.updatedProblemStatement=e,this.exercise().problemStatement=e,this.showHighlightedDifferences=!0,this.exercise().type!==$.PROGRAMMING&&this.highlightProblemStatementDifferences(),this.isHidden=!1,this.problemStatementUpdateEvent.emit(this.updatedProblemStatementWithHighlightedDifferencesHTML))}highlightProblemStatementDifferences(){let t=T(this.outdatedProblemStatement),e=T(this.updatedProblemStatement);this.updatedProblemStatementHTML=e,this.updatedProblemStatementWithHighlightedDifferencesHTML=ee(t,e)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=A({type:i,selectors:[["jhi-exam-exercise-update-highlighter"]],inputs:{exercise:[1,"exercise"]},outputs:{problemStatementUpdateEvent:"problemStatementUpdateEvent"},decls:5,vars:6,consts:[["id","highlightDiffButton",1,"btn","py-0","px-2","mt-0","mb-0","ms-2",3,"click","hidden"]],template:function(e,o){e&1&&(R(0,"button",0),q("click",function(r){return o.toggleHighlightedProblemStatement(r)}),E(1),N(2,"artemisTranslate"),N(3,"artemisTranslate"),F(),E(4,`
`)),e&2&&(z("hidden",o.isHidden),j(),G(`
    `,o.showHighlightedDifferences?M(2,2,"artemisApp.exam.problemStatementUpdate.showNew"):M(3,4,"artemisApp.exam.problemStatementUpdate.showDiff"),`
`))},dependencies:[_],styles:["#highlightDiffButton[_ngcontent-%COMP%]{background-color:#fbc107;border:none;text-align:center;text-decoration:none;display:inline-block;font-size:16px;color:#353d47}#highlightDiffButton[_ngcontent-%COMP%]:hover{color:#fff}"]})}return i})();export{J as a,ee as b,Pe as c};
//# sourceMappingURL=chunk-M2FHCXD3.js.map
