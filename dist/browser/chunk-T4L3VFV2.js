import{a as Te}from"./chunk-YSX3GO3R.js";import{a as xe}from"./chunk-PA7LJOOC.js";import{a as fe}from"./chunk-AOI2U3YC.js";import{a as _e}from"./chunk-USOMQCKZ.js";import{b as A}from"./chunk-6EYB5QBP.js";import{a as ge}from"./chunk-MP6UGYTC.js";import{a as Ce}from"./chunk-2QXIMOEO.js";import{a as L,e as le}from"./chunk-CK7FH6VF.js";import{F as ee,q as Q,r as X,s as Z}from"./chunk-VZRSC3LP.js";import{m as pe,o as de}from"./chunk-VK7JPHFE.js";import{c as ae}from"./chunk-BNDLMKXK.js";import{a as he}from"./chunk-K3W6YFKH.js";import{c as ce}from"./chunk-JXJXC4DZ.js";import{d as me}from"./chunk-EDXSOKK5.js";import{b as se}from"./chunk-R5BZWVRQ.js";import{p as k}from"./chunk-DID2YGL7.js";import{Xa as oe,Za as re}from"./chunk-Z4VHWOB5.js";import{a as ie}from"./chunk-XUCCGZJR.js";import{a as ne}from"./chunk-HKBU2OOC.js";import{a as ue}from"./chunk-U54OSGNH.js";import{h as G,i as J}from"./chunk-M6Z6DKZQ.js";import{c as te}from"./chunk-E2KBL4LX.js";import{e as Y}from"./chunk-PZTBTDSR.js";import{Ac as $,Bc as D,Db as o,Dc as T,Ea as p,Ed as W,Ma as x,Mc as C,Na as f,Oc as s,Rc as z,Rd as H,Tb as B,Wb as F,Za as _,Zb as y,ab as R,cd as N,dd as t,fd as E,kc as l,lc as U,mc as I,pc as w,rd as q,sc as g,uc as K,vc as j,wb as b,wc as O,xb as M,xc as a,ya as V,yc as c,yd as S,zc as m,zd as v}from"./chunk-5LC5EQRR.js";import{j as P}from"./chunk-3E746U5Y.js";var ye=(()=>{class i{buildSourceTreeUrl(e,n){return n?`sourcetree://cloneRepo?type=stash&cloneUrl=${encodeURI(n)}&baseWebUrl=${e}`:void 0}buildIdeUrl(e,n){if(e&&n.deepLink.includes("{cloneUrl}"))return n.deepLink.replace("{cloneUrl}",encodeURIComponent(e))}static \u0275fac=function(n){return new(n||i)};static \u0275prov=V({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Se=(()=>{class i{sanitizer=p(Y);transform(e){return this.sanitizer.bypassSecurityTrustUrl(e)}static \u0275fac=function(n){return new(n||i)};static \u0275pipe=F({name:"safeUrl",type:i,pure:!0})}return i})();var ve=i=>({ideName:i});function ke(i,h){if(i&1&&(t(0,`
            `),m(1,"div",15),t(2,`
        `)),i&2){let e=s(2);o(),l("innerHTML",e.sshKeyMissingTip,b)}}function Ae(i,h){if(i&1&&(t(0,`
            `),m(1,"div",15),t(2,`
        `)),i&2){let e=s(2);o(),l("innerHTML",e.sshKeysExpiredTip,b)}}function Pe(i,h){if(i&1&&(t(0,`
            `),m(1,"div",15),t(2,`
        `)),i&2){let e=s(2);o(),l("innerHTML",e.tokenMissingTip,b)}}function Me(i,h){if(i&1&&(t(0,`
            `),m(1,"div",15),t(2,`
        `)),i&2){let e=s(2);o(),l("innerHTML",e.tokenExpiredTip,b)}}function we(i,h){if(i&1){let e=T();t(0,`
            `),a(1,"div",16),t(2,`
                `),a(3,"input",17),C("click",function(){x(e);let r=s(2);return f(r.switchPracticeMode())}),c(),t(4,`
                `),m(5,"label",18),t(6,`
            `),c(),t(7,`
        `)}if(i&2){let e=s(2);o(3),l("checked",e.isPracticeMode)}}function Ue(i,h){if(i&1){let e=T();t(0,`
                            `),a(1,"a",19),C("click",function(){x(e);let r=s(3);return f(r.useHttpsPassword())}),t(2,"HTTPS"),c(),t(3,`
                        `)}if(i&2){let e=s(3);o(),w("dropdown-item ",e.selectedAuthenticationMechanism===e.RepositoryAuthenticationMethod.Password?"active":"","")}}function Ee(i,h){if(i&1){let e=T();t(0,`
                            `),a(1,"a",20),C("click",function(){x(e);let r=s(3);return f(r.useHttpsToken())}),t(2,"Token"),c(),t(3,`
                        `)}if(i&2){let e=s(3);o(),w("dropdown-item ",e.selectedAuthenticationMechanism===e.RepositoryAuthenticationMethod.Token?"active":"","")}}function He(i,h){if(i&1){let e=T();t(0,`
                            `),a(1,"a",21),C("click",function(){x(e);let r=s(3);return f(r.useSshUrl())}),t(2,"SSH"),c(),t(3,`
                        `)}if(i&2){let e=s(3);o(),w("dropdown-item ",e.selectedAuthenticationMechanism===e.RepositoryAuthenticationMethod.SSH?"active":"","")}}function Le(i,h){if(i&1&&(t(0,`
                        `),y(1,Ue,4,3)(2,Ee,4,3)(3,He,4,3)),i&2){let e=h.$implicit,n=s(2);o(),g(e===n.RepositoryAuthenticationMethod.Password?1:-1),o(),g(e===n.RepositoryAuthenticationMethod.Token?2:-1),o(),g(e===n.RepositoryAuthenticationMethod.SSH?3:-1)}}function Ve(i,h){if(i&1&&(t(0,`
                    `),a(1,"a",22),S(2,"safeUrl"),t(3,`
                        `),m(4,"fa-icon",23),t(5,`
                    `),c(),t(6,`
                `)),i&2){let e=s(2);o(),U("flex",1),l("href",v(2,4,e.getHttpRepositoryUri()),M),o(3),l("icon",e.faExternalLink)}}function Re(i,h){if(i&1&&(t(0,`
                    `),a(1,"a",24),t(2,`
                        `),m(3,"fa-icon",23),t(4,`
                    `),c(),t(5,`
                `)),i&2){let e=s(2);o(),U("flex",1),l("routerLink",e.routerLinkForRepositoryView()),o(2),l("icon",e.faExternalLink)}}function Be(i,h){if(i&1){let e=T();t(0,`
        `),y(1,ke,3,1)(2,Ae,3,1)(3,Pe,3,1)(4,Me,3,1)(5,we,8,1),m(6,"h5",2),t(7,`

        `),a(8,"div",3),t(9,`
            `),a(10,"div",4),t(11,`
                `),a(12,"button",5),t(13),c(),t(14,`
                `),a(15,"div",6),t(16,`
                    `),j(17,Le,4,3,null,null,K),c(),t(19,`
            `),c(),t(20,`
            `),a(21,"pre",7),C("cdkCopyToClipboardCopied",function(r){x(e);let u=s();return f(u.copyEnabled?u.onCopyFinished(r):null)}),t(22),c(),t(23,`
            `),a(24,"div",8),t(25,`
                `),y(26,Ve,7,6)(27,Re,6,4),c(),t(28,`
        `),c(),t(29,`
        `),a(30,"button",9),C("cdkCopyToClipboardCopied",function(r){x(e);let u=s();return f(u.onCopyFinished(r))}),c(),t(31,`
        `),a(32,"a",10),S(33,"safeUrl"),t(34,`
        `),c(),t(35,`
        `),m(36,"jhi-help-icon",11),t(37,`
        `),a(38,"a",12),S(39,"safeUrl"),t(40," "),c(),t(41,`
        `),t(42,`
        `),m(43,"iframe",13),t(44,`
        `),m(45,"jhi-help-icon",14),t(46,`
    `)}if(i&2){let e=s();o(),g(e.selectedAuthenticationMechanism===e.RepositoryAuthenticationMethod.SSH&&!e.doesUserHaveSSHkeys?1:-1),o(),g(e.selectedAuthenticationMechanism===e.RepositoryAuthenticationMethod.SSH&&e.areAnySshKeysExpired?2:-1),o(),g(e.selectedAuthenticationMechanism===e.RepositoryAuthenticationMethod.Token&&e.isInCourseManagement&&!e.userTokenPresent?3:-1),o(),g(e.selectedAuthenticationMechanism===e.RepositoryAuthenticationMethod.Token&&e.isInCourseManagement&&e.userTokenPresent&&!e.userTokenStillValid?4:-1),o(),g(e.participations().length>1?5:-1),o(),l("jhiTranslate",e.cloneHeadline),o(7),E(`
                    `,e.selectedAuthenticationMechanism===e.RepositoryAuthenticationMethod.SSH?"SSH":e.selectedAuthenticationMechanism===e.RepositoryAuthenticationMethod.Token?"Token":"HTTPS",`
                `),o(4),O(e.authenticationMechanisms),o(4),l("cdkCopyToClipboard",e.getHttpOrSshRepositoryUri(!1)),o(),E("",e.getHttpOrSshRepositoryUri()," "),o(4),g(e.localVCEnabled()?27:26),o(4),I("btn-success",e.wasCopied),z("jhiTranslate",e.wasCopied?"artemisApp.exerciseActions.copiedUrl":"artemisApp.exerciseActions.copyUrl"),l("cdkCopyToClipboard",e.getHttpOrSshRepositoryUri(!1))("disabled",!e.copyEnabled),o(2),l("href",v(33,18,e.buildIdeUrl()),M)("translateValues",q(22,ve,e.ideName)),o(6),l("href",v(39,20,e.buildSourceTreeUrl()),M)}}var d=function(i){return i.Password="password",i.Token="token",i.SSH="ssh",i}(d||{}),xt=(()=>{class i{translateService=p(te);externalCloningService=p(ye);sshUserSettingsService=p(xe);accountService=p(se);profileService=p(ae);localStorage=p(ie);participationService=p(le);ideSettingsService=p(_e);alertService=p(ce);router=p(G);FeatureToggle=ne;ProgrammingLanguage=A;RepositoryAuthenticationMethod=d;loading=_(!1);smallButtons=_.required();repositoryUri=_.required();routerLinkForRepositoryView=_.required();participations=_([]);exercise=_();hideLabelMobile=_(!1);authenticationMechanisms=[d.Password,d.Token,d.SSH];selectedAuthenticationMechanism=d.Password;userTokenStillValid=!1;userTokenPresent=!1;sshEnabled=!1;sshTemplateUrl;versionControlUrl;localVCEnabled=R(!1);gitlabVCEnabled=!1;copyEnabled=!1;doesUserHaveSSHkeys=!1;areAnySshKeysExpired=!1;isInCourseManagement=!1;sshSettingsUrl;vcsTokenSettingsUrl;sshKeyMissingTip;sshKeysExpiredTip;tokenMissingTip;tokenExpiredTip;user;sshKeys;cloneHeadline;wasCopied=!1;isTeamParticipation;activeParticipation;isPracticeMode;vscodeFallback={name:"VS Code",deepLink:"vscode://vscode.git/clone?url={cloneUrl}"};programmingLanguageToIde=new Map([[A.EMPTY,this.vscodeFallback]]);faCode=oe;faExternalLink=re;ideName;constructor(){this.isInCourseManagement=this.router.url.includes("course-management"),H(()=>P(this,null,function*(){if(this.participations().length){let e=this.participationService.shouldPreferPractice(this.exercise());this.activeParticipation=this.participationService.getSpecificStudentParticipation(this.participations(),e)??this.participations()[0],this.isPracticeMode=L(this.activeParticipation),this.isTeamParticipation=!!this.activeParticipation?.team}this.cloneHeadline=this.getCloneHeadline()})),H(()=>{!this.isInCourseManagement&&this.localVCEnabled()&&this.loadVcsAccessTokensForAllParticipations()})}ngOnInit(){return P(this,null,function*(){let e=yield this.accountService.identity();e&&(this.user=e,yield this.checkForSshKeys(),this.profileService.getProfileInfo().subscribe(n=>{this.sshSettingsUrl=n.sshKeysURL,this.sshTemplateUrl=n.sshCloneURLTemplate,n.repositoryAuthenticationMechanisms?.length&&(this.authenticationMechanisms=n.repositoryAuthenticationMechanisms.filter(r=>Object.values(d).includes(r))),n.versionControlUrl&&(this.versionControlUrl=n.versionControlUrl),this.localVCEnabled.set(n.activeProfiles.includes(pe)),this.gitlabVCEnabled=n.activeProfiles.includes(de),this.configureTooltips(n)}),this.ideSettingsService.loadIdePreferences().then(n=>{n.size&&(this.programmingLanguageToIde=n),this.ideName=this.getIde().name}))})}useSshUrl(){this.selectedAuthenticationMechanism=d.SSH,this.copyEnabled=this.doesUserHaveSSHkeys||this.gitlabVCEnabled,this.storeToLocalStorage()}useHttpsToken(){this.selectedAuthenticationMechanism=d.Token,this.isInCourseManagement?(this.userTokenStillValid=k().isBefore(k(this.user.vcsAccessTokenExpiryDate)),this.userTokenPresent=!!this.user.vcsAccessToken?.startsWith("vcpat"),this.copyEnabled=this.userTokenPresent&&this.userTokenStillValid):this.copyEnabled=!!this.activeParticipation?.vcsAccessToken,this.storeToLocalStorage()}useHttpsPassword(){this.selectedAuthenticationMechanism=d.Password,this.copyEnabled=!0,this.storeToLocalStorage()}storeToLocalStorage(){this.localStorage.store("code-button-state",this.selectedAuthenticationMechanism)}formatTip(e,n){return this.translateService.instant(e).replace(/{link:(.*)}/,`<a href="${n}" target="_blank">$1</a>`)}getRepositoryUri(){return this.activeParticipation?.repositoryUri??this.repositoryUri()}onClick(){this.selectedAuthenticationMechanism=this.authenticationMechanisms.includes(this.localStorage.retrieve("code-button-state"))?this.localStorage.retrieve("code-button-state"):this.authenticationMechanisms[0],this.useSsh&&this.useSshUrl(),this.useToken&&this.useHttpsToken(),this.usePassword&&this.useHttpsPassword()}getHttpOrSshRepositoryUri(e=!0){if(this.useSsh&&this.sshTemplateUrl)return this.getSshCloneUrl(this.getRepositoryUri());let n=this.getRepositoryUri(),r=e?"**********":this.getUsedToken(),u=`://${this.user.login}${this.useToken?`:${r}`:""}@`;return n.includes("@")?n.replace(/:\/\/.*@/,u):n.replace("://",u)}loadVcsAccessTokensForAllParticipations(){this.participations().forEach(e=>{e.id&&!e.vcsAccessToken&&this.loadParticipationVcsAccessToken(e)})}loadParticipationVcsAccessToken(e){this.accountService.getVcsAccessToken(e.id).subscribe({next:n=>{n.body&&(e.vcsAccessToken=n.body,this.copyEnabled=this.useToken)},error:n=>{n.status==404&&this.createNewParticipationVcsAccessToken(e),n.status==403&&this.alertService.warning("403 Forbidden")}})}createNewParticipationVcsAccessToken(e){this.accountService.createVcsAccessToken(e.id).subscribe({next:n=>{n.body&&(e.vcsAccessToken=n.body,this.copyEnabled=this.useToken)},error:n=>{n.status==403&&this.alertService.warning("403 Forbidden")}})}getUsedToken(){return this.useToken?this.isInCourseManagement?this.user.vcsAccessToken:this.activeParticipation?.vcsAccessToken:""}getHttpRepositoryUri(){return this.isTeamParticipation?this.repositoryUriForTeam(this.getRepositoryUri()):this.getRepositoryUri()}repositoryUriForTeam(e){return e.replace(/^(\w*:\/\/)(.*)$/,`$1${this.user.login}@$2`)}getSshCloneUrl(e){return e.replace(/^\w*:\/\/[^/]*?\/(scm\/)?(.*)$/,this.sshTemplateUrl+"$2")}onCopyFinished(e){e&&(this.wasCopied=!0,setTimeout(()=>{this.wasCopied=!1},3e3))}buildSourceTreeUrl(){return this.externalCloningService.buildSourceTreeUrl(this.versionControlUrl,this.getHttpOrSshRepositoryUri(!1))}buildIdeUrl(){return this.externalCloningService.buildIdeUrl(this.getHttpOrSshRepositoryUri(!1),this.getIde())}getIde(){return this.programmingLanguageToIde.get(this.exercise()?.programmingLanguage??A.EMPTY)??this.programmingLanguageToIde.get(A.EMPTY)??this.vscodeFallback}switchPracticeMode(){this.isPracticeMode=!this.isPracticeMode,this.activeParticipation=this.participationService.getSpecificStudentParticipation(this.participations(),this.isPracticeMode),this.cloneHeadline=this.isPracticeMode?"artemisApp.exerciseActions.clonePracticeRepository":"artemisApp.exerciseActions.cloneRatedRepository",this.activeParticipation.vcsAccessToken&&(this.user.vcsAccessToken=this.activeParticipation.vcsAccessToken)}get useToken(){return this.selectedAuthenticationMechanism===d.Token}get useSsh(){return this.selectedAuthenticationMechanism===d.SSH}get usePassword(){return this.selectedAuthenticationMechanism===d.Password}checkForSshKeys(){return P(this,null,function*(){if(this.sshKeys=yield this.sshUserSettingsService.getCachedSshKeys(),this.sshKeys){let e=k();this.doesUserHaveSSHkeys=this.sshKeys.length>0,this.areAnySshKeysExpired=this.sshKeys.some(n=>{if(n.expiryDate)return k(n.expiryDate).isBefore(e)})}})}configureTooltips(e){this.localVCEnabled()?(this.vcsTokenSettingsUrl=`${window.location.origin}/user-settings/vcs-token`,this.sshSettingsUrl=`${window.location.origin}/user-settings/ssh`):this.sshSettingsUrl=e.sshKeysURL,this.tokenMissingTip=this.formatTip("artemisApp.exerciseActions.vcsTokenTip",this.vcsTokenSettingsUrl),this.tokenExpiredTip=this.formatTip("artemisApp.exerciseActions.vcsTokenExpiredTip",this.vcsTokenSettingsUrl),this.sshKeyMissingTip=this.formatTip("artemisApp.exerciseActions.sshKeyTip",this.sshSettingsUrl),this.sshKeysExpiredTip=this.formatTip("artemisApp.exerciseActions.sshKeyExpiredTip",this.sshSettingsUrl)}getCloneHeadline(){return this.participations().length?(this.isPracticeMode=L(this.activeParticipation),this.isPracticeMode&&!this.exercise()?.exerciseGroup?"artemisApp.exerciseActions.clonePracticeRepository":"artemisApp.exerciseActions.cloneRatedRepository"):"artemisApp.exerciseActions.cloneExerciseRepository"}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=B({type:i,selectors:[["jhi-code-button"]],inputs:{loading:[1,"loading"],smallButtons:[1,"smallButtons"],repositoryUri:[1,"repositoryUri"],routerLinkForRepositoryView:[1,"routerLinkForRepositoryView"],participations:[1,"participations"],exercise:[1,"exercise"],hideLabelMobile:[1,"hideLabelMobile"]},decls:9,vars:10,consts:[["popContent",""],["jhi-exercise-action-button","","placement","right auto","container","body",1,"code-button",3,"click","buttonIcon","jhiFeatureToggle","buttonLabel","buttonLoading","smallButton","hideLabelMobile","ngbPopover","autoClose"],[3,"jhiTranslate"],[1,"d-flex",2,"margin","0","max-width","100%"],["aria-label","Button group with nested dropdown","ngbDropdown","","role","group",1,"btn-group",2,"margin-bottom","10px"],["ngbDropdownToggle","","type","button",1,"btn","btn-primary","btn-sm","dropdown-toggle","https-or-ssh-button"],["ngbDropdownMenu","",1,"dropdown-menu",2,"min-width","100%"],[1,"clone-url","url-box-remove-line-left","url-box-remove-line-right",3,"cdkCopyToClipboardCopied","cdkCopyToClipboard"],[1,"d-flex","align-items-center"],["data-testid","copyRepoUrlButton","type","button",1,"btn","btn-primary","btn-sm","me-2",2,"min-width","100px",3,"cdkCopyToClipboardCopied","cdkCopyToClipboard","disabled","jhiTranslate"],["target","hidden-iframe","jhiTranslate","artemisApp.exerciseActions.ideButton.openIn",1,"btn","btn-primary","btn-sm",3,"href","translateValues"],["placement","right auto","text","artemisApp.exerciseActions.ideButton.helpIcon"],["target","hidden-iframe","jhiTranslate","artemisApp.exerciseActions.cloneSourceTree.button",1,"btn","btn-primary","btn-sm",3,"href"],["name","hidden-iframe",2,"visibility","hidden","position","absolute"],["placement","right auto","text","artemisApp.exerciseActions.cloneSourceTree.helpIcon"],[1,"alert","alert-warning",3,"innerHTML"],[1,"form-check","form-switch"],["mdbCheckbox","","id","switch-practice","type","checkbox",1,"form-check-input",3,"click","checked"],["for","switch-practice","jhiTranslate","artemisApp.exerciseActions.practiceMode.title",1,"form-check-label"],["id","useHTTPSButton",3,"click"],["id","useHTTPSWithTokenButton",3,"click"],["id","useSSHButton",3,"click"],["target","_blank","rel","noopener noreferrer",1,"btn","btn-secondary","btn-sm","me-2","open-repository-button",3,"href"],[3,"icon"],["target","_blank","rel","noopener noreferrer",1,"btn","btn-secondary","btn-sm","me-2","open-repository-button",3,"routerLink"]],template:function(n,r){if(n&1){let u=T();$(0),t(1,`
    `),a(2,"button",1),S(3,"artemisTranslate"),C("click",function(){return x(u),f(r.onClick())}),c(),t(4,`
    `),y(5,Be,47,24,"ng-template",null,0,W),t(7,`
`),D(),t(8,`
`)}if(n&2){let u=N(6);o(2),l("buttonIcon",r.faCode)("jhiFeatureToggle",r.FeatureToggle.ProgrammingExercises)("buttonLabel",v(3,8,"artemisApp.exerciseActions.code"))("buttonLoading",r.loading())("smallButton",r.smallButtons())("hideLabelMobile",r.hideLabelMobile())("ngbPopover",u)("autoClose","outside")}},dependencies:[Te,ge,ee,ue,Z,X,Q,fe,me,J,Ce,he,Se],styles:[".open-repository-button[_ngcontent-%COMP%]{margin-bottom:10px;border-top-left-radius:0;border-bottom-left-radius:0}.https-or-ssh-button[_ngcontent-%COMP%]{border-top-right-radius:0;border-bottom-right-radius:0}.url-box-remove-line-left[_ngcontent-%COMP%]{border-top-left-radius:0;border-bottom-left-radius:0;border-left:none}.url-box-remove-line-right[_ngcontent-%COMP%]{border-top-right-radius:0;border-bottom-right-radius:0;border-right:none}.clone-url[_ngcontent-%COMP%]{flex:1;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;max-width:50vw;padding:4.5px}"]})}return i})();export{ye as a,xt as b};
//# sourceMappingURL=chunk-T4L3VFV2.js.map
