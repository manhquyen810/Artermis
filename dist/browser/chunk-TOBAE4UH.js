import{a as b}from"./chunk-JYHI54MX.js";import{a as p}from"./chunk-H7UNTMXY.js";import{b as d}from"./chunk-W3K7VYWC.js";import{a as u}from"./chunk-7VLYAOO4.js";import{c as S}from"./chunk-JXJXC4DZ.js";import{Ea as s,ya as l}from"./chunk-5LC5EQRR.js";import{a as m}from"./chunk-3E746U5Y.js";var T=(()=>{class t{orionConnectorService=s(u);programmingSubmissionService=s(d);repositoryExportService=s(b);manualAssessmentService=s(p);alertService=s(S);orionState;activeSubmissionId=void 0;constructor(){this.orionConnectorService&&this.orionConnectorService.state()&&this.orionConnectorService.state().subscribe(i=>{this.orionState?.cloning&&!i.cloning&&this.activeSubmissionId!==void 0&&this.manualAssessmentService.cancelAssessment(this.activeSubmissionId).subscribe(),this.orionState=m({},i)})}downloadSubmissionInOrion(i,e,o=0,r){e==="new"?this.programmingSubmissionService.getSubmissionWithoutAssessment(i,!0,o).subscribe(n=>{n&&this.sendSubmissionToOrionCancellable(i,n.id,o,r)}):this.sendSubmissionToOrion(i,e.id,o,r)}sendSubmissionToOrionCancellable(i,e,o=0,r){this.activeSubmissionId=e,this.sendSubmissionToOrion(i,e,o,r)}sendSubmissionToOrion(i,e,o=0,r){this.orionConnectorService.isCloning(!0);let n={exportAllParticipants:!1,filterLateSubmissions:!1,excludePracticeSubmissions:!1,addParticipantName:!1,combineStudentCommits:!0,anonymizeRepository:!0,normalizeCodeStyle:!1};this.programmingSubmissionService.lockAndGetProgrammingSubmissionParticipation(e,o).subscribe(v=>{this.repositoryExportService.exportReposByParticipations(i,[v.participation.id],n).subscribe(f=>{let a=new FileReader;a.onloadend=()=>{let c=a.result,h=c.slice(c.indexOf(",")+1);this.orionConnectorService.downloadSubmission(e,o,r,h)},a.onerror=()=>{this.alertService.error("artemisApp.assessmentDashboard.orion.downloadFailed")},a.readAsDataURL(f.body)})})}static \u0275fac=function(e){return new(e||t)};static \u0275prov=l({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();export{T as a};
//# sourceMappingURL=chunk-TOBAE4UH.js.map
