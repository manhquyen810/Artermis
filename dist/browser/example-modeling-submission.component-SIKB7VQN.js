import{a as Be,b as E,c as De}from"./chunk-77A5CC3Z.js";import{a as Ve}from"./chunk-7F5FYCZN.js";import{a as Ne}from"./chunk-7OWNIVQU.js";import"./chunk-3DNS47RB.js";import{a as Pe}from"./chunk-UVXOAEFF.js";import{a as Re}from"./chunk-OAPRXDEH.js";import{b as je,c as P}from"./chunk-4ISQXSLY.js";import"./chunk-5WJSNL65.js";import"./chunk-FNJRUM5G.js";import{a as Oe}from"./chunk-4P7M5PJP.js";import"./chunk-GITU5WHL.js";import"./chunk-GXLYQKDJ.js";import{c as j}from"./chunk-CCVWGTN5.js";import"./chunk-MD22LTSS.js";import"./chunk-RKZRHQUL.js";import"./chunk-A2A6JFSH.js";import"./chunk-MD6Z63OB.js";import"./chunk-M2FHCXD3.js";import"./chunk-RGQYMQQL.js";import"./chunk-FLZTDUOG.js";import"./chunk-QU4DXSXD.js";import"./chunk-656XE4CO.js";import"./chunk-O2WHE2S3.js";import"./chunk-U4DJRHYQ.js";import"./chunk-JRBFEQNN.js";import"./chunk-DIZEKHOC.js";import"./chunk-V7PDYRDZ.js";import"./chunk-EANMTTQG.js";import"./chunk-65Z25AP3.js";import"./chunk-5M3YV54C.js";import"./chunk-RYZEETVB.js";import"./chunk-VTF2OQPK.js";import{a as Ie}from"./chunk-BNRTXX46.js";import"./chunk-N4VVKRBU.js";import"./chunk-5AQXEKLE.js";import{b as T}from"./chunk-3JSWSN6W.js";import"./chunk-7XNS72RJ.js";import"./chunk-KYCCMZSV.js";import{k as ke,l as Fe}from"./chunk-DXTZ4GAW.js";import"./chunk-2UXGFGK3.js";import"./chunk-O4VJ5OXY.js";import"./chunk-BDII35IB.js";import"./chunk-LARBQRTJ.js";import"./chunk-OTNXTVPX.js";import"./chunk-Z2YUBN6N.js";import"./chunk-6EYB5QBP.js";import"./chunk-GERFCPB6.js";import"./chunk-T624HJJL.js";import"./chunk-HQTS6JOY.js";import"./chunk-HMZID6NQ.js";import"./chunk-O26CMRR4.js";import"./chunk-MP6UGYTC.js";import{a as we}from"./chunk-2QXIMOEO.js";import"./chunk-JHBUBEY6.js";import{x as fe}from"./chunk-R2SUWIPY.js";import"./chunk-35PLMJNP.js";import{a as Me,b as Ae}from"./chunk-4I367PEU.js";import"./chunk-QA7Y7QBM.js";import"./chunk-ZPITQMA6.js";import"./chunk-2CUFQLAH.js";import{a as Te}from"./chunk-DRMCDU75.js";import"./chunk-Z6NSEM73.js";import"./chunk-AR57MWOI.js";import"./chunk-A5PTZAPN.js";import"./chunk-AU6UEH3U.js";import"./chunk-FGAONQTL.js";import"./chunk-HQ6UGNQX.js";import"./chunk-ZLJ76G5I.js";import"./chunk-MLVGKM2P.js";import{c as ge}from"./chunk-CK7FH6VF.js";import{b as Se,e as N}from"./chunk-PUNMJFMR.js";import"./chunk-R75LTV62.js";import{c as R}from"./chunk-5MVJAZRV.js";import"./chunk-XBLNBTXN.js";import"./chunk-G3JOQOSD.js";import"./chunk-G4I63THF.js";import"./chunk-PZ7IDTIM.js";import{k as ye}from"./chunk-CT44YL7Q.js";import"./chunk-ZFM7LHJQ.js";import"./chunk-JNO6DNVW.js";import"./chunk-5YQ3ACZE.js";import"./chunk-EELXLOHY.js";import"./chunk-VZRSC3LP.js";import"./chunk-5SKDOIBQ.js";import{K as ae,c as te,h as ne,m as se,p as oe}from"./chunk-WA5GEAJB.js";import"./chunk-VK7JPHFE.js";import"./chunk-BNDLMKXK.js";import"./chunk-BQNBT6PW.js";import"./chunk-5GXY5RYT.js";import{a as Ce}from"./chunk-K3W6YFKH.js";import{c as _e}from"./chunk-JXJXC4DZ.js";import{d as Ee}from"./chunk-EDXSOKK5.js";import"./chunk-R5BZWVRQ.js";import"./chunk-DID2YGL7.js";import{k as be}from"./chunk-CXQURQM5.js";import"./chunk-S4QLGR2R.js";import{Fd as he,Ob as de,Oc as ce,Qc as pe,eb as le,lb as re,sd as xe,tb as me,wd as ue}from"./chunk-Z4VHWOB5.js";import"./chunk-XUCCGZJR.js";import"./chunk-HKBU2OOC.js";import"./chunk-5ZXXURLP.js";import"./chunk-NOBD5HSR.js";import{a as ve}from"./chunk-U54OSGNH.js";import{f as ee,h as ie}from"./chunk-M6Z6DKZQ.js";import"./chunk-3Y6745HG.js";import"./chunk-E2KBL4LX.js";import"./chunk-PZTBTDSR.js";import"./chunk-IOA4DPXY.js";import{Db as o,Dc as _,Ea as S,F as U,Ma as u,Mc as g,Na as h,Oc as m,P as L,Pd as X,Qd as Z,Rc as Y,Rd as $,T as W,Tb as Q,Yc as F,Zb as b,Zc as I,_c as V,ab as J,dd as i,ed as O,fd as w,kc as x,lc as k,ld as v,md as M,nd as A,qd as H,ra as y,rd as K,sc as c,uc as z,vc as q,wc as G,xc as a,yc as l,yd as f,z as D,zc as p,zd as C}from"./chunk-5LC5EQRR.js";import{j as B}from"./chunk-3E746U5Y.js";var Le=t=>({exerciseTitle:t}),We=()=>[];function Je(t,d){t&1&&(i(0,`
                `),p(1,"h5",11),i(2,`
            `))}function Qe(t,d){t&1&&(i(0,`
                `),p(1,"p",12),i(2,`
            `))}function ze(t,d){t&1&&(i(0,`
                                `),a(1,"span",25),i(2,"Create new example submission"),l(),i(3,`
                            `))}function qe(t,d){t&1&&(i(0,`
                                `),p(1,"span",26),i(2,`
                            `))}function Ge(t,d){if(t&1){let e=_();i(0,`
                    `),a(1,"div",14),i(2,`
                        `),a(3,"div"),i(4,`
                            `),a(5,"div",15),i(6,`
                                `),p(7,"span",16),i(8,`
                                `),p(9,"jhi-help-icon",17),i(10,`
                            `),l(),i(11,`
                            `),a(12,"div",18),i(13,`
                                `),a(14,"input",19),A("ngModelChange",function(n){u(e);let r=m(3);return M(r.selectedMode,n)||(r.selectedMode=n),h(n)}),l(),i(15,`
                                `),p(16,"label",20),i(17,`
                                `),a(18,"input",21),A("ngModelChange",function(n){u(e);let r=m(3);return M(r.selectedMode,n)||(r.selectedMode=n),h(n)}),l(),i(19,`
                                `),p(20,"label",22),i(21,`
                            `),l(),i(22,`
                        `),l(),i(23,`
                        `),a(24,"button",23),g("click",function(){u(e);let n=m(3);return h(n.upsertExampleModelingSubmission())}),i(25,`
                            `),p(26,"fa-icon",24),i(27,`
                            `),b(28,ze,4,0)(29,qe,3,0),l(),i(30,`
                    `),l(),i(31,`
                `)}if(t&2){let e=m(3);o(9),x("text","artemisApp.exampleSubmission.selectModelExplanation"),o(5),x("value",e.ExampleSubmissionMode.READ_AND_CONFIRM),v("ngModel",e.selectedMode),o(4),x("value",e.ExampleSubmissionMode.ASSESS_CORRECTLY),v("ngModel",e.selectedMode),o(8),x("icon",e.faSave),o(2),c(e.isNewSubmission?28:-1),o(),c(e.isNewSubmission?-1:29)}}function Ye(t,d){if(t&1){let e=_();i(0,`
                    `),a(1,"button",27),g("click",function(){u(e);let n=m(3);return h(n.saveExampleAssessment())}),i(2,`
                        `),p(3,"fa-icon",24),i(4,`
                        `),p(5,"span",28),i(6,`
                    `),l(),i(7,`
                `)}if(t&2){let e=m(3);o(3),x("icon",e.faSave)}}function He(t,d){if(t&1){let e=_();i(0,`
                            `),a(1,"button",30),g("click",function(){u(e);let n=m(4);return h(n.showAssessment())}),i(2,`
                                `),p(3,"fa-icon",24),i(4,`
                                `),p(5,"span",31),i(6,`
                            `),l(),i(7,`
                        `)}if(t&2){let e=m(4);o(3),x("icon",e.faChalkboardTeacher)}}function Ke(t,d){if(t&1){let e=_();i(0,`
                            `),a(1,"button",30),g("click",function(){u(e);let n=m(4);return h(n.showSubmission())}),i(2,`
                                `),p(3,"fa-icon",24),i(4,`
                                `),p(5,"span",32),i(6,`
                            `),l(),i(7,`
                        `)}if(t&2){let e=m(4);o(3),x("icon",e.faCodeBranch)}}function Xe(t,d){if(t&1&&(i(0,`
                    `),a(1,"div",29),i(2,`
                        `),b(3,He,8,1)(4,Ke,8,1),l(),i(5,`
                `)),t&2){let e=m(3);o(3),c(e.assessmentMode?-1:3),o(),c(e.assessmentMode?4:-1)}}function Ze(t,d){if(t&1&&(i(0,`
            `),a(1,"div",13),i(2,`
                `),b(3,Ge,32,8)(4,Ye,8,1)(5,Xe,6,2),l(),i(6,`
        `)),t&2){let e=m(2);o(3),c(e.assessmentMode?-1:3),o(),c(e.assessmentMode?4:-1),o(),c(e.exampleSubmission&&!e.isNewSubmission?5:-1)}}function $e(t,d){if(t&1&&(i(0,`
                            `),a(1,"div",33),i(2,`
                                `),a(3,"span",34),i(4),f(5,"artemisTranslate"),l(),i(6,`
                                `),a(7,"div",35),i(8,`
                                    `),p(9,"fa-icon",24),i(10,`
                                `),l(),i(11,`
                            `),l(),i(12,`
                        `)),t&2){let e=d.$implicit;o(4),O(C(5,4,e.text)),o(5),k("color",e.color),x("icon",e.icon)}}function ei(t,d){if(t&1&&(i(0,`
                            `),a(1,"div",33),i(2,`
                                `),a(3,"span",34),i(4),f(5,"artemisTranslate"),l(),i(6,`
                                `),a(7,"div",36),i(8,`
                                    `),p(9,"fa-icon",24),i(10,`
                                `),l(),i(11,`
                            `),l(),i(12,`
                        `)),t&2){let e=m(2);o(4),O(C(5,2,e.legend[3].text)),o(5),x("icon",e.legend[3].icon)}}function ii(t,d){if(t&1){let e=_();i(0,`
                `),a(1,"div",37),i(2,`
                    `),a(3,"button",38),g("click",function(){u(e);let n=m(2);return h(n.readAndUnderstood())}),i(4,`
                        `),p(5,"fa-icon",24),i(6,`
                        `),p(7,"span",39),i(8,`
                    `),l(),i(9,`
                `),l(),i(10,`
            `)}if(t&2){let e=m(2);o(5),x("icon",e.faSave)}}function ti(t,d){if(t&1){let e=_();i(0,`
                `),a(1,"div",37),i(2,`
                    `),a(3,"button",40),g("click",function(){u(e);let n=m(2);return h(n.checkAssessment())}),l(),i(4,`
                `),l(),i(5,`
            `)}if(t&2){let e=m(2);o(3),x("disabled",!e.assessments||!e.assessmentsAreValid)}}function ni(t,d){if(t&1&&(i(0,`
                        `),a(1,"div",41),i(2,`
                            `),a(3,"div",42),i(4,`
                                `),p(5,"span",43),i(6,`
                            `),l(),i(7,`
                        `),l(),i(8,`
                    `)),t&2){let e=m(2);o(3),k("background-color",e.highlightColor())}}function si(t,d){if(t&1){let e=_();i(0,`
                            `),a(1,"jhi-modeling-editor",44),g("explanationChange",function(n){u(e);let r=m(2);return h(r.explanationChanged(n))}),l(),i(2,`
                        `)}if(t&2){let e=m(2);o(),x("umlModel",e.umlModel)("diagramType",e.exercise.diagramType)("readOnly",e.readOnly)("explanation",e.explanationText)("withExplanation",!0)}}function oi(t,d){if(t&1){let e=_();i(0,`
                            `),a(1,"jhi-modeling-assessment",45),g("feedbackChanged",function(n){u(e);let r=m(2);return h(r.onReferencedFeedbackChanged(n))}),l(),i(2,`
                        `)}if(t&2){let e=m(2);o(),x("umlModel",e.umlModel)("resultFeedbacks",(e.result==null?null:e.result.feedbacks)||H(10,We))("diagramType",e.exercise.diagramType)("maxScore",e.exercise.maxPoints||0)("maxBonusPoints",e.exercise.bonusPoints||0)("totalScore",e.totalScore)("readOnly",e.readOnly)("course",e.course)("explanation",e.explanationText)("highlightedElements",e.highlightedElements())}}function ai(t,d){if(t&1&&(i(0,`
                        `),a(1,"h3",46),i(2),f(3,"artemisTranslate"),a(4,"sup"),i(5,`
                                `),a(6,"small"),i(7,`
                                    `),p(8,"fa-icon",47),f(9,"artemisTranslate"),i(10,`
                                `),l(),i(11,`
                            `),l(),i(12,`
                        `),l(),i(13,`
                    `)),t&2){let e=m(2);o(2),w(`
                            `,C(3,3,"artemisApp.exampleSubmission.assessmentExplanation"),`
                            `),o(6),Y("title",C(9,5,"artemisApp.exampleSubmission.assessmentExplanationInfo")),x("icon",e.faInfoCircle)}}function li(t,d){if(t&1){let e=_();i(0,`
                        `),a(1,"textarea",48),A("ngModelChange",function(n){u(e);let r=m(2);return M(r.assessmentExplanation,n)||(r.assessmentExplanation=n),h(n)}),l(),i(2,`
                    `)}if(t&2){let e=m(2);o(),v("ngModel",e.assessmentExplanation),x("disabled",e.readOnly)}}function ri(t,d){if(t&1){let e=_();i(0,`
                            `),a(1,"jhi-unreferenced-feedback",49),A("feedbacksChange",function(n){u(e);let r=m(3);return M(r.unreferencedFeedback,n)||(r.unreferencedFeedback=n),h(n)}),g("feedbacksChange",function(n){u(e);let r=m(3);return h(r.onUnReferencedFeedbackChanged(n))}),l(),i(2,`
                        `)}if(t&2){let e=m(3);o(),v("feedbacks",e.unreferencedFeedback),x("readOnly",e.readOnly)("addReferenceIdForExampleSubmission",!0)("resultId",e.result.id)}}function mi(t,d){if(t&1&&(i(0,`
                        `),b(1,ri,3,4)),t&2){let e=m(2);o(),c(e.result&&e.result.id?1:-1)}}function di(t,d){if(t&1&&(i(0,`
                    `),p(1,"jhi-collapsable-assessment-instructions",50),i(2,`
                `)),t&2){let e=m(2);o(),x("readOnly",e.readOnly)("exercise",e.exercise)("collapsed",!e.readOnly&&!e.toComplete)("isAssessmentTraining",e.toComplete)("showAssessmentInstructions",e.assessmentMode)}}function ci(t,d){if(t&1&&(i(0,`
    `),a(1,"div",0),i(2,`
        `),a(3,"div",1),i(4,`
            `),a(5,"h2",2),i(6),l(),i(7,`
            `),b(8,Je,3,0)(9,Qe,3,0),l(),i(10,`
        `),b(11,Ze,7,3),a(12,"div",0),i(13,`
            `),a(14,"div",3),i(15,`
                `),a(16,"div",4),i(17,`
                    `),a(18,"span",5)(19,"strong"),i(20),f(21,"artemisTranslate"),l()(),i(22,`
                    `),a(23,"div",6),i(24,`
                        `),q(25,$e,13,6,null,null,z),b(27,ei,13,4),l(),i(28,`
                `),l(),i(29,`
            `),l(),i(30,`
            `),b(31,ii,11,1)(32,ti,6,1),l(),i(33,`
        `),a(34,"div",7),i(35,`
            `),a(36,"div",8),i(37,`
                `),a(38,"div",9),i(39,`
                    `),b(40,ni,9,2),a(41,"div",10),i(42,`
                        `),b(43,si,3,5)(44,oi,3,11),l(),i(45,`
                    `),i(46,`
                    `),b(47,ai,14,7)(48,li,3,2)(49,mi,2,1),l(),i(50,`
                `),b(51,di,3,5),l(),i(52,`
        `),l(),i(53,`
    `),l(),i(54,`
`)),t&2){let e=m();o(5),x("translateValues",K(18,Le,e.exercise==null?null:e.exercise.title)),o(),w(`
                Example Modeling Submission for Exercise `,e.exercise==null?null:e.exercise.title,`
            `),o(2),c(e.toComplete?8:-1),o(),c(e.assessmentMode?9:-1),o(2),c(e.exercise.isAtLeastEditor&&!e.readOnly&&!e.toComplete?11:-1),o(9),w("",C(21,16,"artemisApp.exampleSubmission.legend.title")," : "),o(5),G(e.legend.slice(0,3)),o(2),c(e.toComplete?27:-1),o(4),c(e.readOnly?31:-1),o(),c(e.toComplete?32:-1),o(8),c(e.highlightedElements()&&e.highlightedElements().size>0?40:-1),o(3),c(!e.assessmentMode&&e.exercise.diagramType?43:-1),o(),c(e.assessmentMode&&e.exercise.diagramType?44:-1),o(3),c(e.assessmentMode&&e.selectedMode===e.ExampleSubmissionMode.READ_AND_CONFIRM&&(!e.readOnly||e.assessmentExplanation&&e.assessmentExplanation.length>0)?47:-1),o(),c(e.assessmentMode&&e.selectedMode===e.ExampleSubmissionMode.READ_AND_CONFIRM&&(!e.readOnly||e.assessmentExplanation&&e.assessmentExplanation.length>0)?48:-1),o(),c(e.assessmentMode?49:-1),o(2),c(e.exercise?51:-1)}}var Yi=(()=>{class t{exerciseService=S(ge);exampleSubmissionService=S(Pe);modelingAssessmentService=S(Oe);tutorParticipationService=S(fe);alertService=S(_e);route=S(ee);router=S(ie);navigationUtilService=S(Te);modelingEditor;assessmentEditor;themeService=S(Ae);isNewSubmission;assessmentMode=!1;exerciseId;exampleSubmission;modelingSubmission;umlModel;explanationText;feedbackChanged=!1;assessmentsAreValid=!1;result;totalScore;invalidError;exercise;course;readOnly;toComplete;assessmentExplanation;isExamMode;selectedMode;ExampleSubmissionMode=E;legend=[{text:"artemisApp.exampleSubmission.legend.positiveScore",icon:xe,color:"green"},{text:"artemisApp.exampleSubmission.legend.negativeScore",icon:ce,color:"red"},{text:"artemisApp.exampleSubmission.legend.feedbackWithoutScore",icon:he,color:"blue"},{text:"artemisApp.exampleSubmission.legend.incorrectAssessment",icon:ue,color:"yellow"}];exampleSubmissionId;referencedFeedback=[];unreferencedFeedback=[];get assessments(){return[...this.referencedFeedback,...this.unreferencedFeedback]}highlightedElements=J(new Map);referencedExampleFeedback=[];highlightColor=Z(()=>this.themeService.userPreference()===Me.DARK?"darkblue":"lightblue");faSave=me;faCircle=le;faInfoCircle=de;faCodeBranch=re;faChalkboardTeacher=pe;constructor(){$(()=>{let e=this.highlightColor();X(()=>{let s=new Map;this.highlightedElements().forEach((n,r)=>{s.set(r,e)}),this.highlightedElements.set(s)})})}ngOnInit(){this.exerciseId=Number(this.route.snapshot.paramMap.get("exerciseId"));let e=this.route.snapshot.paramMap.get("exampleSubmissionId");this.readOnly=!!this.route.snapshot.queryParamMap.get("readOnly"),this.toComplete=!!this.route.snapshot.queryParamMap.get("toComplete"),e==="new"?(this.isNewSubmission=!0,this.exampleSubmissionId=-1):this.exampleSubmissionId=+e,(this.readOnly||this.toComplete)&&(this.assessmentMode=!0),this.loadAll()}loadAll(){let e=this.exerciseService.find(this.exerciseId);if(this.isNewSubmission)this.exampleSubmission=new Be;else{let s=this.exampleSubmissionService.get(this.exampleSubmissionId).pipe(y(n=>{this.exampleSubmission=n.body,this.exampleSubmission.submission&&(this.modelingSubmission=this.exampleSubmission.submission,this.modelingSubmission.model&&(this.umlModel=JSON.parse(this.modelingSubmission.model)),this.explanationText=this.modelingSubmission.explanationText??""),this.exampleSubmission.usedForTutorial?this.selectedMode=E.ASSESS_CORRECTLY:this.selectedMode=E.READ_AND_CONFIRM,this.assessmentExplanation=this.exampleSubmission.assessmentExplanation,this.toComplete?this.modelingAssessmentService.getExampleAssessment(this.exerciseId,this.modelingSubmission.id).subscribe(r=>{this.updateExampleAssessmentSolution(r)}):this.modelingAssessmentService.getExampleAssessment(this.exerciseId,this.modelingSubmission.id).subscribe(r=>{this.updateAssessment(r),this.checkScoreBoundaries()})}));e=U([e,s]).pipe(D(([n])=>n))}e.subscribe(s=>{this.exercise=s.body,this.course=be(this.exercise),this.isExamMode=this.exercise.exerciseGroup!=null})}upsertExampleModelingSubmission(){this.isNewSubmission?this.createNewExampleModelingSubmission():this.updateExampleModelingSubmission().subscribe(()=>this.updateAssessmentExplanationAndExampleAssessment())}createNewExampleModelingSubmission(){let e=new Re;e.model=JSON.stringify(this.modelingEditor.getCurrentModel()),e.explanationText=this.explanationText,e.exampleSubmission=!0;let s=this.exampleSubmission;s.submission=e,s.exercise=this.exercise,s.usedForTutorial=this.selectedMode===E.ASSESS_CORRECTLY,this.exampleSubmissionService.create(s,this.exerciseId).subscribe({next:n=>{this.exampleSubmission=n.body,this.exampleSubmissionId=this.exampleSubmission.id,this.exampleSubmission.submission&&(this.modelingSubmission=this.exampleSubmission.submission,this.modelingSubmission.model&&(this.umlModel=JSON.parse(this.modelingSubmission.model)),this.explanationText=this.modelingSubmission.explanationText??""),this.isNewSubmission=!1,this.alertService.success("artemisApp.modelingEditor.saveSuccessful"),this.navigationUtilService.replaceNewWithIdInUrl(window.location.href,this.exampleSubmissionId)},error:n=>{R(this.alertService,n)}})}updateExampleModelingSubmission(){this.modelingSubmission||this.createNewExampleModelingSubmission();let e=this.modelingEditor.getCurrentModel();this.modelingSubmission.model=JSON.stringify(e),this.modelingSubmission.explanationText=this.explanationText,this.modelingSubmission.exampleSubmission=!0,this.result&&(this.referencedFeedback=je(this.referencedFeedback,e),this.result.feedbacks=this.assessments,N(this.modelingSubmission,this.result),delete this.result.submission);let s=this.exampleSubmission;return s.submission=this.modelingSubmission,s.exercise=this.exercise,s.usedForTutorial=this.selectedMode===E.ASSESS_CORRECTLY,this.exampleSubmissionService.update(s,this.exerciseId).pipe(y(n=>{this.exampleSubmission=n.body,this.exampleSubmissionId=this.exampleSubmission.id,this.exampleSubmission.submission&&(this.modelingSubmission=this.exampleSubmission.submission,this.modelingSubmission.model&&(this.umlModel=JSON.parse(this.modelingSubmission.model)),this.modelingSubmission.explanationText&&(this.explanationText=this.modelingSubmission.explanationText)),this.isNewSubmission=!1,this.alertService.success("artemisApp.modelingEditor.saveSuccessful")}),L(n=>{throw R(this.alertService,n),n}))}onReferencedFeedbackChanged(e){this.referencedFeedback=e,this.feedbackChanged=!0,this.checkScoreBoundaries()}onUnReferencedFeedbackChanged(e){this.unreferencedFeedback=e,this.feedbackChanged=!0,this.checkScoreBoundaries()}showAssessment(){this.modelChanged()&&this.updateExampleModelingSubmission().subscribe(),this.assessmentMode=!0}modelChanged(){return this.modelingEditor&&JSON.stringify(this.umlModel)!==JSON.stringify(this.modelingEditor.getCurrentModel())}explanationChanged(e){this.explanationText=e}showSubmission(){this.feedbackChanged&&(this.saveExampleAssessment(),this.feedbackChanged=!1),this.assessmentMode=!1}saveExampleAssessment(){if(this.checkScoreBoundaries(),!this.assessmentsAreValid){this.alertService.error("artemisApp.modelingAssessment.invalidAssessments");return}this.assessmentExplanation!==this.exampleSubmission.assessmentExplanation&&this.assessments?this.updateAssessmentExplanationAndExampleAssessment():this.assessmentExplanation!==this.exampleSubmission.assessmentExplanation?this.updateAssessmentExplanation():this.assessments&&this.updateExampleAssessment()}updateAssessmentExplanationAndExampleAssessment(){this.exampleSubmission.assessmentExplanation=this.assessmentExplanation,this.exampleSubmissionService.update(this.exampleSubmission,this.exerciseId).pipe(y(e=>{this.exampleSubmission=e.body,this.assessmentExplanation=this.exampleSubmission.assessmentExplanation}),W(()=>this.modelingAssessmentService.saveExampleAssessment(this.assessments,this.exampleSubmissionId))).subscribe({next:e=>{this.updateAssessment(e),this.alertService.success("artemisApp.modelingAssessmentEditor.messages.saveSuccessful")},error:()=>{this.alertService.error("artemisApp.modelingAssessmentEditor.messages.saveFailed")}})}updateAssessmentExplanation(){this.exampleSubmission.assessmentExplanation=this.assessmentExplanation,this.exampleSubmissionService.update(this.exampleSubmission,this.exerciseId).subscribe(e=>{this.exampleSubmission=e.body,this.assessmentExplanation=this.exampleSubmission.assessmentExplanation})}updateExampleAssessment(){this.modelingAssessmentService.saveExampleAssessment(this.assessments,this.exampleSubmissionId).subscribe({next:e=>{this.updateAssessment(e),this.alertService.success("artemisApp.modelingAssessmentEditor.messages.saveSuccessful")},error:()=>{this.alertService.error("artemisApp.modelingAssessmentEditor.messages.saveFailed")}})}checkScoreBoundaries(){if(this.assessments.length===0){this.totalScore=0,this.assessmentsAreValid=!0;return}let e=this.assessments.map(r=>r.credits);if(!e.every(r=>r!=null&&!isNaN(r))){this.invalidError="The score field must be a number and can not be empty!",this.assessmentsAreValid=!1;return}let s=Fe(this.exercise),n=e.reduce((r,Ue)=>r+Ue,0);this.totalScore=ke(n,s),this.assessmentsAreValid=!0,this.invalidError=void 0}back(){return B(this,null,function*(){let e=this.exercise.course?.id||this.exercise.exerciseGroup?.exam?.course?.id;this.readOnly||this.toComplete?yield this.router.navigate(["/course-management",e,"assessment-dashboard",this.exerciseId]):this.isExamMode?yield this.router.navigate(["/course-management",e,"exams",this.exercise.exerciseGroup?.exam?.id,"exercise-groups",this.exercise.exerciseGroup?.id,"modeling-exercises",this.exerciseId,"example-submissions"]):yield this.router.navigate(["/course-management",e,"modeling-exercises",this.exerciseId,"example-submissions"])})}checkAssessment(){if(ye(),this.checkScoreBoundaries(),!this.assessmentsAreValid){this.alertService.error("artemisApp.modelingAssessment.invalidAssessments");return}let e=Object.assign({},this.exampleSubmission),s=new Ie;N(e.submission,s),delete s.submission,Se(e.submission).feedbacks=this.assessments,new De(this.tutorParticipationService,this.alertService,this).assessExampleSubmission(e,this.exerciseId)}markAllFeedbackToCorrect(){this.assessments.forEach(e=>{e.correctionStatus="CORRECT"}),this.assessmentEditor.resultFeedbacks=this.referencedFeedback}markWrongFeedback(e){e.forEach(s=>{let n=this.assessments.find(r=>r.reference===s.reference);n!=null&&(n.correctionStatus=s.type)}),this.assessmentEditor.resultFeedbacks=this.referencedFeedback,this.highlightMissedFeedback()}highlightMissedFeedback(){let e=this.referencedExampleFeedback.filter(n=>!this.referencedFeedback.some(r=>r.reference===n.reference)),s=new Map;for(let n of e)s.set(n.referenceId,this.highlightColor());this.highlightedElements.set(s)}readAndUnderstood(){this.tutorParticipationService.assessExampleSubmission(this.exampleSubmission,this.exerciseId).subscribe(()=>{this.alertService.success("artemisApp.exampleSubmission.readSuccessfully"),this.back()})}updateExampleAssessmentSolution(e){e&&(this.referencedExampleFeedback=e.feedbacks?.filter(s=>s.type!==T.MANUAL_UNREFERENCED)||[])}updateAssessment(e){this.result=e,e&&(this.referencedFeedback=e.feedbacks?.filter(s=>s.type!==T.MANUAL_UNREFERENCED)||[],this.unreferencedFeedback=e.feedbacks?.filter(s=>s.type===T.MANUAL_UNREFERENCED)||[])}static \u0275fac=function(s){return new(s||t)};static \u0275cmp=Q({type:t,selectors:[["jhi-example-modeling-submission"]],viewQuery:function(s,n){if(s&1&&(F(j,5),F(P,5)),s&2){let r;I(r=V())&&(n.modelingEditor=r.first),I(r=V())&&(n.assessmentEditor=r.first)}},decls:1,vars:1,consts:[[1,"row"],[1,"col-12","col-lg-7","d-flex","flex-column","justify-content-between"],["jhiTranslate","artemisApp.modelingExercise.exampleSubmissionForModelingExercise",3,"translateValues"],[1,"col-9","mb-3"],[1,"row","m-0","p-0","align-items-center"],[1,"p-0","pe-2","col-md-auto"],[1,"col","d-flex"],[1,"col-12"],[1,"row","flex-nowrap"],[1,"col","editor-container-outer"],[1,"row","editor-container-inner"],["jhiTranslate","artemisApp.exampleSubmission.home.assessmentTraining",1,"fw-light"],["jhiTranslate","artemisApp.exampleSubmission.assessmentInstruction"],[1,"col-12","col-lg-4","text-end"],[1,"d-flex","justify-content-end","flex-wrap","align-items-center"],[1,"text-start"],["jhiTranslate","artemisApp.exampleSubmission.assessmentTraining"],[3,"text"],["role","group",1,"btn-group"],["type","radio","name","mode","id","read-and-confirm-button","autocomplete","off",1,"btn-check",3,"ngModelChange","value","ngModel"],["for","read-and-confirm-button","jhiTranslate","artemisApp.exampleSubmission.readAndConfirm",1,"btn","btn-outline-secondary"],["type","radio","name","mode","id","only-not-imported","autocomplete","off",1,"btn-check",3,"ngModelChange","value","ngModel"],["for","only-not-imported","jhiTranslate","artemisApp.exampleSubmission.assessCorrectly",1,"btn","btn-outline-secondary"],[1,"btn","btn-primary","ms-2","button-resize",3,"click"],[3,"icon"],["jhiTranslate","artemisApp.modelingExercise.createNewExampleSubmission","id","new-modeling-example-submission"],["jhiTranslate","artemisApp.modelingExercise.saveExampleSubmission"],[1,"btn","btn-primary","button-resize",3,"click"],["jhiTranslate","artemisApp.modelingExercise.saveExampleAssessment"],[1,"mt-2","mb-3"],[1,"btn","btn-secondary","button-resize",3,"click"],["jhiTranslate","artemisApp.modelingExercise.showExampleAssessment","id","show-modeling-example-assessment"],["jhiTranslate","artemisApp.modelingExercise.showExampleSubmission"],[1,"d-flex","align-items-center","pe-5"],[1,"pe-2"],[1,"d-flex","justify-content-center","align-items-center","p-0","legend-icon-wrapper"],[1,"d-flex","justify-content-center","align-items-center","p-0","legend-icon-wrapper","warning-icon-wrapper"],[1,"col-3","text-end","mb-2"],[1,"btn","btn-success",3,"click"],["jhiTranslate","artemisApp.exampleSubmission.readAndUnderstood"],["jhiTranslate","artemisApp.exampleSubmission.submitAssessment",1,"btn","btn-primary","px-5",3,"click","disabled"],[1,"col"],[1,"my-2","text-center"],["jhiTranslate","artemisApp.exampleSubmission.modelElementHint"],[1,"col-12",3,"explanationChange","umlModel","diagramType","readOnly","explanation","withExplanation"],[1,"col-12",3,"feedbackChanged","umlModel","resultFeedbacks","diagramType","maxScore","maxBonusPoints","totalScore","readOnly","course","explanation","highlightedElements"],[1,"mt-3"],[1,"text-warning",3,"icon","title"],["rows","4","maxLength","2000",1,"form-control",3,"ngModelChange","ngModel","disabled"],[3,"feedbacksChange","feedbacks","readOnly","addReferenceIdForExampleSubmission","resultId"],[1,"col-auto","pe-2",3,"readOnly","exercise","collapsed","isAssessmentTraining","showAssessmentInstructions"]],template:function(s,n){s&1&&b(0,ci,55,20),s&2&&c(n.exercise?0:-1)},dependencies:[ve,we,ae,te,oe,ne,se,Ee,j,P,Ne,Ve,Ce],styles:[".editor-container-outer[_ngcontent-%COMP%]{min-width:0}.editor-container-inner[_ngcontent-%COMP%]{min-height:80vh}.button-resize[_ngcontent-%COMP%]{min-width:245px}.legend-icon-wrapper[_ngcontent-%COMP%]{background-color:var(--bs-body-color);height:29px;width:29px;border-radius:100%}.warning-icon-wrapper[_ngcontent-%COMP%]{background-color:var(--bs-yellow);color:var(--bs-bg-color)}"]})}return t})();export{Yi as ExampleModelingSubmissionComponent};
//# sourceMappingURL=example-modeling-submission.component-SIKB7VQN.js.map
