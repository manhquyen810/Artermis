import{a as ct}from"./chunk-DJL2LECX.js";import{a as Kn,b as it,c as ot,d as Jn,e as Xn,f as st,g as Zn,h as ei,i as rt,j as ti,k as at,l as ni,m as ii}from"./chunk-CJVQ2B7U.js";import{a as se}from"./chunk-DKAABN5U.js";import{a as ke,b as nt}from"./chunk-P2ARLJ6R.js";import{a as tt}from"./chunk-ND2AMZB2.js";import{a as Bn,b as Gn,c as Wn,d as Hn,e as zn,f as $n,g as Qn,h as qn,i as Yn}from"./chunk-JZSZQ37X.js";import{a as et}from"./chunk-X237AILQ.js";import{a as Si}from"./chunk-RGQYMQQL.js";import{B as Rn}from"./chunk-RTOKZMYN.js";import{a as Ln}from"./chunk-JRBFEQNN.js";import{a as Ze}from"./chunk-LYZAUST5.js";import{a as Xe,d as Un}from"./chunk-O26CMRR4.js";import{B as Je,C as Fn,D as ee,F as jn,H as oe,a as xn,b as Me,c as Ie,d as De,g as Ye,h as $,i as Ke,m as bn,o as Sn,p as An,r as On,s as Mn,t as In,u as Dn,v as Ct,x as kn,y as ae,z as Vn}from"./chunk-QH7SWO42.js";import{a as Tn,e as wn,f as yn,g as Pn,h as En,i as V}from"./chunk-P2M2VQE3.js";import{d as ut}from"./chunk-ZPITQMA6.js";import{c as qe}from"./chunk-5MVJAZRV.js";import{c as Nn}from"./chunk-JNO6DNVW.js";import{K as ye,v as Be}from"./chunk-VZRSC3LP.js";import{b as Gt}from"./chunk-5SKDOIBQ.js";import{J as Le,K as z,L as we,b as Wt,c as Ht,e as _e,h as H,i as xe,m as Re,n as be,s as Se,v as Te}from"./chunk-WA5GEAJB.js";import{c as _n}from"./chunk-BNDLMKXK.js";import{a as P}from"./chunk-K3W6YFKH.js";import{c as Qe}from"./chunk-JXJXC4DZ.js";import{d as F}from"./chunk-EDXSOKK5.js";import{p as Ut}from"./chunk-DID2YGL7.js";import{C as Yt,Db as sn,Ec as mn,I as Kt,Jb as rn,Kb as ze,L as Jt,Lc as $e,Ld as gn,Mc as hn,N as Xt,Nc as un,Ob as an,Oc as Ae,P as Zt,Sa as He,Tc as Oe,Uc as Cn,Zb as cn,_ as Pe,d as Qt,db as on,fc as ln,ia as en,id as vn,la as tn,mc as dn,qc as pn,rd as fn,s as qt,va as nn,w as Ge,y as We,yc as Ee}from"./chunk-Z4VHWOB5.js";import{a as $t}from"./chunk-XUCCGZJR.js";import{a as zt}from"./chunk-NOBD5HSR.js";import{a as y}from"./chunk-U54OSGNH.js";import{f as Rt,h as Lt,i as Bt}from"./chunk-M6Z6DKZQ.js";import{n as W}from"./chunk-IOA4DPXY.js";import{Ad as Z,Cb as Pt,Db as a,Dc as g,Ea as x,F as xt,Id as ie,La as me,Ma as m,Mb as ne,Mc as v,Na as h,Nb as Et,Oc as c,P as K,Qa as B,Rc as J,Rd as ge,Sc as Mt,Tb as w,U as re,Va as O,W as bt,Xb as G,Ya as k,Yc as he,Za as A,Zb as f,Zc as ue,_ as pe,_c as Ce,aa as St,ad as X,bd as ve,cd as ht,dd as t,ed as R,f as D,fd as L,gd as It,hd as Dt,j as Y,kc as d,ld as kt,mc as At,md as Vt,nd as Ft,pa as b,pd as jt,qd as Ne,r as te,rc as je,rd as E,sc as C,sd as fe,uc as Ot,vc as N,vd as Nt,wb as wt,wc as U,xb as yt,xc as s,ya as Tt,yc as r,yd as _,z as Ue,zc as u,zd as T}from"./chunk-5LC5EQRR.js";import{a as le,b as de,h as bi,j as _t}from"./chunk-3E746U5Y.js";var Ve=(()=>{class n{closeSidebar$=new O;openSidebar$=new O;toggleSidebar$=new O;closeSidebar(){this.closeSidebar$.emit()}openSidebar(){this.openSidebar$.emit()}toggleSidebar(){this.toggleSidebar$.emit()}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Tt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Ti=["postingThread"],wi=["container"],oi=n=>({"is-not-in-active-search":n}),yi=n=>({"posting-infinite-scroll-container":n}),Pi=n=>({search:n});function Ei(n,p){n&1&&(t(0,`
                    `),u(1,"span",12),t(2,`
                `))}function Ai(n,p){if(n&1){let e=g();t(0,`
                    `),s(1,"button",13),v("click",function(){m(e);let i=c();return h(i.openSidebar())}),t(2,`
                        `),u(3,"fa-icon",14),t(4,`
                    `),r(),t(5,`
                    `),u(6,"span",15),t(7,`
                `)}if(n&2){let e=c();a(3),d("icon",e.faChevronLeft),a(3),d("translateValues",E(2,Pi,e.courseWideSearchConfig().searchTerm))}}function Oi(n,p){if(n&1){let e=g();t(0,`
            `),s(1,"div",16),t(2,`
                `),s(3,"form",17),t(4,`
                    `),t(5,`
                    `),s(6,"div",18),t(7,`
                        `),t(8,`
                        `),s(9,"div",10),t(10,`
                            `),s(11,"div",19),t(12,`
                                `),u(13,"fa-icon",14),t(14,`
                            `),r(),t(15,`
                            `),s(16,"div",20),t(17,`
                                `),s(18,"input",21),v("change",function(){m(e);let i=c();return h(i.onSelectContext())}),r(),t(19,`
                                `),u(20,"label",22),t(21,`
                            `),r(),t(22,`
                            `),s(23,"div",20),t(24,`
                                `),s(25,"input",23),v("change",function(){m(e);let i=c();return h(i.onSelectContext())}),r(),t(26,`
                                `),u(27,"label",24),t(28,`
                            `),r(),t(29,`
                            `),s(30,"div",20),t(31,`
                                `),s(32,"input",25),v("change",function(){m(e);let i=c();return h(i.onSelectContext())}),r(),t(33,`
                                `),u(34,"label",26),t(35,`
                            `),r(),t(36,`
                        `),r(),t(37,`
                        `),t(38,`
                        `),s(39,"div",27),t(40,`
                            `),u(41,"div",28),t(42,`
                            `),s(43,"div",29),v("click",function(){m(e);let i=c();return h(i.onChangeSortDir())}),t(44,`
                                `),u(45,"fa-icon",30),_(46,"artemisTranslate"),_(47,"artemisTranslate"),t(48,`
                            `),r(),t(49,`
                        `),r(),t(50,`
                    `),r(),t(51,`
                `),r(),t(52,`
            `),r(),t(53,`
        `)}if(n&2){let e=c();a(3),d("formGroup",e.formGroup),a(10),d("icon",e.faFilter),a(32),d("icon",e.sortingOrder===e.SortDirection.ASCENDING?e.faLongArrowAltUp:e.faLongArrowAltDown)("ngbTooltip",e.sortingOrder===e.SortDirection.ASCENDING?T(46,4,"artemisApp.metis.overview.sortAscending"):T(47,6,"artemisApp.metis.overview.sortDescending"))}}function Mi(n,p){if(n&1&&(t(0,`
                        `),s(1,"div",31),t(2,`
                            `),u(3,"fa-icon",32),t(4,`
                        `),r(),t(5,`
                    `)),n&2){let e=c();a(3),d("icon",e.faCircleNotch)}}function Ii(n,p){if(n&1&&(t(0,`
                        `),s(1,"div",31),t(2,`
                            `),u(3,"fa-icon",33),t(4,`
                        `),r(),t(5,`
                    `)),n&2){let e=c();a(3),d("icon",e.faEnvelope)}}function Di(n,p){if(n&1){let e=g();t(0,`
                            `),s(1,"div",34),t(2,`
                                `),s(3,"jhi-posting-thread",35,1),v("openThread",function(i){m(e);let l=c();return h(l.setPostForThread(i))}),r(),t(5,`
                            `),r(),t(6,`
                        `)}if(n&2){let e,o,i=p.$implicit,l=c();a(3),d("lastReadDate",i.conversation==null?null:i.conversation.lastMessageDate)("hasChannelModerationRights",!!((e=l.getAsChannel(i.conversation))!=null&&e.hasChannelModerationRights))("id","item-"+i.id)("post",i)("showAnswers",!1)("readOnlyMode",!!((o=l.getAsChannel(i.conversation))!=null&&o.isArchived))("isCommunicationPage",!0)("showChannelReference",!0)}}var pt=(()=>{class n{courseWideSearchConfig=A.required();messages=Et("postingThread");messages$=Gt(this.messages);content=ne("container");openThread=k();course;currentPostContextFilter;messagesContainerHeight=700;faPlus=$e;faFilter=He;faLongArrowAltUp=ln;faLongArrowAltDown=mn;faTimes=Ae;faEnvelope=ze;faCircleNotch=We;faChevronLeft=Oe;SortDirection=$;sortingOrder=$.ASCENDING;ngUnsubscribe=new D;isFetchingPosts=!0;totalNumberOfPosts=0;posts=[];previousScrollDistanceFromTop;page=1;formGroup;getAsChannel=V;courseSidebarService=x(Ve);metisService=x(ee);metisConversationService=x(oe);formBuilder=x(Le);cdr=x(ie);ngOnInit(){this.subscribeToMetis(),this.resetFormGroup(),this.cdr.detectChanges(),this.onSearch()}ngAfterViewInit(){this.messages$.pipe(b(this.ngUnsubscribe)).subscribe(this.handleScrollOnNewMessage)}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}openSidebar(){this.courseSidebarService.openSidebar()}subscribeToMetis(){this.metisService.posts.pipe(b(this.ngUnsubscribe)).subscribe(e=>{this.setPosts(e),this.isFetchingPosts=!1}),this.metisService.totalNumberOfPosts.pipe(b(this.ngUnsubscribe)).subscribe(e=>{this.totalNumberOfPosts=e})}setPosts(e){this.content()&&(this.previousScrollDistanceFromTop=this.content().nativeElement.scrollHeight-this.content().nativeElement.scrollTop),this.posts=e.slice().reverse()}handleScrollOnNewMessage=()=>{(this.posts.length>0&&this.content()&&this.content().nativeElement.scrollTop===0&&this.page===1||this.previousScrollDistanceFromTop===this.messagesContainerHeight)&&this.scrollToBottomOfMessages()};scrollToBottomOfMessages(){this.content()&&(this.content().nativeElement.scrollTop=this.content().nativeElement.scrollHeight)}fetchNextPage(){this.posts.length<this.totalNumberOfPosts&&(this.page+=1,this.commandMetisToFetchPosts()),this.content()&&(this.content().nativeElement.scrollTop=this.content().nativeElement.scrollTop+50)}commandMetisToFetchPosts(e=!1){this.refreshMetisConversationPostContextFilter(),this.currentPostContextFilter&&(this.isFetchingPosts=!0,this.metisService.getFilteredPosts(this.currentPostContextFilter,e))}refreshMetisConversationPostContextFilter(){let e=this.courseWideSearchConfig();e&&(this.currentPostContextFilter={courseId:this.course?.id,searchText:e.searchTerm?e.searchTerm.trim():void 0,postSortCriterion:Ke.CREATION_DATE,filterToUnresolved:e.filterToUnresolved,filterToOwn:e.filterToOwn,filterToAnsweredOrReacted:e.filterToAnsweredOrReacted,sortingOrder:e.sortingOrder,pagingEnabled:!0,page:this.page-1,pageSize:50},this.metisConversationService.conversationsOfUser$.pipe(b(this.ngUnsubscribe)).subscribe(o=>{this.currentPostContextFilter.courseWideChannelIds=o.filter(i=>!(this.currentPostContextFilter?.filterToUnresolved&&this.conversationIsAnnouncement(i))).map(i=>i.id)}))}conversationIsAnnouncement(e){return e.type==="channel"?e.isAnnouncementChannel:!1}postsTrackByFn=(e,o)=>o.id;setPostForThread(e){this.openThread.emit(e)}onSearch(){this.commandMetisToFetchPosts(!0)}resetFormGroup(){this.formGroup=this.formBuilder.group({filterToUnresolved:!1,filterToOwn:!1,filterToAnsweredOrReacted:!1})}onChangeSortDir(){this.sortingOrder=this.sortingOrder===$.DESCENDING?$.ASCENDING:$.DESCENDING,this.onSelectContext()}onSelectContext(){let e=this.courseWideSearchConfig();e&&(e.filterToUnresolved=this.formGroup.get("filterToUnresolved")?.value,e.filterToOwn=this.formGroup.get("filterToOwn")?.value,e.filterToAnsweredOrReacted=this.formGroup.get("filterToAnsweredOrReacted")?.value,e.sortingOrder=this.sortingOrder,this.onSearch())}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=w({type:n,selectors:[["jhi-course-wide-search"]],viewQuery:function(o,i){o&1&&(X(i.messages,Ti,5),X(i.content,wi,5)),o&2&&ve(2)},inputs:{courseWideSearchConfig:[1,"courseWideSearchConfig"]},outputs:{openThread:"openThread"},decls:44,vars:14,consts:[["container",""],["postingThread",""],[1,"course-wide-search-mobile-disclaimer",3,"ngClass"],["jhiTranslate","artemisApp.metis.overview.mobileDisclaimer",1,"mb-2"],["jhiTranslate","artemisApp.metis.overview.mobileDisclaimerCallToAction",1,"btn","btn-outline-secondary",3,"click"],[3,"ngClass"],[1,"mt-2","mx-2"],[1,"d-inline-block","rounded","p-1","info"],[1,"justify-content-center","coursewide-search"],[1,"justify-content-center"],[1,"row"],["id","scrollableDiv","infinite-scroll","",3,"scrolledUp","ngClass","scrollWindow"],["jhiTranslate","artemisApp.metis.overview.allPublicMessages"],[1,"btn","btn-sm","btn-outline-secondary","d-inline-block","d-sm-none","me-2",3,"click"],[3,"icon"],["jhiTranslate","artemisApp.metis.overview.searchResults",3,"translateValues"],[1,"mb-1"],[3,"formGroup"],[1,"ms-3","me-1","d-flex","justify-content-between","flex-wrap"],[1,"col-auto","p-0"],[1,"col-auto","p-0","ps-2"],["type","checkbox","formControlName","filterToUnresolved","name","filterToUnresolved","id","filterToUnresolved",1,"form-check-input",3,"change"],["for","filterToUnresolved","jhiTranslate","artemisApp.metis.overview.filterToUnresolved",1,"p-0"],["type","checkbox","formControlName","filterToOwn","name","filterToOwn","id","filterToOwn",1,"form-check-input",3,"change"],["for","filterToOwn","jhiTranslate","artemisApp.metis.overview.filterToOwn",1,"p-0"],["type","checkbox","formControlName","filterToAnsweredOrReacted","name","filterToAnsweredOrReacted","id","filterToAnsweredOrReacted",1,"form-check-input",3,"change"],["for","filterToAnsweredOrReacted","jhiTranslate","artemisApp.metis.overview.filterToAnsweredOrReacted",1,"p-0"],[1,"d-flex"],["jhiTranslate","artemisApp.metis.overview.sortedByDate",1,"col-auto","p-0","me-1"],["role","button",1,"col-auto","p-0","clickable",3,"click"],[3,"icon","ngbTooltip"],[1,"envelope"],["size","3x","animation","spin",3,"icon"],["size","5x",3,"icon"],[1,"pt-2"],[3,"openThread","lastReadDate","hasChannelModerationRights","id","post","showAnswers","readOnlyMode","isCommunicationPage","showChannelReference"]],template:function(o,i){if(o&1){let l=g();s(0,"div",2),t(1,`
    `),u(2,"span",3),t(3,`
    `),s(4,"button",4),v("click",function(){return m(l),h(i.openSidebar())}),r(),t(5,`
`),r(),t(6,`
`),s(7,"div",5),t(8,`
    `),s(9,"div",6),t(10,`
        `),s(11,"div"),t(12,`
            `),s(13,"h4",7),t(14,`
                `),f(15,Ei,3,0)(16,Ai,8,4),r(),t(17,`
        `),r(),t(18,`
        `),f(19,Oi,54,8),u(20,"hr"),t(21,`
        `),s(22,"div",8),t(23,`
            `),s(24,"div",9),t(25,`
                `),s(26,"div",10),t(27,`
                    `),t(28,`
                    `),f(29,Mi,6,1)(30,Ii,6,1),s(31,"div",11,0),v("scrolledUp",function(){return m(l),h(i.fetchNextPage())}),t(33,`
                        `),t(34,`
                        `),t(35,`
                        `),N(36,Di,7,8,null,null,i.postsTrackByFn,!0),r(),t(38,`
                `),r(),t(39,`
            `),r(),t(40,`
        `),r(),t(41,`
    `),r(),t(42,`
`),r(),t(43,`
`)}o&2&&(d("ngClass",E(8,oi,!i.courseWideSearchConfig().searchTerm)),a(7),d("ngClass",E(10,oi,!i.courseWideSearchConfig().searchTerm)),a(8),C(i.courseWideSearchConfig().searchTerm?16:15),a(4),C(i.formGroup?19:-1),a(10),C(i.isFetchingPosts?29:-1),a(),C(!i.isFetchingPosts&&i.posts.length===0?30:-1),a(),d("ngClass",E(12,yi,i.posts.length!==0))("scrollWindow",!1),a(5),U(i.posts))},dependencies:[W,y,F,z,be,Wt,H,xe,we,Se,Te,ye,ct,tt,P],styles:[`.coursewide-search .bold-line{height:1px;background:var(--metis-light-gray)}.coursewide-search .form-select{border:0;box-shadow:none!important}.coursewide-search .selection-prefix{padding-top:.375rem!important}.coursewide-search .posting-infinite-scroll-container{--search-channel-header-height: 80px;max-height:calc(75vh - var(--header-height) - var(--search-channel-header-height));overflow-y:auto}.coursewide-search .envelope{text-align:center;opacity:.75;height:250px;padding-top:100px;padding-bottom:100px}.course-wide-search-mobile-disclaimer{display:none}@media (max-width: 575.98px){.is-not-in-active-search{display:none}.course-wide-search-mobile-disclaimer{pointer-events:none;position:absolute;top:10%;left:0;height:80%;width:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;opacity:0;transition:opacity .2s ease-in-out}.course-wide-search-mobile-disclaimer.is-not-in-active-search{opacity:1;pointer-events:all}.coursewide-search .posting-infinite-scroll-container{max-height:calc(60vh - var(--header-height) - var(--search-channel-header-height));max-height:calc(60dvh - var(--header-height) - var(--search-channel-header-height))}}
`],encapsulation:2})}return n})(),lt=class{searchTerm;filterToUnresolved;filterToOwn;filterToAnsweredOrReacted;sortingOrder};function ki(n,p){if(n&1){let e=g();t(0,`
    `),s(1,"div",0),t(2,`
        `),s(3,"div",1),t(4,`
            `),s(5,"h4",2),t(6,`
                `),s(7,"span"),t(8),_(9,"artemisTranslate"),_(10,"artemisTranslate"),_(11,"artemisTranslate"),r(),t(12,`
            `),r(),t(13,`
            `),s(14,"button",3),v("click",function(){m(e);let i=c();return h(i.dismiss())}),r(),t(15,`
        `),r(),t(16,`
        `),s(17,"div",4),t(18,`
            `),u(19,"p",5),t(20,`
            `),s(21,"jhi-channel-form",6),v("channelTypeChanged",function(i){m(e);let l=c();return h(l.onChannelTypeChanged(i))})("isAnnouncementChannelChanged",function(i){m(e);let l=c();return h(l.onIsAnnouncementChannelChanged(i))})("isCourseWideChannelChanged",function(i){m(e);let l=c();return h(l.onIsCourseWideChannelChanged(i))})("formSubmitted",function(i){m(e);let l=c();return h(l.onFormSubmitted(i))}),r(),t(22,`
        `),r(),t(23,`
    `),r(),t(24,`
`)}if(n&2){let e=c();a(8),Dt("",T(9,3,e.isPublicChannel?"artemisApp.dialogs.createChannel.titlePublicChannel":"artemisApp.dialogs.createChannel.titlePrivateChannel"),`
                    `,e.isCourseWideChannel?T(10,5,"artemisApp.dialogs.createChannel.titleCourseWideChannel"):"",`
                    `,T(11,7,e.isAnnouncementChannel?"artemisApp.dialogs.createChannel.titleAnnouncementChannel":"artemisApp.dialogs.createChannel.titleRegularChannel"),`
                `)}}var si=(()=>{class n extends se{course;initialize(){super.initialize(["course"])}channelToCreate=new Pn;isPublicChannel=!0;isAnnouncementChannel=!1;isCourseWideChannel=!1;onChannelTypeChanged(e){this.isPublicChannel=e==="PUBLIC"}onIsAnnouncementChannelChanged(e){this.isAnnouncementChannel=e}onIsCourseWideChannelChanged(e){this.isCourseWideChannel=e}onFormSubmitted(e){this.createChannel(e)}createChannel(e){let{name:o,description:i,isPublic:l,isAnnouncementChannel:S,isCourseWideChannel:M}=e;this.channelToCreate.name=o?o.trim():void 0,this.channelToCreate.description=i?i.trim():void 0,this.channelToCreate.isPublic=l??!1,this.channelToCreate.isAnnouncementChannel=S??!1,this.channelToCreate.isCourseWide=M??!1,this.close(this.channelToCreate)}static \u0275fac=(()=>{let e;return function(i){return(e||(e=B(n)))(i||n)}})();static \u0275cmp=w({type:n,selectors:[["jhi-channels-create-dialog"]],inputs:{course:"course"},features:[G],decls:1,vars:1,consts:[["ngbAutofocus","",1,"channels-overview"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["jhiTranslate","artemisApp.dialogs.createChannel.description"],[3,"channelTypeChanged","isAnnouncementChannelChanged","isCourseWideChannelChanged","formSubmitted"]],template:function(o,i){o&1&&f(0,ki,25,9),o&2&&C(i.isInitialized?0:-1)},dependencies:[y,ti,P],encapsulation:2})}return n})();var Vi=n=>({title:n});function Fi(n,p){n&1&&(t(0,`
                `),s(1,"span",5),t(2),_(3,"artemisTranslate"),r(),t(4,`
            `)),n&2&&(a(2),R(T(3,1,"artemisApp.dialogs.channelOverview.channelItem.joined:")))}function ji(n,p){if(n&1&&(t(0,`
                `),s(1,"div"),t(2,`
                    `),s(3,"span",6),t(4),r(),t(5,`
                `),r(),t(6,`
            `)),n&2){let e=c(2);a(4),L(" ",e.channel.description,"")}}function Ni(n,p){if(n&1&&(t(0,`
                `),s(1,"div"),t(2,`
                    `),u(3,"span",7),t(4,`
                `),r(),t(5,`
            `)),n&2){let e=c(2);a(3),d("translateValues",E(1,Vi,e.channel.tutorialGroupTitle))}}function Ui(n,p){if(n&1){let e=g();t(0,`
                `),s(1,"button",8),v("click",function(i){m(e);let l=c(2);return h(l.emitChannelAction(i,"register"))}),r(),t(2,`
                `),t(3,`
            `)}if(n&2){let e=c(2);a(),d("id","register"+e.channel.id)}}function Ri(n,p){if(n&1){let e=g();t(0,`
                `),s(1,"button",9),v("click",function(i){m(e);let l=c(2);return h(l.emitChannelAction(i,"view"))}),r(),t(2,`
            `)}if(n&2){let e=c(2);a(),d("id","view"+e.channel.id)}}function Li(n,p){if(n&1){let e=g();t(0,`
                `),s(1,"button",10),v("click",function(i){m(e);let l=c(2);return h(l.emitChannelAction(i,"deregister"))}),r(),t(2,`
            `)}if(n&2){let e=c(2);a(),d("id","deregister"+e.channel.id)}}function Bi(n,p){if(n&1&&(t(0,`
    `),s(1,"div",0),t(2,`
        `),s(3,"div",1),t(4,`
            `),s(5,"div",2),t(6,`
                `),s(7,"span"),t(8,`
                    `),u(9,"jhi-channel-icon",3),t(10,`
                `),r(),t(11,`
                `),s(12,"span"),t(13),r(),t(14,`
            `),r(),t(15,`
            `),f(16,Fi,5,3),s(17,"span"),t(18),_(19,"artemisTranslate"),r(),t(20,`
            `),f(21,ji,7,1)(22,Ni,6,3),r(),t(23,`
        `),s(24,"div",4),t(25,`
            `),f(26,Ui,4,1)(27,Ri,3,1)(28,Li,3,1),r(),t(29,`
    `),r(),t(30,`
`)),n&2){let e=c();a(9),d("isPublic",e.channel.isPublic)("isAnnouncementChannel",e.channel.isAnnouncementChannel),a(4),R(e.channel.name),a(3),C(e.channel.isMember?16:-1),a(2),It(" ",e.channel.numberOfMembers," ",T(19,11,"artemisApp.dialogs.channelOverview.channelItem.members"),""),a(3),C(e.channel.description&&e.channel.description.length>0?21:-1),a(),C(e.channel.tutorialGroupId&&e.channel.tutorialGroupTitle?22:-1),a(4),C(e.canJoinChannel(e.channel)?26:-1),a(),C(e.channel.isMember?27:-1),a(),C(e.canLeaveConversation(e.channel)?28:-1)}}var ri=(()=>{class n{canJoinChannel=ei;canLeaveConversation=Zn;channelAction=new O;channel;emitChannelAction(e,o){e.stopPropagation(),this.channelAction.emit({action:o,channel:this.channel})}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=w({type:n,selectors:[["jhi-channel-item"]],inputs:{channel:"channel"},outputs:{channelAction:"channelAction"},decls:1,vars:1,consts:[[1,"d-flex","justify-content-between","align-items-start","channel-item"],[1,"ms-2","me-auto"],[1,"fw-bold"],[3,"isPublic","isAnnouncementChannel"],[1,"interaction"],[1,"badge","bg-success","rounded-pill"],[1,"d-inline-block","text-truncate","long-text","fst-italic"],["jhiTranslate","artemisApp.entities.tutorialGroup.channelReverse",1,"badge","bg-info","rounded-pill",3,"translateValues"],["type","button","jhiTranslate","artemisApp.dialogs.channelOverview.actions.join",1,"btn","btn-primary",3,"click","id"],["type","button","jhiTranslate","artemisApp.dialogs.channelOverview.actions.view",1,"btn","btn-secondary",3,"click","id"],["type","button","jhiTranslate","artemisApp.dialogs.channelOverview.actions.leave",1,"btn","btn-danger",3,"click","id"]],template:function(o,i){o&1&&f(0,Bi,31,13),o&2&&C(i.channel?0:-1)},dependencies:[it,y,P],styles:[".channel-item[_ngcontent-%COMP%]{padding:.5rem}.channel-item[_ngcontent-%COMP%]   .interaction[_ngcontent-%COMP%]{visibility:hidden}.channel-item[_ngcontent-%COMP%]:hover   .interaction[_ngcontent-%COMP%]{visibility:visible}.channel-item[_ngcontent-%COMP%]   .long-text[_ngcontent-%COMP%]{max-width:600px}"]})}return n})();var Gi=n=>({courseTitle:n});function Wi(n,p){return this.channels.indexOf(p)}function Hi(n,p){if(n&1){let e=g();t(0,`
                                    `),s(1,"li",9),t(2,`
                                        `),s(3,"jhi-channel-item",10),v("channelAction",function(i){m(e);let l=c(3);return h(l.onChannelAction(i))}),r(),t(4,`
                                    `),r(),t(5,`
                                `)}if(n&2){let e=p.$implicit;a(),d("id","channel-"+e.id),a(2),d("channel",e)}}function zi(n,p){if(n&1&&(t(0,`
                    `),s(1,"div",6),t(2,`
                        `),s(3,"div",7),t(4,`
                            `),s(5,"ul",8),t(6,`
                                `),N(7,Hi,6,2,null,null,Wi,!0),r(),t(9,`
                        `),r(),t(10,`
                    `),r(),t(11,`
                `)),n&2){let e=c(2);a(7),U(e.channels)}}function $i(n,p){if(n&1){let e=g();t(0,`
        `),s(1,"div",1),t(2,`
            `),s(3,"div",2),t(4,`
                `),s(5,"h4",3),t(6,`
                    `),s(7,"span"),t(8),_(9,"artemisTranslate"),r(),t(10,`
                `),r(),t(11,`
                `),s(12,"button",4),v("click",function(){m(e);let i=c();return h(i.clear())}),r(),t(13,`
            `),r(),t(14,`
            `),s(15,"div",5),t(16,`
                `),t(17,`
                `),f(18,zi,12,0),r(),t(19,`
        `),r(),t(20,`
    `)}if(n&2){let e=c();a(8),R(Z(9,2,"artemisApp.dialogs.channelOverview.title",E(5,Gi,e.course.title))),a(10),C(e.channels&&e.channels.length>0?18:-1)}}var ai=(()=>{class n extends se{channelService=x(jn);alertService=x(Qe);ngUnsubscribe=new D;canCreateChannel=rt;createChannelFn;course;channelSubType;channelActions$=new D;noOfChannels=0;channelModificationPerformed=!1;isLoading=!1;channels=[];isInitialized=!1;faChevronRight=Cn;initialize(){super.initialize(["course","channelSubType"]),this.isInitialized&&this.loadChannelsOfCourse()}ngOnInit(){this.channelActions$.pipe(re(500),pe(),b(this.ngUnsubscribe)).subscribe(e=>{this.performChannelAction(e)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}clear(){this.channelModificationPerformed?this.close([void 0,!0]):this.dismiss()}onChannelAction(e){this.channelActions$.next(e)}performChannelAction(e){switch(e.action){case"register":this.channelService.registerUsersToChannel(this.course.id,e.channel.id).pipe(b(this.ngUnsubscribe)).subscribe(()=>{this.loadChannelsOfCourse(),this.channelModificationPerformed=!0});break;case"deregister":this.channelService.deregisterUsersFromChannel(this.course.id,e.channel.id).pipe(b(this.ngUnsubscribe)).subscribe(()=>{this.loadChannelsOfCourse(),this.channelModificationPerformed=!0});break;case"view":this.close([e.channel,this.channelModificationPerformed]);break}}loadChannelsOfCourse(){this.isLoading=!0,this.channelService.getChannelsOfCourse(this.course.id).pipe(Ue(e=>e.body),St(()=>{this.isLoading=!1}),b(this.ngUnsubscribe)).subscribe({next:e=>{this.channels=e,this.noOfChannels=this.channels.length},error:e=>{qe(this.alertService,e)}})}static \u0275fac=(()=>{let e;return function(i){return(e||(e=B(n)))(i||n)}})();static \u0275cmp=w({type:n,selectors:[["jhi-channels-overview-dialog"]],inputs:{createChannelFn:"createChannelFn",course:"course",channelSubType:"channelSubType"},features:[G],decls:4,vars:2,consts:[[3,"isLoading"],[1,"channels-overview"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"form-group","mt-2"],[1,"table-wrapper-scroll-y","scrollbar"],[1,"list-group"],[1,"list-group-item",3,"id"],[3,"channelAction","channel"]],template:function(o,i){o&1&&(s(0,"jhi-loading-indicator-container",0),t(1,`
    `),f(2,$i,21,7),r(),t(3,`
`)),o&2&&(d("isLoading",i.isLoading),a(2),C(i.isInitialized?2:-1))},dependencies:[et,ri,P],styles:[".channels-overview[_ngcontent-%COMP%]   .scrollbar[_ngcontent-%COMP%]{position:relative;max-height:500px;overflow:auto}.channels-overview[_ngcontent-%COMP%]   .table-wrapper-scroll-y[_ngcontent-%COMP%]{display:block}.channels-overview[_ngcontent-%COMP%]   .list-group-item[_ngcontent-%COMP%]{overflow:hidden;padding:0}.channels-overview[_ngcontent-%COMP%]   .other-channels[_ngcontent-%COMP%]{cursor:pointer}"]})}return n})();var Qi=()=>({max:9});function qi(n,p){n&1&&(t(0,`
                            `),u(1,"div",13),t(2,`
                        `))}function Yi(n,p){n&1&&(t(0,`
                            `),u(1,"div",14),t(2,`
                        `)),n&2&&(a(),d("translateValues",Ne(1,Qi)))}function Ki(n,p){if(n&1&&(t(0,`
                    `),s(1,"div",12),t(2,`
                        `),f(3,qi,3,0)(4,Yi,3,2),r(),t(5,`
                `)),n&2){let e=c(2);a(3),C(!(e.selectedUsersControl==null||e.selectedUsersControl.errors==null)&&e.selectedUsersControl.errors.required?3:-1),a(),C(!(e.selectedUsersControl==null||e.selectedUsersControl.errors==null)&&e.selectedUsersControl.errors.maxlength?4:-1)}}function Ji(n,p){if(n&1){let e=g();t(0,`
    `),s(1,"div",0),t(2,`
        `),s(3,"div",1),t(4,`
            `),s(5,"h4",2),t(6,`
                `),u(7,"span",3),t(8,`
            `),r(),t(9,`
            `),s(10,"button",4),v("click",function(){m(e);let i=c();return h(i.clear())}),r(),t(11,`
        `),r(),t(12,`
        `),s(13,"div",5),t(14,`
            `),s(15,"form",6),v("ngSubmit",function(){m(e);let i=c();return h(i.onSubmit())}),t(16,`
                `),u(17,"jhi-course-users-selector",7),_(18,"artemisTranslate"),t(19,`
                `),f(20,Ki,6,2),s(21,"div",8),t(22,`
                    `),s(23,"div",9),t(24,`
                        `),s(25,"button",10),t(26,`
                            `),u(27,"span",11),t(28,`
                        `),r(),t(29,`
                    `),r(),t(30,`
                `),r(),t(31,`
            `),r(),t(32,`
        `),r(),t(33,`
    `),r(),t(34,`
`)}if(n&2){let e=c();a(15),d("formGroup",e.form),a(2),d("courseId",e.course.id)("label",T(18,5,"artemisApp.dialogs.createGroupChat.userSelectorLabel")),a(3),C(e.selectedUsersControl!=null&&e.selectedUsersControl.invalid&&(e.selectedUsersControl!=null&&e.selectedUsersControl.dirty||e.selectedUsersControl!=null&&e.selectedUsersControl.touched)?20:-1),a(5),d("disabled",!e.isSubmitPossible)}}var ci=(()=>{class n extends se{fb=x(Le);course;form;initialize(){super.initialize(["course"]),this.isInitialized&&this.initializeForm()}initializeForm(){if(this.form)return;let e=[_e.required,_e.maxLength(9)];this.form=this.fb.group({selectedUsers:[[],e]})}get selectedUsersControl(){return this.form.get("selectedUsers")}get isSubmitPossible(){return!this.form.invalid}clear(){this.dismiss()}onSubmit(){this.close(this.selectedUsersControl?.value??[])}static \u0275fac=(()=>{let e;return function(i){return(e||(e=B(n)))(i||n)}})();static \u0275cmp=w({type:n,selectors:[["jhi-group-chat-create-dialog"]],inputs:{course:"course"},features:[G],decls:1,vars:1,consts:[["ngbAutofocus",""],[1,"modal-header"],[1,"modal-title"],["jhiTranslate","artemisApp.dialogs.createGroupChat.title"],["type","button",1,"btn-close","dismiss",3,"click"],[1,"modal-body"],[3,"ngSubmit","formGroup"],["formControlName","selectedUsers",3,"courseId","label"],[1,"row","mt-3"],[1,"col-12","text-end"],["type","submit","id","submitButton",1,"btn","btn-primary",3,"disabled"],["jhiTranslate","artemisApp.dialogs.createGroupChat.confirmButton"],[1,"alert","alert-danger"],["jhiTranslate","artemisApp.dialogs.createGroupChat.requiredError"],["jhiTranslate","artemisApp.dialogs.createGroupChat.maxError",3,"translateValues"]],template:function(o,i){o&1&&f(0,Ji,35,7),o&2&&C(i.isInitialized?0:-1)},dependencies:[y,z,be,H,xe,we,Se,Te,ot,P],encapsulation:2})}return n})();function Xi(n,p){if(n&1){let e=g();t(0,`
    `),s(1,"div",0),t(2,`
        `),s(3,"div",1),t(4,`
            `),s(5,"h4",2),t(6,`
                `),u(7,"span",3),t(8,`
            `),r(),t(9,`
            `),s(10,"button",4),v("click",function(){m(e);let i=c();return h(i.clear())}),r(),t(11,`
        `),r(),t(12,`
        `),s(13,"div",5),t(14,`
            `),s(15,"jhi-course-users-selector",6),_(16,"artemisTranslate"),v("ngModelChange",function(i){m(e);let l=c();return h(l.onSelectedUsersChange(i))}),r(),t(17,`
        `),r(),t(18,`
    `),r(),t(19,`
`)}if(n&2){let e=c();a(15),d("ngModel",e.selectedUsers)("multiSelect",!1)("showUserList",!1)("courseId",e.course.id)("label",T(16,5,"artemisApp.dialogs.createOneToOneChat.userSelectorLabel"))}}var li=(()=>{class n extends se{course;isInitialized=!1;selectedUsers=[];userToChatWith;initialize(){super.initialize(["course"])}clear(){this.dismiss()}onUserSelected(){this.close(this.userToChatWith)}onSelectedUsersChange(e){e&&e.length>0&&(this.selectedUsers=e,this.userToChatWith=this.selectedUsers[0],this.onUserSelected())}static \u0275fac=(()=>{let e;return function(i){return(e||(e=B(n)))(i||n)}})();static \u0275cmp=w({type:n,selectors:[["jhi-one-to-one-chat-create-dialog"]],inputs:{course:"course"},features:[G],decls:1,vars:1,consts:[["ngbAutofocus",""],[1,"modal-header"],[1,"modal-title"],["jhiTranslate","artemisApp.dialogs.createOneToOneChat.title"],["type","button",1,"btn-close","dismiss",3,"click"],[1,"modal-body"],[3,"ngModelChange","ngModel","multiSelect","showUserList","courseId","label"]],template:function(o,i){o&1&&f(0,Xi,20,7),o&2&&C(i.isInitialized?0:-1)},dependencies:[y,ot,z,H,Re,P],encapsulation:2})}return n})();function Zi(n,p){if(n&1&&(t(0,`
        `),s(1,"li"),t(2),s(3,"a",2),t(4),r(),t(5,`)
        `),r(),t(6,`
    `)),n&2){let e=p.$implicit;a(2),L(`
            `,e.name," ("),a(),Mt("href","mailto:",e.email,"",yt),a(),R(e.email)}}var di=(()=>{class n{alertService=x(Qe);conversationService=x(Je);course=A.required();responsibleContacts=[];ngOnInit(){this.course().id&&this.conversationService.getResponsibleUsersForCodeOfConduct(this.course().id).subscribe({next:e=>{e.body&&(this.responsibleContacts=e.body)},error:e=>qe(this.alertService,e)})}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=w({type:n,selectors:[["jhi-course-conversations-code-of-conduct"]],inputs:{course:[1,"course"]},decls:10,vars:3,consts:[["jhiTranslate","artemisApp.codeOfConduct.title"],[3,"innerHTML"],[3,"href"]],template:function(o,i){o&1&&(u(0,"h3",0),t(1,`
`),u(2,"div",1),_(3,"htmlForMarkdown"),t(4,`
`),s(5,"ul"),t(6,`
    `),N(7,Zi,7,4,null,null,Ot),r(),t(9,`
`)),o&2&&(a(2),d("innerHTML",T(3,1,i.course().courseInformationSharingMessagingCodeOfConduct||""),wt),a(5),U(i.responsibleContacts))},dependencies:[y,Ln],encapsulation:2})}return n})();var eo=(n,p)=>["/courses",n,"tutorial-groups",p],to=n=>({title:n}),pi=n=>({number:n});function no(n,p){if(n&1&&(t(0,`
                        `),u(1,"jhi-channel-icon",11),t(2,`
                    `)),n&2){let e=c(2);a(),d("isPublic",e.activeConversationAsChannel.isPublic)("isAnnouncementChannel",e.activeConversationAsChannel.isAnnouncementChannel)}}function io(n,p){if(n&1&&(t(0,`
                        `),u(1,"fa-icon",12),t(2,`
                    `)),n&2){let e=c(2);a(),d("icon",e.faPeopleGroup)}}function oo(n,p){if(n&1&&(t(0,`
                        `),u(1,"jhi-profile-picture",13),t(2,`
                    `)),n&2){let e=c(2);a(),d("imageSizeInRem","2")("fontSizeInRem","0.9")("imageId","sidebar-profile-picture")("defaultPictureId","sidebar-default-profile-picture")("isGray",!1)("authorId",e.otherUser.id)("authorName",e.otherUser.name)("imageUrl",e.otherUser.imageUrl)("isEditable",!1)}}function so(n,p){if(n&1&&(t(0,`
                    `),s(1,"div",14),t(2,`
                        `),u(3,"a",15),t(4,`
                    `),r(),t(5,`
                `)),n&2){let e=c(3);a(3),d("routerLink",fe(2,eo,e.course.id,e.activeConversationAsChannel.tutorialGroupId))("translateValues",E(5,to,e.activeConversationAsChannel.tutorialGroupTitle))}}function ro(n,p){if(n&1&&(t(0,`
                `),f(1,so,6,7)),n&2){let e=c(2);a(),C(e.activeConversationAsChannel.tutorialGroupId&&e.activeConversationAsChannel.tutorialGroupTitle?1:-1)}}function ao(n,p){n&1&&(t(0,`
                                        `),u(1,"jhi-emoji",18),t(2,`
                                    `))}function co(n,p){n&1&&(t(0,`
                                        `),u(1,"jhi-emoji",19),t(2,`
                                    `))}function lo(n,p){if(n&1){let e=g();t(0,`
                            `),s(1,"div",16),t(2,`
                                `),s(3,"button",17),v("click",function(){m(e);let i=c(2);return h(i.togglePinnedMessages())}),t(4,`
                                    `),f(5,ao,3,0)(6,co,3,0),s(7,"span"),t(8),_(9,"artemisTranslate"),_(10,"artemisTranslate"),_(11,"artemisTranslate"),_(12,"artemisTranslate"),_(13,"artemisTranslate"),r(),t(14,`
                                `),r(),t(15,`
                            `),r(),t(16,`
                        `)}if(n&2){let e=c(2);a(5),C(e.showPinnedMessages?5:6),a(3),L(`
                                        `,e.showPinnedMessages?T(9,2,"artemisApp.metis.showing")+(e.pinnedMessageCount()===1?T(10,4,"artemisApp.metis.singlePinned"):Z(11,6,"artemisApp.metis.multiplePinned",E(14,pi,e.pinnedMessageCount()))):e.pinnedMessageCount()===1?T(12,9,"artemisApp.metis.singlePinned"):Z(13,11,"artemisApp.metis.multiplePinned",E(16,pi,e.pinnedMessageCount())),`
                                    `)}}function po(n,p){if(n&1&&(t(0,`
                            `),s(1,"a",20),t(2,`
                            `),r(),t(3,`
                        `)),n&2){let e,o=c(2);a(),d("jhiTranslate",(e=o.channelSubTypeReferenceTranslationKey)!==null&&e!==void 0?e:"")("routerLink",o.channelSubTypeReferenceRouterLink)}}function mo(n,p){if(n&1){let e=g();t(0,`
                            `),s(1,"button",21),v("click",function(i){m(e);let l=c(2);return h(l.openAddUsersDialog(i))}),t(2,`
                                `),u(3,"fa-icon",3),t(4,`
                            `),r(),t(5,`
                        `)}if(n&2){let e=c(2);a(3),d("icon",e.faUserPlus)}}function ho(n,p){if(n&1&&(t(0,`
                `),s(1,"div",22),t(2,`
                    `),s(3,"span",23),t(4),r(),t(5,`
                `),r(),t(6,`
            `)),n&2){let e=c(3);a(4),R(e.activeConversationAsChannel.topic)}}function uo(n,p){if(n&1&&(t(0,`
            `),f(1,ho,7,1)),n&2){let e=c(2);a(),C(e.activeConversationAsChannel.topic&&e.activeConversationAsChannel.topic.length>0?1:-1)}}function Co(n,p){if(n&1){let e=g();t(0,`
    `),s(1,"div"),t(2,`
        `),s(3,"div",0),t(4,`
            `),s(5,"div",1),t(6,`
                `),s(7,"button",2),v("click",function(){m(e);let i=c();return h(i.openSidebar())}),t(8,`
                    `),u(9,"fa-icon",3),t(10,`
                `),r(),t(11,`
                `),s(12,"h4",4),v("click",function(i){m(e);let l=c();return h(l.openConversationDetailDialog(i,l.INFO))}),t(13,`
                    `),f(14,no,3,2)(15,io,3,1)(16,oo,3,9),t(17),r(),t(18,`
            `),r(),t(19,`
            `),f(20,ro,2,1),s(21,"div",5),t(22,`
                `),s(23,"div",6),t(24,`
                    `),s(25,"div",7),t(26,`
                        `),f(27,lo,17,18),s(28,"button",8),v("click",function(){m(e);let i=c();return h(i.toggleSearchBar())}),t(29,`
                            `),u(30,"fa-icon",3),t(31,`
                        `),r(),t(32,`
                    `),r(),t(33,`
                `),r(),t(34,`
                `),s(35,"div",6),t(36,`
                    `),s(37,"div",9),t(38,`
                        `),f(39,po,4,2),s(40,"button",10),v("click",function(i){m(e);let l=c();return h(l.openConversationDetailDialog(i,l.MEMBERS))}),t(41,`
                            `),u(42,"fa-icon",3),t(43),r(),t(44,`
                        `),f(45,mo,6,1),r(),t(46,`
                `),r(),t(47,`
            `),r(),t(48,`
        `),r(),t(49,`
        `),f(50,uo,2,1),r(),t(51,`
`)}if(n&2){let e=c();a(9),d("icon",e.faChevronLeft),a(5),C(e.activeConversationAsChannel?14:-1),a(),C(e.getAsGroupChat(e.activeConversation)?15:-1),a(),C(e.getAsOneToOneChat(e.activeConversation)&&e.otherUser?16:-1),a(),L(`
                    `,e.conversationService.getConversationName(e.activeConversation,!0),`
                `),a(3),C(e.activeConversationAsChannel?20:-1),a(7),C(e.pinnedMessageCount()>0?27:-1),a(3),d("icon",e.faSearch),a(9),C(e.activeConversationAsChannel!=null&&e.activeConversationAsChannel.subTypeReferenceId?39:-1),a(3),d("icon",e.faUserGroup),a(),L(" ",e.activeConversation.numberOfMembers||0,`
                        `),a(2),C(e.canAddUsers(e.activeConversation)?45:-1),a(5),C(e.activeConversationAsChannel?50:-1)}}var mi=(()=>{class n{modalService=x(Be);metisConversationService=x(oe);conversationService=x(Je);metisService=x(ee);pinnedMessageCount=A(0);togglePinnedMessage=k();ngUnsubscribe=new D;collapseSearch=new O;onUpdateSidebar=new O;INFO=at.INFO;MEMBERS=at.MEMBERS;course;activeConversation;activeConversationAsChannel;channelSubTypeReferenceTranslationKey;channelSubTypeReferenceRouterLink;otherUser;faUserPlus=fn;faUserGroup=tn;faSearch=Ee;faChevronLeft=Oe;faPeopleGroup=Yt;showPinnedMessages=!1;courseSidebarService=x(Ve);cdr=x(ie);getAsGroupChat=Mn;getAsOneToOneChat=Ct;canAddUsers=Xn;ngOnInit(){this.course=this.metisConversationService.course,this.subscribeToActiveConversation()}ngOnChanges(e){if(e.pinnedMessageCount){let o=e.pinnedMessageCount.currentValue;this.showPinnedMessages&&o===0&&(this.showPinnedMessages=!1,this.cdr.detectChanges())}}togglePinnedMessages(){this.togglePinnedMessage.emit(),this.showPinnedMessages=!this.showPinnedMessages,this.cdr.detectChanges()}getOtherUser(){let e=Ct(this.activeConversation);e&&(this.otherUser=e.members?.find(o=>!o.isRequestingUser))}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}openSidebar(){this.courseSidebarService.openSidebar()}subscribeToActiveConversation(){this.metisConversationService.activeConversation$.pipe(b(this.ngUnsubscribe)).subscribe(e=>{this.activeConversation=e,this.activeConversationAsChannel=V(e),this.channelSubTypeReferenceTranslationKey=kn(this.activeConversationAsChannel?.subType),this.channelSubTypeReferenceRouterLink=this.metisService.getLinkForChannelSubType(this.activeConversationAsChannel),this.getOtherUser()})}openAddUsersDialog(e){e.stopPropagation();let o=this.modalService.open(Jn,ae);o.componentInstance.course=this.course,o.componentInstance.activeConversation=this.activeConversation,o.componentInstance.initialize(),te(o.result).pipe(K(()=>Y),b(this.ngUnsubscribe)).subscribe(()=>{this.metisConversationService.forceRefresh().subscribe({complete:()=>{}})})}openConversationDetailDialog(e,o){e.stopPropagation();let i=this.modalService.open(ni,ae);i.componentInstance.course=this.course,i.componentInstance.activeConversation=this.activeConversation,i.componentInstance.selectedTab=o,this.getAsOneToOneChat(this.activeConversation)&&(i.componentInstance.selectedTab=at.INFO),i.componentInstance.initialize();let l=i.componentInstance.userNameClicked;if(l){let S=l.subscribe(M=>{i.dismiss(),this.metisConversationService.createOneToOneChatWithId(M).pipe(K(Q=>Y)).subscribe()});i.closed.subscribe(()=>S.unsubscribe())}te(i.result).pipe(K(()=>Y),b(this.ngUnsubscribe)).subscribe(()=>{this.metisConversationService.forceRefresh().subscribe({complete:()=>{}}),this.onUpdateSidebar.emit()})}toggleSearchBar(){this.collapseSearch.emit()}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=w({type:n,selectors:[["jhi-conversation-header"]],inputs:{pinnedMessageCount:[1,"pinnedMessageCount"]},outputs:{togglePinnedMessage:"togglePinnedMessage",collapseSearch:"collapseSearch",onUpdateSidebar:"onUpdateSidebar"},features:[me],decls:1,vars:1,consts:[[1,"d-flex","justify-content-between","flex-wrap"],[1,"d-flex","align-items-center","px-3"],[1,"btn","btn-sm","btn-outline-secondary","d-inline-block","d-sm-none","me-2",3,"click"],[3,"icon"],[1,"pointer","d-inline-block","rounded","py-2","info","mb-0",3,"click"],[1,"d-flex","flex-wrap","gap-2","py-2","px-3"],["role","toolbar",1,"btn-toolbar"],["role","group",1,"btn-group","me-1"],["type","button",1,"btn","btn-outline-secondary","btn-sm","search",3,"click"],["role","group",1,"btn-group"],["type","button",1,"btn","btn-sm","btn-outline-secondary","members",3,"click"],[3,"isPublic","isAnnouncementChannel"],["size","xs",3,"icon"],[1,"me-2",3,"imageSizeInRem","fontSizeInRem","imageId","defaultPictureId","isGray","authorId","authorName","imageUrl","isEditable"],[1,"p-2"],["role","button","jhiTranslate","artemisApp.entities.tutorialGroup.channelReverse",1,"btn","btn-info","btn-sm",3,"routerLink","translateValues"],[1,"pinned-messages-button"],["type","button",1,"btn","btn-sm","btn-outline-secondary",3,"click"],["emoji","x",1,"fs-x-small"],["emoji","pushpin"],[1,"btn","btn-sm","btn-outline-secondary","sub-type-reference",3,"jhiTranslate","routerLink"],["type","button",1,"btn","btn-sm","btn-outline-secondary","addUsers",3,"click"],[1,"text-body-secondary","d-flex","justify-content-between","px-2"],["id","conversation-topic",1,"d-inline-block","mw-100"]],template:function(o,i){o&1&&f(0,Co,52,13),o&2&&C(i.activeConversation&&i.course?0:-1)},dependencies:[F,it,Ze,y,Bt,$n,P],styles:[".pinned-messages-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:1.25rem;padding:.3rem .6rem;display:flex;align-items:center;gap:.3rem;margin-right:1rem}"]})}return n})();var vo=["searchInput"],fo=["container"],go=["postingThread"],_o=(n,p,e,o,i)=>({"posting-infinite-scroll-container":n,"content-height-dev":p,"is-fetching-posts":e,"hide-input-full":o,"hide-input":i}),xo=n=>({count:n}),hi=()=>[];function bo(n,p){if(n&1){let e=g();t(0,`
                        `),s(1,"button",14),v("click",function(){m(e);let i=c(3);return h(i.clearSearchInput())}),t(2,`
                            `),u(3,"span",15),t(4,`
                            `),u(5,"fa-icon",16),t(6,`
                        `),r(),t(7,`
                    `)}if(n&2){let e=c(3);a(3),d("hidden",!0),a(2),d("icon",e.faTimes)}}function So(n,p){n&1&&(t(0,`
                                `),u(1,"span",17),t(2,`
                            `))}function To(n,p){n&1&&(t(0,`
                                `),u(1,"span",18),t(2,`
                            `))}function wo(n,p){if(n&1&&(t(0,`
                                `),u(1,"span",19),t(2,`
                            `)),n&2){let e=c(3);a(),d("translateValues",E(1,xo,e.totalNumberOfPosts))}}function yo(n,p){if(n&1){let e=g();t(0,`
                `),s(1,"div",8),t(2,`
                    `),s(3,"span",9),t(4,`
                        `),u(5,"fa-icon",10),t(6,`
                        `),u(7,"span",11),t(8,`
                    `),r(),t(9,`
                    `),s(10,"input",12,1),_(12,"artemisTranslate"),v("input",function(i){m(e);let l=c(2);return h(l.onSearchQueryInput(i))}),r(),t(13,`
                    `),f(14,bo,8,2),s(15,"span",13),t(16,`
                        `),f(17,So,3,0)(18,To,3,0)(19,wo,3,3),t(20,`
                    `),r(),t(21,`
                `),r(),t(22,`
            `)}if(n&2){let e,o=c(2);a(),At("search-active",!!o.searchText),a(4),d("icon",o.faSearch),a(2),d("hidden",!0),a(3),J("placeholder",T(12,8,"artemisApp.conversationsLayout.conversationMessages.searchBarPlaceholder")),a(4),C(o.searchText?14:-1),a(),d("hidden",!o.searchText),a(2),C((e=o.totalNumberOfPosts)===0?17:e===1?18:19)}}function Po(n,p){if(n&1&&(t(0,`
                `),s(1,"div",20),t(2,`
                    `),u(3,"fa-icon",21),t(4,`
                `),r(),t(5,`
            `)),n&2){let e=c(2);a(3),d("icon",e.faCircleNotch)}}function Eo(n,p){if(n&1&&(t(0,`
                `),s(1,"div",20),t(2,`
                    `),u(3,"fa-icon",22),t(4,`
                `),r(),t(5,`
            `)),n&2){let e=c(2);a(3),d("icon",e.faEnvelope)}}function Ao(n,p){if(n&1){let e=g();t(0,`
                            `),s(1,"div",24),t(2,`
                                `),s(3,"jhi-posting-thread",25,2),v("openThread",function(i){m(e);let l=c(3);return h(l.setPostForThread(i))})("onNavigateToPost",function(i){m(e);let l=c(3);return h(l.onTriggerNavigateToPost(i))}),r(),t(5,`
                            `),r(),t(6,`
                        `)}if(n&2){let e,o,i=p.$implicit,l=c(3);a(3),d("lastReadDate",l._activeConversation==null?null:l._activeConversation.lastReadDate)("hasChannelModerationRights",!!((e=l.getAsChannel(l._activeConversation))!=null&&e.hasChannelModerationRights))("id","item-"+i.id)("post",i)("showAnswers",!1)("readOnlyMode",!!((o=l.getAsChannel(l._activeConversation))!=null&&o.isArchived))("isCommunicationPage",!0)("isConsecutive",i.isConsecutive||!1)("forwardedPosts",i.forwardedPosts||Ne(10,hi))("forwardedAnswerPosts",i.forwardedAnswerPosts||Ne(11,hi))}}function Oo(n,p){if(n&1&&(t(0,`
                    `),s(1,"div",23),t(2,`
                        `),N(3,Ao,7,12,null,null,je().postsTrackByFn,!0),r(),t(5,`
                `)),n&2){let e=p.$implicit;a(3),U(e.posts)}}function Mo(n,p){if(n&1){let e=g();t(0,`
                            `),s(1,"div",27),t(2,`
                                `),s(3,"button",28),v("click",function(){m(e);let i=ht(6);return h(i.open())}),r(),t(4,`
                                `),s(5,"jhi-post-create-edit-modal",29,3),v("onCreate",function(){m(e);let i=c(3);return h(i.handleNewMessageCreated())}),r(),t(7,`
                            `),r(),t(8,`
                        `)}if(n&2){let e=c(3);a(5),d("posting",e.newPost)("isCommunicationPage",!0)}}function Io(n,p){if(n&1){let e=g();t(0,`
                            `),s(1,"jhi-message-inline-input",30),v("onCreate",function(){m(e);let i=c(3);return h(i.handleNewMessageCreated())}),r(),t(2,`
                        `)}if(n&2){let e=c(3);a(),d("posting",e.newPost)}}function Do(n,p){if(n&1&&(t(0,`
                    `),s(1,"div",26),t(2,`
                        `),f(3,Mo,9,2)(4,Io,3,1),r(),t(5,`
                `)),n&2){let e,o=c(2);a(3),C((e=o.getAsChannel(o._activeConversation))!=null&&e.isAnnouncementChannel?3:4)}}function ko(n,p){if(n&1){let e=g();t(0,`
                        `),s(1,"div",27),t(2,`
                            `),s(3,"button",28),v("click",function(){m(e);let i=ht(6);return h(i.open())}),r(),t(4,`
                            `),s(5,"jhi-post-create-edit-modal",29,3),v("onCreate",function(){m(e);let i=c(3);return h(i.handleNewMessageCreated())}),r(),t(7,`
                        `),r(),t(8,`
                    `)}if(n&2){let e=c(3);a(5),d("posting",e.newPost)("isCommunicationPage",!0)}}function Vo(n,p){if(n&1){let e=g();t(0,`
                        `),s(1,"jhi-message-inline-input",30),v("onCreate",function(){m(e);let i=c(3);return h(i.handleNewMessageCreated())}),r(),t(2,`
                    `)}if(n&2){let e=c(3);a(),d("posting",e.newPost)}}function Fo(n,p){if(n&1&&(t(0,`
                `),s(1,"div",31),t(2,`
                    `),f(3,ko,9,2)(4,Vo,3,1),r(),t(5,`
            `)),n&2){let e,o=c(2);a(3),C((e=o.getAsChannel(o._activeConversation))!=null&&e.isAnnouncementChannel?3:4)}}function jo(n,p){if(n&1){let e=g();t(0,`
    `),s(1,"div",4),t(2,`
        `),s(3,"div",5),t(4,`
            `),t(5,`
            `),f(6,yo,23,10),r(),t(7,`
        `),s(8,"div",6),t(9,`
            `),t(10,`
            `),f(11,Po,6,1)(12,Eo,6,1),s(13,"div",7,0),v("scrolledUp",function(){m(e);let i=c();return h(i.fetchNextPage())}),t(15,`
                `),t(16,`
                `),t(17,`
                `),N(18,Oo,6,0,null,null,je().postsGroupTrackByFn,!0),f(20,Do,6,1),r(),t(21,`
            `),f(22,Fo,6,1),r(),t(23,`
    `),r(),t(24,`
`)}if(n&2){let e=c();a(6),C(e.searchbarCollapsed?-1:6),a(5),C(e.isFetchingPosts?11:-1),a(),C(!e.isFetchingPosts&&(e.posts.length===0||!e._activeConversation)?12:-1),a(),d("ngClass",Nt(7,_o,e.posts.length!==0,e.contentHeightDev,e.isFetchingPosts,e.isHiddenInputFull,e.isHiddenInputWithCallToAction))("scrollWindow",!1),a(5),U(e.groupedPosts),a(2),C(e._activeConversation&&e.newPost&&e.canCreateNewMessageInConversation(e._activeConversation)&&e.isMobile?20:-1),a(2),C(e._activeConversation&&e.newPost&&e.canCreateNewMessageInConversation(e._activeConversation)&&!e.isMobile?22:-1)}}var ui=(()=>{class n{metisService=x(ee);metisConversationService=x(oe);cdr=x(ie);ngUnsubscribe=new D;sessionStorageKey="conversationId.scrollPosition.";PageType=Ye;ButtonType=Xe;scrollDebounceTime=100;scrollSubject=new D;canStartSaving=!1;createdNewMessage=!1;openThread=new O;searchInput;messages;content;course;searchbarCollapsed=!1;contentHeightDev=!1;showOnlyPinned=A(!1);pinnedCount=k();pinnedPosts=[];focusPostId=A(void 0);openThreadOnFocus=A(!1);getAsChannel=V;canCreateNewMessageInConversation=st;previousScrollDistanceFromTop;messagesContainerHeight=700;currentPostContextFilter;search$=new D;searchText="";_activeConversation;onNavigateToPost=k();elementsAtScrollPosition;newPost;posts=[];allPosts=[];groupedPosts=[];totalNumberOfPosts=0;page=1;isFetchingPosts=!0;faTimes=Ae;faSearch=Ee;faEnvelope=ze;faCircleNotch=We;isMobile=!1;isHiddenInputWithCallToAction=!1;isHiddenInputFull=!1;focusOnPostId=void 0;isOpenThreadOnFocus=!1;layoutService=x(nt);constructor(){ge(()=>{this.focusOnPostId=this.focusPostId(),this.isOpenThreadOnFocus=this.openThreadOnFocus()})}ngOnChanges(e){e.showOnlyPinned&&!e.showOnlyPinned.firstChange&&this.setPosts()}applyPinnedMessageFilter(){this.showOnlyPinned()?this.posts=this.pinnedPosts:this.posts=[...this.allPosts],this.cdr.detectChanges()}ngOnInit(){this.subscribeToSearch(),this.subscribeToMetis(),this.subscribeToActiveConversation(),this.setupScrollDebounce(),this.isMobile=this.layoutService.isBreakpointActive(ke.extraSmall),this.layoutService.subscribeToLayoutChanges().pipe(b(this.ngUnsubscribe)).subscribe(()=>{this.isMobile=this.layoutService.isBreakpointActive(ke.extraSmall)}),this.metisService.getPinnedPosts().pipe(b(this.ngUnsubscribe)).subscribe(e=>{this.pinnedPosts=e,this.pinnedCount.emit(e.length),this.cdr.detectChanges()}),this.metisService.fetchAllPinnedPosts(this._activeConversation.id).subscribe(),this.cdr.detectChanges()}subscribeToActiveConversation(){this.metisConversationService.activeConversation$.pipe(b(this.ngUnsubscribe)).subscribe(e=>{this._activeConversation&&V(e)?.isArchived!==V(this._activeConversation)?.isArchived&&(this._activeConversation=e),!(e&&this._activeConversation?.id===e.id)&&(this._activeConversation=e,this.onActiveConversationChange())})}subscribeToSearch(){this.search$.pipe(re(300),pe(),Ue(e=>(e??"").trim().toLowerCase()),b(this.ngUnsubscribe)).subscribe({next:e=>{this.searchText=e,this.onSearch()}})}ngAfterViewInit(){this.messages.changes.pipe(b(this.ngUnsubscribe)).subscribe(this.handleScrollOnNewMessage),this.messages.changes.pipe(b(this.ngUnsubscribe)).subscribe(()=>{!this.createdNewMessage&&this.posts.length>0?this.scrollToStoredId():this.createdNewMessage=!1}),this.content.nativeElement.addEventListener("scroll",()=>{this.findElementsAtScrollPosition()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.scrollSubject.complete(),this.content?.nativeElement.removeEventListener("scroll",this.saveScrollPosition)}scrollToStoredId(){let e;this.focusOnPostId?e=this.focusOnPostId+"":e=sessionStorage.getItem(this.sessionStorageKey+this._activeConversation?.id)??"",requestAnimationFrame(()=>this.goToLastSelectedElement(parseInt(e,10),this.isOpenThreadOnFocus))}onActiveConversationChange(){this._activeConversation!==void 0&&this.getAsChannel(this._activeConversation)?.isAnnouncementChannel?(this.isHiddenInputFull=!st(this._activeConversation),this.isHiddenInputWithCallToAction=st(this._activeConversation)):(this.isHiddenInputFull=!1,this.isHiddenInputWithCallToAction=!1),this.course&&this._activeConversation&&(this.searchInput&&(this.searchInput.nativeElement.value="",this.searchText=""),this.canStartSaving=!1,this.onSearch(),this.createEmptyPost(),this.metisService.fetchAllPinnedPosts(this._activeConversation.id).subscribe({next:e=>{this.pinnedPosts=e,this.pinnedCount.emit(e.length)}}))}subscribeToMetis(){this.metisService.posts.pipe(b(this.ngUnsubscribe)).subscribe(e=>{this.allPosts=e,this.setPosts(),this.isFetchingPosts=!1}),this.metisService.totalNumberOfPosts.pipe(b(this.ngUnsubscribe)).subscribe(e=>{this.totalNumberOfPosts=e})}refreshMetisConversationPostContextFilter(){this.currentPostContextFilter={courseId:this.course?.id,conversationId:this._activeConversation?.id,searchText:this.searchText?this.searchText.trim():void 0,postSortCriterion:Ke.CREATION_DATE,sortingOrder:$.DESCENDING,pagingEnabled:!0,page:this.page-1,pageSize:50}}groupPosts(){if(!this.posts||this.posts.length===0){this.groupedPosts=[];return}let e=this.posts.sort((l,S)=>l.creationDate.valueOf()-S.creationDate.valueOf()),o=[],i={author:e[0].author,posts:[de(le({},e[0]),{isConsecutive:!1})]};for(let l=1;l<e.length;l++){let S=e[l],M=i.posts[i.posts.length-1],Q=Number.MAX_SAFE_INTEGER;S.creationDate&&M.creationDate&&(Q=S.creationDate.diff(M.creationDate,"minute")),S.author?.id===i.author?.id&&Q<5&&Q>=0?i.posts.push(de(le({},S),{isConsecutive:!0})):(o.push(i),i={author:S.author,posts:[de(le({},S),{isConsecutive:!1})]})}o.push(i),this.groupedPosts=o,this.cdr.detectChanges()}setPosts(){this.content&&(this.previousScrollDistanceFromTop=this.content.nativeElement.scrollHeight-this.content.nativeElement.scrollTop),this.applyPinnedMessageFilter(),this.posts=this.posts.slice().reverse();let e=this.posts.filter(o=>o.hasForwardedMessages&&o.id!==void 0).map(o=>o.id);e.length>0?this.metisService.getForwardedMessagesByIds(e,Ie.POST)?.subscribe(o=>{let i=o.body;if(i){let l=new Map(i.map(ce=>[ce.id,ce.messages])),S=[],M=[];l.forEach(ce=>{ce.forEach(q=>{q.sourceType?.toString()==="POST"&&q.sourceId?S.push(q.sourceId):q.sourceType?.toString()==="ANSWER"&&q.sourceId&&M.push(q.sourceId)})});let Q=[];S.length>0&&Q.push(this.metisService.getSourcePostsByIds(S)),M.length>0&&Q.push(this.metisService.getSourceAnswerPostsByIds(M)),Q.length>0?xt(Q).subscribe(ce=>{let q=[],ft=[];ce.forEach(j=>{Array.isArray(j)&&j.length>0&&(j[0].conversation!==void 0?q=j:j[0].resolvesPost!==void 0&&(ft=j))}),this.posts=this.posts.map(j=>{let gt=l.get(j.id)||[];return j.forwardedPosts=q.filter(mt=>gt.some(Fe=>Fe.sourceId===mt.id&&Fe.sourceType?.toString()==="POST")),j.forwardedAnswerPosts=ft.filter(mt=>gt.some(Fe=>Fe.sourceId===mt.id&&Fe.sourceType?.toString()==="ANSWER")),j}),this.groupPosts(),this.cdr.markForCheck()}):this.groupPosts()}else this.groupPosts()}):this.groupPosts()}fetchNextPage(){let e=this.posts.length<this.totalNumberOfPosts,o=0;e?(this.page+=1,this.commandMetisToFetchPosts(),o=50):this.canStartSaving||(this.canStartSaving=!0),this.content.nativeElement.scrollTop=this.content.nativeElement.scrollTop+o}commandMetisToFetchPosts(e=!1){this.refreshMetisConversationPostContextFilter(),this.currentPostContextFilter&&(this.isFetchingPosts=!0,this.metisService.getFilteredPosts(this.currentPostContextFilter,e,this._activeConversation))}onSearch(){this.page=1,this.commandMetisToFetchPosts(!0)}createEmptyPost(){this.newPost=this.createEmptyPostInMetis()}createEmptyPostInMetis(){if(!this._activeConversation)return;let e;if(En(this._activeConversation)){let o=new yn;o.isAnnouncementChannel=this._activeConversation.isAnnouncementChannel,e=o}else if(On(this._activeConversation))e=new An;else if(Dn(this._activeConversation))e=new In;else throw new Error("Conversation type not supported");return e.id=this._activeConversation.id,this.refreshMetisConversationPostContextFilter(),this.metisService.createEmptyPostForContext(e)}postsGroupTrackByFn=(e,o)=>"grp_"+o.posts.map(i=>i.id?.toString()).join("_");postsTrackByFn=(e,o)=>"post_"+o.id;setPostForThread(e){this.openThread.emit(e)}handleScrollOnNewMessage=()=>{(this.posts.length>0&&this.content.nativeElement.scrollTop===0&&this.page===1||this.previousScrollDistanceFromTop===this.messagesContainerHeight)&&this.scrollToBottomOfMessages()};scrollToBottomOfMessages(){requestAnimationFrame(()=>{this.content.nativeElement.scrollTop=this.content.nativeElement.scrollHeight})}onSearchQueryInput(e){let o=e.target.value?.trim().toLowerCase()??"";this.search$.next(o)}clearSearchInput(){this.searchInput&&(this.searchInput.nativeElement.value="",this.searchInput.nativeElement.dispatchEvent(new Event("input")))}setupScrollDebounce(){this.scrollSubject.pipe(re(this.scrollDebounceTime),b(this.ngUnsubscribe)).subscribe(e=>{this._activeConversation?.id&&sessionStorage.setItem(this.sessionStorageKey+this._activeConversation.id,e.toString())})}saveScrollPosition=e=>{this.scrollSubject.next(e)};handleNewMessageCreated(){this.createdNewMessage=!0,this.createEmptyPost(),this.scrollToBottomOfMessages()}goToLastSelectedElement(e,o){return _t(this,null,function*(){if(!e){this.scrollToBottomOfMessages(),this.canStartSaving=!0;return}let l=this.messages.toArray().find(S=>S.post.id===e);l?(this.content.nativeElement.scrollTop=Math.max(0,l.elementRef.nativeElement.offsetTop-10),this.canStartSaving=!0,o&&this.openThread.emit(l.post),this.focusOnPostId=void 0,this.isOpenThreadOnFocus=!1):this.fetchNextPage()})}findElementsAtScrollPosition(){let e=this.messages.toArray(),o=this.content.nativeElement.getBoundingClientRect(),i=[];for(let l of e){if(!l.elementRef?.nativeElement||!l.post?.id)continue;let S=l.elementRef.nativeElement.getBoundingClientRect();if(S.top>=o.top&&S.bottom<=o.bottom){i.push(l);break}}this.elementsAtScrollPosition=i,this.elementsAtScrollPosition&&this.elementsAtScrollPosition.length>0&&this.canStartSaving&&this.saveScrollPosition(this.elementsAtScrollPosition[0].post.id)}onTriggerNavigateToPost(e){this.onNavigateToPost.emit(e)}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=w({type:n,selectors:[["jhi-conversation-messages"]],viewQuery:function(o,i){if(o&1&&(he(vo,5),he(fo,5),he(go,5)),o&2){let l;ue(l=Ce())&&(i.searchInput=l.first),ue(l=Ce())&&(i.content=l.first),ue(l=Ce())&&(i.messages=l)}},inputs:{course:"course",searchbarCollapsed:"searchbarCollapsed",contentHeightDev:"contentHeightDev",showOnlyPinned:[1,"showOnlyPinned"],focusPostId:[1,"focusPostId"],openThreadOnFocus:[1,"openThreadOnFocus"]},outputs:{openThread:"openThread",pinnedCount:"pinnedCount",onNavigateToPost:"onNavigateToPost"},features:[me],decls:1,vars:1,consts:[["container",""],["searchInput",""],["postingThread",""],["createEditModal",""],[1,"justify-content-center","conversation-messages"],[1,"justify-content-center","px-3"],[1,"channel-content"],["id","scrollableDiv","infinite-scroll","",1,"conversation-messages-message-list","position-relative",3,"scrolledUp","ngClass","scrollWindow"],[1,"input-group","channel-search"],[1,"input-group-text"],["size","sm",3,"icon"],["id","inputLabel","jhiTranslate","artemisApp.conversationsLayout.conversationMessages.searchLabel",3,"hidden"],["id","searchInput","aria-labelledby","inputLabel","aria-describedby","searchResult","type","text",1,"form-control",3,"input","placeholder"],["id","searchResult",1,"input-group-text",3,"hidden"],["type","button","aria-labelledby","clearSearchLabel","id","clearSearchButton",1,"btn","btn-outline-secondary","border-end-0","border-start-0",3,"click"],["id","clearSearchLabel","jhiTranslate","artemisApp.conversationsLayout.conversationMessages.clearSearch",3,"hidden"],["size","xs",3,"icon"],["jhiTranslate","artemisApp.conversationsLayout.conversationMessages.searchResultsNone"],["jhiTranslate","artemisApp.conversationsLayout.conversationMessages.searchResultsSingle"],["jhiTranslate","artemisApp.conversationsLayout.conversationMessages.searchResultsMultiple",3,"translateValues"],[1,"envelope"],["size","3x","animation","spin",3,"icon"],["size","5x",3,"icon"],[1,"message-group"],[1,"post-item"],[3,"openThread","onNavigateToPost","lastReadDate","hasChannelModerationRights","id","post","showAnswers","readOnlyMode","isCommunicationPage","isConsecutive","forwardedPosts","forwardedAnswerPosts"],[1,"px-3"],[1,"pt-2"],["jhiTranslate","artemisApp.metis.newAnnouncement",1,"btn","btn-md","btn-primary",3,"click"],[3,"onCreate","posting","isCommunicationPage"],[1,"message-input",3,"onCreate","posting"],[1,"d-none","d-sm-block","px-3"]],template:function(o,i){o&1&&f(0,jo,25,13),o&2&&C(i.course?0:-1)},dependencies:[F,y,ct,W,tt,Qn,qn,P],styles:[`.conversation-messages{--message-input-height-prod: 142px;--message-input-height-dev: 158px;--search-height: 52px;--channel-header-height: 52px;--header-height: 68px;--announcement-button-height: 48px}.conversation-messages .search-active input{border:1px solid var(--primary)}.conversation-messages .search-active>span{color:var(--primary);border:1px solid var(--primary)}.conversation-messages .search-active>#clearSearchButton{color:var(--primary);border:1px solid var(--primary)}.conversation-messages .search-active fa-icon svg path{fill:var(--primary);stroke:var(--primary)}.conversation-messages .bold-line{height:1px;background:var(--metis-light-gray)}.conversation-messages .form-select{border:0;box-shadow:none!important}.conversation-messages .selection-prefix{padding-top:.375rem!important}.conversation-messages .posting-infinite-scroll-container{max-height:calc(100vh - var(--header-height) - var(--message-input-height-prod) - var(--search-height) - var(--channel-header-height));overflow-y:auto}.conversation-messages .posting-infinite-scroll-container.hide-input-full{max-height:calc(100vh - var(--header-height) - var(--search-height) - var(--channel-header-height))}.conversation-messages .posting-infinite-scroll-container.hide-input{max-height:calc(100vh - var(--announcement-button-height) - var(--header-height) - var(--search-height) - var(--channel-header-height))}.conversation-messages .posting-infinite-scroll-container.content-height-dev{max-height:calc(100vh - var(--header-height) - var(--message-input-height-dev) - var(--search-height) - var(--channel-header-height))}@media (max-width: 575.98px){.conversation-messages .posting-infinite-scroll-container.content-height-dev{max-height:calc(90vh - var(--message-input-height-dev) - var(--search-height) - var(--channel-header-height));max-height:calc(90dvh - var(--message-input-height-dev) - var(--search-height) - var(--channel-header-height))}}.conversation-messages .posting-infinite-scroll-container.hide-input-full.content-height-dev{max-height:calc(100vh - var(--header-height) - var(--search-height) - var(--channel-header-height))}.conversation-messages .posting-infinite-scroll-container.hide-input.content-height-dev{max-height:calc(100vh - var(--announcement-button-height) - var(--header-height) - var(--search-height) - var(--channel-header-height))}@media (max-width: 575.98px){.conversation-messages .posting-infinite-scroll-container{max-height:calc(90vh - var(--message-input-height-prod) - var(--search-height) - var(--channel-header-height));max-height:calc(90dvh - var(--message-input-height-prod) - var(--search-height) - var(--channel-header-height))}}.conversation-messages .envelope{text-align:center;opacity:.75;margin-top:auto;margin-bottom:auto}.conversation-messages .conversation-messages-message-list.is-fetching-posts{display:none}.message-group{display:flex;flex-direction:column;margin-bottom:10px}.grouped-posts{margin-left:30px;padding-left:10px}.grouped-posts,.grouped-post{margin-top:0;margin-bottom:0;padding:0}jhi-posting-thread{margin-bottom:5px}.channel-content{height:calc(100vh - 1rem - var(--header-height) - var(--message-input-height-dev) - var(--channel-header-height));display:flex;flex-direction:column;justify-content:space-between}@media (max-width: 767.98px){.channel-content{height:calc(100vh - var(--header-height) - var(--message-input-height-dev) - var(--channel-header-height))}}.channel-search{z-index:1040;margin:.5rem;position:fixed;right:1.5rem;max-width:275px;border-radius:.25rem;background-color:var(--bs-card-bg)}
`],encapsulation:2})}return n})();var vt=bi(Si());function No(n,p){if(n&1){let e=g();t(0,`
                `),s(1,"div",4),t(2,`
                    `),s(3,"button",5),v("click",function(){m(e);let i=c();return h(i.closeAlert())}),r(),t(4,`
                    `),u(5,"h4",6),t(6,`
                    `),u(7,"p",7),t(8,`
                    `),u(9,"hr"),t(10,`
                    `),u(11,"p",8),t(12,`
                `),r(),t(13,`
            `)}}function Uo(n,p){if(n&1){let e=g();t(0,`
                `),s(1,"button",9),_(2,"artemisTranslate"),v("click",function(){m(e);let i=c();return h(i.isModalOpen.emit())}),r(),t(3,`
                `),u(4,"button",10),_(5,"artemisTranslate"),t(6,`
            `)}if(n&2){let e=c();a(),d("buttonLabel",T(2,4,"artemisApp.metis.cancel")),a(3),d("buttonLoading",e.isLoading)("disabled",e.isLoading||!e.formGroup.valid)("buttonLabel",T(5,6,"artemisApp.conversationsLayout.saveMessage"))}}var Ci=(()=>{class n extends Bn{localStorageService=x($t);warningDismissed=!1;activeConversation=A();valueChange=new O;ngOnInit(){super.ngOnInit(),this.warningDismissed=!!this.localStorageService.retrieve("chatWarningDismissed")}ngOnChanges(e){if(this.formGroup&&e)for(let o in e)e.hasOwnProperty(o)&&o==="posting"&&e.posting.previousValue?.post?.id===e.posting.currentValue?.post?.id&&(this.posting.content=this.formGroup.get("content")?.value);super.ngOnChanges()}resetFormGroup(e=void 0){e!==void 0&&(this.posting.content=e),this.formGroup=this.formBuilder.group({content:[this.posting.content,[_e.required,_e.maxLength(this.maxContentLength),bn]]})}createPosting(){this.posting.content=this.formGroup.get("content")?.value,this.metisService.createAnswerPost(this.posting).subscribe({next:e=>{this.resetFormGroup(""),this.isLoading=!1,this.onCreate.emit(e)},error:()=>{this.isLoading=!1}})}updatePosting(){this.posting.content=this.formGroup.get("content")?.value,this.metisService.updateAnswerPost(this.posting).subscribe({next:()=>{this.isLoading=!1},error:()=>{this.isLoading=!1}})}closeAlert(){this.warningDismissed=!0,this.localStorageService.store("chatWarningDismissed",!0)}static \u0275fac=(()=>{let e;return function(i){return(e||(e=B(n)))(i||n)}})();static \u0275cmp=w({type:n,selectors:[["jhi-message-reply-inline-input"]],inputs:{activeConversation:[1,"activeConversation"]},outputs:{valueChange:"valueChange"},features:[G,me],decls:13,vars:10,consts:[[3,"ngSubmit","formGroup"],[1,"message-inline-input-form__wrapper","mb-3","me-1"],["formControlName","content",3,"keydown.enter","valueChange","activeConversation","editorHeight","maxContentLength","isInputLengthDisplayed","isButtonLoading","isFormGroupValid","editType"],[1,"col","mt-1","text-end"],["role","alert",1,"alert","alert-warning","alert-dismissible","text-start","fade","show"],["type","button","aria-label","Close",1,"btn-close",3,"click"],["jhiTranslate","artemisApp.messageWarning.headerText",1,"alert-heading"],["jhiTranslate","artemisApp.messageWarning.mainParagraph"],["jhiTranslate","artemisApp.messageWarning.lastParagraph",1,"mb-0"],["jhi-posting-button","",1,"btn","btn-sm","btn-outline-secondary",3,"click","buttonLabel"],["jhi-posting-button","","id","save","type","submit",1,"btn","btn-sm","btn-outline-primary",3,"buttonLoading","disabled","buttonLabel"]],template:function(o,i){o&1&&(s(0,"form",0),v("ngSubmit",function(){return i.confirm()}),t(1,`
    `),s(2,"div",1),t(3,`
        `),s(4,"jhi-posting-markdown-editor",2),v("keydown.enter",function(){return i.confirm()})("valueChange",function(){return i.valueChange.emit()}),r(),t(5,`
        `),s(6,"div",3),t(7,`
            `),f(8,No,14,0)(9,Uo,7,8),r(),t(10,`
    `),r(),t(11,`
`),r(),t(12,`
`)),o&2&&(d("formGroup",i.formGroup),a(4),d("activeConversation",i.activeConversation())("editorHeight",i.editorHeight)("maxContentLength",i.maxContentLength)("isInputLengthDisplayed",!1)("isButtonLoading",i.isLoading)("isFormGroupValid",i.formGroup.valid)("editType",i.editType),a(4),C(i.warningDismissed?-1:8),a(),C(i.editType===i.EditType.UPDATE?9:-1))},dependencies:[z,be,H,xe,we,Se,Te,zn,y,Rn,P],styles:[`.message-inline-input-form__wrapper{padding-top:5px}.message-inline-input-form__wrapper .markdown-editor-wrapper{background-color:transparent!important}.message-inline-input-form__wrapper .markdown-editor-wrapper .markdown-editor{border:1px solid var(--border-color);background-color:transparent!important}.message-inline-input-form__wrapper .ng-invalid{border:none}
`],encapsulation:2})}return n})();var Ro=["expandTooltip"],Lo=["threadContainer"],Bo=["scrollBody"],Go=n=>({expanded:n});function Wo(n,p){if(n&1&&(t(0,`
            `),s(1,"div",14),t(2,`
                `),u(3,"fa-icon",15),t(4,`
            `),r(),t(5,`
        `)),n&2){let e=c();a(3),d("icon",e.faGripLinesVertical)}}function Ho(n,p){if(n&1){let e=g();t(0,`
                                `),s(1,"jhi-message-reply-inline-input",20),v("onCreate",function(){m(e);let i=c(2);return h(i.createdAnswerPost=i.createEmptyAnswerPost())})("valueChange",function(){m(e);let i=c(2);return h(i.scrollEditorIntoView())}),r(),t(2,`
                            `)}if(n&2){let e=c(2);a(),d("activeConversation",e.conversation)("posting",e.createdAnswerPost)}}function zo(n,p){if(n&1&&(t(0,`
                    `),s(1,"div",16),t(2,`
                        `),s(3,"div",17),t(4,`
                            `),u(5,"jhi-post",18),t(6,`
                        `),r(),t(7,`
                        `),s(8,"div",19),t(9,`
                            `),f(10,Ho,3,2),r(),t(11,`
                    `),r(),t(12,`
                `)),n&2){let e=c();a(5),d("readOnlyMode",e.readOnlyMode)("posting",e.post)("showAnswers",!0)("isCommunicationPage",!0)("isThreadSidebar",!0)("lastReadDate",e.conversation==null?null:e.conversation.lastReadDate)("hasChannelModerationRights",e.hasChannelModerationRights),a(5),C(e.readOnlyMode?-1:10)}}var vi=(()=>{class n{scrollBody;expandTooltip=ne("expandTooltip");threadContainer=ne("threadContainer");readOnlyMode=!1;set activeConversation(e){this.conversation=e,this.hasChannelModerationRights=V(this.conversation)?.hasChannelModerationRights??!1}set activePost(e){this.post=e,this.createdAnswerPost=this.createEmptyAnswerPost()}closePostThread=new O;post;createdAnswerPost;conversation;hasChannelModerationRights=!1;faXmark=un;faChevronLeft=Oe;faGripLinesVertical=en;faArrowLeft=sn;faExpand=hn;faCompress=Kt;isExpanded=!1;createEmptyAnswerPost(){let e=new Sn;return e.content="",e.post=this.post,e}toggleExpand(){this.threadContainer()&&(this.threadContainer().nativeElement.style.width=""),this.isExpanded=!this.isExpanded,this.expandTooltip()?.close()}ngAfterViewInit(){(0,vt.default)(".expanded-thread").resizable({edges:{left:".draggable-left",right:!1,bottom:!1,top:!1},modifiers:[vt.default.modifiers.restrictSize({min:{width:window.innerWidth*.3,height:0},max:{width:window.innerWidth,height:0}})],inertia:!0}).on("resizestart",function(e){e.target.classList.add("card-resizable")}).on("resizeend",function(e){e.target.classList.remove("card-resizable")}).on("resizemove",function(e){let o=e.target;o.style.width=e.rect.width+"px"})}scrollEditorIntoView(){this.scrollBody?.nativeElement?.scrollTo({top:this.scrollBody.nativeElement.scrollHeight,behavior:"instant"})}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=w({type:n,selectors:[["jhi-conversation-thread-sidebar"]],viewQuery:function(o,i){if(o&1&&(X(i.expandTooltip,Ro,5),X(i.threadContainer,Lo,5),he(Bo,5)),o&2){ve(2);let l;ue(l=Ce())&&(i.scrollBody=l.first)}},inputs:{readOnlyMode:"readOnlyMode",activeConversation:"activeConversation",activePost:"activePost"},outputs:{closePostThread:"closePostThread"},decls:41,vars:15,consts:[["threadContainer",""],["expandTooltip","ngbTooltip"],["scrollBody",""],[1,"h-100"],[1,"postings-container","expanded-thread",3,"ngClass"],[1,"card"],[1,"card-header","cursor-default","d-flex"],[1,"row","flex-grow-1"],[1,"col"],["jhiTranslate","artemisApp.conversationsLayout.threadSideBar.label",1,"mb-0","fw-medium"],[1,"col-auto","d-flex","align-items-center","flex-row","gap-2"],[1,"pointer","me-2",3,"click","icon","ngbTooltip"],[1,"pointer",3,"click","ngbTooltip","icon"],[1,"pt-0","scrollbar","wrapper-scroll-y","mx-1","thread-answer-post"],[1,"draggable-left"],[3,"icon"],[1,"my-2"],[1,"card-body","px-0"],[3,"readOnlyMode","posting","showAnswers","isCommunicationPage","isThreadSidebar","lastReadDate","hasChannelModerationRights"],[1,"message-input","mx-3","pt-2"],[3,"onCreate","valueChange","activeConversation","posting"]],template:function(o,i){if(o&1){let l=g();t(0,`
`),s(1,"div",3),t(2,`
    `),s(3,"div",4,0),t(5,`
        `),f(6,Wo,6,1),s(7,"div",5),t(8,`
            `),t(9,`
            `),s(10,"div",6),t(11,`
                `),s(12,"div",7),t(13,`
                    `),s(14,"div",8),t(15,`
                        `),u(16,"h5",9),t(17,`
                    `),r(),t(18,`
                    `),s(19,"div",10),t(20,`
                        `),s(21,"fa-icon",11,1),_(23,"artemisTranslate"),_(24,"artemisTranslate"),v("click",function(){return m(l),h(i.toggleExpand())}),r(),t(25,`
                        `),s(26,"fa-icon",12),_(27,"artemisTranslate"),v("click",function(){return m(l),h(i.closePostThread.emit())}),r(),t(28,`
                    `),r(),t(29,`
                `),r(),t(30,`
            `),r(),t(31,`
            `),t(32,`
            `),s(33,"div",13,2),t(35,`
                `),f(36,zo,13,8),r(),t(37,`
        `),r(),t(38,`
    `),r(),t(39,`
`),r(),t(40,`
`)}o&2&&(a(3),d("ngClass",E(13,Go,i.isExpanded)),a(3),C(i.isExpanded?-1:6),a(15),d("icon",i.isExpanded?i.faCompress:i.faExpand)("ngbTooltip",i.isExpanded?T(23,7,"artemisApp.conversationsLayout.threadSideBar.collapse"):T(24,9,"artemisApp.conversationsLayout.threadSideBar.expand")),a(5),d("ngbTooltip",T(27,11,"artemisApp.conversationsLayout.threadSideBar.close"))("icon",i.faXmark),a(10),C(i.post!==void 0?36:-1))},dependencies:[F,y,ye,Yn,Ci,P,W],styles:[".postings-container[_ngcontent-%COMP%]{display:flex;height:100%;margin-left:auto;min-width:30%;max-width:100%}.postings-container[_ngcontent-%COMP%]   .back-instruction[_ngcontent-%COMP%]{font-size:12px}.expanded-thread[_ngcontent-%COMP%]{display:flex;flex-grow:1;min-width:30%;max-width:100%}.expanded-thread[_ngcontent-%COMP%]   .scrollbar[_ngcontent-%COMP%]{position:relative;max-height:1000px;overflow-x:hidden}.expanded-thread[_ngcontent-%COMP%]   .wrapper-scroll-y[_ngcontent-%COMP%]{display:block}.expanded-thread[_ngcontent-%COMP%]   .draggable-left[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-width:1.5%;max-width:1.5%}.expanded-thread[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{width:inherit}.expanded-thread[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{justify-content:space-between;align-items:center;cursor:pointer;display:flex}.expanded-thread[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{display:flex}.expanded-thread[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%] > .col-auto[_ngcontent-%COMP%]:last-child{display:flex;flex-direction:column;justify-content:center}.expanded-thread.expanded[_ngcontent-%COMP%]{width:100%;position:absolute;top:0;right:0;bottom:0;z-index:1050}.collapsed-thread[_ngcontent-%COMP%]{display:flex;justify-content:space-between;flex-flow:column;margin-left:auto;cursor:pointer}.collapsed-thread[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{writing-mode:vertical-rl;margin:auto}.collapsed-thread[_ngcontent-%COMP%]   .expand-thread-icon[_ngcontent-%COMP%]{padding-top:.5rem;padding-bottom:.5rem;place-self:center}@media screen and (max-width: 992px){.expanded-thread[_ngcontent-%COMP%]{width:94vw}.expanded-thread[_ngcontent-%COMP%]   .draggable-left[_ngcontent-%COMP%]{display:none}}@media (max-width: 575.98px){.expanded-thread[_ngcontent-%COMP%]{width:100%}.expanded-thread[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{min-width:100%}}"]})}return n})();var $o=n=>({"is-answer-post":n});function Qo(n,p){n&1&&(t(0,`
                        > `),u(1,"span",5),t(2,`
                    `))}function qo(n,p){if(n&1&&(t(0,`
            `),s(1,"div",1),t(2,`
                `),s(3,"span",2),t(4,`
                    `),u(5,"fa-icon",3),t(6,`
                `),r(),t(7,`
                `),s(8,"span",4),t(9),f(10,Qo,3,0),r(),t(11,`
            `),r(),t(12,`
        `)),n&2){let e=c(2);a(5),d("icon",e.post().conversation.type===e.ConversationType.CHANNEL?e.faHashtag:e.faLock),a(4),L(`
                    `,e.post().conversation.title,`
                    `),a(),C(e.isAnswerPost?10:-1)}}function Yo(n,p){if(n&1&&(t(0,`
                    `),s(1,"div",12),t(2,`
                        `),u(3,"fa-icon",3),t(4,`
                    `),r(),t(5,`
                `)),n&2){let e=c(3);a(3),d("icon",e.faEllipsis)}}function Ko(n,p){if(n&1&&(t(0,`
                                `),s(1,"span",13),_(2,"artemisDate"),t(3),_(4,"artemisDate"),_(5,"artemisDate"),r(),t(6,`
                            `)),n&2){let e=c(3);a(),J("ngbTooltip",Z(2,3,e.post().creationDate,"time")),d("disableTooltip",e.postingIsOfToday),a(2),L(`
                                    `,e.postingIsOfToday?Z(4,6,e.post().creationDate,"time"):Z(5,9,e.post().creationDate,"short-date"),`
                                `)}}function Jo(n,p){if(n&1&&(t(0,`
            `),s(1,"div",6),t(2,`
                `),f(3,Yo,6,1),s(4,"div",7),t(5,`
                    `),u(6,"jhi-profile-picture",8),t(7,`
                    `),s(8,"div",9),t(9,`
                        `),s(10,"div"),t(11,`
                            `),s(12,"span",10),t(13),r(),t(14,`
                            `),f(15,Ko,7,12),r(),t(16,`
                        `),s(17,"div"),t(18,`
                            `),u(19,"jhi-posting-content",11),t(20,`
                        `),r(),t(21,`
                    `),r(),t(22,`
                `),r(),t(23,`
            `),r(),t(24,`
        `)),n&2){let e=c(2);a(3),C(e.isAnswerPost?3:-1),a(),d("ngClass",E(14,$o,e.isAnswerPost)),a(2),d("authorId",e.post().author.id)("authorName",e.post().author.name)("imageUrl",e.post().author.imageUrl),a(7),R(e.post().author.name),a(2),C(e.post().creationDate!==void 0?15:-1),a(4),d("previewMode",!1)("content",e.post().content)("author",e.post().author)("isEdited",!!e.post().updatedDate)("posting",e.post())("isReply",!1)("isSubscribeToMetis",!1)}}function Xo(n,p){if(n&1){let e=g();t(0,`
            `),s(1,"div",14),t(2,`
                `),s(3,"div",15),t(4,`
                    `),s(5,"button",16),_(6,"artemisTranslate"),v("click",function(){m(e);let i=c(2);return h(i.onStatusChangeClick(i.SavedPostStatus.PROGRESS))}),t(7,`
                        `),u(8,"fa-icon",3),t(9,`
                    `),r(),t(10,`
                    `),s(11,"button",16),_(12,"artemisTranslate"),v("click",function(){m(e);let i=c(2);return h(i.onStatusChangeClick(i.SavedPostStatus.COMPLETED))}),t(13,`
                        `),u(14,"fa-icon",3),t(15,`
                    `),r(),t(16,`
                    `),s(17,"button",16),_(18,"artemisTranslate"),v("click",function(){m(e);let i=c(2);return h(i.onStatusChangeClick(i.SavedPostStatus.ARCHIVED))}),t(19,`
                        `),u(20,"fa-icon",3),t(21,`
                    `),r(),t(22,`
                `),r(),t(23,`
            `),r(),t(24,`
        `)}if(n&2){let e=c(2);a(5),J("ngbTooltip",T(6,9,"artemisApp.metis.post.bookmarkPostProgress")),d("disabled",e.post().savedPostStatus===e.SavedPostStatus.PROGRESS),a(3),d("icon",e.faBookmark),a(3),J("ngbTooltip",T(12,11,"artemisApp.metis.post.bookmarkPostComplete")),d("disabled",e.post().savedPostStatus===e.SavedPostStatus.COMPLETED),a(3),d("icon",e.faCheckSquare),a(3),J("ngbTooltip",T(18,13,"artemisApp.metis.post.bookmarkPostArchived")),d("disabled",e.post().savedPostStatus===e.SavedPostStatus.ARCHIVED),a(3),d("icon",e.faBoxArchive)}}function Zo(n,p){if(n&1&&(t(0,`
        `),f(1,qo,13,3)(2,Jo,25,16)(3,Xo,25,15)),n&2){let e=c();a(),C(e.isShowSummary?1:-1),a(),C(e.isShowContent?2:-1),a(),C(e.isShowSavedPostOptions()?3:-1)}}var fi=(()=>{class n{post=A();isShowSavedPostOptions=A(!1);onChangeSavedPostStatus=k();onNavigateToPost=k();ConversationType=Tn;SavedPostStatus=xn;isAnswerPost=!1;postingIsOfToday=!1;isShowPosting=!1;isShowSummary=!1;isShowContent=!1;faLock=Zt;faHashtag=vn;faCheckSquare=Jt;faBookmark=Pe;faBoxArchive=Ge;faEllipsis=dn;constructor(){ge(()=>{this.isShowPosting=this.post()!==void 0,this.isShowSummary=this.isShowPosting&&this.post().conversation!==void 0&&this.post().conversation.type!==void 0&&this.post().conversation.title!==void 0,this.isShowContent=this.isShowPosting&&this.post().author!==void 0&&this.post().content!==void 0&&this.post().postingType!==void 0,this.isAnswerPost=this.post()?.postingType===Ie.ANSWER.valueOf(),this.post()&&(this.postingIsOfToday=Ut().isSame(this.post().creationDate,"day"))})}onStatusChangeClick(e){this.onChangeSavedPostStatus.emit(e)}onTriggerNavigateToPost(){this.post()!==void 0&&this.onNavigateToPost.emit(this.post())}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=w({type:n,selectors:[["jhi-posting-summary"]],inputs:{post:[1,"post"],isShowSavedPostOptions:[1,"isShowSavedPostOptions"]},outputs:{onChangeSavedPostStatus:"onChangeSavedPostStatus",onNavigateToPost:"onNavigateToPost"},decls:4,vars:1,consts:[[1,"posting-summary","rounded","p-2",3,"click"],[1,"posting-summary-conversation","fs-x-small","text-secondary","d-flex","align-items-center","mb-1"],[1,"d-inline-block"],[3,"icon"],[1,"d-inline-block","ms-1"],["jhiTranslate","artemisApp.metis.post.thread"],[1,"posting-summary-wrap"],[1,"posting-summary-content","d-inline-flex","align-items-start","gap-2",3,"ngClass"],["imageSizeInRem","2.25","fontSizeInRem","0.9","imageId","post-profile-picture","defaultPictureId","post-default-profile-picture",3,"authorId","authorName","imageUrl"],[1,"posting-summary-author-content","fs-small","flex-column","align-items-start"],[1,"fw-semibold","d-inline-block","me-1"],[3,"previewMode","content","author","isEdited","posting","isReply","isSubscribeToMetis"],[1,"text-secondary"],[1,"fs-small","text-secondary",3,"disableTooltip","ngbTooltip"],[1,"posting-summary-saved-post-options"],["role","group","aria-label","Saved options",1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled","ngbTooltip"]],template:function(o,i){o&1&&(s(0,"div",0),v("click",function(){return i.onTriggerNavigateToPost()}),t(1,`
    `),f(2,Zo,4,3),r(),t(3,`
`)),o&2&&(a(2),C(i.post()!==void 0?2:-1))},dependencies:[F,y,W,Ze,ye,Hn,Nn,P],styles:[".posting-summary[_ngcontent-%COMP%]{background-color:transparent;cursor:pointer;position:relative;transition:background-color .2s ease-in-out}.posting-summary[_ngcontent-%COMP%]:hover{background-color:#0d6efd1a}.posting-summary[_ngcontent-%COMP%]:hover   .posting-summary-saved-post-options[_ngcontent-%COMP%]{opacity:1}.posting-summary-author-content[_ngcontent-%COMP%]{margin-top:-.15em}.posting-summary-saved-post-options[_ngcontent-%COMP%]{position:absolute;top:.3rem;right:.3rem;opacity:0;transition:opacity .2s ease-in-out}.posting-summary-content.is-answer-post[_ngcontent-%COMP%]{padding-left:.7rem;margin-left:.35rem;border-left:1px solid #6c757d}@media (max-width: 575.98px){.posting-summary-saved-post-options[_ngcontent-%COMP%]{opacity:1}}"]})}return n})();function es(n,p){if(n&1&&(t(0,`
        `),s(1,"div",6),t(2,`
            `),u(3,"fa-icon",7),t(4,`
            `),u(5,"span",8),t(6,`
        `),r(),t(7,`
    `)),n&2){let e=c();a(3),d("icon",e.faInfoCircle)}}function ts(n,p){if(n&1){let e=g();t(0,`
                    `),s(1,"jhi-posting-summary",9),v("onChangeSavedPostStatus",function(i){m(e);let l=c().$implicit,S=c(2);return h(S.changeSavedPostStatus(l,i))})("onNavigateToPost",function(){m(e);let i=c().$implicit,l=c(2);return h(l.onTriggerNavigateToPost(i))}),r(),t(2,`
                `)}if(n&2){let e=c().$implicit;a(),d("post",e)("isShowSavedPostOptions",!0)}}function ns(n,p){if(n&1&&(t(0,`
                `),f(1,ts,3,2)),n&2){let e=p.$implicit,o=c(2);a(),C(o.hiddenPosts.includes(e.id)?-1:1)}}function is(n,p){if(n&1&&(t(0,`
            `),N(1,ns,2,1,null,null,je().trackPostFunction,!0)),n&2){let e=c();a(),U(e.posts)}}function os(n,p){if(n&1&&(t(0,`
            `),s(1,"div",10),t(2,`
                `),u(3,"fa-icon",11),t(4,`
                `),u(5,"span",12),t(6,`
            `),r(),t(7,`
        `)),n&2){let e=c();a(3),d("icon",e.faBookmark)}}var gi=(()=>{class n{savedPostStatus=A();courseId=A();onNavigateToPost=k();savedPostService=x(Fn);posts;hiddenPosts=[];savedPostStatusMap=Me.PROGRESS;isShowDeleteNotice=!1;faBookmark=Pe;faInfoCircle=an;constructor(){ge(()=>{this.savedPostStatusMap=De.statusToMap(this.savedPostStatus()),this.isShowDeleteNotice=this.savedPostStatusMap!==Me.PROGRESS,this.savedPostService.fetchSavedPosts(this.courseId(),this.savedPostStatus()).subscribe({next:e=>{e.body?this.posts=e.body.map(this.savedPostService.convertPostingToCorrespondingType):this.posts=[]},error:()=>{this.posts=[]},complete:()=>{this.hiddenPosts=[]}})})}trackPostFunction=(e,o)=>e+""+o.id;changeSavedPostStatus(e,o){this.savedPostService.changeSavedPostStatus(e,o).subscribe({next:()=>{}}),this.hiddenPosts.push(e.id)}onTriggerNavigateToPost(e){this.onNavigateToPost.emit(e)}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=w({type:n,selectors:[["jhi-saved-posts"]],inputs:{savedPostStatus:[1,"savedPostStatus"],courseId:[1,"courseId"]},outputs:{onNavigateToPost:"onNavigateToPost"},decls:21,vars:3,consts:[[1,"saved-posts","pt-2","px-2","d-flex","flex-column","h-100"],[1,"mb-0","p-1","pb-0"],["jhiTranslate","artemisApp.metis.overview.savedPosts"],[3,"jhiTranslate"],[1,"my-2"],[1,"saved-posts-post-container","flex-grow"],[1,"saved-posts-delete-notice","m-2","fs-x-small","text-secondary"],[1,"me-1",3,"icon"],["jhiTranslate","artemisApp.metis.overview.deleteNoticeSavedPosts"],[3,"onChangeSavedPostStatus","onNavigateToPost","post","isShowSavedPostOptions"],[1,"saved-posts-empty-notice","text-secondary"],["size","3x",1,"mb-3",3,"icon"],["jhiTranslate","artemisApp.metis.overview.emptySavedPosts"]],template:function(o,i){o&1&&(s(0,"div",0),t(1,`
    `),s(2,"div"),t(3,`
        `),s(4,"h4",1),t(5,`
            `),u(6,"span",2),t(7," ("),u(8,"span",3),t(9,`)
        `),r(),t(10,`
    `),r(),t(11,`
    `),u(12,"hr",4),t(13,`
    `),f(14,es,8,1),s(15,"div",5),t(16,`
        `),f(17,is,3,0)(18,os,8,1),r(),t(19,`
`),r(),t(20,`
`)),o&2&&(a(8),d("jhiTranslate","artemisApp.metis.overview."+i.savedPostStatusMap.toString()),a(6),C(i.isShowDeleteNotice?14:-1),a(3),C(i.posts&&i.posts.length>0?17:18))},dependencies:[y,F,fi],styles:[".saved-posts-post-container[_ngcontent-%COMP%]{overflow-y:auto;overflow-x:hidden;height:100%;max-height:100%}.saved-posts-empty-notice[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}"]})}return n})();var ss=["courseWideSearchInput"],rs=(n,p)=>({"sidebar-collapsed":n,"is-not-in-active-conversation":p}),_i=(n,p)=>({"content-height-dev":n,"is-answer-thread-open":p});function as(n,p){if(n&1){let e=g();t(0,`
        `),s(1,"div",6),t(2,`
            `),u(3,"jhi-course-conversations-code-of-conduct",7),t(4,`
            `),s(5,"button",8),v("click",function(){m(e);let i=c();return h(i.acceptCodeOfConduct())}),r(),t(6,`
        `),r(),t(7,`
    `)}if(n&2){let e=c();a(3),d("course",e.course)}}function cs(n,p){if(n&1&&(t(0,`
                `),s(1,"div",14),t(2,`
                    `),u(3,"jhi-course-conversations-code-of-conduct",7),t(4,`
                `),r(),t(5,`
            `)),n&2){let e=c(2);a(3),d("course",e.course)}}function ls(n,p){if(n&1){let e=g();t(0,`
                    `),s(1,"jhi-conversation-header",15),v("collapseSearch",function(){m(e);let i=c(2);return h(i.toggleChannelSearch())})("onUpdateSidebar",function(){m(e);let i=c(2);return h(i.prepareSidebarData())})("togglePinnedMessage",function(){m(e);let i=c(2);return h(i.togglePinnedView())}),r(),t(2,`
                    `),s(3,"jhi-conversation-messages",16),v("openThread",function(i){m(e);let l=c(2);return h(l.openThread(i))})("onNavigateToPost",function(i){m(e);let l=c(2);return h(l.onTriggerNavigateToPost(i))})("pinnedCount",function(i){m(e);let l=c(2);return h(l.onPinnedCountChanged(i))}),r(),t(4,`
                `)}if(n&2){let e=c(2);a(),d("pinnedMessageCount",e.pinnedCount),a(2),d("contentHeightDev",!e.isProduction||e.isTestServer)("course",e.course)("searchbarCollapsed",e.channelSearchCollapsed)("focusPostId",e.focusPostId)("openThreadOnFocus",e.openThreadOnFocus)("showOnlyPinned",e.showOnlyPinned)}}function ds(n,p){if(n&1){let e=g();t(0,`
                        `),s(1,"jhi-course-wide-search",17),v("openThread",function(i){m(e);let l=c(3);return h(l.postInThread=i)}),r(),t(2,`
                    `)}if(n&2){let e=c(3);a(),d("courseWideSearchConfig",e.courseWideSearchConfig)}}function ps(n,p){if(n&1){let e=g();t(0,`
                        `),s(1,"jhi-saved-posts",18),v("onNavigateToPost",function(i){m(e);let l=c(3);return h(l.onNavigateToPost(i))}),r(),t(2,`
                    `)}if(n&2){let e=c(3);a(),d("savedPostStatus",e.selectedSavedPostStatus)("courseId",e.course.id)}}function ms(n,p){if(n&1&&(t(0,`
                    `),f(1,ds,3,1)(2,ps,3,2)),n&2){let e=c(2);a(),C(e.selectedSavedPostStatus===null?1:2)}}function hs(n,p){if(n&1){let e=g();t(0,`
                    `),s(1,"jhi-conversation-thread-sidebar",19),v("closePostThread",function(){m(e);let i=c(2);return h(i.postInThread=void 0)}),r(),t(2,`
                `)}if(n&2){let e,o,i=c(2);a(),d("activeConversation",(e=i.activeConversation)!==null&&e!==void 0?e:i.postInThread.conversation)("readOnlyMode",!!((o=i.getAsChannel(i.postInThread.conversation))!=null&&o.isArchived))("activePost",i.postInThread)}}function us(n,p){if(n&1){let e=g();t(0,`
        `),s(1,"div",9),t(2,`
            `),s(3,"div",10),t(4,`
                `),s(5,"jhi-sidebar",11),v("onSelectConversation",function(i){m(e);let l=c();return h(l.onConversationSelected(i))})("onUpdateSidebar",function(){m(e);let i=c();return h(i.prepareSidebarData())})("onCreateChannelPressed",function(){m(e);let i=c();return h(i.openCreateChannelDialog())})("onMarkAllChannelsAsRead",function(){m(e);let i=c();return h(i.markAllChannelAsRead())})("onBrowsePressed",function(){m(e);let i=c();return h(i.openChannelOverviewDialog())})("onDirectChatPressed",function(){m(e);let i=c();return h(i.openCreateOneToOneChatDialog())})("onGroupChatPressed",function(){m(e);let i=c();return h(i.openCreateGroupChatDialog())}),r(),t(6,`
            `),r(),t(7,`
            `),f(8,cs,6,1),s(9,"div",12),t(10,`
                `),f(11,ls,5,7)(12,ms,3,1),r(),t(13,`
            `),s(14,"div",13),t(15,`
                `),f(16,hs,3,3),r(),t(17,`
        `),r(),t(18,`
    `)}if(n&2){let e=c();a(3),d("ngClass",fe(14,rs,e.isCollapsed,!e.activeConversation)),a(2),d("itemSelected",e.conversationSelected)("courseId",e.course.id)("sidebarData",e.sidebarData)("channelTypeIcon",e.CHANNEL_TYPE_ICON)("sidebarItemAlwaysShow",e.DEFAULT_SHOW_ALWAYS)("collapseState",e.DEFAULT_COLLAPSE_STATE)("inCommunication",!0)("reEmitNonDistinctSidebarEvents",!0),a(3),C(e.course&&!e.activeConversation&&e.isCodeOfConductPresented?8:-1),a(),d("ngClass",fe(17,_i,!e.isProduction||e.isTestServer,!!e.postInThread)),a(2),C(e.activeConversation?11:12),a(3),d("ngClass",fe(20,_i,!e.isProduction||e.isTestServer,!!e.postInThread)),a(2),C(e.postInThread?16:-1)}}var xi={favoriteChannels:{entityData:[]},recents:{entityData:[]},generalChannels:{entityData:[]},exerciseChannels:{entityData:[]},lectureChannels:{entityData:[]},examChannels:{entityData:[]},feedbackDiscussion:{entityData:[]},archivedChannels:{entityData:[]},savedPosts:{entityData:[]}},Cs={generalChannels:Qt,exerciseChannels:Xt,examChannels:gn,groupChats:qt,directMessages:rn,favoriteChannels:on,lectureChannels:pn,archivedChannels:Ge,feedbackDiscussion:nn,savedPosts:Pe,recents:cn},vs={generalChannels:!0,exerciseChannels:!0,examChannels:!0,groupChats:!0,directMessages:!0,favoriteChannels:!1,lectureChannels:!0,archivedChannels:!0,feedbackDiscussion:!0,savedPosts:!0,recents:!0},fs={generalChannels:!0,exerciseChannels:!1,examChannels:!1,groupChats:!0,directMessages:!0,favoriteChannels:!0,lectureChannels:!1,archivedChannels:!1,feedbackDiscussion:!1,savedPosts:!0,recents:!0},ql=(()=>{class n{router=x(Lt);activatedRoute=x(Rt);metisConversationService=x(oe);metisService=x(ee);courseOverviewService=x(Kn);modalService=x(Be);profileService=x(_n);ngUnsubscribe=new D;closeSidebarEventSubscription;openSidebarEventSubscription;toggleSidebarEventSubscription;breakpointSubscription;course;isLoading=!1;isServiceSetUp=!1;messagingEnabled=!1;postInThread;activeConversation=void 0;conversationsOfUser=[];channelSearchCollapsed=!0;conversationSelected=!0;sidebarData;accordionConversationGroups;sidebarConversations=[];profileSubscription;isCollapsed=!1;isProduction=!0;isTestServer=!1;isMobile=!1;focusPostId=void 0;openThreadOnFocus=!1;selectedSavedPostStatus=null;showOnlyPinned=!1;pinnedCount=0;CHANNEL_TYPE_ICON=Cs;DEFAULT_COLLAPSE_STATE=vs;DEFAULT_SHOW_ALWAYS=fs;isCodeOfConductAccepted;isCodeOfConductPresented=!1;courseWideSearch=ne(pt);searchElement=ne("courseWideSearchInput");courseWideSearchConfig;courseWideSearchTerm="";ButtonType=Xe;faPlus=$e;faTimes=Ae;faFilter=He;faSearch=Ee;createChannelFn;channelActions$=new O;courseSidebarService=x(Ve);layoutService=x(nt);changeDetector=x(ie);getAsChannel=V;subscribeToMetis(){this.metisService.posts.pipe(b(this.ngUnsubscribe)).subscribe(e=>{this.postInThread?.id&&e&&(this.postInThread=e.find(o=>o.id===this.postInThread?.id))})}togglePinnedView(){this.showOnlyPinned=!this.showOnlyPinned}onPinnedCountChanged(e){this.pinnedCount=e,this.pinnedCount==0&&this.showOnlyPinned&&(this.showOnlyPinned=!1),this.changeDetector.detectChanges()}setupMetis(){this.metisService.setPageType(Ye.OVERVIEW),this.metisService.setCourse(this.course)}ngOnInit(){this.isMobile=this.layoutService.isBreakpointActive(ke.extraSmall),this.breakpointSubscription=this.layoutService.subscribeToLayoutChanges().subscribe(()=>{this.isMobile=this.layoutService.isBreakpointActive(ke.extraSmall)}),this.openSidebarEventSubscription=this.courseSidebarService.openSidebar$.subscribe(()=>{this.setIsCollapsed(!0)}),this.closeSidebarEventSubscription=this.courseSidebarService.closeSidebar$.subscribe(()=>{this.setIsCollapsed(!1)}),this.toggleSidebarEventSubscription=this.courseSidebarService.toggleSidebar$.subscribe(()=>{this.toggleSidebar()}),this.isMobile?this.courseSidebarService.openSidebar():this.courseOverviewService.getSidebarCollapseStateFromStorage("conversation")?this.courseSidebarService.openSidebar():this.courseSidebarService.closeSidebar(),this.isLoading=!0,this.metisConversationService.isServiceSetup$.pipe(b(this.ngUnsubscribe)).subscribe(e=>{e&&(this.course=this.metisConversationService.course,this.initializeCourseWideSearchConfig(),this.initializeSidebarAccordions(),this.setupMetis(),this.subscribeToMetis(),this.subscribeToQueryParameter(),this.subscribeToActiveConversation(),this.subscribeToIsCodeOfConductAccepted(),this.subscribeToIsCodeOfConductPresented(),this.subscribeToConversationsOfUser(),this.updateQueryParameters(),this.prepareSidebarData(),this.metisConversationService.checkIsCodeOfConductAccepted(this.course),this.isServiceSetUp=!0,this.isLoading=!1),this.channelActions$.pipe(re(500),pe((o,i)=>i.action!=="create"&&o.action===i.action&&o.channel.id===i.channel.id&&o.channel.name===i.channel.name),b(this.ngUnsubscribe)).subscribe(o=>{this.performChannelAction(o)}),this.createChannelFn=o=>this.metisConversationService.createChannel(o)}),this.profileSubscription=this.profileService.getProfileInfo()?.subscribe(e=>{this.isProduction=e?.inProduction,this.isTestServer=e.testServer??!1})}performChannelAction(e){this.createChannelFn&&this.createChannelFn(e.channel).pipe(b(this.ngUnsubscribe)).subscribe({complete:()=>{this.prepareSidebarData()},error:o=>{zt("Error creating channel:",o)}})}subscribeToQueryParameter(){this.activatedRoute.queryParams.pipe(bt(1),b(this.ngUnsubscribe)).subscribe(e=>{e.conversationId&&(isNaN(Number(e.conversationId))&&Object.values(Me).map(o=>o.toString()).includes(e.conversationId)?this.selectedSavedPostStatus=De.mapToStatus(e.conversationId):(this.metisConversationService.setActiveConversation(Number(e.conversationId)),this.closeSidebarOnMobile())),e.focusPostId&&(this.focusPostId=Number(e.focusPostId)),e.openThreadOnFocus&&(this.openThreadOnFocus=e.openThreadOnFocus),e.messageId?(this.postInThread={id:Number(e.messageId)},this.closeSidebarOnMobile()):this.postInThread=void 0})}onNavigateToPost(e){e.referencePostId===void 0||e.conversation?.id===void 0||(this.focusPostId=e.referencePostId,this.openThreadOnFocus=e.postingType===Ie.ANSWER,this.metisConversationService.setActiveConversation(e.conversation.id),this.changeDetector.detectChanges())}updateQueryParameters(){this.router.navigate([],{relativeTo:this.activatedRoute,queryParams:{conversationId:this.activeConversation?.id??(this.selectedSavedPostStatus!==null?De.statusToMap(this.selectedSavedPostStatus):void 0)},replaceUrl:!0})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.openSidebarEventSubscription?.unsubscribe(),this.closeSidebarEventSubscription?.unsubscribe(),this.toggleSidebarEventSubscription?.unsubscribe(),this.profileSubscription?.unsubscribe(),this.breakpointSubscription?.unsubscribe()}subscribeToActiveConversation(){this.metisConversationService.activeConversation$.pipe(b(this.ngUnsubscribe)).subscribe(e=>{let o=this.activeConversation;this.activeConversation=e,this.isMobile&&e&&o?.id!==e.id&&this.courseSidebarService.closeSidebar(),this.updateQueryParameters()})}subscribeToIsCodeOfConductAccepted(){this.metisConversationService.isCodeOfConductAccepted$.pipe(b(this.ngUnsubscribe)).subscribe(e=>{this.isCodeOfConductAccepted=e})}subscribeToIsCodeOfConductPresented(){this.metisConversationService.isCodeOfConductPresented$.pipe(b(this.ngUnsubscribe)).subscribe(e=>{this.isCodeOfConductPresented=e})}subscribeToConversationsOfUser(){this.metisConversationService.conversationsOfUser$.pipe(b(this.ngUnsubscribe)).subscribe(e=>{this.conversationsOfUser=e??[]})}acceptCodeOfConduct(){this.course&&this.metisConversationService.acceptCodeOfConduct(this.course)}initializeCourseWideSearchConfig(){this.courseWideSearchConfig=new lt,this.courseWideSearchConfig.searchTerm="",this.courseWideSearchConfig.filterToUnresolved=!1,this.courseWideSearchConfig.filterToOwn=!1,this.courseWideSearchConfig.filterToAnsweredOrReacted=!1,this.courseWideSearchConfig.sortingOrder=$.ASCENDING}initializeSidebarAccordions(){this.messagingEnabled=ut(this.course),this.accordionConversationGroups=this.messagingEnabled?de(le({},xi),{groupChats:{entityData:[]},directMessages:{entityData:[]}}):xi}hideSearchTerm(){this.courseWideSearchTerm=""}onSearch(){this.isMobile&&(this.courseWideSearchTerm?this.courseSidebarService.closeSidebar():this.courseSidebarService.openSidebar()),this.selectedSavedPostStatus=null,this.metisConversationService.setActiveConversation(void 0),this.activeConversation=void 0,this.updateQueryParameters(),this.courseWideSearchConfig.searchTerm=this.courseWideSearchTerm,this.courseWideSearch()?.onSearch()}prepareSidebarData(){this.metisConversationService.forceRefresh().subscribe({complete:()=>{this.sidebarConversations=this.courseOverviewService.mapConversationsToSidebarCardElements(this.course,this.conversationsOfUser),this.accordionConversationGroups=this.courseOverviewService.groupConversationsByChannelType(this.course,this.conversationsOfUser,this.messagingEnabled),this.accordionConversationGroups.recents.entityData=this.sidebarConversations?.filter(e=>e.isCurrent)||[],this.updateSidebarData()}})}updateSidebarData(){this.sidebarData={groupByCategory:!0,sidebarType:"conversation",storageId:"conversation",groupedData:this.accordionConversationGroups,ungroupedData:this.sidebarConversations,showAccordionLeadingIcon:!0,messagingEnabled:ut(this.course),canCreateChannel:rt(this.course)}}onConversationSelected(e){this.closeSidebarOnMobile(),this.focusPostId=void 0,this.openThreadOnFocus=!1,typeof e=="string"?Object.values(Me).map(o=>o.toString()).includes(e)&&(this.selectedSavedPostStatus=De.mapToStatus(e),this.postInThread=void 0,this.metisConversationService.setActiveConversation(void 0),this.activeConversation=void 0,this.updateQueryParameters(),this.metisService.resetCachedPosts(),this.changeDetector.detectChanges()):(e=+e,this.selectedSavedPostStatus=null,this.metisConversationService.setActiveConversation(e))}toggleSidebar(){this.setIsCollapsed(!this.isCollapsed)}closeSidebarOnMobile(){this.isMobile&&this.courseSidebarService.closeSidebar()}setIsCollapsed(e){this.isCollapsed=e,this.courseOverviewService.setSidebarCollapseState("conversation",this.isCollapsed)}openCreateGroupChatDialog(){let e=this.modalService.open(ci,ae);e.componentInstance.course=this.course,e.componentInstance.initialize(),te(e.result).pipe(K(()=>Y),b(this.ngUnsubscribe)).subscribe(o=>{this.metisConversationService.createGroupChat(o?.map(i=>i.login)).subscribe({complete:()=>{this.prepareSidebarData()}})})}openCreateOneToOneChatDialog(){let e=this.modalService.open(li,ae);e.componentInstance.course=this.course,e.componentInstance.initialize(),te(e.result).pipe(K(()=>Y),b(this.ngUnsubscribe)).subscribe(o=>{o?.login&&this.metisConversationService.createOneToOneChat(o.login).subscribe({complete:()=>{this.prepareSidebarData()}})})}openCreateChannelDialog(){let e=this.modalService.open(si,Vn);e.componentInstance.course=this.course,e.componentInstance.initialize(),te(e.result).pipe(K(()=>Y),b(this.ngUnsubscribe)).subscribe(o=>{this.channelActions$.emit({action:"create",channel:o})})}markAllChannelAsRead(){this.metisConversationService.markAllChannelsAsRead(this.course).subscribe({complete:()=>{this.metisConversationService.forceRefresh().subscribe({complete:()=>{this.prepareSidebarData(),this.closeSidebarOnMobile()}})}})}openChannelOverviewDialog(){let o=this.modalService.open(ai,ae);o.componentInstance.course=this.course,o.componentInstance.createChannelFn=wn.GENERAL===null?this.metisConversationService.createChannel:void 0,o.componentInstance.channelSubType=null,o.componentInstance.initialize(),te(o.result).pipe(K(()=>Y),b(this.ngUnsubscribe)).subscribe(i=>{let[l,S]=i;S?this.metisConversationService.forceRefresh(!l,!0).subscribe({complete:()=>{l&&(this.metisConversationService.setActiveConversation(l),this.closeSidebarOnMobile())}}):l&&(this.metisConversationService.setActiveConversation(l),this.closeSidebarOnMobile()),this.prepareSidebarData()})}toggleChannelSearch(){this.channelSearchCollapsed=!this.channelSearchCollapsed}openThread(e){this.postInThread=e}handleSearchShortcut(e){(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),this.searchElement().nativeElement.focus())}onTriggerNavigateToPost(e){let o=e?.conversation?.id;this.focusPostId=e.id,this.openThreadOnFocus=!1,e.id!==void 0&&(e?.conversation?.id===void 0&&(this.openThreadOnFocus=!0,o=e?.post?.conversation?.id,this.focusPostId=e?.post?.id),this.metisConversationService.setActiveConversation(o),this.changeDetector.detectChanges())}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=w({type:n,selectors:[["jhi-course-conversations"]],viewQuery:function(o,i){o&1&&(X(i.courseWideSearch,pt,5),X(i.searchElement,ss,5)),o&2&&ve(2)},hostBindings:function(o,i){o&1&&v("keydown",function(S){return i.handleSearchShortcut(S)},!1,Pt)},features:[jt([ee,Wn,Gn])],decls:18,vars:11,consts:[["courseWideSearchInput",""],[3,"isLoading"],[1,"input-group","mb-2","rounded-3","p-2","me-2","module-bg",3,"hidden"],["name","searchText","id","search",1,"form-control",3,"ngModelChange","keyup.enter","ngModel","placeholder"],[3,"onClick","btnType","icon"],["id","search-submit",1,"ms-1",3,"onClick","icon"],[1,"module-bg","px-3","py-3","code-of-conduct"],[3,"course"],["id","acceptCodeOfConductButton","type","button","jhiTranslate","artemisApp.codeOfConduct.accept",1,"btn","btn-primary",3,"click"],[1,"d-flex","justify-content-between"],[1,"communication-content-sidebar",3,"ngClass"],[3,"onSelectConversation","onUpdateSidebar","onCreateChannelPressed","onMarkAllChannelsAsRead","onBrowsePressed","onDirectChatPressed","onGroupChatPressed","itemSelected","courseId","sidebarData","channelTypeIcon","sidebarItemAlwaysShow","collapseState","inCommunication","reEmitNonDistinctSidebarEvents"],[1,"communication-message-wrap","col","flex-grow-1","module-bg","rounded-3","scrollable-content",3,"ngClass"],[1,"scrollable-content",3,"ngClass"],[1,"col","pe-0","flex-grow-1"],[3,"collapseSearch","onUpdateSidebar","togglePinnedMessage","pinnedMessageCount"],[3,"openThread","onNavigateToPost","pinnedCount","contentHeightDev","course","searchbarCollapsed","focusPostId","openThreadOnFocus","showOnlyPinned"],[3,"openThread","courseWideSearchConfig"],[3,"onNavigateToPost","savedPostStatus","courseId"],[3,"closePostThread","activeConversation","readOnlyMode","activePost"]],template:function(o,i){if(o&1){let l=g();s(0,"jhi-loading-indicator-container",1),t(1,`
    `),s(2,"div",2),t(3,`
        `),t(4,`
        `),s(5,"input",3,0),_(7,"artemisTranslate"),Ft("ngModelChange",function(M){return m(l),Vt(i.courseWideSearchTerm,M)||(i.courseWideSearchTerm=M),h(M)}),v("keyup.enter",function(){return m(l),h(i.onSearch())}),r(),t(8,`
        `),s(9,"jhi-button",4),v("onClick",function(){return m(l),h(i.hideSearchTerm())}),r(),t(10,`
        `),s(11,"jhi-button",5),v("onClick",function(){return m(l),h(i.onSearch())}),r(),t(12,`
    `),r(),t(13,`
    `),t(14,`
    `),f(15,as,8,1)(16,us,19,23),r(),t(17,`
`)}o&2&&(d("isLoading",i.isLoading),a(2),d("hidden",!i.isCodeOfConductAccepted),a(3),J("placeholder",T(7,9,"artemisApp.metis.overview.searchBarDefault")),kt("ngModel",i.courseWideSearchTerm),a(4),d("btnType",i.ButtonType.SECONDARY)("icon",i.faTimes),a(2),d("icon",i.faSearch),a(4),C(i.course&&i.isCodeOfConductAccepted===!1?15:-1),a(),C(i.isCodeOfConductAccepted&&i.isServiceSetUp&&i.course?16:-1))},dependencies:[et,z,Ht,H,Re,Un,di,y,W,ii,mi,ui,pt,gi,vi,P],styles:[`.course-body-container{position:relative}.refresh-overlay{position:absolute;inset:0;display:flex;justify-content:center;align-items:flex-start;opacity:0;pointer-events:none;transition:.1s ease-out opacity}.refresh-overlay.active{background-color:var(--overview-refresh-overlay-bg-color);opacity:1;pointer-events:auto;transition:.2s ease-in opacity}.refresh-overlay .ng-fa-icon{position:relative;top:calc(47.5vh - 150px);transform:translateY(-50%);color:var(--overview-refresh-overlay-color)}.back-button{cursor:pointer}.current-week-row ::ng-deep>div{background-color:var(--overview-light-primary-background-color)}.statistic-summary{margin-top:25px}.statistic-summary .chart-container{display:inline-flex;align-items:center;justify-content:flex-end;margin-bottom:20px}.statistic-summary .chart-container .chart-text{position:absolute;width:350px}.statistic-summary .color-legend-container{margin-bottom:40px}.statistic-summary .color-legend-container .color-legend-entry{display:inline-flex;align-items:center;width:100%}.exercise-row-container .control-label{cursor:pointer}.exercise-row-container .collapsed{margin-top:1rem;border-bottom:1px solid var(--overview-light-border-color)}.icon-container{display:inline-block;vertical-align:middle;horiz-align:center}.course-information{padding-top:29px}.course-information .exercise-panel .row.has-exercises{cursor:pointer;border-radius:3px}.course-information .exercise-panel .row.has-exercises:hover{background-color:var(--overview-light-background-color)}.course-information .exercise-panel .row.has-exercises:hover .icon{color:var(--primary)}.exercise-divider{height:0;width:100%;margin:1rem 0 .5rem;border-top:1px solid var(--overview-light-border-color)}.color-indicator{height:20px;width:20px;background-color:#0f6ab4;position:relative;top:-4px;margin-right:5px;border-radius:3px}canvas#complete-chart{z-index:99}.dev-button{text-align:left;color:#fff;background-color:#3e8acc;border:none;border-radius:1px}.dev-button:hover{background-color:#0f6ab4}.dev-button:active{box-shadow:0 2px 0 var(--artemis-dark)}.dev-button:disabled{background-color:gray}.btn-primary,.btn-primary:hover,.btn-primary:disabled,.btn-info,.btn-info:hover,.btn-success,.btn-success:hover{color:#fff}@media (max-width: 768px){.col-12{width:100%!important}}.fadeInIcon{animation:fadeIn .3s;animation-iteration-count:initial}@media (max-width: 655px){.horizontal-scroll{overflow-x:auto}}@keyframes fadeIn{0%{opacity:0}50%{opacity:.5}to{visibility:visible;opacity:1}}.exercise-content-sidebar-width{width:calc(100% - 263px)!important;transition:width .1s 0s ease-in-out}.exercise-content-width{width:100%;transition:width .1s 0s ease-in-out}
`,`.second-layer-modal-bg{background-color:var(--secondary)}.module-bg{background-color:var(--module-bg)}.code-of-conduct{--communications-header-height: 125px;border-radius:.25rem;overflow-y:auto;overflow-x:hidden;max-height:calc(100vh - var(--header-height) - var(--communications-header-height))}.scrollable-content{--message-input-height-dev: 164px;--message-input-height-prod: 148px;overflow-y:auto;overflow-x:hidden;max-height:calc(100vh - var(--header-height) - var(--message-input-height-prod));flex-wrap:wrap}.scrollable-content.content-height-dev{max-height:calc(100vh - var(--header-height) - var(--message-input-height-dev))}@media (max-width: 768px){.scrollable-content{max-height:calc(100vh - var(--header-height) - var(--message-input-height-prod))!important;max-height:calc(100dvh - var(--header-height) - var(--message-input-height-prod))!important}}.message-input{border-top:1px solid;border-color:var(--bs-card-border-color)}.communication-message-wrap{min-width:30%}@media (max-width: 575.98px){.communication-content-sidebar{position:absolute;width:100%;z-index:2;pointer-events:none}.communication-content-sidebar .sidebar-wrap,.communication-content-sidebar .communication-content-sidebar .sidebar-width{max-width:0}.communication-content-sidebar.sidebar-collapsed{pointer-events:all}.communication-content-sidebar.sidebar-collapsed .sidebar-wrap,.communication-content-sidebar.sidebar-collapsed .sidebar-width{max-width:100%}.communication-content-sidebar.sidebar-collapsed .sidebar-width{width:100%}.communication-content-sidebar .sidebar-content{opacity:0}.communication-content-sidebar.sidebar-collapsed .sidebar-content{opacity:1}.communication-content-sidebar .sidebar-wrap{margin-right:0}.communication-message-wrap.is-answer-thread-open{display:none}.communication-message-wrap{max-width:100%}}
`],encapsulation:2})}return n})();export{Ve as a,ql as b};
//# sourceMappingURL=chunk-26L2EO26.js.map
