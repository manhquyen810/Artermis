import{a as we}from"./chunk-HQTS6JOY.js";import{a as Ae}from"./chunk-HMZID6NQ.js";import{a as be,b as ye,d as Te}from"./chunk-O26CMRR4.js";import"./chunk-MP6UGYTC.js";import{a as Se}from"./chunk-AZBLKUAM.js";import{c as ve}from"./chunk-JNO6DNVW.js";import{b as W}from"./chunk-EELXLOHY.js";import{N as xe,u as ue,v as he}from"./chunk-VZRSC3LP.js";import"./chunk-5SKDOIBQ.js";import{K as M,b as le,c as pe,h as U,i as de,k as ce,m as I,n as me}from"./chunk-WA5GEAJB.js";import{a as j}from"./chunk-K3W6YFKH.js";import{c as T}from"./chunk-JXJXC4DZ.js";import{d as k}from"./chunk-EDXSOKK5.js";import{b as De}from"./chunk-R5BZWVRQ.js";import"./chunk-DID2YGL7.js";import"./chunk-CXQURQM5.js";import"./chunk-S4QLGR2R.js";import{Zc as _e,fa as ge,sd as Ce,y as fe}from"./chunk-Z4VHWOB5.js";import"./chunk-XUCCGZJR.js";import"./chunk-HKBU2OOC.js";import"./chunk-5ZXXURLP.js";import"./chunk-NOBD5HSR.js";import{a as A}from"./chunk-U54OSGNH.js";import{f as se}from"./chunk-M6Z6DKZQ.js";import"./chunk-3Y6745HG.js";import{c as Ee}from"./chunk-E2KBL4LX.js";import"./chunk-PZTBTDSR.js";import{O as ae}from"./chunk-IOA4DPXY.js";import{Ad as Q,Db as s,Dc as C,Ea as p,Ib as Z,Ma as u,Mc as x,Na as h,Oc as c,P as K,Tb as S,Va as w,Vb as $,Yc as te,Zb as _,Zc as ie,_a as X,_c as ne,cd as oe,dd as t,ed as P,f as G,fd as q,kc as d,lc as ee,ld as v,mc as R,md as b,nd as y,oa as H,r as Y,ra as J,rd as re,s as L,sc as E,xc as r,ya as O,yc as a,yd as D,zc as m,zd as F}from"./chunk-5LC5EQRR.js";import"./chunk-3E746U5Y.js";var Re=(()=>{class n{http=p(ae);requestDataExport(){return this.http.post("api/core/data-exports",{})}downloadDataExport(e){let o=`api/core/data-exports/${e}`;window.open(o,"_blank")}canRequestDataExport(){return this.http.get("api/core/data-exports/can-request")}canDownloadAnyDataExport(){return this.http.get("api/core/data-exports/can-download")}canDownloadSpecificDataExport(e){return this.http.get(`api/core/data-exports/${e}/can-download`)}requestDataExportForAnotherUser(e){return this.http.post(`api/core/admin/data-exports/${e}`,{})}static \u0275fac=function(o){return new(o||n)};static \u0275prov=O({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var V=class{id;dataExportState;createdDate;creationFinishedDate;downloadDate;nextRequestDate;user},z=function(n){return n.REQUESTED="REQUESTED",n.IN_CREATION="IN_CREATION",n.EMAIL_SENT="EMAIL_SENT",n.DOWNLOADED="DOWNLOADED",n.DELETED="DELETED",n.DOWNLOADED_DELETED="DOWNLOADED_DELETED",n.FAILED="FAILED",n}(z||{});var Ue=n=>({length:n}),qe=(()=>{class n{userService=p(Se);loginOrName;loginOrNameChange=new w;searching=!1;searchFailed=!1;searchNoResults=!1;searchQueryTooShort=!0;faCircleNotch=fe;MIN_SEARCH_QUERY_LENGTH=3;search=e=>(this.searchFailed=!1,e.pipe(H(o=>o.length<this.MIN_SEARCH_QUERY_LENGTH?(this.searchQueryTooShort=!0,this.searching=!1,L([])):(this.searchQueryTooShort=!1,this.searching=!0,this.userService.search(o).pipe(H(i=>L(i.body)),J(i=>{this.searching=!1,this.searchNoResults=i.length===0}),K(()=>(this.searching=!1,this.searchFailed=!0,L([]))))))));onChange(){let e=this.loginOrName;e&&e.login?this.loginOrNameChange.emit(e.login):this.loginOrNameChange.emit(this.loginOrName),this.searchQueryTooShort=this.loginOrName.length<this.MIN_SEARCH_QUERY_LENGTH}resultFormatter=e=>e.name+" ("+e.login+")";inputFormatter(e){let o=e;return o&&o.login?o.login:e}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=S({type:n,selectors:[["jhi-type-ahead-user-search-field"]],inputs:{loginOrName:"loginOrName"},outputs:{loginOrNameChange:"loginOrNameChange"},decls:31,vars:23,consts:[["for","typeahead-user-login","jhiTranslate","artemisApp.dataExport.loginOrName",1,"mb-1","form-check-label"],[1,"search-container"],["id","typeahead-user-login","type","text",1,"form-control",3,"ngModelChange","input","change","focus","select","blur","ngModel","ngbTypeahead","placeholder","resultFormatter","inputFormatter"],[1,"search-info"],["size","lg","animation","spin",3,"icon"],[1,"badge","bg-danger",3,"jhiTranslate"],[1,"badge","bg-warning",3,"jhiTranslate"],[1,"badge","bg-info",3,"jhiTranslate","translateValues"]],template:function(o,i){o&1&&(m(0,"label",0),t(1,`
`),r(2,"div",1),t(3,`
    `),r(4,"input",2),D(5,"artemisTranslate"),y("ngModelChange",function(f){return b(i.loginOrName,f)||(i.loginOrName=f),f}),x("input",function(){return i.onChange()})("change",function(){return i.onChange()})("focus",function(){return i.onChange()})("select",function(){return i.onChange()})("blur",function(){return i.onChange()}),a(),t(6,`

    `),r(7,"div",3),t(8,`
        `),m(9,"fa-icon",4),t(10,`
    `),a(),t(11,`
    `),r(12,"div",3),t(13,`
        `),r(14,"span",5),t(15," Search failed "),a(),t(16,`
    `),a(),t(17,`
    `),r(18,"div",3),t(19,`
        `),r(20,"span",6),t(21," No results "),a(),t(22,`
    `),a(),t(23,`
    `),r(24,"div",3),t(25,`
        `),r(26,"span",7),t(27),a(),t(28,`
    `),a(),t(29,`
`),a(),t(30,`
`)),o&2&&(s(4),v("ngModel",i.loginOrName),d("ngbTypeahead",i.search)("placeholder",F(5,19,"artemisApp.dataExport.loginOrName"))("resultFormatter",i.resultFormatter)("inputFormatter",i.inputFormatter),s(3),R("active",i.searching),s(2),d("icon",i.faCircleNotch),s(3),R("active",i.searchFailed),s(2),d("jhiTranslate","artemisApp.dataTable.search.failed"),s(4),R("active",i.searchNoResults),s(2),d("jhiTranslate","artemisApp.dataTable.search.noResults"),s(4),R("active",i.searchQueryTooShort),s(2),d("jhiTranslate","artemisApp.dataExport.searchQueryTooShort")("translateValues",re(21,Ue,i.MIN_SEARCH_QUERY_LENGTH)),s(),q(`
            Please enter at least `,i.MIN_SEARCH_QUERY_LENGTH,` characters
        `))},dependencies:[A,M,pe,U,I,xe,k,j],styles:[".search-container[_ngcontent-%COMP%]{position:relative;flex:1}.search-info[_ngcontent-%COMP%]{position:absolute;top:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;padding:0 .75rem;font-size:18px;pointer-events:none;opacity:0;transition:.1s ease-out opacity}.search-info.active[_ngcontent-%COMP%]{opacity:1;transition:.2s ease-in opacity}ngb-typeahead-window.dropdown-menu.show[_ngcontent-%COMP%]{max-height:calc(100vh - 380px);overflow-y:auto!important;will-change:unset!important}.dropdown-item.selected[_ngcontent-%COMP%]{background-color:var(--data-table-dropdown-item-selected-background-color)}"]})}return n})();var Ie=["dataExportConfirmationForm"];function Me(n,g){if(n&1){let e=C();t(0,`
                            `),r(1,"jhi-type-ahead-user-search-field",18),y("loginOrNameChange",function(i){u(e);let l=c(3);return b(l.expectedLogin,i)||(l.expectedLogin=i),h(i)}),a(),t(2,`
                        `)}if(n&2){let e=c(3);s(),v("loginOrName",e.expectedLogin)}}function je(n,g){if(n&1){let e=C();t(0,`
                    `),r(1,"div",14),t(2,`
                        `),r(3,"div",15),t(4,`
                            `),r(5,"input",16),x("change",function(i){u(e);let l=c(2);return h(l.onRequestDataExportForOtherUserChanged(i))}),y("ngModelChange",function(i){u(e);let l=c(2);return b(l.requestForAnotherUser,i)||(l.requestForAnotherUser=i),h(i)}),a(),t(6,`
                            `),m(7,"label",17),t(8,`
                        `),a(),t(9,`
                        `),_(10,Me,3,1),a(),t(11,`
                `)}if(n&2){let e=c(2);s(5),v("ngModel",e.requestForAnotherUser),s(5),E(e.requestForAnotherUser?10:-1)}}function ke(n,g){if(n&1&&(t(0,`
            `),r(1,"div"),t(2,`
                `),_(3,je,12,2),a(),t(4,`
        `)),n&2){let e=c();s(3),E(e.adminDialog?3:-1)}}function Ve(n,g){if(n&1&&(t(0,`
                `),r(1,"span"),m(2,"fa-icon",19),t(3,"\xA0"),a(),t(4,`
            `)),n&2){let e=c();s(2),d("icon",e.faSpinner)}}var Fe=(()=>{class n{activeModal=p(ue);alertService=p(T);dialogErrorSubscription;dialogError;dataExportRequest;dataExportRequestForAnotherUser;dataExportConfirmationForm;submitDisabled;enteredLogin;expectedLogin;adminDialog=!1;requestForAnotherUser=!1;expectedLoginOfOtherUser;deleteQuestion;confirmationTextHint;ownLogin;faBan=ge;faSpinner=_e;faCheck=Ce;ngOnInit(){this.dialogErrorSubscription=this.dialogError.subscribe(e=>{e===""?this.clear():(this.submitDisabled=!1,this.alertService.error(e))}),this.confirmationTextHint="artemisApp.dataExport.typeLoginToConfirm"}ngOnDestroy(){this.dialogErrorSubscription&&this.dialogErrorSubscription.unsubscribe()}clear(){this.activeModal.close()}confirmDataExportRequest(){this.submitDisabled=!0,this.requestForAnotherUser?this.dataExportRequestForAnotherUser.emit(this.expectedLogin):this.dataExportRequest.emit()}onRequestDataExportForOtherUserChanged(e){e.target.checked?(this.ownLogin=this.expectedLogin,this.expectedLogin=this.expectedLoginOfOtherUser??"",this.confirmationTextHint="artemisApp.dataExport.typeUserLoginToConfirm",this.enteredLogin=""):(this.enteredLogin="",this.expectedLogin=this.ownLogin,this.confirmationTextHint="artemisApp.dataExport.typeLoginToConfirm",this.expectedLoginOfOtherUser="")}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=S({type:n,selectors:[["jhi-data-export-confirmation-dialog"]],viewQuery:function(o,i){if(o&1&&te(Ie,7),o&2){let l;ie(l=ne())&&(i.dataExportConfirmationForm=l.first)}},outputs:{dataExportRequest:"dataExportRequest",dataExportRequestForAnotherUser:"dataExportRequestForAnotherUser"},decls:42,vars:14,consts:[["dataExportConfirmationForm","ngForm"],["name","dataExportConfirmationForm",3,"ngSubmit"],[1,"modal-header"],[1,"modal-title"],["jhiTranslate","artemisApp.dataExport.confirmationHeader"],["type","button","data-dismiss","modal","aria-hidden","true",1,"btn-close",3,"click"],[1,"modal-body"],[3,"jhiTranslate"],["name","confirmEntityName",3,"ngModelChange","entityName","confirmationText","disabled","ngModel"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-secondary",3,"click","disabled"],[3,"icon"],["jhiTranslate","entity.action.cancel"],["id","request","type","submit",1,"btn","btn-primary",3,"disabled"],[1,"checkbox"],[1,"control-label","form-check"],["id","request-for-other-user","type","checkbox","name","checkbox",1,"form-check-input",3,"change","ngModelChange","ngModel"],["for","request-for-other-user","jhiTranslate","artemisApp.dataExport.requestForAnotherUser",1,"form-check-label"],[3,"loginOrNameChange","loginOrName"],["animation","spin",3,"icon"]],template:function(o,i){if(o&1){let l=C();r(0,"form",1,0),x("ngSubmit",function(){return u(l),h(i.confirmDataExportRequest())}),t(2,`
    `),r(3,"div",2),t(4,`
        `),r(5,"h4",3),t(6,`
            `),m(7,"span",4),t(8,`
        `),a(),t(9,`
        `),r(10,"button",5),x("click",function(){return u(l),h(i.clear())}),a(),t(11,`
    `),a(),t(12,`
    `),r(13,"div",6),t(14,`
        `),r(15,"p",7),t(16,"Are you sure you want to request?"),a(),t(17,`
        `),_(18,ke,5,1),r(19,"jhi-confirm-entity-name",8),y("ngModelChange",function(B){return u(l),b(i.enteredLogin,B)||(i.enteredLogin=B),h(B)}),a(),t(20,`
    `),a(),t(21,`
    `),r(22,"div",9),t(23,`
        `),r(24,"button",10),x("click",function(){return u(l),h(i.clear())}),t(25,`
            `),m(26,"fa-icon",11),t(27,"\xA0"),m(28,"span",12),t(29,`
        `),a(),t(30,`
        `),r(31,"button",13),t(32,`
            `),_(33,Ve,5,1),m(34,"fa-icon",11),t(35,`\xA0
            `),r(36,"span",7),t(37," Request"),a(),t(38,`
        `),a(),t(39,`
    `),a(),t(40,`
`),a(),t(41,`
`)}if(o&2){let l=oe(1);s(15),d("jhiTranslate","artemisApp.dataExport.confirmationQuestion"),s(3),E(i.adminDialog?18:-1),s(),d("entityName",i.expectedLogin)("confirmationText",i.confirmationTextHint)("disabled",i.submitDisabled),v("ngModel",i.enteredLogin),s(5),d("disabled",i.submitDisabled),s(2),d("icon",i.faBan),s(5),ee("cursor",l.invalid||i.submitDisabled?"not-allowed":"pointer"),d("disabled",l.invalid||i.submitDisabled),s(2),E(i.submitDisabled?33:-1),s(),d("icon",i.faCheck),s(2),d("jhiTranslate","artemisApp.dataExport.request")}},dependencies:[M,me,le,U,de,I,ce,A,qe,we,k],encapsulation:2})}return n})();var Ne=(()=>{class n{modalService=p(he);alertService=p(T);modalRef;openConfirmationDialog(e){this.alertService.closeAll(),this.modalRef=this.modalService.open(Fe,{size:"lg",backdrop:"static"}),this.modalRef.componentInstance.expectedLogin=e.userLogin,this.modalRef.componentInstance.adminDialog=e.adminDialog,this.modalRef.componentInstance.dataExportRequest=e.dataExportRequest,this.modalRef.componentInstance.dataExportRequestForAnotherUser=e.dataExportRequestForAnotherUser,this.modalRef.componentInstance.dialogError=e.dialogError,Y(this.modalRef.result).subscribe(()=>this.modalRef=null)}static \u0275fac=function(o){return new(o||n)};static \u0275prov=O({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Le=(()=>{class n{dataExportConfirmationDialogService=p(Ne);renderer=p(Z);elementRef=p(X);translateService=p(Ee);expectedLogin;dialogError;adminDialog=!1;dataExportRequest=new w;dataExportRequestForAnotherUser=new w;buttonText;ngOnInit(){this.renderer.addClass(this.elementRef.nativeElement,"btn"),this.renderer.addClass(this.elementRef.nativeElement,"btn-primary"),this.renderer.addClass(this.elementRef.nativeElement,"btn-lg"),this.renderer.addClass(this.elementRef.nativeElement,"me-1"),this.renderer.setProperty(this.elementRef.nativeElement,"type","submit"),this.buttonText=this.renderer.createElement("span"),this.renderer.addClass(this.buttonText,"d-xl-inline"),this.setTextContent(),this.renderer.appendChild(this.elementRef.nativeElement,this.buttonText),this.translateService.onLangChange.subscribe(()=>{this.setTextContent()})}openConfirmationDialog(){let e={userLogin:this.expectedLogin,dataExportRequest:this.dataExportRequest,dataExportRequestForAnotherUser:this.dataExportRequestForAnotherUser,dialogError:this.dialogError,adminDialog:this.adminDialog};this.dataExportConfirmationDialogService.openConfirmationDialog(e)}onClick(e){e.preventDefault(),this.openConfirmationDialog()}setTextContent(){this.renderer.setProperty(this.buttonText,"textContent",this.translateService.instant("artemisApp.dataExport.request"))}static \u0275fac=function(o){return new(o||n)};static \u0275dir=$({type:n,selectors:[["","jhiDataExportRequestButton",""]],hostBindings:function(o,i){o&1&&x("click",function(f){return i.onClick(f)})},inputs:{expectedLogin:"expectedLogin",dialogError:"dialogError",adminDialog:"adminDialog"},outputs:{dataExportRequest:"dataExportRequest",dataExportRequestForAnotherUser:"dataExportRequestForAnotherUser"}})}return n})();function Be(n,g){if(n&1){let e=C();t(0,`
            `),r(1,"button",2),x("dataExportRequest",function(){u(e);let i=c();return h(i.requestExport())})("dataExportRequestForAnotherUser",function(i){u(e);let l=c();return h(l.requestExportForAnotherUser(i))}),a(),t(2,`
        `)}if(n&2){let e=c();s(),d("adminDialog",e.isAdmin)("expectedLogin",e.currentLogin)("dialogError",e.dialogError$)("disabled",!e.canRequestDataExport&&!e.isAdmin)}}function He(n,g){if(n&1){let e=C();t(0,`
            `),r(1,"jhi-button",3),x("onClick",function(){u(e);let i=c();return h(i.downloadDataExport())}),a(),t(2,`
        `)}if(n&2){let e=c();s(),d("btnSize",e.ButtonSize.LARGE)("disabled",!e.canDownload)("tooltip","artemisApp.dataExport.download")("title","artemisApp.dataExport.download")}}function Pe(n,g){if(n&1&&(t(0,`
            `),r(1,"p"),t(2,`
                `),m(3,"span",4),t(4,`
                `),r(5,"span",5),t(6),D(7,"artemisDate"),a(),t(8,`
            `),a(),t(9,`
        `)),n&2){let e=c();s(6),P(Q(7,1,e.dataExport==null?null:e.dataExport.createdDate,"long-date"))}}function Qe(n,g){if(n&1&&(t(0,`
            `),r(1,"p"),t(2,`
                `),m(3,"span",6),t(4,`
                `),r(5,"span",5),t(6),D(7,"artemisDate"),a(),t(8,`
            `),a(),t(9,`
        `)),n&2){let e=c();s(6),P(Q(7,1,e.dataExport==null?null:e.dataExport.nextRequestDate,"long-date"))}}function We(n,g){n&1&&(t(0,`
            `),r(1,"p"),t(2,`
                `),m(3,"span",7),t(4,`
            `),a(),t(5,`
        `))}var ii=(()=>{class n{dataExportService=p(Re);accountService=p(De);alertService=p(T);route=p(se);ActionType=Ae;ButtonSize=ye;ButtonType=be;DataExportState=z;dialogErrorSource=new G;dialogError$=this.dialogErrorSource.asObservable();canDownload=!1;canRequestDataExport=!1;currentLogin;dataExportId;downloadMode=!1;titleKey;description;state;dataExport=new V;isAdmin=!1;ngOnInit(){this.currentLogin=this.accountService.userIdentity?.login,this.isAdmin=this.accountService.isAdmin(),this.route.params.subscribe(e=>{e.id&&(this.downloadMode=!0,this.dataExportId=e.id)}),this.downloadMode?(this.titleKey="artemisApp.dataExport.titleDownload",this.description="artemisApp.dataExport.descriptionDownload",this.dataExportService.canDownloadSpecificDataExport(this.dataExportId).subscribe(e=>{this.canDownload=e})):(this.titleKey="artemisApp.dataExport.title",this.description="artemisApp.dataExport.description",this.dataExportService.canRequestDataExport().subscribe(e=>{this.canRequestDataExport=e}),this.dataExportService.canDownloadAnyDataExport().subscribe(e=>{this.dataExport.createdDate=W(e.createdDate),this.dataExport.nextRequestDate=W(e.nextRequestDate),this.canDownload=!!e.id,this.canDownload&&(this.dataExport.id=e.id,this.dataExportId=e.id),this.dataExport.dataExportState=e.dataExportState,this.state=e.dataExportState}))}requestExport(){this.dataExportService.requestDataExport().subscribe({next:e=>{this.dialogErrorSource.next(""),this.alertService.success("artemisApp.dataExport.requestSuccess"),this.dataExportId=e.id,this.canRequestDataExport=!1,this.state=e.dataExportState,this.dataExport.createdDate=e.createdDate},error:e=>{this.dialogErrorSource.next(e.message),this.alertService.error("artemisApp.dataExport.requestError")}})}downloadDataExport(){this.dataExportService.downloadDataExport(this.dataExportId)}requestExportForAnotherUser(e){this.dataExportService.requestDataExportForAnotherUser(e).subscribe({next:()=>{this.dialogErrorSource.next(""),this.alertService.success("artemisApp.dataExport.requestForUserSuccess",{login:e})},error:o=>{this.dialogErrorSource.next(o.message),this.alertService.error("artemisApp.dataExport.requestForUserError",{login:e})}})}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=S({type:n,selectors:[["jhi-data-export"]],decls:22,vars:11,consts:[[1,"column","d-flex","justify-content-center","align-content-center"],[1,"mt-3","d-flex-column","align-content-center"],["jhiDataExportRequestButton","",1,"mb-1",3,"dataExportRequest","dataExportRequestForAnotherUser","adminDialog","expectedLogin","dialogError","disabled"],["id","download-data-export-btn",3,"onClick","btnSize","disabled","tooltip","title"],["jhiTranslate","artemisApp.dataExport.lastRequestDate"],[1,"bold"],["jhiTranslate","artemisApp.dataExport.nextRequestDate"],["jhiTranslate","artemisApp.dataExport.isBeingCreated"]],template:function(o,i){o&1&&(r(0,"div"),t(1,`
    `),r(2,"h1"),t(3),D(4,"artemisTranslate"),a(),t(5,`
    `),r(6,"p"),t(7),D(8,"artemisTranslate"),a(),t(9,`
    `),r(10,"div",0),t(11,`
        `),_(12,Be,3,4)(13,He,3,4),a(),t(14,`
    `),r(15,"div",1),t(16,`
        `),_(17,Pe,10,4)(18,Qe,10,4)(19,We,6,0),a(),t(20,`
`),a(),t(21,`
`)),o&2&&(s(3),q(`
        `,F(4,7,i.titleKey),`
    `),s(4),q(`
        `,F(8,9,i.description),`
    `),s(5),E(i.downloadMode?-1:12),s(),E(i.canDownload?13:-1),s(4),E(i.dataExport!=null&&i.dataExport.createdDate&&i.state!==i.DataExportState.FAILED?17:-1),s(),E(i.dataExport!=null&&i.dataExport.nextRequestDate&&(i.state===i.DataExportState.DELETED||i.state===i.DataExportState.DOWNLOADED_DELETED)&&!i.canRequestDataExport?18:-1),s(),E(i.state===i.DataExportState.REQUESTED||i.state===i.DataExportState.IN_CREATION?19:-1))},dependencies:[Le,Te,A,ve,j],encapsulation:2})}return n})();export{ii as DataExportComponent};
//# sourceMappingURL=data-export.component-MYPZ56AS.js.map
