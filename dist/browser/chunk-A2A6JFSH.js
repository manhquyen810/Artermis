import{c as Ve}from"./chunk-MD6Z63OB.js";import{b as $e,c as te}from"./chunk-M2FHCXD3.js";import{a as Ge}from"./chunk-FLZTDUOG.js";import{a as Be}from"./chunk-QU4DXSXD.js";import{a as Ne,b as Ae}from"./chunk-O2WHE2S3.js";import{a as We,b as $}from"./chunk-V7PDYRDZ.js";import{a as De}from"./chunk-EANMTTQG.js";import{c as B}from"./chunk-65Z25AP3.js";import{a as He}from"./chunk-5M3YV54C.js";import{g as Le}from"./chunk-5AQXEKLE.js";import{d as ee}from"./chunk-DXTZ4GAW.js";import{e as Oe,i as ze,t as je}from"./chunk-Z2YUBN6N.js";import{a as ye}from"./chunk-JHBUBEY6.js";import{a as Y,b as V}from"./chunk-4I367PEU.js";import{a as W}from"./chunk-5MVJAZRV.js";import{h as Fe}from"./chunk-CT44YL7Q.js";import{d as Z}from"./chunk-ZFM7LHJQ.js";import{K as ve,v as N}from"./chunk-VZRSC3LP.js";import{b as _e}from"./chunk-5SKDOIBQ.js";import{a as Me}from"./chunk-K3W6YFKH.js";import{d as U}from"./chunk-EDXSOKK5.js";import{c as A}from"./chunk-CXQURQM5.js";import{Oc as Pe,Zc as Ie,eb as we,sd as Re}from"./chunk-Z4VHWOB5.js";import{a as Ue}from"./chunk-U54OSGNH.js";import{e as ke}from"./chunk-PZTBTDSR.js";import{L as J,O as Ee}from"./chunk-IOA4DPXY.js";import{Ad as Se,B as re,Db as c,Dc as y,Ea as l,Ia as oe,J as ae,L as X,La as L,Lb as le,Ma as w,Mc as M,Na as P,Oc as p,P as K,Rd as be,Sd as Te,Tb as R,Va as ce,Yc as he,Zb as k,Zc as fe,_c as xe,c as se,dd as s,f as j,ic as pe,kc as m,m as G,mc as H,n as E,oa as Q,oc as me,ra as b,s as g,sc as h,sd as Ce,tc as de,vc as ue,wb as I,wc as ge,xc as f,ya as v,yc as x,yd as D,z as _,zc as d,zd as q}from"./chunk-5LC5EQRR.js";var C=function(n){return n.NOT_EXECUTED="NOT_EXECUTED",n.SUCCESS="SUCCESS",n.FAIL="FAIL",n.NO_RESULT="NO_RESULT",n}(C||{}),tt=/<testid>(\d+)<\/testid>/,it=/,(?![^(]*?\))/,T=(()=>{class n{testStatusForTask=(e,i)=>{if(i?.successful&&(!i.feedbacks||!i.feedbacks.length)&&e)return{testCaseState:C.SUCCESS,detailed:{successfulTests:e,failedTests:[],notExecutedTests:[]}};if(i?.feedbacks?.length){let{failed:t,notExecuted:r,successful:o}=this.separateTests(e,i),u;return t.length>0?u=C.FAIL:r.length>0||e.length===0?u=C.NOT_EXECUTED:u=C.SUCCESS,{testCaseState:u,detailed:{successfulTests:o,failedTests:t,notExecutedTests:r}}}else return{testCaseState:C.NO_RESULT,detailed:{successfulTests:[],failedTests:[],notExecutedTests:e}}};separateTests(e,i){return e.reduce((t,r)=>{let o=i?.feedbacks?.find(u=>u.testCase?.id===r);return{failed:o?.positive===!1?[...t.failed,r]:t.failed,successful:o?.positive===!0?[...t.successful,r]:t.successful,notExecuted:o?.positive===void 0?[...t.notExecuted,r]:t.notExecuted}},{failed:[],successful:[],notExecuted:[]})}convertTestListToIds(e,i){return e.split(it).map(t=>t.trim()).map(t=>this.convertProblemStatementTextToTestId(t,i)??-1)}convertProblemStatementTextToTestId(e,i){let t=tt.exec(e);return t?parseInt(t[1]):i?.find(r=>r.testName===e)?.id}static \u0275fac=function(i){return new(i||n)};static \u0275prov=v({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var ne=new j,F=class n{resourceUrl="api/programming/plantuml";encoder;themeService=l(V);http=l(Ee);constructor(){this.encoder=new ie,be(()=>{this.themeService.currentTheme(),ne.next()})}getPlantUmlImage(a){return this.http.get(`${this.resourceUrl}/png`,{params:new J({encoder:this.encoder}).set("plantuml",a).set("useDarkTheme",this.themeService.currentTheme()===Y.DARK),responseType:"arraybuffer"}).pipe(_(e=>this.convertPlantUmlResponseToBase64(e)))}getPlantUmlSvg(a){return this.http.get(`${this.resourceUrl}/svg`,{params:new J({encoder:this.encoder}).set("plantuml",a).set("useDarkTheme",this.themeService.currentTheme()===Y.DARK),responseType:"text"})}convertPlantUmlResponseToBase64(a){return Buffer.from(a,"binary").toString("base64")}static \u0275fac=function(e){return new(e||n)};static \u0275prov=v({token:n,factory:n.\u0275fac,providedIn:"root"})};G([Z({maxCacheCount:100,maxAge:36e5,slidingExpiration:!0,cacheBusterObserver:ne}),E("design:type",Function),E("design:paramtypes",[String]),E("design:returntype",void 0)],F.prototype,"getPlantUmlImage",null);G([Z({maxCacheCount:100,maxAge:36e5,slidingExpiration:!0,cacheBusterObserver:ne}),E("design:type",Function),E("design:paramtypes",[String]),E("design:returntype",se)],F.prototype,"getPlantUmlSvg",null);var ie=class{encodeKey(a){return encodeURIComponent(a)}encodeValue(a){return encodeURIComponent(a)}decodeKey(a){return decodeURIComponent(a)}decodeValue(a){return decodeURIComponent(a)}};var nt=/testsColor\((\s*[^()\s]+(\([^()]*\))?)\)/g,Xe=(()=>{class n extends De{programmingExerciseInstructionService=l(T);plantUmlService=l(F);latestResult;testCases;injectableElementsFoundSubject=new j;plantUmlIndex=0;constructor(){super()}setLatestResult(e){this.latestResult=e}setTestCases(e){this.testCases=e}subscribeForInjectableElementsFound(){return this.injectableElementsFoundSubject.asObservable()}loadAndInjectPlantUml(e,i){this.plantUmlService.getPlantUmlSvg(e).pipe(b(t=>{let r=document.getElementById(`plantUml-${i}`);r&&(r.innerHTML=We.sanitize(t))})).subscribe()}replaceText(e){let i="%idPlaceholder%",t=/@startuml([^@]*)@enduml/g,r=`<div class="mb-4" id="plantUml-${i}"></div>`,u=(e.match(t)??[]).map(S=>{let O=this.plantUmlIndex;return this.plantUmlIndex++,{plantUmlId:O,plantUml:S}}),qe=u.reduce((S,O)=>S.replace(new RegExp(W(O.plantUml),"g"),r.replace(i,O.plantUmlId.toString())),e),Je=u.map(S=>(S.plantUml=S.plantUml.replace(nt,(O,Ye)=>{let Ze=this.programmingExerciseInstructionService.convertTestListToIds(Ye,this.testCases),{testCaseState:et}=this.programmingExerciseInstructionService.testStatusForTask(Ze,this.latestResult);switch(et){case C.SUCCESS:return"green";case C.FAIL:return"red";default:return"grey"}}),S));return this.injectableElementsFoundSubject.next(()=>{Je.forEach(S=>{this.loadAndInjectPlantUml(S.plantUml,S.plantUmlId)})}),qe}static \u0275fac=function(i){return new(i||n)};static \u0275prov=v({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var st=(n,a)=>({totalTests:n,passedTests:a});function rt(n,a){if(n&1&&(s(0,`
        `),d(1,"fa-icon",1),s(2,`
    `)),n&2){let e=p();c(),m("icon",e.farCheckCircle)}}function at(n,a){if(n&1&&(s(0,`
        `),d(1,"fa-icon",2),s(2,`
    `)),n&2){let e=p();c(),m("icon",e.farTimesCircle)}}function ot(n,a){if(n&1&&(s(0,`
        `),d(1,"fa-icon",3),s(2,`
    `)),n&2){let e=p();c(),m("icon",e.faCircleDot)}}function ct(n,a){if(n&1&&(s(0,`
        `),d(1,"span",4),D(2,"safeHtml"),s(3,`
    `)),n&2){let e=p();c(),m("innerHTML",q(2,1,e.taskName),I)}}function lt(n,a){if(n&1){let e=y();s(0,`
        `),f(1,"span",5),D(2,"artemisTranslate"),M("click",function(){w(e);let t=p();return P(t.showDetailsForTests())}),x(),s(3,`
    `)}if(n&2){let e=p();c(),me((e.testIds==null?null:e.testIds.length)===e.successfulTests.length?"text-success":e.failedTests.length?"text-danger":"text-secondary"),m("innerHTML",Se(2,3,e.translationBasePath+"totalTestsPassing",Ce(6,st,e.testIds.length,e.successfulTests.length)),I)}}function pt(n,a){if(n&1&&(s(0,`
        `),d(1,"span",6),D(2,"artemisTranslate"),s(3,`
    `)),n&2){let e=p();c(),m("innerHTML",q(2,1,e.translationBasePath+(e.testIds.length?"noResult":"noTests")),I)}}var Ke=(()=>{class n{programmingExerciseInstructionService=l(T);modalService=l(N);TestCaseState=C;translationBasePath="artemisApp.editor.testStatusLabels.";taskName;get testIds(){return this.testIdsValue}exercise;latestResult;testIdsValue;testCaseState;successfulTests;notExecutedTests;failedTests;hasMessage;faCircleDot=Oe;farCheckCircle=ze;farTimesCircle=je;set testIds(e){this.testIdsValue=e;let{testCaseState:i,detailed:{successfulTests:t,notExecutedTests:r,failedTests:o}}=this.programmingExerciseInstructionService.testStatusForTask(this.testIds,this.latestResult);this.testCaseState=i,this.successfulTests=t,this.notExecutedTests=r,this.failedTests=o,this.hasMessage=this.hasTestMessage(e)}hasTestMessage(e){if(!this.latestResult?.feedbacks)return!1;let i=this.latestResult.feedbacks;return e.some(t=>i.find(r=>r.testCase?.id===t&&r.detailText))}showDetailsForTests(){if(!this.latestResult)return;let i=this.modalService.open(B,{keyboard:!0,size:"lg"}).componentInstance;i.exercise=this.exercise,i.result=this.latestResult,i.feedbackFilter=this.testIds,i.exerciseType=A.PROGRAMMING,i.taskName=this.taskName,i.numberOfNotExecutedTests=this.notExecutedTests.length}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=R({type:n,selectors:[["jhi-programming-exercise-instructions-task-status"]],inputs:{taskName:"taskName",testIds:"testIds",exercise:"exercise",latestResult:"latestResult"},decls:9,vars:9,consts:[[1,"guided-tour"],["size","lg",1,"test-icon","text-success",3,"icon"],["size","lg",1,"test-icon","text-danger",3,"icon"],["size","lg",1,"test-icon","text-secondary",3,"icon"],[1,"task-name",3,"innerHTML"],[1,"guided-tour","test-status--linked",3,"click","innerHTML"],[1,"text-secondary",3,"innerHTML"]],template:function(i,t){i&1&&(f(0,"div",0),s(1,`
    `),k(2,rt,3,1)(3,at,3,1)(4,ot,3,1)(5,ct,4,3)(6,lt,4,9)(7,pt,4,3),x(),s(8,`
`)),i&2&&(H("success",t.testCaseState===t.TestCaseState.SUCCESS)("failed",t.testCaseState===t.TestCaseState.FAIL),c(2),h(t.testCaseState===t.TestCaseState.SUCCESS?2:-1),c(),h(t.testCaseState===t.TestCaseState.FAIL?3:-1),c(),h(t.testCaseState===t.TestCaseState.NO_RESULT||t.testCaseState===t.TestCaseState.NOT_EXECUTED?4:-1),c(),h(t.taskName?5:-1),c(),h(t.latestResult&&t.latestResult.feedbacks&&t.latestResult.feedbacks.length&&t.testIds.length?6:7))},dependencies:[U,Me,Ge],styles:[".test-status--linked[_ngcontent-%COMP%]{text-decoration:underline;cursor:pointer}.test-icon[_ngcontent-%COMP%], .task-name[_ngcontent-%COMP%]{font-weight:700}"]})}return n})();function mt(n,a){if(n&1&&(s(0,`
                            `),d(1,"fa-icon",7),s(2,`
                        `)),n&2){let e=p(2);c(),m("icon",e.faCheck)}}function dt(n,a){if(n&1&&(s(0,`
                            `),d(1,"fa-icon",8),s(2,`
                        `)),n&2){let e=p(2);c(),m("icon",e.faTimes)}}function ut(n,a){if(n&1&&(s(0,`
                            `),d(1,"fa-icon",9),s(2,`
                        `)),n&2){let e=p(2);c(),m("icon",e.faCircle)}}function gt(n,a){if(n&1){let e=y();s(0,`
                `),f(1,"div",5),s(2,`
                    `),s(3,`
                    `),f(4,"div",6),M("click",function(){let t=w(e).$implicit,r=p();return P(r.showDetailsForTests(t.testIds,t.title))}),s(5,`
                        `),k(6,mt,3,1)(7,dt,3,1)(8,ut,3,1),x(),s(9,`
                `),x(),s(10,`
            `)}if(n&2){let e=a.$implicit,i=p();c(4),H("stepwizard-step--success",e.done===i.TestCaseState.SUCCESS)("stepwizard-step--failed",e.done===i.TestCaseState.FAIL)("stepwizard-step--not-executed",e.done===i.TestCaseState.NOT_EXECUTED)("stepwizard-step--no-result",e.done===i.TestCaseState.NO_RESULT),m("ngbTooltip",e.title),c(2),h(e.done===i.TestCaseState.SUCCESS?6:-1),c(),h(e.done===i.TestCaseState.FAIL?7:-1),c(),h(e.done===i.TestCaseState.NOT_EXECUTED||e.done===i.TestCaseState.NO_RESULT?8:-1)}}var Qe=(()=>{class n{modalService=l(N);instructionService=l(T);TestCaseState=C;exercise;latestResult;tasks;steps;faTimes=Pe;faCheck=Re;faCircle=we;ngOnChanges(e){(e.tasks&&this.tasks||this.tasks&&e.latestResult)&&(this.steps=this.tasks.map(({taskName:i,testIds:t})=>({done:this.instructionService.testStatusForTask(t,this.latestResult).testCaseState,title:i,testIds:t})))}showDetailsForTests(e,i){if(!this.latestResult||!e.length)return;let{detailed:{notExecutedTests:t}}=this.instructionService.testStatusForTask(e,this.latestResult),o=this.modalService.open(B,{keyboard:!0,size:"lg"}).componentInstance;o.exercise=this.exercise,o.result=this.latestResult,o.feedbackFilter=e,o.exerciseType=A.PROGRAMMING,o.taskName=i,o.numberOfNotExecutedTests=t.length}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=R({type:n,selectors:[["jhi-programming-exercise-instructions-step-wizard"]],inputs:{exercise:"exercise",latestResult:"latestResult",tasks:"tasks"},features:[L],decls:15,vars:1,consts:[[1,"card-second-header",3,"hidden"],[1,"stepwizard"],["jhiTranslate","artemisApp.programmingExercise.problemStatement.tasksOfExercise",1,"stepwizard-title","pe-3"],[1,"stepwizard-row","position-relative"],[1,"stepwizard-row-line"],[1,"stepwizard-step"],[1,"btn","btn-circle",3,"click","ngbTooltip"],["size","lg",1,"text-success",3,"icon"],["size","lg",1,"text-danger",3,"icon"],["size","lg",1,"not-done",3,"icon"]],template:function(i,t){i&1&&(f(0,"div",0),s(1,`
    `),f(2,"div",1),s(3,`
        `),d(4,"div",2),s(5,`
        `),f(6,"div",3),s(7,`
            `),d(8,"hr",4),s(9,`
            `),ue(10,gt,11,12,null,null,de),x(),s(12,`
    `),x(),s(13,`
`),x(),s(14,`
`)),i&2&&(m("hidden",!(t.steps!=null&&t.steps.length)),c(10),ge(t.steps))},dependencies:[Ue,ve,U],styles:[".card-second-header[_ngcontent-%COMP%]{padding:1rem 1rem 0}.stepwizard[_ngcontent-%COMP%]{display:table;width:100%;position:relative}.stepwizard-title[_ngcontent-%COMP%]{display:table-cell;width:1%}.stepwizard-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:space-between}.stepwizard-step[_ngcontent-%COMP%]{display:table-cell;text-align:center;position:relative}.stepwizard-step[_ngcontent-%COMP%]   .fa[_ngcontent-%COMP%]{vertical-align:initial}.stepwizard-step[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:10px}.stepwizard-step[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{opacity:1!important;filter:alpha(opacity=100)!important;cursor:default}.stepwizard-step[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{cursor:default;background-color:var(--bs-card-bg);width:21px;height:21px;text-align:center;padding:0;font-size:.6rem;line-height:1;border-radius:15px;border-width:2px;border-color:#6c757d;display:inline-flex;align-items:center;justify-content:center}.stepwizard-step--no-result.btn[_ngcontent-%COMP%]{cursor:default}.stepwizard-step[_ngcontent-%COMP%]   .stepwizard-step--failed.btn[_ngcontent-%COMP%]{cursor:pointer;color:#dc3545;border-color:#dc3545}.stepwizard-step[_ngcontent-%COMP%]   .stepwizard-step--success.btn[_ngcontent-%COMP%]{cursor:pointer;color:#198754;border-color:#198754}.stepwizard-step[_ngcontent-%COMP%]   .stepwizard-step--no-result.btn[_ngcontent-%COMP%], .stepwizard-step[_ngcontent-%COMP%]   .btn.not-done[_ngcontent-%COMP%], .stepwizard-step[_ngcontent-%COMP%]   .stepwizard-step--not-executed.btn[_ngcontent-%COMP%]{color:#6c757d;font-size:.4rem}.test-passing[_ngcontent-%COMP%]{cursor:default!important}.test-passing[_ngcontent-%COMP%]:hover{background-color:var(--programming-exercise-instruction-step-wizard-test-passing-hover-color)}.stepwizard-row-line[_ngcontent-%COMP%]{position:absolute;top:50%;left:0;right:0;margin:0;border-top:3px solid #adb5bd}"]})}return n})();function ht(n,a){if(n&1){let e=y();s(0,`
            `),f(1,"jhi-exam-exercise-update-highlighter",3),M("problemStatementUpdateEvent",function(){w(e);let t=p(2);return P(t.renderUpdatedProblemStatement())}),x(),s(2,`
        `)}if(n&2){let e=p(2);c(),m("exercise",e.exercise)}}function ft(n,a){if(n&1&&(s(0,`
    `),f(1,"div",0),s(2,`
        `),d(3,"jhi-programming-exercise-instructions-step-wizard",1),s(4,`
        `),s(5,`
        `),k(6,ht,3,1),d(7,"div",2),s(8,`
    `),x(),s(9,`
`)),n&2){let e=p();c(3),m("exercise",e.exercise)("latestResult",e.latestResultValue)("tasks",e.tasks),c(3),h(e.exercise&&e.exercise.exerciseGroup?6:-1),c(),m("hidden",!e.renderedMarkdown)("innerHtml",e.renderedMarkdown,I)}}function xt(n,a){if(n&1&&(s(0,`
    `),f(1,"span",4),d(2,"fa-icon",5),x(),s(3,`
`)),n&2){let e=p();c(2),m("icon",e.faSpinner)}}var Gi=(()=>{class n{viewContainerRef=l(le);resultService=l(He);participationWebsocketService=l(ye);programmingExerciseTaskWrapper=l(Ae);programmingExercisePlantUmlWrapper=l(Xe);programmingExerciseParticipationService=l(Be);programmingExerciseGradingService=l(Ve);sanitizer=l(ke);programmingExerciseInstructionService=l(T);appRef=l(pe);injector=l(oe);themeService=l(V);exercise;participation;generateHtmlEvents;personalParticipation;onNoInstructionsAvailable=new ce;examExerciseUpdateHighlighterComponent;problemStatement;participationSubscription;testCasesSubscription;isInitial=!0;isLoading;latestResultValue;taskIndex=0;tasks;get latestResult(){return this.latestResultValue}set latestResult(e){this.latestResultValue=e,this.programmingExercisePlantUmlWrapper.setLatestResult(this.latestResultValue),this.programmingExercisePlantUmlWrapper.setTestCases(this.testCases)}renderedMarkdown;injectableContentForMarkdownCallbacks=[];markdownExtensions;injectableContentFoundSubscription;generateHtmlSubscription;testCases;themeChangeSubscription=_e(this.themeService.currentTheme).subscribe(()=>{this.isInitial||this.updateMarkdown()});faSpinner=Ie;constructor(){this.programmingExerciseTaskWrapper.viewContainerRef=this.viewContainerRef}ngOnChanges(e){this.exercise?.isAtLeastTutor&&(this.testCasesSubscription&&this.testCasesSubscription.unsubscribe(),this.testCasesSubscription=this.programmingExerciseGradingService.getTestCases(this.exercise.id).pipe(b(i=>{this.testCases=i})).subscribe()),g(!!this.markdownExtensions).pipe(b(i=>!i&&this.setupMarkdownSubscriptions()),_(()=>Le(e)),b(i=>{i&&(this.isInitial=!0,this.generateHtmlSubscription&&this.generateHtmlSubscription.unsubscribe(),this.generateHtmlEvents&&this.generateHtmlEvents.subscribe(()=>{this.updateMarkdown()}),this.setupResultWebsocket())}),Q(i=>!this.isLoading&&this.exercise&&this.participation&&(this.isInitial||i)?(this.isLoading=!0,g(this.exercise.problemStatement).pipe(b(t=>{if(!t)return this.onNoInstructionsAvailable.emit(),this.isLoading=!1,this.isInitial=!1,g(void 0)}),X(t=>!!t),b(t=>this.problemStatement=t),Q(()=>this.loadInitialResult()),b(t=>{this.latestResult=t}),b(()=>{this.updateMarkdown(),this.isInitial=!1,this.isLoading=!1}))):ee(e)&&this.problemStatement===void 0?(this.latestResult=this.latestResultValue,this.problemStatement=this.exercise.problemStatement,this.updateMarkdown(),g(void 0)):this.exercise&&ee(e)?(this.latestResult=this.latestResultValue,this.problemStatement=this.exercise.problemStatement,g(void 0)):g(void 0))).subscribe()}setupMarkdownSubscriptions(){this.markdownExtensions=[this.programmingExerciseTaskWrapper.getExtension(),this.programmingExercisePlantUmlWrapper.getExtension()],this.injectableContentFoundSubscription&&this.injectableContentFoundSubscription.unsubscribe(),this.injectableContentFoundSubscription=ae(this.programmingExercisePlantUmlWrapper.subscribeForInjectableElementsFound()).subscribe(e=>{this.injectableContentForMarkdownCallbacks=[...this.injectableContentForMarkdownCallbacks,e]})}setupResultWebsocket(){this.participationSubscription&&this.participationSubscription.unsubscribe(),this.participationSubscription=this.participationWebsocketService.subscribeForLatestResultOfParticipation(this.participation.id,this.personalParticipation,this.exercise.id).pipe(X(e=>!!e)).subscribe(e=>{this.latestResult=e,this.programmingExercisePlantUmlWrapper.setLatestResult(this.latestResult),this.updateMarkdown()})}updateMarkdown(){this.latestResult=this.latestResultValue,this.injectableContentForMarkdownCallbacks=[],this.renderMarkdown()}renderUpdatedProblemStatement(){this.updateMarkdown()}loadInitialResult(){if(this.participation?.id&&this.participation?.results?.length){let e=Fe(this.participation.results);return e?(e.participation=this.participation,e.feedbacks?g(e):this.loadAndAttachResultDetails(e)):g(void 0)}else return this.participation&&this.participation.id?this.loadLatestResult():g(void 0)}loadLatestResult(){return this.programmingExerciseParticipationService.getLatestResultWithFeedback(this.participation.id,!0).pipe(K(()=>g(void 0)),re(e=>e&&!e.feedbacks?this.loadAndAttachResultDetails(e):g(e)))}loadAndAttachResultDetails(e){let i=e.participation?e.participation:this.participation;return this.resultService.getFeedbackDetailsForResult(i.id,e).pipe(_(t=>t&&t.body),_(t=>(e.feedbacks=t,e)),K(()=>g(e)))}renderMarkdown(){if(this.examExerciseUpdateHighlighterComponent?.showHighlightedDifferences&&this.examExerciseUpdateHighlighterComponent.outdatedProblemStatement&&this.examExerciseUpdateHighlighterComponent.updatedProblemStatement){let e=$(this.examExerciseUpdateHighlighterComponent.outdatedProblemStatement,this.markdownExtensions),i=$(this.examExerciseUpdateHighlighterComponent.updatedProblemStatement,this.markdownExtensions),t=$e(e,i),r=this.prepareTasks(t),o=this.addStylesForTables(r);this.renderedMarkdown=this.sanitizer.bypassSecurityTrustHtml(o??r),setTimeout(()=>{let u=this.injectableContentForMarkdownCallbacks[this.injectableContentForMarkdownCallbacks.length-1];u&&u(),this.injectTasksIntoDocument()},0)}else if(this.exercise?.problemStatement){this.injectableContentForMarkdownCallbacks=[];let e=$(this.exercise.problemStatement,this.markdownExtensions),i=this.prepareTasks(e),t=this.addStylesForTables(i);this.renderedMarkdown=this.sanitizer.bypassSecurityTrustHtml(t??i),setTimeout(()=>{this.injectableContentForMarkdownCallbacks.forEach(r=>{r()}),this.injectTasksIntoDocument()},0)}}addStylesForTables(e){if(e?.includes("<table")){let t=new DOMParser().parseFromString(e,"text/html");return t.querySelectorAll("table").forEach(o=>{o.style.maxWidth="100%",o.style.overflowX="scroll",o.style.display="block"}),t.body.innerHTML}else return}prepareTasks(e){let i=Array.from(e.matchAll(Ne));return i?(this.tasks=i.filter(t=>t?.length===3).map(t=>{let r=this.taskIndex;return this.taskIndex++,{id:r,completeString:t[0],taskName:t[1],testIds:t[2]?this.programmingExerciseInstructionService.convertTestListToIds(t[2],this.testCases):[]}}),this.tasks.reduce((t,{completeString:r,id:o})=>t.replace(new RegExp(W(r),"g"),`<div class="pe-${this.exercise.id}-task-${o.toString()} d-flex">&#8203;</div>`),e)):e}injectTasksIntoDocument=()=>{this.tasks.forEach(({id:e,taskName:i,testIds:t})=>{let r=document.getElementsByClassName(`pe-${this.exercise.id}-task-${e}`);for(let o=0;o<r.length;o++){let u=r[o];this.createTaskComponent(u,i,t)}})};createTaskComponent(e,i,t){let r=Te(Ke,{hostElement:e,environmentInjector:this.injector});r.instance.exercise=this.exercise,r.instance.taskName=i,r.instance.latestResult=this.latestResult,r.instance.testIds=t,this.appRef.attachView(r.hostView),r.changeDetectorRef.detectChanges()}ngOnDestroy(){this.participationSubscription&&this.participationSubscription.unsubscribe(),this.generateHtmlSubscription&&this.generateHtmlSubscription.unsubscribe(),this.injectableContentFoundSubscription&&this.injectableContentFoundSubscription.unsubscribe(),this.testCasesSubscription&&this.testCasesSubscription.unsubscribe(),this.themeChangeSubscription&&this.themeChangeSubscription.unsubscribe()}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=R({type:n,selectors:[["jhi-programming-exercise-instructions"]],viewQuery:function(i,t){if(i&1&&he(te,5),i&2){let r;fe(r=xe())&&(t.examExerciseUpdateHighlighterComponent=r.first)}},inputs:{exercise:"exercise",participation:"participation",generateHtmlEvents:"generateHtmlEvents",personalParticipation:"personalParticipation"},outputs:{onNoInstructionsAvailable:"onNoInstructionsAvailable"},features:[L],decls:2,vars:1,consts:[[1,"instructions__content","border-0"],[3,"exercise","latestResult","tasks"],["id","programming-exercise-instructions-content",1,"guided-tour","instructions__content__markdown","markdown-preview",3,"hidden","innerHtml"],[3,"problemStatementUpdateEvent","exercise"],["id","programming-exercise-instructions-loading",1,"d-flex","justify-content-center","mt-2"],["size","lg","animation","spin",3,"icon"]],template:function(i,t){i&1&&k(0,ft,10,6)(1,xt,4,1),i&2&&h(t.isLoading?1:0)},dependencies:[Qe,te,U],styles:[`.instructions[_ngcontent-%COMP%], .instructions__content[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;flex:1 1 auto;height:100%}.instructions__content__markdown[_ngcontent-%COMP%]{height:inherit;overflow:auto;padding:1rem}



`]})}return n})();export{Gi as a};
//# sourceMappingURL=chunk-A2A6JFSH.js.map
