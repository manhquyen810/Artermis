import{G as b}from"./chunk-IOA4DPXY.js";import{Ba as l,Da as n,Ea as v,Fa as M,L as O,Wa as m,_ as D,f as g,fb as S,gc as N,la as R,oa as F,s as a,ya as c}from"./chunk-5LC5EQRR.js";var o=function(t){return t.Local="local_strategy",t.Session="session_strategy",t.InMemory="in_memory_strategy",t}(o||{}),w=class{static isStorageAvailable(s){let e=!0;try{typeof s=="object"?(s.setItem("test-storage","foobar"),s.removeItem("test-storage")):e=!1}catch{e=!1}return e}};function C(){}var G="ngx-webstorage",$="|",J=!1,u=(()=>{class t{static{this.prefix=G}static{this.separator=$}static{this.isCaseSensitive=J}static normalize(e){return e=t.isCaseSensitive?e:e.toLowerCase(),`${t.prefix}${t.separator}${e}`}static isNormalizedKey(e){return e.indexOf(t.prefix+t.separator)===0}static setPrefix(e){t.prefix=e}static setSeparator(e){t.separator=e}static setCaseSensitive(e){t.isCaseSensitive=e}static consumeConfiguration(e){"prefix"in e&&this.setPrefix(e.prefix),"separator"in e&&this.setSeparator(e.separator),"caseSensitive"in e&&this.setCaseSensitive(e.caseSensitive)}}return t})(),h=class{constructor(s){this.strategy=s}retrieve(s){let e;return this.strategy.get(u.normalize(s)).subscribe(i=>e=typeof i>"u"?null:i),e}store(s,e){return this.strategy.set(u.normalize(s),e).subscribe(C),e}clear(s){s!==void 0?this.strategy.del(u.normalize(s)).subscribe(C):this.strategy.clear().subscribe(C)}getStrategyName(){return this.strategy.name}observe(s){return s=u.normalize(s),this.strategy.keyChanges.pipe(O(e=>e===null||e===s),F(()=>this.strategy.get(s)),D(),R({refCount:!0,bufferSize:1}))}};var E=(()=>{class t{constructor(){this.caches={}}get(e,i){return this.getCacheStore(e)[i]}set(e,i,r){this.getCacheStore(e)[i]=r}del(e,i){delete this.getCacheStore(e)[i]}clear(e){this.caches[e]={}}getCacheStore(e){return e in this.caches?this.caches[e]:this.caches[e]={}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=c({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),V=new l("window_local_storage");function U(){return typeof window<"u"?window.localStorage:null}var q={provide:V,useFactory:U},Z=new l("window_session_storage");function B(){return typeof window<"u"?window.sessionStorage:null}var Q={provide:Z,useFactory:B},y=class{constructor(s,e){this.storage=s,this.cache=e,this.keyChanges=new g}get isAvailable(){return this._isAvailable===void 0&&(this._isAvailable=w.isStorageAvailable(this.storage)),this._isAvailable}get(s){let e=this.cache.get(this.name,s);if(e!==void 0)return a(e);try{let i=this.storage.getItem(s);i!==null&&(e=JSON.parse(i),this.cache.set(this.name,s,e))}catch(i){console.warn(i)}return a(e)}set(s,e){let i=JSON.stringify(e);return this.storage.setItem(s,i),this.cache.set(this.name,s,e),this.keyChanges.next(s),a(e)}del(s){return this.storage.removeItem(s),this.cache.del(this.name,s),this.keyChanges.next(s),a(null)}clear(){return this.storage.clear(),this.cache.clear(this.name),this.keyChanges.next(null),a(null)}},x=class t extends y{static{this.strategyName=o.Local}constructor(s,e,i,r){super(s,e),this.storage=s,this.cache=e,this.platformId=i,this.zone=r,this.name=t.strategyName,b(this.platformId)&&this.listenExternalChanges()}listenExternalChanges(){window.addEventListener("storage",s=>this.zone.run(()=>{if(s.storageArea!==this.storage)return;let e=s.key;e!==null?this.cache.del(this.name,s.key):this.cache.clear(this.name),this.keyChanges.next(e)}))}static{this.\u0275fac=function(e){return new(e||t)(n(V),n(E),n(S),n(m))}}static{this.\u0275prov=c({token:t,factory:t.\u0275fac})}},j=class t extends y{static{this.strategyName=o.Session}constructor(s,e,i,r){super(s,e),this.storage=s,this.cache=e,this.platformId=i,this.zone=r,this.name=t.strategyName,b(this.platformId)&&this.listenExternalChanges()}listenExternalChanges(){window.addEventListener("storage",s=>this.zone.run(()=>{if(s.storageArea!==this.storage)return;let e=s.key;s.key!==null?this.cache.del(this.name,s.key):this.cache.clear(this.name),this.keyChanges.next(e)}))}static{this.\u0275fac=function(e){return new(e||t)(n(Z),n(E),n(S),n(m))}}static{this.\u0275prov=c({token:t,factory:t.\u0275fac})}},I=class t{static{this.strategyName=o.InMemory}constructor(s){this.cache=s,this.keyChanges=new g,this.isAvailable=!0,this.name=t.strategyName}get(s){return a(this.cache.get(this.name,s))}set(s,e){return this.cache.set(this.name,s,e),this.keyChanges.next(s),a(e)}del(s){return this.cache.del(this.name,s),this.keyChanges.next(s),a(null)}clear(){return this.cache.clear(this.name),this.keyChanges.next(null),a(null)}static{this.\u0275fac=function(e){return new(e||t)(n(E))}}static{this.\u0275prov=c({token:t,factory:t.\u0275fac})}},p=new l("STORAGE_STRATEGIES"),X=[{provide:p,useClass:I,multi:!0},{provide:p,useClass:x,multi:!0},{provide:p,useClass:j,multi:!0}],[Y,H,W]=X;var T="invalid_strategy",A=(()=>{class t{static{this.index={}}constructor(e){this.strategies=e,this.registration$=new g,e||(e=[]),this.strategies=e.reverse().map((i,r,d)=>i.name).map((i,r,d)=>d.indexOf(i)===r?r:null).filter(i=>i!==null).map(i=>e[i])}static get(e){if(!this.isStrategyRegistered(e))throw Error(T);let i=this.index[e];return i.isAvailable||(i=this.index[o.InMemory]),i}static set(e,i){this.index[e]=i}static clear(e){e!==void 0?delete this.index[e]:this.index={}}static isStrategyRegistered(e){return e in this.index}static hasRegistredStrategies(){return Object.keys(this.index).length>0}getStrategy(e){return t.get(e)}indexStrategies(){this.strategies.forEach(e=>this.register(e.name,e))}indexStrategy(e,i=!1){if(t.isStrategyRegistered(e)&&!i)return t.get(e);let r=this.strategies.find(d=>d.name===e);if(!r)throw new Error(T);return this.register(e,r,i),r}register(e,i,r=!1){(!t.isStrategyRegistered(e)||r)&&(t.set(e,i),this.registration$.next(e))}static{this.\u0275fac=function(i){return new(i||t)(n(p,8))}}static{this.\u0275prov=c({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),k=class extends h{};function _(t){let s=t.indexStrategy(o.Local);return new h(s)}var K={provide:k,useFactory:_,deps:[A]},z=class extends h{};function ee(t){let s=t.indexStrategy(o.Session);return new h(s)}var te={provide:z,useFactory:ee,deps:[A]};var L=new l("ngx_webstorage_config"),f=function(t){return t[t.Config=1]="Config",t[t.LocalStorage=2]="LocalStorage",t[t.SessionStorage=3]="SessionStorage",t}(f||{});function se(){let t=v(L),s=v(A);return()=>{u.consumeConfiguration(t),s.indexStrategies()}}function de(...t){let{configProvider:s,featureProviders:e}=ie(t);return M([s,Y,N(()=>se()()),...e])}function ie(t){let s,e=[],i=new Set;for(let r of t){if(i.has(r.kind))throw new Error(`Feature ${r.kind} is already provided.`);r.kind===f.Config?s=r.providers[0]:e.push(...r.providers),i.add(r.kind)}return{configProvider:s??{provide:L,useValue:{prefix:G,separator:$,caseSensitive:J}},featureProviders:e}}function P(t,s){return{kind:t,providers:s}}function ge(t){return P(f.Config,[{provide:L,useValue:t}])}function pe(){return P(f.LocalStorage,[q,K,H])}function ye(){return P(f.SessionStorage,[Q,te,W])}export{k as a,z as b,de as c,ge as d,pe as e,ye as f};
//# sourceMappingURL=chunk-XUCCGZJR.js.map
