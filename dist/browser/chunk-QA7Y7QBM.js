import{p as i}from"./chunk-DID2YGL7.js";import{O as a}from"./chunk-IOA4DPXY.js";import{Ea as h,ya as o}from"./chunk-5LC5EQRR.js";var D=(()=>{class n{resourceUrl;recentOffsets;recentClientDates;http;constructor(){let t=h(a);this.http=t,this.resourceUrl="api/core/public/time",this.recentOffsets=new Array,this.recentClientDates=new Array}updateTime(){let t,e=i(new Date);this.recentClientDates.length>4?t=this.recentClientDates.some(s=>Math.abs(e.diff(s,"s"))>60):t=!0,t&&this.http.get(this.resourceUrl).subscribe(s=>{this.setServerDate(s)})}setServerDate(t){let e=i(t),s=i();this.recentClientDates.push(s);let r=e.diff(s,"ms");this.recentOffsets.push(r),this.recentOffsets.length>5&&(this.recentOffsets.shift(),this.recentClientDates.shift())}now(){let t=i();if(this.recentOffsets.length===0)return t;let e=this.recentOffsets[0];if(this.recentOffsets.length===5){let r=[...this.recentOffsets].sort((f,c)=>c-f);r.shift(),r.pop(),e=r.reduce((f,c)=>f+c)/r.length}return t.add(e,"ms")}static \u0275fac=function(e){return new(e||n)};static \u0275prov=o({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();export{D as a};
//# sourceMappingURL=chunk-QA7Y7QBM.js.map
