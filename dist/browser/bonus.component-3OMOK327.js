import{a as Ne}from"./chunk-R7WDKVQG.js";import{a as U,b as C,c as Ae}from"./chunk-7WZTW6CZ.js";import{a as Me}from"./chunk-TRIJ3OLY.js";import{a as Pe}from"./chunk-ZR3WKJ5U.js";import{a as we}from"./chunk-GRLLGFUW.js";import"./chunk-XUG3TIT6.js";import"./chunk-TDPG6WFH.js";import"./chunk-PTO7UATL.js";import{a as Oe}from"./chunk-FLZTDUOG.js";import{a as Ie}from"./chunk-WIZ2YSLS.js";import"./chunk-BIK4CL5A.js";import{a as Ge}from"./chunk-W7RIOT23.js";import{b as ve}from"./chunk-T624HJJL.js";import"./chunk-HQTS6JOY.js";import"./chunk-HMZID6NQ.js";import{b as Ee}from"./chunk-O26CMRR4.js";import"./chunk-MP6UGYTC.js";import{a as Be}from"./chunk-2QXIMOEO.js";import"./chunk-AR57MWOI.js";import"./chunk-A5PTZAPN.js";import"./chunk-AU6UEH3U.js";import"./chunk-FGAONQTL.js";import"./chunk-HQ6UGNQX.js";import"./chunk-ZLJ76G5I.js";import"./chunk-MLVGKM2P.js";import"./chunk-CK7FH6VF.js";import"./chunk-PUNMJFMR.js";import"./chunk-R75LTV62.js";import"./chunk-5MVJAZRV.js";import"./chunk-XBLNBTXN.js";import"./chunk-G3JOQOSD.js";import"./chunk-G4I63THF.js";import"./chunk-PZ7IDTIM.js";import"./chunk-CT44YL7Q.js";import"./chunk-5YQ3ACZE.js";import"./chunk-EELXLOHY.js";import{K as ue,L as pe}from"./chunk-VZRSC3LP.js";import"./chunk-5SKDOIBQ.js";import{B as de,K as ce,c as ie,h as oe,m as ae,o as re,w as se,x as le,z as me}from"./chunk-WA5GEAJB.js";import"./chunk-5GXY5RYT.js";import{a as fe}from"./chunk-K3W6YFKH.js";import{c as Ce}from"./chunk-JXJXC4DZ.js";import{d as be,f as Te}from"./chunk-EDXSOKK5.js";import"./chunk-R5BZWVRQ.js";import"./chunk-DID2YGL7.js";import"./chunk-CXQURQM5.js";import"./chunk-S4QLGR2R.js";import{Lc as ge,Oc as Se,kb as xe,tb as _e,wd as he}from"./chunk-Z4VHWOB5.js";import"./chunk-XUCCGZJR.js";import"./chunk-HKBU2OOC.js";import"./chunk-5ZXXURLP.js";import"./chunk-NOBD5HSR.js";import{a as ye}from"./chunk-U54OSGNH.js";import{f as te,h as ne}from"./chunk-M6Z6DKZQ.js";import"./chunk-3Y6745HG.js";import"./chunk-E2KBL4LX.js";import"./chunk-PZTBTDSR.js";import{E as ee,t as Z}from"./chunk-IOA4DPXY.js";import{Bd as z,Cc as L,Db as i,Dc as E,Ea as B,Ed as $,F as J,Ma as S,Mc as y,Na as h,Oc as m,P as R,Tb as q,Zb as x,aa as M,cd as P,dd as e,ed as f,f as K,fd as W,gd as X,hd as F,id as k,kc as c,ld as G,md as I,nd as O,qd as j,ra as A,rd as Y,s as Q,sc as p,uc as N,vc as D,wb as T,wc as V,xc as a,yc as r,yd as _,zc as l,zd as g}from"./chunk-5LC5EQRR.js";import"./chunk-3E746U5Y.js";var De=()=>({translationKey:"artemisApp.bonus.bonusStrategy.helpText"}),Ve=()=>({translationKey:"artemisApp.bonus.calculation.helpText"}),Le=()=>({translationKey:"artemisApp.bonus.bonusSource.helpText"}),je=n=>({maxPossibleGrade:n});function Ue(n,d){if(n&1&&(l(0,"span",11),_(1,"artemisTranslate"),_(2,"safeHtml")),n&2){let t=m().translationKey;c("innerHTML",g(2,3,g(1,1,t)),T)}}function He(n,d){if(n&1&&(e(0,`
        `),l(1,"fa-icon",12),e(2,`
    `)),n&2){m();let t=P(2),o=m();i(),c("icon",o.faQuestionCircle)("ngbTooltip",t)}}function Re(n,d){if(n&1&&(e(0,`
        `),a(1,"div",13),e(2,`
            `),l(3,"fa-icon",14),e(4,`
            `),l(5,"label",15),_(6,"artemisTranslate"),_(7,"safeHtml"),e(8,`
        `),r(),e(9,`
    `)),n&2){let t=m().translationKey,o=m();i(3),c("icon",o.faQuestionCircle),i(2),c("innerHTML",g(7,4,g(6,2,t)),T)}}function We(n,d){if(n&1&&(e(0,`
    `),x(1,Ue,3,5,"ng-template",null,1,$),e(3,`
    `),x(4,He,3,2)(5,Re,10,6)),n&2){let t=m();i(4),p(t.bonus.id?4:-1),i(),p(t.bonus.id?-1:5)}}function Fe(n,d){if(n&1){let t=E();e(0,`
        `),a(1,"div",4),e(2,`
            `),l(3,"div",5),e(4,`
            `),a(5,"div",6),e(6,`
                `),l(7,"label",16),e(8,`
                `),L(9,8),e(10,`
                `),a(11,"jhi-mode-picker",9),O("valueChange",function(s){S(t);let u=m();return I(u.bonus.weight,s)||(u.bonus.weight=s),h(s)}),y("valueChange",function(){S(t);let s=m();return h(s.onWeightChange())}),r(),e(12,`
            `),r(),e(13,`
        `),r(),e(14,`
    `)}if(n&2){let t=m(),o=P(1);i(9),c("ngTemplateOutlet",o)("ngTemplateOutletContext",j(4,Ve)),i(2),c("options",t.calculationSigns),G("value",t.bonus.weight)}}function ke(n,d){if(n&1&&(e(0,`
                        `),a(1,"option",19),e(2),r(),e(3,`
                    `)),n&2){let t=d.$implicit,o=m(2);i(),c("ngValue",t),i(),f(o.getGradingScaleTitle(t))}}function ze(n,d){if(n&1){let t=E();e(0,`
        `),a(1,"div",4),e(2,`
            `),l(3,"div",5),e(4,`
            `),a(5,"div",6),e(6,`
                `),l(7,"label",17),e(8,`
                `),L(9,8),e(10,`
                `),a(11,"select",18),_(12,"artemisTranslate"),O("ngModelChange",function(s){S(t);let u=m();return I(u.bonus.sourceGradingScale,s)||(u.bonus.sourceGradingScale=s),h(s)}),y("ngModelChange",function(s){S(t);let u=m();return h(u.onBonusSourceChange(s))}),e(13,`
                    `),D(14,ke,4,2,null,null,N),r(),e(16,`
            `),r(),e(17,`
        `),r(),e(18,`
    `)}if(n&2){let t=m(),o=P(1);i(9),c("ngTemplateOutlet",o)("ngTemplateOutletContext",j(6,Le)),i(2),G("ngModel",t.bonus.sourceGradingScale),c("title",g(12,4,"artemisApp.bonus.bonusSource.title")),i(3),V(t.sourceGradingScales)}}function $e(n,d){n&1&&(e(0,`
                    `),l(1,"jhi-help-icon",25),e(2,`
                `))}function Ke(n,d){n&1&&(e(0,`
                                `),l(1,"th",26),e(2,`
                            `))}function Qe(n,d){if(n&1&&(e(0,`
                                    `),a(1,"td"),e(2,`
                                        `),l(3,"span",11),_(4,"gradeStepBounds"),_(5,"safeHtml"),e(6,`
                                    `),r(),e(7,`
                                `)),n&2){let t=m(),o=t.$implicit,s=t.$index,u=t.$count,w=m(2);i(3),c("innerHTML",g(5,5,z(4,1,o,w.GradeEditMode.POINTS,s===u-1)),T)}}function Je(n,d){if(n&1&&(e(0,`
                            `),a(1,"tr"),e(2,`
                                `),a(3,"td"),e(4),r(),e(5,`
                                `),a(6,"td"),e(7,`
                                    `),l(8,"span",11),_(9,"gradeStepBounds"),_(10,"safeHtml"),e(11,`
                                `),r(),e(12,`
                                `),x(13,Qe,8,7),r(),e(14,`
                        `)),n&2){let t=d.$implicit,o=d.$index,s=d.$count,u=m(2);i(4),f(t.gradeName),i(4),c("innerHTML",g(10,7,z(9,3,t,u.GradeEditMode.PERCENTAGE,o===s-1)),T),i(5),p(u.hasPointsSet()?13:-1)}}function qe(n,d){if(n&1&&(e(0,`
            `),a(1,"div",20),e(2,`
                `),a(3,"span"),e(4),_(5,"artemisTranslate"),r(),e(6,`
                `),x(7,$e,3,0),r(),e(8,`
            `),a(9,"div",21),e(10,`
                `),a(11,"table",22),e(12,`
                    `),a(13,"thead"),e(14,`
                        `),a(15,"tr"),e(16,`
                            `),l(17,"th",23),e(18,`
                            `),l(19,"th",24),e(20,`
                            `),x(21,Ke,3,0),r(),e(22,`
                    `),r(),e(23,`
                    `),a(24,"tbody"),e(25,`
                        `),D(26,Je,15,9,null,null,N),r(),e(28,`
                `),r(),e(29,`
            `),r(),e(30,`
        `)),n&2){let t=m();i(4),X("",g(5,4,"artemisApp.bonus.bonusSource.maxPoints"),": ",t.getGradingScaleMaxPoints(t.bonus.sourceGradingScale),""),i(3),p(t.bonus.sourceGradingScale!=null&&t.bonus.sourceGradingScale.course?7:-1),i(14),p(t.hasPointsSet()?21:-1),i(5),V(t.bonus.sourceGradingScale==null?null:t.bonus.sourceGradingScale.gradeSteps)}}function Xe(n,d){n&1&&(e(0,`
                        `),l(1,"div",37),e(2,`
                    `))}function Ye(n,d){if(n&1&&(e(0,`
                `),a(1,"div",31),e(2,`
                    `),a(3,"div",32),e(4,`
                        `),a(5,"div",33),e(6,`
                            `),a(7,"strong",11),_(8,"artemisTranslate"),_(9,"safeHtml"),e(10,"Exam"),l(11,"br"),e(12,"Grade"),r(),e(13,`
                        `),r(),e(14,`
                        `),a(15,"div",34),e(16,`
                            `),a(17,"strong",35),e(18),r(),e(19,`
                        `),r(),e(20,`
                        `),a(21,"div",34),l(22,"strong",11),_(23,"artemisTranslate"),_(24,"safeHtml"),r(),e(25,`
                        `),a(26,"div",34)(27,"strong",35),e(28,"="),r()(),e(29,`
                        `),a(30,"div",34),e(31,`
                            `),l(32,"strong",11),_(33,"artemisTranslate"),_(34,"safeHtml"),e(35,`
                        `),r(),e(36,`
                    `),r(),e(37,`
                    `),x(38,Xe,3,0),l(39,"div",36),e(40,`
                `),r(),e(41,`
            `)),n&2){let t=m(2);i(7),c("innerHTML",g(9,8,g(8,6,"artemisApp.bonus.formula."+(t.bonus.bonusStrategy===t.BonusStrategy.POINTS?"examPoints":"examGrade"))),T),i(11),f(t.getCalculationSign(t.bonus.weight)),i(4),c("innerHTML",g(24,12,g(23,10,"artemisApp.bonus.formula.bonusGrade")),T),i(10),c("innerHTML",g(34,16,g(33,14,"artemisApp.bonus.formula."+(t.bonus.bonusStrategy===t.BonusStrategy.POINTS?"finalPoints":"finalGrade"))),T),i(6),p(t.bonus.bonusStrategy===t.BonusStrategy.POINTS?38:-1),i(),c("translateValues",Y(18,je,t.maxPossibleGrade()))}}function Ze(n,d){n&1&&(e(0,`
                `),l(1,"div",38),e(2,`
            `))}function et(n,d){n&1&&(e(0,`
                                    `),l(1,"th",48),e(2,`
                                `))}function tt(n,d){if(n&1&&(e(0,`
                                                `),l(1,"fa-icon",49),_(2,"artemisTranslate"),e(3,`
                                            `)),n&2){let t=m(5);i(),c("icon",t.faExclamationTriangle)("ngbTooltip",g(2,2,"artemisApp.bonus.examples.exceedsMax"))}}function nt(n,d){if(n&1&&(e(0,`
                                        `),a(1,"td"),e(2),x(3,tt,4,4),r(),e(4,`
                                    `)),n&2){let t=m().$implicit,o=m(3);i(2),k(`
                                            `,t.studentPointsOfBonusTo," ",o.getCalculationSign(o.bonus.weight)," ",t.bonusGrade," = ",t.finalPoints,`
                                            `),i(),p(t.exceedsMax?3:-1)}}function it(n,d){if(n&1&&e(0),n&2){let t=m().$implicit,o=m(3);F(`
                                            `,t.examGrade," ",o.getCalculationSign(o.bonus.weight)," ",t.bonusGrade,` =
                                        `)}}function ot(n,d){if(n&1&&(e(0,`
                                            `),l(1,"fa-icon",49),_(2,"artemisTranslate"),e(3,`
                                        `)),n&2){let t=m(4);i(),c("icon",t.faExclamationTriangle)("ngbTooltip",g(2,2,"artemisApp.bonus.examples.exceedsMax"))}}function at(n,d){if(n&1&&(e(0,`
                                `),a(1,"tr"),e(2,`
                                    `),a(3,"td"),e(4),r(),e(5,`
                                    `),a(6,"td"),e(7),r(),e(8,`
                                    `),a(9,"td"),e(10),_(11,"artemisTranslate"),r(),e(12,`
                                    `),a(13,"td"),e(14),r(),e(15,`
                                    `),x(16,nt,5,5),a(17,"td"),e(18,`
                                        `),x(19,it,1,3),e(20),x(21,ot,4,4),r(),e(22,`
                                `),r(),e(23,`
                            `)),n&2){let t,o=d.$implicit,s=m(3);i(4),f(o.studentPointsOfBonusTo),i(3),f(o.examGrade),i(3),f((t=o.studentPointsOfBonusSource)!==null&&t!==void 0?t:g(11,8,"artemisApp.bonus.examples.any")),i(4),f(o.bonusGrade),i(2),p(s.bonus.bonusStrategy===s.BonusStrategy.POINTS?16:-1),i(3),p(s.bonus.bonusStrategy===s.BonusStrategy.GRADES_CONTINUOUS?19:-1),i(),W(`
                                        `,o.finalGrade,`
                                        `),i(),p(s.bonus.bonusStrategy!==s.BonusStrategy.POINTS&&o.exceedsMax?21:-1)}}function rt(n,d){if(n&1&&(e(0,`
                                                `),l(1,"fa-icon",49),_(2,"artemisTranslate"),e(3,`
                                            `)),n&2){let t=m(5);i(),c("icon",t.faExclamationTriangle)("ngbTooltip",g(2,2,"artemisApp.bonus.examples.exceedsMax"))}}function st(n,d){if(n&1&&(e(0),x(1,rt,4,4)),n&2){let t=m(4);k(`
                                            `,t.dynamicExample.studentPointsOfBonusTo," ",t.getCalculationSign(t.bonus.weight)," ",t.dynamicExample.bonusGrade,` =
                                            `,t.dynamicExample.finalPoints,`
                                            `),i(),p(t.dynamicExample.exceedsMax?1:-1)}}function lt(n,d){if(n&1&&(e(0,`
                                    `),a(1,"td"),e(2,`
                                        `),x(3,st,2,5),r(),e(4,`
                                `)),n&2){let t=m(3);i(3),p(t.dynamicExample.finalPoints!==void 0?3:-1)}}function mt(n,d){if(n&1&&e(0),n&2){let t=m(3);F(`
                                        `,t.dynamicExample.examGrade," ",t.getCalculationSign(t.bonus.weight)," ",t.dynamicExample.bonusGrade,`
                                        =
                                    `)}}function dt(n,d){if(n&1&&(e(0,`
                                        `),l(1,"fa-icon",49),_(2,"artemisTranslate"),e(3,`
                                    `)),n&2){let t=m(3);i(),c("icon",t.faExclamationTriangle)("ngbTooltip",g(2,2,"artemisApp.bonus.examples.exceedsMax"))}}function ct(n,d){if(n&1){let t=E();e(0,`
                `),a(1,"div"),e(2,`
                    `),l(3,"h5",39),e(4,`
                    `),l(5,"p",40),e(6,`
                    `),a(7,"table",22),e(8,`
                        `),a(9,"thead"),e(10,`
                            `),a(11,"tr"),e(12,`
                                `),l(13,"th",41),e(14,`
                                `),l(15,"th",42),e(16,`
                                `),l(17,"th",43),e(18,`
                                `),l(19,"th",44),e(20,`
                                `),x(21,et,3,0),l(22,"th",45),e(23,`
                            `),r(),e(24,`
                        `),r(),e(25,`
                        `),a(26,"tbody"),e(27,`
                            `),D(28,at,24,10,null,null,N),a(30,"tr"),e(31,`
                                `),a(32,"td",46),e(33,`
                                    `),a(34,"input",47),O("ngModelChange",function(s){S(t);let u=m(2);return I(u.dynamicExample.studentPointsOfBonusTo,s)||(u.dynamicExample.studentPointsOfBonusTo=s),h(s)}),y("change",function(){S(t);let s=m(2);return h(s.calculateDynamicExample())}),r(),e(35,`
                                `),r(),e(36,`
                                `),a(37,"td"),e(38),r(),e(39,`
                                `),a(40,"td",46),e(41,`
                                    `),a(42,"input",47),O("ngModelChange",function(s){S(t);let u=m(2);return I(u.dynamicExample.studentPointsOfBonusSource,s)||(u.dynamicExample.studentPointsOfBonusSource=s),h(s)}),y("change",function(){S(t);let s=m(2);return h(s.calculateDynamicExample())}),r(),e(43,`
                                `),r(),e(44,`
                                `),a(45,"td"),e(46),r(),e(47,`
                                `),x(48,lt,5,1),a(49,"td"),e(50,`
                                    `),x(51,mt,1,3),e(52),x(53,dt,4,4),r(),e(54,`
                            `),r(),e(55,`
                        `),r(),e(56,`
                    `),r(),e(57,`
                `),r(),e(58,`
            `)}if(n&2){let t=m(2);i(21),p(t.currentBonusStrategyOption===t.BonusStrategyOption.POINTS?21:-1),i(7),V(t.examples),i(6),G("ngModel",t.dynamicExample.studentPointsOfBonusTo),i(4),f(t.dynamicExample.examGrade),i(4),G("ngModel",t.dynamicExample.studentPointsOfBonusSource),i(4),f(t.dynamicExample.bonusGrade),i(2),p(t.bonus.bonusStrategy===t.BonusStrategy.POINTS?48:-1),i(3),p(t.bonus.bonusStrategy===t.BonusStrategy.GRADES_CONTINUOUS&&t.dynamicExample.finalGrade?51:-1),i(),W(`
                                    `,t.dynamicExample.finalGrade,`
                                    `),i(),p(t.bonus.bonusStrategy!==t.BonusStrategy.POINTS&&t.dynamicExample.exceedsMax?53:-1)}}function ut(n,d){if(n&1){let t=E();e(0,`
                    `),a(1,"button",50),y("delete",function(){S(t);let s=m(2);return h(s.delete())}),e(2,`
                        `),a(3,"fa-icon",29),l(4,"span",51),r(),e(5,`
                    `),r(),e(6,`
                `)}if(n&2){let t=m(2);i(),c("entityTitle","")("buttonSize",t.ButtonSize.MEDIUM)("dialogError",t.dialogError$)("disabled",t.isLoading),i(2),c("icon",t.faTimes)}}function pt(n,d){if(n&1){let t=E();e(0,`
            `),l(1,"h5",27),e(2,`
            `),x(3,Ye,42,20)(4,Ze,3,0)(5,ct,59,9),a(6,"div"),e(7,`
                `),a(8,"button",28),y("click",function(){S(t);let s=m();return h(s.save())}),e(9,`
                    `),l(10,"fa-icon",29),e(11,"\xA0"),l(12,"span",30),e(13,`
                `),r(),e(14,`
                `),x(15,ut,7,5),r(),e(16,`
        `)}if(n&2){let t=m();i(3),p(t.bonus.bonusStrategy&&t.bonus.weight&&t.bonusToGradeStepsDTO?3:-1),i(),p(t.hasBonusStrategyWeightMismatch?4:-1),i(),p(t.examples.length?5:-1),i(3),c("disabled",t.isLoading),i(2),c("icon",t.faSave),i(5),p(t.bonus.id?15:-1)}}var b=function(n){return n[n.GRADES=0]="GRADES",n[n.POINTS=1]="POINTS",n}(b||{}),v=function(n){return n[n.DISCRETE=0]="DISCRETE",n[n.CONTINUOUS=1]="CONTINUOUS",n}(v||{}),Ft=(()=>{class n{bonusService=B(Ne);gradingSystemService=B(we);route=B(te);router=B(ne);alertService=B(Ce);CALCULATION_PLUS=1;CALCULATION_MINUS=-1;faSave=_e;faPlus=ge;faTimes=Se;faExclamationTriangle=he;faQuestionCircle=xe;ButtonSize=Ee;GradeEditMode=Pe;BonusStrategyOption=b;BonusStrategy=C;bonusStrategyOptions=[b.GRADES,b.POINTS].map(t=>({value:t,labelKey:"artemisApp.bonus.bonusStrategy."+b[t].toLowerCase(),btnClass:"btn-secondary"}));bonusStrategyDiscreteness=[v.CONTINUOUS].map(t=>({value:t,labelKey:"artemisApp.bonus.discreteness."+v[t].toLowerCase(),btnClass:"btn-secondary"}));calculationSigns=[{value:this.CALCULATION_MINUS,label:"\u2212",btnClass:"btn-secondary"},{value:this.CALCULATION_PLUS,label:"+",btnClass:"btn-secondary"}];sourceGradingScales=[];bonusToGradeStepsDTO;isLoading=!1;courseId;examId;dialogErrorSource=new K;dialogError$=this.dialogErrorSource.asObservable();currentBonusStrategyOption;currentBonusStrategyDiscreteness;examples=[];dynamicExample=new Ae(0,0);bonus=new U;hasBonusStrategyWeightMismatch=!1;state={page:1,pageSize:100,searchTerm:"",sortingOrder:Ge.DESCENDING,sortedColumn:"ID"};ngOnInit(){this.isLoading=!0;let t=this.route.snapshot.paramMap;this.courseId=Number(t.get("courseId")),this.examId=Number(t.get("examId")),J([this.bonusService.findBonusForExam(this.courseId,this.examId).pipe(A(o=>{this.setBonus(o.body||new U)}),R(o=>{if(o?.status===404)return Q(void 0);throw o})),this.gradingSystemService.findWithBonusGradeTypeForInstructor(this.state).pipe(A(o=>{this.sourceGradingScales=o.body?.resultsOnPage||[]})),this.gradingSystemService.findGradeSteps(this.courseId,this.examId).pipe(A(o=>{if(o)this.bonusToGradeStepsDTO=o,this.gradingSystemService.sortGradeSteps(o.gradeSteps),this.gradingSystemService.setGradePoints(o.gradeSteps,o.maxPoints);else throw new Error(`No grade steps found for bonus calculation. Bonus to course id "${this.courseId}", exam id "${this.examId}"`)}),R(o=>{throw this.alertService.error(o.message),this.navigateToExam(),new Error(`No grade scale found for bonus calculation. Bonus to course id "${this.courseId}", exam id "${this.examId}"`)}))]).pipe(M(()=>{this.isLoading=!1})).subscribe(()=>{this.setSourceGradingScale()})}navigateToExam(){this.router.navigate(["course-management",this.courseId,"exams",this.examId])}setSourceGradingScale(){if(this.bonus.sourceGradingScale){let t=this.sourceGradingScales.find(o=>o.id===this.bonus.sourceGradingScale.id);if(!t)throw new Error(`sourceGradingScale not found for id: ${this.bonus.sourceGradingScale.id}`);this.bonus.sourceGradingScale=t,this.onBonusSourceChange(t)}}generateExamples(){this.bonus.sourceGradingScale&&this.bonus.bonusStrategy?(this.hasBonusStrategyWeightMismatch=this.checkBonusStrategyWeightMismatch(this.bonus.bonusStrategy,this.bonus.weight,this.bonusToGradeStepsDTO.gradeSteps),this.examples=this.hasBonusStrategyWeightMismatch?[]:this.bonusService.generateBonusExamples(this.bonus,this.bonusToGradeStepsDTO)):(this.hasBonusStrategyWeightMismatch=!1,this.examples=[])}checkBonusStrategyWeightMismatch(t,o,s){switch(t){case C.POINTS:return o<0;case C.GRADES_CONTINUOUS:case C.GRADES_DISCRETE:let u=this.gradingSystemService.getNumericValueForGradeName(this.gradingSystemService.maxGrade(s)),w=this.gradingSystemService.getNumericValueForGradeName(s[0]?.gradeName);return this.bonusService.doesBonusExceedMax(w,u,o);default:return!1}}setBonus(t){switch(this.bonus=t,t.bonusStrategy){case C.POINTS:this.currentBonusStrategyOption=b.POINTS,this.currentBonusStrategyDiscreteness=void 0;break;case C.GRADES_CONTINUOUS:this.currentBonusStrategyOption=b.GRADES,this.currentBonusStrategyDiscreteness=v.CONTINUOUS;break;case C.GRADES_DISCRETE:this.currentBonusStrategyOption=b.GRADES,this.currentBonusStrategyDiscreteness=v.DISCRETE;break;default:this.currentBonusStrategyOption=void 0,this.currentBonusStrategyDiscreteness=void 0}}onBonusStrategyInputChange(){this.bonus.bonusStrategy=this.convertFromInputsToBonusStrategy(this.currentBonusStrategyOption,this.currentBonusStrategyDiscreteness),this.generateExamples(),this.refreshDynamicExample()}onWeightChange(){this.generateExamples(),this.refreshDynamicExample()}convertFromInputsToBonusStrategy(t,o){if(t===b.POINTS)return C.POINTS;if(t===b.GRADES)switch(o){case v.CONTINUOUS:case void 0:return C.GRADES_CONTINUOUS;case v.DISCRETE:return C.GRADES_DISCRETE;default:return}}save(){this.isLoading=!0,(this.bonus.id?this.bonusService.updateBonus(this.courseId,this.examId,this.bonus):this.bonusService.createBonusForExam(this.courseId,this.examId,this.bonus)).pipe(M(()=>{this.isLoading=!1})).subscribe(o=>this.bonus.id=o.body?.id)}delete(){this.bonus.id&&(this.isLoading=!0,this.bonusService.deleteBonus(this.courseId,this.examId,this.bonus.id).pipe(M(()=>{this.isLoading=!1})).subscribe({next:t=>{this.setBonus(t.body||new U),this.dialogErrorSource.next("")},error:t=>this.dialogErrorSource.next(t.message)}))}getGradingScaleTitle(t){return this.gradingSystemService.getGradingScaleTitle(t)}getGradingScaleMaxPoints(t){return this.gradingSystemService.getGradingScaleMaxPoints(t)}hasPointsSet(){return!!this.bonus.sourceGradingScale?.gradeSteps&&this.gradingSystemService.hasPointsSet(this.bonus.sourceGradingScale.gradeSteps)}setBonusSourcePoints(t){this.gradingSystemService.hasPointsSet(t.gradeSteps)||this.gradingSystemService.setGradePoints(t.gradeSteps,this.getGradingScaleMaxPoints(t)),this.gradingSystemService.sortGradeSteps(t.gradeSteps)}calculateDynamicExample(){this.bonusService.calculateFinalGrade(this.dynamicExample,this.bonus,this.bonusToGradeStepsDTO)}refreshDynamicExample(){this.dynamicExample.finalGrade!=null&&this.calculateDynamicExample()}onBonusSourceChange(t){this.setBonusSourcePoints(t),this.generateExamples(),this.refreshDynamicExample()}getCalculationSign(t){return t>0?"+":"\u2212"}maxPossibleGrade(){return this.gradingSystemService.maxGrade(this.bonusToGradeStepsDTO.gradeSteps)}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=q({type:n,selectors:[["jhi-bonus"]],decls:29,vars:9,consts:[["helpTextTemplate",""],["tipContent",""],[1,"bonus-form-start"],["jhiTranslate","artemisApp.bonus.title"],[1,"row","mt-4"],[1,"bonus-form-step","col-1"],[1,"form-group","col"],["jhiTranslate","artemisApp.bonus.bonusStrategy.title",1,"no-flex-shrink","h5"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"d-block","mt-1",3,"valueChange","options","value"],[1,"bonus-calculated"],[3,"innerHTML"],["placement","right auto",1,"text-secondary",3,"icon","ngbTooltip"],[1,"d-flex","align-items-baseline"],[1,"text-secondary",3,"icon"],[1,"ps-1","pb-1",3,"innerHTML"],["jhiTranslate","artemisApp.bonus.calculation.title",1,"no-flex-shrink","h5"],["jhiTranslate","artemisApp.bonus.bonusSource.title",1,"no-flex-shrink","h5"],[1,"form-select","mt-1",3,"ngModelChange","ngModel","title"],[3,"ngValue"],[1,"mb-0","ms-2","fs-6","fw-bold","no-flex-shrink"],[1,"mb-4","fs-6"],[1,"table","table-striped"],["jhiTranslate","artemisApp.exam.examSummary.bonus"],["jhiTranslate","artemisApp.exam.examSummary.interval"],["text","artemisApp.bonus.bonusSource.maxPointsCourseHelpText"],["jhiTranslate","artemisApp.exam.examSummary.intervalPoints"],["jhiTranslate","artemisApp.bonus.formula.title",1,"mb-0"],["type","button",1,"btn","btn-primary","mr-1","mb-1",3,"click","disabled"],[3,"icon"],["jhiTranslate","entity.action.save"],[1,"fs-3","mb-4"],[1,"d-flex","pb-2","align-items-center"],[1,"pe-2"],[1,"p-2"],[1,"calculation-sign"],["jhiTranslate","artemisApp.bonus.formula.finalGradeLimit",1,"row","fs-6","ps-2",3,"translateValues"],["jhiTranslate","artemisApp.bonus.formula.finalGradeFromPoints",1,"row","fs-6","ps-2"],["jhiTranslate","artemisApp.bonus.warnStrategyWeightMismatch",1,"alert","alert-warning"],["jhiTranslate","artemisApp.bonus.examples.title"],["jhiTranslate","artemisApp.bonus.examples.helpText",1,"mb-1"],["jhiTranslate","artemisApp.bonus.examples.examPoints"],["jhiTranslate","artemisApp.bonus.examples.examGrade"],["jhiTranslate","artemisApp.bonus.examples.bonusSourceStudentPoints"],["jhiTranslate","artemisApp.bonus.examples.bonusGrade"],["jhiTranslate","artemisApp.bonus.examples.finalGrade"],[1,"ps-0"],["type","number","step","0.5","min","0",1,"dynamic-example",3,"ngModelChange","change","ngModel"],["jhiTranslate","artemisApp.bonus.examples.finalPoints"],[1,"text-warning",3,"icon","ngbTooltip"],["jhiDeleteButton","","deleteQuestion","artemisApp.bonus.deleteQuestion",1,"mb-1",3,"delete","entityTitle","buttonSize","dialogError","disabled"],["jhiTranslate","entity.action.delete"]],template:function(o,s){if(o&1){let u=E();x(0,We,6,2,"ng-template",null,0,$),e(2,`
`),a(3,"article",2),e(4,`
    `),l(5,"h2",3),e(6,`
    `),a(7,"div",4),e(8,`
        `),l(9,"div",5),e(10,`
        `),a(11,"div",6),e(12,`
            `),l(13,"label",7),e(14,`
            `),L(15,8),e(16,`
            `),a(17,"jhi-mode-picker",9),O("valueChange",function(H){return S(u),I(s.currentBonusStrategyOption,H)||(s.currentBonusStrategyOption=H),h(H)}),y("valueChange",function(){return S(u),h(s.onBonusStrategyInputChange())}),r(),e(18,`
        `),r(),e(19,`
    `),r(),e(20,`
    `),x(21,Fe,15,5)(22,ze,19,7),a(23,"div",10),e(24,`
        `),x(25,qe,31,6)(26,pt,17,6),r(),e(27,`
`),r(),e(28,`
`)}if(o&2){let u=P(1);i(15),c("ngTemplateOutlet",u)("ngTemplateOutletContext",j(8,De)),i(2),c("options",s.bonusStrategyOptions),G("value",s.currentBonusStrategyOption),i(4),p(s.bonus.id||s.currentBonusStrategyOption!==void 0?21:-1),i(),p(s.bonus.id||s.bonus.weight!==void 0?22:-1),i(3),p(s.bonus.sourceGradingScale!=null&&s.bonus.sourceGradingScale.gradeSteps?25:-1),i(),p(s.bonus.bonusStrategy&&s.bonus.sourceGradingScale&&s.bonus.weight?26:-1)}},dependencies:[Oe,Me,Ie,fe,ye,ve,Te,be,pe,ue,ce,le,me,ie,re,se,oe,de,ae,ee,Z,Be],styles:[".bonus-form-start[_ngcontent-%COMP%]{counter-reset:bonus-step-counter;margin-right:calc(2.25rem - 1px)}.bonus-form-step[_ngcontent-%COMP%]{border-radius:1.5rem;width:1.5rem;height:1.5rem;border:1px solid;text-align:center;margin-left:calc(.75rem - 1px)}.bonus-form-step[_ngcontent-%COMP%]:before{counter-increment:bonus-step-counter;content:counter(bonus-step-counter)}.bonus-calculated[_ngcontent-%COMP%]{margin-left:calc(2.25rem - 1px)}.calculation-sign[_ngcontent-%COMP%]{font-size:3rem}.dynamic-example[_ngcontent-%COMP%]{padding-left:calc(.5rem - 2px);width:50%}"]})}return n})();export{Ft as BonusComponent,v as BonusStrategyDiscreteness,b as BonusStrategyOption};
//# sourceMappingURL=bonus.component-3OMOK327.js.map
