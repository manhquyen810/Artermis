import{b as D}from"./chunk-MBS3WUDO.js";import{a as y}from"./chunk-G3JOQOSD.js";import{a as u,b as c}from"./chunk-EELXLOHY.js";import{b as g}from"./chunk-R5BZWVRQ.js";import{a as v}from"./chunk-5ZXXURLP.js";import{O as f}from"./chunk-IOA4DPXY.js";import{Ea as m,L as d,la as h,ya as l,z as n}from"./chunk-5LC5EQRR.js";var b="/user/topic/team-assignments",T=(()=>{class s{http=m(f);websocketService=m(v);accountService=m(g);teamAssignmentUpdates$;teamAssignmentUpdatesResolver;authenticationStateSubscriber;websocketStatusSubscription;ngOnDestroy(){this.websocketStatusSubscription?.unsubscribe()}static resourceUrl(e){return`api/exercise/exercises/${e}/teams`}create(e,t){let r=s.convertTeamDatesFromClient(t);return this.http.post(s.resourceUrl(e.id),r,{observe:"response"}).pipe(n(i=>s.convertTeamResponseDatesFromServer(i)))}update(e,t){let r=s.convertTeamDatesFromClient(t);return this.http.put(`${s.resourceUrl(e.id)}/${t.id}`,r,{observe:"response"}).pipe(n(i=>s.convertTeamResponseDatesFromServer(i)))}find(e,t){return this.http.get(`${s.resourceUrl(e.id)}/${t}`,{observe:"response"}).pipe(n(r=>s.convertTeamResponseDatesFromServer(r)))}findAllByExerciseId(e,t){let r=y(t?{teamOwnerId:t}:{});return this.http.get(s.resourceUrl(e),{params:r,observe:"response"}).pipe(n(i=>s.convertTeamArrayResponseDatesFromServer(i)))}delete(e,t){return this.http.delete(`${s.resourceUrl(e.id)}/${t}`,{observe:"response"})}existsByShortName(e,t){return this.http.get(`api/exercise/courses/${e.id}/teams/exists?shortName=${t}`,{observe:"response"})}searchInCourseForExerciseTeam(e,t,r){let i=`api/exercise/courses/${e.id}/exercises/${t.id}/team-search-users?loginOrName=${r}`;return this.http.get(i,{observe:"response"})}importTeams(e,t,r){let i=t.map(a=>s.convertTeamDatesFromClient(a));return this.http.put(`${s.resourceUrl(e.id)}/import-from-list?importStrategyType=${r}`,i,{observe:"response"})}importTeamsFromSourceExercise(e,t,r){return this.http.put(`${s.resourceUrl(e.id)}/import-from-exercise/${t.id}?importStrategyType=${r}`,{},{observe:"response"})}findCourseWithExercisesAndParticipationsForTeam(e,t){return this.http.get(`api/exercise/courses/${e.id}/teams/${t.shortName}/with-exercises-and-participations`,{observe:"response"}).pipe(n(r=>this.setAccessRightsCourseEntityResponseType(r)))}exportTeams(e){let t=[];e.forEach(a=>{a.students&&a.students.forEach(o=>{let p={teamName:a.name??"",username:o.login??""};o.firstName&&(p.firstName=o.firstName),o.lastName&&(p.lastName=o.lastName),o.visibleRegistrationNumber&&(p.registrationNumber=o.visibleRegistrationNumber),t.push(p)})});let r=JSON.stringify(t),i=new Blob([r],{type:"application/json"});D(i,"teams.json")}get teamAssignmentUpdates(){return new Promise(e=>{if(this.teamAssignmentUpdates$)return e(this.teamAssignmentUpdates$);this.authenticationStateSubscriber=this.accountService.getAuthenticationState().subscribe(t=>{setTimeout(()=>{t?(this.teamAssignmentUpdatesResolver=()=>e(this.newTeamAssignmentUpdates$),this.websocketStatusSubscription=this.websocketService.connectionState.pipe(d(r=>r.connected)).subscribe(()=>this.teamAssignmentUpdatesResolver())):(this.websocketService.unsubscribe(b),this.websocketStatusSubscription?.unsubscribe(),this.teamAssignmentUpdates$=null,this.authenticationStateSubscriber.unsubscribe())},500)})})}get newTeamAssignmentUpdates$(){return this.websocketService.subscribe(b),this.teamAssignmentUpdates$=this.websocketService.receive(b).pipe(h(16)),this.teamAssignmentUpdates$}static convertTeamArrayResponseDatesFromServer(e){return e.body&&e.body.map(t=>this.convertTeamDatesFromServer(t)),e}static convertTeamResponseDatesFromServer(e){return e.body&&(e.body.createdDate=c(e.body.createdDate),e.body.lastModifiedDate=c(e.body.lastModifiedDate)),e}static convertTeamDatesFromServer(e){return e.createdDate=c(e.createdDate),e.lastModifiedDate=c(e.lastModifiedDate),e}static convertTeamDatesFromClient(e){return Object.assign({},e,{createdDate:u(e.createdDate),lastModifiedDate:u(e.lastModifiedDate)})}setAccessRightsCourseEntityResponseType(e){return e.body&&this.accountService.setAccessRightsForCourse(e.body),e}static \u0275fac=function(t){return new(t||s)};static \u0275prov=l({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();export{T as a};
//# sourceMappingURL=chunk-MNX6OTP5.js.map
