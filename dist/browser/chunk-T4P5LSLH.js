import{a as li}from"./chunk-OAPRXDEH.js";import{a as mi,c as ci}from"./chunk-4ISQXSLY.js";import{a as ti,b as ni}from"./chunk-43HC4K73.js";import{b as si}from"./chunk-A4MOLMZQ.js";import{a as ei}from"./chunk-NT3333UE.js";import{a as ii,b as ri}from"./chunk-VOBYQYWS.js";import{a as ai}from"./chunk-23SCGJT4.js";import{a as Qe}from"./chunk-U6AELCVK.js";import{a as di}from"./chunk-7VA67MIB.js";import{a as oi}from"./chunk-TOVMCMTA.js";import{a as Xe}from"./chunk-LXDP326M.js";import{a as Ze}from"./chunk-4P7M5PJP.js";import{a as Ye}from"./chunk-NUC4ZXFE.js";import{c as X}from"./chunk-CCVWGTN5.js";import{C as $e,a as Je}from"./chunk-RKZRHQUL.js";import{a as qe}from"./chunk-JRBFEQNN.js";import{m as Ge,o as ze}from"./chunk-5AQXEKLE.js";import{k as Ue,l as $}from"./chunk-3JSWSN6W.js";import{e as Q,f as Ke}from"./chunk-DXTZ4GAW.js";import{q as Be}from"./chunk-Z2YUBN6N.js";import{a as We,d as Ne}from"./chunk-O26CMRR4.js";import{a as Le}from"./chunk-JHBUBEY6.js";import{a as y,c as M,e as ke,f as we,g as q,i as Re,j as P,r as D,s as De,t as Fe,u as Oe,y as Ie}from"./chunk-R2SUWIPY.js";import{b,h as Pe}from"./chunk-PUNMJFMR.js";import{c as F}from"./chunk-5MVJAZRV.js";import{a as A}from"./chunk-PZ7IDTIM.js";import{c as J}from"./chunk-CT44YL7Q.js";import{K as ge}from"./chunk-VZRSC3LP.js";import{v as z}from"./chunk-5GXY5RYT.js";import{a as Ve}from"./chunk-K3W6YFKH.js";import{c as Ae}from"./chunk-JXJXC4DZ.js";import{d as He}from"./chunk-EDXSOKK5.js";import{b as Me}from"./chunk-R5BZWVRQ.js";import{p as f}from"./chunk-DID2YGL7.js";import{k as ye}from"./chunk-CXQURQM5.js";import{_b as ve,jc as Ee,wd as Te}from"./chunk-Z4VHWOB5.js";import{a as Se}from"./chunk-5ZXXURLP.js";import{a as Ce}from"./chunk-NOBD5HSR.js";import{a as je}from"./chunk-U54OSGNH.js";import{f as xe,i as _e}from"./chunk-M6Z6DKZQ.js";import{c as fe}from"./chunk-E2KBL4LX.js";import{B as be,n as he}from"./chunk-IOA4DPXY.js";import{Ac as N,Ad as pe,Bb as ie,Bc as B,Db as s,Dc as v,Ea as x,L as E,Ma as _,Mc as S,Na as g,Oc as a,P as H,Tb as te,Yc as ae,Zb as h,Zc as re,_c as le,a as Y,dd as i,ed as U,f as L,fd as w,kc as c,ld as me,ma as Z,md as de,nd as ce,oa as j,qd as K,ra as ee,s as V,sc as d,sd as ue,td as G,uc as ne,vc as se,wb as W,wc as oe,xc as m,yc as r,yd as T,zc as p,zd as R}from"./chunk-5LC5EQRR.js";var ui={settingsKey:"modeling_tour",resetParticipation:ke.EXERCISE_PARTICIPATION,steps:[new we({headlineTranslateKey:"tour.modelingExercise.editorArea.headline",contentTranslateKey:"tour.modelingExercise.editorArea.content"}),new q({headlineTranslateKey:"tour.modelingExercise.addEditUmlElement.headline",contentTranslateKey:"tour.modelingExercise.addEditUmlElement.content",hintTranslateKey:"tour.modelingExercise.addEditUmlElement.hint",imageUrl:"/../../../content/images/guided-tour-images/apollon-add-edit-element.gif"}),new q({headlineTranslateKey:"tour.modelingExercise.createAssociation.headline",contentTranslateKey:"tour.modelingExercise.createAssociation.content",hintTranslateKey:"tour.modelingExercise.createAssociation.hint",imageUrl:"/../../../content/images/guided-tour-images/apollon-add-association.gif"}),new P({highlightSelector:"jhi-modeling-editor .guided-tour.modeling-editor .modeling-editor",headlineTranslateKey:"tour.modelingExercise.executeTasks.headline",contentTranslateKey:"tour.modelingExercise.executeTasks.content",highlightPadding:5,orientation:y.TOP,userInteractionEvent:M.MODELING,modelingTask:new D(De.name,"tour.modelingExercise.executeTasks.personClass")}),new P({highlightSelector:"jhi-modeling-editor .guided-tour.modeling-editor .modeling-editor",headlineTranslateKey:"tour.modelingExercise.executeTasks.headline",contentTranslateKey:"tour.modelingExercise.executeTasks.content",orientation:y.TOP,userInteractionEvent:M.MODELING,modelingTask:new D(Fe.name,"tour.modelingExercise.executeTasks.studentClass")}),new P({highlightSelector:"jhi-modeling-editor .guided-tour.modeling-editor .modeling-editor",headlineTranslateKey:"tour.modelingExercise.executeTasks.headline",contentTranslateKey:"tour.modelingExercise.executeTasks.content",orientation:y.TOP,userInteractionEvent:M.MODELING,modelingTask:new D(Oe.name,"tour.modelingExercise.executeTasks.association")}),new Re({highlightSelector:"jhi-modeling-submission .guided-tour.submission-button",headlineTranslateKey:"tour.modelingExercise.submit.headline",contentTranslateKey:"tour.modelingExercise.submit.content",hintTranslateKey:"tour.modelingExercise.submit.hint",highlightPadding:20,orientation:y.LEFT,userInteractionEvent:M.CLICK,triggerNextStep:!0})]};var O=class{participation;patch;constructor(l){this.patch=l}};var _i=(n,l,e)=>["/courses",n,"exercises","modeling-exercises",l,"participate",e],gi=(n,l)=>({isChanged:n,isSaving:l}),pi=()=>[],fi=(n,l,e)=>({"text-secondary":n,"text-success":l,"text-danger":e});function Ci(n,l){if(n&1){let e=v();i(0,`
                            `),m(1,"jhi-button",5),S("click",function(){_(e);let o=a(4);return g(o.showResultHistory=!o.showResultHistory)}),r(),i(2,`
                        `)}if(n&2){let e=a(4);s(),c("icon",e.faTimeline)("title",e.showResultHistory?"entity.action.hideTimeline":"entity.action.viewTimeline")}}function Si(n,l){if(n&1&&(i(0,`
                            `),p(1,"jhi-button",6),i(2,`
                        `)),n&2){let e=a(4);s(),c("title","entity.action.continueSubmission")("routerLink",G(2,_i,e.course==null?null:e.course.id,e.modelingExercise==null?null:e.modelingExercise.id,e.result==null||e.result.participation==null?null:e.result.participation.id))}}function vi(n,l){if(n&1&&(i(0,`
                        `),h(1,Ci,3,2)(2,Si,3,6)),n&2){let e=a(3);s(),d(((e.sortedSubmissionHistory==null?null:e.sortedSubmissionHistory.length)||0)>1?1:-1),s(),d(e.isActive||!e.modelingExercise.dueDate?2:-1)}}function Ei(n,l){if(n&1){let e=v();i(0,`
                            `),m(1,"jhi-request-feedback-button",7),S("generatingFeedback",function(){_(e);let o=a(4);return g(o.isGeneratingFeedback=!0)}),r(),i(2,`
                        `)}if(n&2){let e=a(4);s(),c("exercise",e.modelingExercise)("pendingChanges",e.isChanged)("hasAthenaResultForLatestSubmission",e.hasAthenaResultForLatestSubmission)("isGeneratingFeedback",e.isGeneratingFeedback)("isSubmitted",e.submission.submitted||!1)}}function Ti(n,l){if(n&1&&(i(0,`
                        `),h(1,Ei,3,5)),n&2){let e=a(3);s(),d(e.modelingExercise.allowFeedbackRequests&&(!e.modelingExercise.dueDate||!e.hasExerciseDueDatePassed(e.modelingExercise,e.participation))?1:-1)}}function yi(n,l){if(n&1&&(i(0,`
                    `),h(1,vi,3,2)(2,Ti,2,1)),n&2){let e=a(2);s(),d(e.isFeedbackView?1:2)}}function Mi(n,l){if(n&1){let e=v();i(0,`
                    `),m(1,"jhi-button",8),S("onClick",function(){_(e);let o=a(2);return g(o.submit())}),r(),i(2,`
                `)}if(n&2){let e=a(2);s(),c("disabled",!e.isActive&&!e.isLate||!e.submission||!!e.result||e.isLate&&!!e.submission.submitted)("title",e.isLate?"entity.action.submitDueDateMissed":"entity.action.submit")("isLoading",e.isSaving)("btnType",e.isLate?e.ButtonType.WARNING:e.ButtonType.PRIMARY)("tooltip",e.submitButtonTooltip)}}function Ai(n,l){if(n&1&&(i(0,`
        `),m(1,"jhi-header-participation-page",1),i(2,`
            `),m(3,"span",2),i(4),T(5,"artemisTranslate"),m(6,"span",3),i(7),r(),i(8,`
            `),r(),i(9,`
            `),N(10,4),i(11,`
                `),h(12,yi,3,1)(13,Mi,3,5),B(),i(14,`
        `),r(),i(15,`
    `)),n&2){let e=a();s(),c("exercise",e.modelingExerciseHeader)("participation",e.modelingParticipationHeader),s(3),w(`
                `,R(5,6,"artemisApp.modelingSubmission.modelingEditor"),`:
                `),s(3),U(e.examMode?e.modelingExercise==null||e.modelingExercise.exerciseGroup==null?null:e.modelingExercise.exerciseGroup.title:e.modelingExercise==null?null:e.modelingExercise.title),s(5),d(e.isOwnerOfParticipation?12:-1),s(),d(e.isFeedbackView?-1:13)}}function ki(n,l){if(n&1&&(i(0,`
        `),m(1,"div",9),i(2,`
            `),m(3,"div",10),i(4,`
                `),p(5,"jhi-result-history",11),i(6,`
            `),r(),i(7,`
        `),r(),i(8,`
    `)),n&2){let e=a();s(5),c("results",e.sortedResultHistory)("exercise",e.modelingExercise)("selectedResultId",e.submission.latestResult==null?null:e.submission.latestResult.id)}}function wi(n,l){if(n&1&&(i(0,`
                                    `),m(1,"div",22),i(2,`
                                        `),p(3,"jhi-team-participate-info-box",23),i(4,`
                                    `),r(),i(5,`
                                `)),n&2){let e=a(3);s(3),c("exercise",e.modelingExercise)("participation",e.participation)("typing$",e.submissionObservable)("dockedToRightSide",!0)}}function Ri(n,l){if(n&1){let e=v();i(0,`
                                                    `),m(1,"jhi-team-submission-sync",27),S("receiveSubmission",function(o){_(e);let u=a(4);return g(u.onReceiveSubmissionFromTeam(o))})("receiveSubmissionPatch",function(o){_(e);let u=a(4);return g(u.onReceiveSubmissionPatchFromTeam(o))}),r(),i(2,`
                                                `)}if(n&2){let e=a(4);s(),c("exerciseType",e.modelingExercise.type)("submissionObservable",e.submissionObservable)("submissionPatchObservable",e.submissionPatchObservable)("participation",e.participation)}}function Pi(n,l){if(n&1){let e=v();i(0,`
                                            `),m(1,"div",24),i(2,`
                                                `),m(3,"jhi-modeling-editor",25),ce("explanationChange",function(o){_(e);let u=a(3);return de(u.explanation,o)||(u.explanation=o),g(o)}),S("onModelPatch",function(o){_(e);let u=a(3);return g(u.onModelPatch(o))}),r(),i(4,`
                                                `),m(5,"fa-icon",26),p(6,"span"),r(),i(7,`
                                                `),h(8,Ri,3,4),r(),i(9,`
                                        `)}if(n&2){let e=a(3);s(3),c("readOnly",!e.isOwnerOfParticipation)("umlModel",e.umlModel)("diagramType",e.modelingExercise.diagramType)("withExplanation",!0),me("explanation",e.explanation),c("resizeOptions",e.resizeOptions)("savedStatus",ue(9,gi,e.isChanged,e.isSaving)),s(2),c("icon",e.faGripLines),s(3),d(e.modelingExercise.teamMode?8:-1)}}function Di(n,l){if(n&1){let e=v();i(0,`
                                            `),m(1,"div",28),i(2,`
                                                `),m(3,"jhi-modeling-assessment",29),S("selectionChanged",function(o){_(e);let u=a(3);return g(u.onSelectionChanged(o))}),r(),i(4,`
                                            `),r(),i(5,`
                                        `)}if(n&2){let e=a(3);s(3),c("umlModel",e.umlModel)("resultFeedbacks",(e.assessmentResult==null?null:e.assessmentResult.feedbacks)||K(10,pi))("diagramType",e.modelingExercise.diagramType)("maxScore",e.modelingExercise.maxPoints||0)("maxBonusPoints",e.modelingExercise.bonusPoints||0)("readOnly",!0)("enablePopups",!1)("displayPoints",!1)("course",e.course)("explanation",e.explanation)}}function Fi(n,l){n&1&&(i(0,`
                                                    `),p(1,"p",32),i(2,`
                                                `))}function Oi(n,l){if(n&1&&(i(0,`
                                                                                `),m(1,"span"),i(2),r(),i(3,`
                                                                            `)),n&2){let e=a().$implicit,t=a(6);s(2),w("",t.assessmentsNames[e.referenceId]==null?null:t.assessmentsNames[e.referenceId].type," ")}}function Ii(n,l){if(n&1&&(i(0,`
                                                                                `),m(1,"code",40),i(2),r(),i(3,`
                                                                            `)),n&2){let e=a().$implicit,t=a(6);s(2),U(t.assessmentsNames[e.referenceId]==null?null:t.assessmentsNames[e.referenceId].name)}}function Li(n,l){n&1&&(i(0,`
                                                                                `),p(1,"br"),i(2,`
                                                                            `))}function Vi(n,l){if(n&1&&(i(0,`
                                                                                `),m(1,"span",41)(2,"strong"),i(3,"Feedback:"),r(),i(4," "),p(5,"span",42),r(),i(6,`
                                                                            `)),n&2){let e=a().$implicit,t=a(6);s(),c("ngClass",G(2,fi,e.isSubsequent,e.credits>0&&e.isSubsequent===void 0,e.credits<0&&e.isSubsequent===void 0)),s(4),c("innerHTML",t.buildFeedbackTextForReview(e),W)}}function Hi(n,l){if(n&1&&(i(0,`
                                                                                `),p(1,"fa-icon",43),T(2,"artemisTranslate"),i(3,`
                                                                            `)),n&2){let e=a(7);s(),c("icon",e.faExclamationTriangle)("ngbTooltip",R(2,2,"artemisApp.assessment.subsequentFeedback"))}}function ji(n,l){if(n&1&&(i(0,`
                                                                    `),m(1,"tr",38),i(2,`
                                                                        `),m(3,"td"),i(4,`
                                                                            `),h(5,Oi,4,1)(6,Ii,4,1)(7,Li,3,0)(8,Vi,7,6),r(),i(9,`
                                                                        `),m(10,"td",39),i(11),T(12,"number"),h(13,Hi,4,4),r(),i(14,`
                                                                    `),r(),i(15,`
                                                                `)),n&2){let e=l.$implicit,t=a(6);s(),c("hidden",!t.shouldBeDisplayed(e)),s(4),d(e.reference?5:-1),s(),d(e.reference?6:-1),s(),d(e.reference?7:-1),s(),d(e.text||e.detailText||e.gradingInstruction?8:-1),s(3),w(`
                                                                            `,pe(12,7,e.credits,"1.0-1"),`
                                                                            `),s(2),d(e.isSubsequent?13:-1)}}function Wi(n,l){if(n&1&&(i(0,`
                                                            `),m(1,"tbody"),i(2,`
                                                                `),se(3,ji,16,10,null,null,ne),r(),i(5,`
                                                        `)),n&2){let e=a(5);s(3),oe(e.referencedFeedback)}}function Ni(n,l){if(n&1&&(i(0,`
                                                    `),p(1,"p",33),i(2,`
                                                    `),m(3,"table",34),i(4,`
                                                        `),m(5,"thead",35),i(6,`
                                                            `),m(7,"tr"),i(8,`
                                                                `),p(9,"th",36),i(10,`
                                                                `),p(11,"th",37),i(12,`
                                                            `),r(),i(13,`
                                                        `),r(),i(14,`
                                                        `),h(15,Wi,6,0),r(),i(16,`
                                                `)),n&2){let e=a(4);s(15),d(e.assessmentsNames?15:-1)}}function Bi(n,l){if(n&1&&(i(0,`
                                            `),m(1,"div",30),i(2,`
                                                `),p(3,"h4",31),i(4,`
                                                `),h(5,Fi,3,0)(6,Ni,17,1),r(),i(7,`
                                        `)),n&2){let e=a(3);s(5),d(!e.assessmentResult||!e.assessmentResult.feedbacks||e.assessmentResult.feedbacks.length===0?5:-1),s(),d(e.assessmentResult&&e.assessmentResult.feedbacks&&e.assessmentResult.feedbacks.length>0?6:-1)}}function Ui(n,l){if(n&1&&(i(0,`
                                    `),p(1,"jhi-additional-feedback",45),i(2,`
                                `)),n&2){let e=a(4);s(),c("feedback",e.unreferencedFeedback||K(3,pi))("additional",!0)("course",e.course)}}function Ki(n,l){if(n&1&&(i(0,`
                            `),m(1,"div",44),i(2,`
                                `),h(3,Ui,3,4),r(),i(4,`
                        `)),n&2){let e=a(3);s(3),d(e.unreferencedFeedback&&e.unreferencedFeedback.length>0?3:-1)}}function Gi(n,l){if(n&1&&(i(0,`
                            `),m(1,"div",44),i(2,`
                                `),p(3,"jhi-rating",46),i(4,`
                            `),r(),i(5,`
                        `)),n&2){let e=a(3);s(3),c("result",e.addParticipationToResult(e.result,e.participation))}}function zi(n,l){if(n&1&&(i(0,`
                            `),p(1,"jhi-complaint-student-view",47),i(2,`
                        `)),n&2){let e=a(3);s(),c("exercise",e.modelingExercise)("participation",e.participation)("result",e.resultWithComplaint?e.resultWithComplaint:e.result)}}function qi(n,l){if(n&1&&(i(0,`
                    `),m(1,"div",17),i(2,`
                        `),m(3,"div",18),i(4,`
                            `),m(5,"div",19),i(6,`
                                `),h(7,wi,6,4),r(),i(8,`
                            `),m(9,"jhi-fullscreen"),i(10,`
                                `),m(11,"div",20),i(12,`
                                    `),m(13,"div",21),i(14,`
                                        `),h(15,Pi,10,12)(16,Di,6,11)(17,Bi,8,2),r(),i(18,`
                                `),r(),i(19,`
                            `),r(),i(20,`
                        `),r(),i(21,`
                        `),h(22,Ki,5,1)(23,Gi,6,1)(24,zi,3,3),r(),i(25,`
                `)),n&2){let e=a(2);s(7),d(e.modelingExercise.teamMode&&(e.isActive||e.isLate)?7:-1),s(8),d(e.submission&&(e.isActive||e.isLate)&&!e.result&&(!e.isLate||!e.submission.submitted)&&!e.isFeedbackView?15:-1),s(),d((!e.isActive||e.result)&&(!e.isLate||e.submission.submitted)||e.isFeedbackView?16:-1),s(),d(e.submission!=null&&e.submission.submitted&&(!e.isActive||e.result)||e.isFeedbackView?17:-1),s(5),d(e.submission!=null&&e.submission.submitted&&(!e.isActive||e.result)||e.isFeedbackView?22:-1),s(),d(e.result?23:-1),s(),d(e.result&&!e.examMode&&!e.isFeedbackView?24:-1)}}function Ji(n,l){if(n&1&&(i(0,`
                    `),p(1,"span",42),T(2,"htmlForMarkdown"),i(3,`
                `)),n&2){let e=a(2);s(),c("innerHTML",R(2,1,e.modelingExercise.problemStatement),W)}}function $i(n,l){if(n&1&&(i(0,`
        `),m(1,"jhi-resizeable-container",12),i(2,`
            `),i(3,`
            `),N(4,13),i(5,`
                `),h(6,qi,26,7),B(),i(7,`
            `),i(8,`
            `),i(9,`
            `),p(10,"fa-icon",14),i(11,`\xA0
            `),p(12,"span",15),i(13,`
            `),m(14,"p",16),i(15,`
                `),h(16,Ji,4,3),r(),i(17,`
            `),i(18,`
        `),r(),i(19,`
    `)),n&2){let e=a();s(),c("isExerciseParticipation",!0)("isBeingPrinted",e.isPrinting)("expandProblemStatement",e.expandProblemStatement)("collapsed",e.isFeedbackView),s(5),d(!e.submission||e.submission.submitted||!e.isExamSummary?6:-1),s(4),c("icon",e.farListAlt),s(6),d(e.modelingExercise.problemStatement?16:-1)}}var un=(()=>{class n{websocketService=x(Se);modelingSubmissionService=x(Xe);modelingAssessmentService=x(Ze);alertService=x(Ae);route=x(xe);participationWebsocketService=x(Le);guidedTourService=x(Ie);accountService=x(Me);translateService=x(fe);addParticipationToResult=Ge;buildFeedbackTextForReview=Ue;ButtonType=We;modelingEditor;participationId;inputExercise;inputSubmission;inputParticipation;isExamSummary=!1;displayHeader=!0;isPrinting=!1;expandProblemStatement=!1;subscription;manualResultUpdateListener;athenaResultUpdateListener;participation;isOwnerOfParticipation;modelingExercise;modelingParticipationHeader;modelingExerciseHeader;course;result;resultWithComplaint;selectedEntities;selectedRelationships;submission;submissionId;sortedSubmissionHistory;sortedResultHistory;assessmentResult;assessmentsNames={};totalScore;umlModel;hasElements=!1;isSaving=!1;isChanged;retryStarted=!1;autoSaveInterval;autoSaveTimer=0;explanation;automaticSubmissionWebsocketChannel;isAfterAssessmentDueDate;isLoading=!0;isLate;isGeneratingFeedback;ComplaintType=Qe;examMode=!1;submissionChange=new L;submissionObservable=this.submissionChange.asObservable();submissionPatchObservable=new L;resizeOptions={verticalResize:!0};faGripLines=Ee;farListAlt=Be;faExclamationTriangle=Te;faTimeline=ve;isFeedbackView=!1;showResultHistory=!1;ngOnInit(){this.inputValuesArePresent()?this.setupComponentWithInputValues():this.route.params.pipe(j(t=>(this.participationId=t.participationId??this.participationId,this.submissionId=Number(t.submissionId)||void 0,this.isFeedbackView=!!this.submissionId,this.participationId&&this.isFeedbackView?this.fetchSubmissionHistory().pipe(j(()=>this.fetchLatestSubmission())):this.fetchLatestSubmission()))).subscribe({next:t=>{t&&(this.updateModelingSubmission(t),this.setupMode())},error:t=>F(this.alertService,t)}),!this.displayHeader&&this.participationId!==void 0||window.scroll(0,0)}setupMode(){this.modelingExercise.teamMode?this.setupSubmissionStreamForTeam():this.setAutoSaveTimer()}fetchLatestSubmission(){return this.modelingSubmissionService.getLatestSubmissionForModelingEditor(this.participationId).pipe(H(e=>(F(this.alertService,e),V(null))))}fetchSubmissionHistory(){return this.modelingSubmissionService.getSubmissionsWithResultsForParticipation(this.participationId).pipe(H(e=>(F(this.alertService,e),V([]))),ee(e=>{this.sortedSubmissionHistory=e.sort((t,o)=>{let u=this.sortResultsByCompletionDate(t.results??[])[0],C=this.sortResultsByCompletionDate(o.results??[])[0],k=u?.completionDate?f(u.completionDate).valueOf():0,I=C?.completionDate?f(C.completionDate).valueOf():0;return k-I}),this.sortedResultHistory=this.sortedSubmissionHistory.map(t=>{let o;return t?.results&&t.results.length>0&&(o=[...t.results].sort((C,k)=>{let I=C.completionDate?f(C.completionDate).valueOf():0;return(k.completionDate?f(k.completionDate).valueOf():0)-I})[0]),o&&(o.participation=t.participation),o}).filter(t=>!!t)}))}sortResultsByCompletionDate(e){return e.sort((t,o)=>{let u=t.completionDate?f(t.completionDate).valueOf():0;return(o.completionDate?f(o.completionDate).valueOf():0)-u})}inputValuesArePresent(){return!!(this.inputExercise||this.inputSubmission||this.inputParticipation)}setupComponentWithInputValues(){this.inputExercise&&(this.modelingExercise=this.inputExercise),this.inputSubmission&&(this.submission=this.inputSubmission),this.inputParticipation&&(this.participation=this.inputParticipation),this.updateModelAndExplanation()}updateModelingSubmission(e){if(e||this.alertService.error("artemisApp.apollonDiagram.submission.noSubmission"),this.modelingParticipationHeader=e.participation,this.modelingParticipationHeader.submissions=[z(e,"participation")],this.modelingExerciseHeader=this.modelingParticipationHeader.exercise,this.modelingExerciseHeader.studentParticipations=[this.participation],this.isFeedbackView&&this.submissionId&&this.sortedSubmissionHistory){let t=this.sortedSubmissionHistory.find(o=>o.id===this.submissionId);t?e=t:Ce(`Submission with ID ${this.submissionId} not found in sorted history results.`)}this.submission=e,b(e)&&(e.participation.results=[b(e)]),this.participation=e.participation,this.isOwnerOfParticipation=this.accountService.isOwnerOfParticipation(this.participation),this.participation.submissions=[z(e,"participation")],this.modelingExercise=this.participation.exercise,this.course=ye(this.modelingExercise),this.modelingExercise.studentParticipations=[this.participation],this.examMode=!!this.modelingExercise.exerciseGroup,this.modelingExercise.diagramType==null&&(this.modelingExercise.diagramType=Je.ClassDiagram),this.isLate=this.modelingExercise&&!!this.modelingExercise.dueDate&&!!this.participation.initializationDate&&f(this.participation.initializationDate).isAfter(Ke(this.modelingExercise,this.participation)),this.isAfterAssessmentDueDate=!this.modelingExercise.assessmentDueDate||f().isAfter(this.modelingExercise.assessmentDueDate),this.updateModelAndExplanation(),this.subscribeToWebsockets(),(b(this.submission)&&this.isAfterAssessmentDueDate||this.isFeedbackView)&&(this.result=b(this.submission),this.isFeedbackView&&this.submissionId&&(this.result=this.sortedSubmissionHistory.find(t=>t.id===this.submissionId)?.latestResult)),this.resultWithComplaint=Pe(this.submission),this.submission.submitted&&this.result&&this.result.completionDate&&(this.isFeedbackView?this.result&&(this.assessmentResult=this.modelingAssessmentService.convertResult(this.result),this.prepareAssessmentData()):this.modelingAssessmentService.getAssessment(this.submission.id).subscribe(t=>{this.assessmentResult=t,this.prepareAssessmentData()})),this.isLoading=!1,this.guidedTourService.enableTourForExercise(this.modelingExercise,ui,!0)}updateModelAndExplanation(){this.submission.model&&(this.umlModel=JSON.parse(this.submission.model),this.hasElements=this.umlModel.elements&&Object.values(this.umlModel.elements).length!==0),this.explanation=this.submission.explanationText??""}subscribeToWebsockets(){this.submission&&this.submission.id&&(this.submission.submitted?this.subscribeToNewResultsWebsocket():this.subscribeToAutomaticSubmissionWebsocket())}subscribeToAutomaticSubmissionWebsocket(){!this.submission||!this.submission.id||(this.automaticSubmissionWebsocketChannel="/user/topic/modelingSubmission/"+this.submission.id,this.websocketService.subscribe(this.automaticSubmissionWebsocketChannel),this.websocketService.receive(this.automaticSubmissionWebsocketChannel).subscribe(e=>{if(e.submitted){this.submission=e,this.submission.model&&(this.umlModel=JSON.parse(this.submission.model),this.hasElements=this.umlModel.elements&&Object.values(this.umlModel.elements).length!==0);let t=b(this.submission);t&&t.completionDate&&(this.isAfterAssessmentDueDate||t.assessmentType===A.AUTOMATIC_ATHENA)&&this.modelingAssessmentService.getAssessment(this.submission.id).subscribe(o=>{this.assessmentResult=o,this.prepareAssessmentData()}),this.alertService.info("artemisApp.modelingEditor.autoSubmit")}}))}subscribeToNewResultsWebsocket(){if(!this.participation?.id)return;let e=this.participationWebsocketService.subscribeForLatestResultOfParticipation(this.participation.id,!0);this.manualResultUpdateListener=e.pipe(E(t=>!!t),E(t=>!t.assessmentType||t.assessmentType!==A.AUTOMATIC_ATHENA)).subscribe(this.handleManualAssessment.bind(this)),this.athenaResultUpdateListener=e.pipe(Z(1),E(t=>!!t),E(t=>t.assessmentType===A.AUTOMATIC_ATHENA)).subscribe(this.handleAthenaAssessment.bind(this))}handleManualAssessment(e){e.completionDate&&(this.assessmentResult=this.modelingAssessmentService.convertResult(e),this.prepareAssessmentData(),this.alertService.info("artemisApp.modelingEditor.newAssessment"))}handleAthenaAssessment(e){e.completionDate?(this.assessmentResult=this.modelingAssessmentService.convertResult(e),this.prepareAssessmentData(),e.successful&&this.alertService.success("artemisApp.exercise.athenaFeedbackSuccessful")):e.successful===!1&&this.alertService.error("artemisApp.exercise.athenaFeedbackFailed"),this.isGeneratingFeedback=!1}setAutoSaveTimer(){this.autoSaveTimer=0,this.autoSaveInterval=window.setInterval(()=>{this.autoSaveTimer++,this.isChanged=!this.canDeactivate(),this.autoSaveTimer>=30&&this.isChanged&&this.saveDiagram()},1e3)}setupSubmissionStreamForTeam(){let e=window.setInterval(()=>{this.isChanged=!this.canDeactivate(),this.isChanged&&(this.updateSubmissionWithCurrentValues(),this.submissionChange.next(this.submission))},2e3);this.cleanup(()=>clearInterval(e))}onModelPatch(e){if(this.modelingExercise.teamMode){let t=new O(e);t.participation=this.participation,t.participation?.exercise&&(t.participation.exercise.studentParticipations=[]),this.submissionPatchObservable.next(Object.assign({},t))}}cleanup(e){this.subscription??=new Y,this.subscription.add(e)}saveDiagram(){this.isSaving||(this.updateSubmissionWithCurrentValues(),this.isSaving=!0,this.autoSaveTimer=0,this.submission.id?this.modelingSubmissionService.update(this.submission,this.modelingExercise.id).subscribe({next:e=>{this.submission=e.body,this.submission.participation.submissions=[this.submission],this.participationWebsocketService.addParticipation(this.submission.participation,this.modelingExercise),this.result=b(this.submission),this.onSaveSuccess()},error:()=>this.onSaveError()}):this.modelingSubmissionService.create(this.submission,this.modelingExercise.id).subscribe({next:e=>{this.submission=e.body,this.result=b(this.submission),this.subscribeToAutomaticSubmissionWebsocket(),this.onSaveSuccess()},error:()=>this.onSaveError()}))}submit(){if(!this.isSaving){if(this.updateSubmissionWithCurrentValues(),this.isModelEmpty(this.submission.model)){this.alertService.warning("artemisApp.modelingEditor.empty");return}this.isSaving=!0,this.autoSaveTimer=0,this.submission.id?this.modelingSubmissionService.update(this.submission,this.modelingExercise.id).subscribe({next:e=>{this.submission=e.body,this.submission.model&&(this.umlModel=JSON.parse(this.submission.model),this.hasElements=this.umlModel.elements&&Object.values(this.umlModel.elements).length!==0),this.submissionChange.next(this.submission),this.participation=this.submission.participation,this.participation.exercise=this.modelingExercise,this.modelingParticipationHeader=this.submission.participation,this.submission.participation.submissions=[this.submission],this.participationWebsocketService.addParticipation(this.participation,this.modelingExercise),this.modelingExercise.studentParticipations=[this.participation],this.modelingExerciseHeader.studentParticipations=[this.participation],this.result=b(this.submission),this.retryStarted=!1,this.isLate?this.alertService.warning("entity.action.submitDueDateMissedAlert"):this.alertService.success("entity.action.submitSuccessfulAlert"),this.subscribeToWebsockets(),this.automaticSubmissionWebsocketChannel&&this.websocketService.unsubscribe(this.automaticSubmissionWebsocketChannel),this.onSaveSuccess()},error:()=>this.onSaveError()}):this.modelingSubmissionService.create(this.submission,this.modelingExercise.id).subscribe({next:e=>{this.submission=e.body,this.submissionChange.next(this.submission),this.participation=this.submission.participation,this.participation.exercise=this.modelingExercise,this.modelingExercise.studentParticipations=[this.participation],this.result=b(this.submission),this.isLate?this.alertService.warning("artemisApp.modelingEditor.submitDueDateMissed"):this.alertService.success("artemisApp.modelingEditor.submitSuccessful"),this.subscribeToAutomaticSubmissionWebsocket(),this.onSaveSuccess()},error:()=>this.onSaveError()})}}onSaveSuccess(){this.isSaving=!1,this.isChanged=!this.canDeactivate()}onSaveError(){this.alertService.error("artemisApp.modelingEditor.error"),this.isSaving=!1}onReceiveSubmissionFromTeam(e){e.participation.exercise=this.modelingExercise,e.participation.submissions=[e],this.updateModelingSubmission(e)}onReceiveSubmissionPatchFromTeam(e){this.modelingEditor.importPatch(e.patch)}isModelEmpty(e){let t=e?JSON.parse(e):void 0;return!t||!t.elements||Object.values(t.elements).length===0}ngOnDestroy(){this.subscription?.unsubscribe(),clearInterval(this.autoSaveInterval),this.automaticSubmissionWebsocketChannel&&this.websocketService.unsubscribe(this.automaticSubmissionWebsocketChannel),this.manualResultUpdateListener&&this.manualResultUpdateListener.unsubscribe(),this.athenaResultUpdateListener&&this.athenaResultUpdateListener.unsubscribe()}get unreferencedFeedback(){if(this.assessmentResult?.feedbacks)return $(this.assessmentResult.feedbacks),ze(this.assessmentResult.feedbacks)}get referencedFeedback(){if(this.assessmentResult?.feedbacks)return $(this.assessmentResult.feedbacks),this.assessmentResult?.feedbacks?.filter(e=>e.reference!=null)}get hasAthenaResultForLatestSubmission(){return b(this.submission)?.assessmentType===A.AUTOMATIC_ATHENA}updateSubmissionWithCurrentValues(){if(this.submission||(this.submission=new li),this.submission.explanationText=this.explanation,!this.modelingEditor||!this.modelingEditor.getCurrentModel())return;let e=this.modelingEditor.getCurrentModel();this.hasElements=e.elements&&Object.values(e.elements).length!==0;let t=JSON.stringify(e);this.submission&&t&&(this.submission.model=t)}prepareAssessmentData(){this.initializeAssessmentInfo()}initializeAssessmentInfo(){if(this.assessmentResult?.feedbacks&&this.umlModel){this.assessmentsNames=mi(this.assessmentResult,this.umlModel);let e=0;for(let t of this.assessmentResult.feedbacks)e+=t.credits;this.totalScore=e}}onSelectionChanged(e){this.selectedEntities=Object.entries(e.elements).filter(([,t])=>t).map(([t])=>t);for(let t of this.selectedEntities)this.selectedEntities.push(...this.getSelectedChildren(t));this.selectedRelationships=Object.entries(e.relationships).filter(([,t])=>t).map(([t])=>t)}getSelectedChildren(e){return!this.umlModel||!this.umlModel.elements?[]:Object.values(this.umlModel.elements).filter(t=>t.owner===e).map(t=>t.id)}shouldBeDisplayed(e){return(!this.selectedEntities||this.selectedEntities.length===0)&&(!this.selectedRelationships||this.selectedRelationships.length===0)?!0:e.referenceType in $e?this.selectedRelationships.indexOf(e.referenceId)>-1:this.selectedEntities.indexOf(e.referenceId)>-1}canDeactivate(){if(!this.modelingEditor||!this.modelingEditor.isApollonEditorMounted)return!0;let e=this.modelingEditor.getCurrentModel(),t=this.explanation===(this.submission.explanationText??"");return!this.modelHasUnsavedChanges(e)&&t}unloadNotification(e){return this.canDeactivate()?!0:(e.preventDefault(),this.translateService.instant("pendingChanges"))}modelHasUnsavedChanges(e){if(!this.submission||!this.submission.model)return Object.values(e.elements).length>0&&JSON.stringify(e)!=="";if(this.submission&&this.submission.model){let t=JSON.parse(this.submission.model),o=t.version===e.version,u=J(t,"size")===J(e,"size");return o&&!u}return!1}calculateNumberOfModelElements(){if(this.submission&&this.submission.model){let e=JSON.parse(this.submission.model);return e.elements.length+e.relationships.length}return 0}get isActive(){return this.modelingExercise&&!this.examMode&&!Q(this.modelingExercise,this.participation)}get submitButtonTooltip(){return this.isLate?"entity.action.submitDueDateMissedTooltip":this.isActive&&!this.modelingExercise.dueDate?"entity.action.submitNoDueDateTooltip":this.isActive?"entity.action.submitTooltip":"entity.action.dueDateMissedTooltip"}hasExerciseDueDatePassed=Q;static \u0275fac=function(t){return new(t||n)};static \u0275cmp=te({type:n,selectors:[["jhi-modeling-submission"]],viewQuery:function(t,o){if(t&1&&ae(X,5),t&2){let u;re(u=le())&&(o.modelingEditor=u.first)}},hostBindings:function(t,o){t&1&&S("beforeunload",function(C){return o.unloadNotification(C)},!1,ie)},inputs:{participationId:"participationId",inputExercise:"inputExercise",inputSubmission:"inputSubmission",inputParticipation:"inputParticipation",isExamSummary:"isExamSummary",displayHeader:"displayHeader",isPrinting:"isPrinting",expandProblemStatement:"expandProblemStatement"},decls:6,vars:4,consts:[[3,"id"],[1,"d-block","mb-4",3,"exercise","participation"],["pagetitle",""],[1,"font-weight-normal"],["submitbutton",""],["id","toggleTimeline",3,"click","icon","title"],["id","Continue",3,"title","routerLink"],[3,"generatingFeedback","exercise","pendingChanges","hasAthenaResultForLatestSubmission","isGeneratingFeedback","isSubmitted"],["id","submit-modeling-submission",1,"guided-tour","submission-button",3,"onClick","disabled","title","isLoading","btnType","tooltip"],[1,"mb-4"],["id","result-history",1,"row","mb-2"],[3,"results","exercise","selectedResultId"],[3,"isExerciseParticipation","isBeingPrinted","expandProblemStatement","collapsed"],["left-body",""],["right-header","",3,"icon"],["right-header","","id","problem-statement","jhiTranslate","artemisApp.modelingSubmission.problemStatement"],["right-body","",1,"mb-3","markdown-preview"],[1,"w-100"],[1,"submission-container","d-flex","flex-column","w-100"],[1,"d-flex","flex-column","flex-md-row"],[1,"column",2,"display","flex","flex-direction","column","flex-grow","1"],[1,"row",2,"flex-grow","1","display","flex"],[1,"flex-shrink-0","align-self-end","align-self-md-stretch","mb-2","ms-md-2","ms-lg-3"],[3,"exercise","participation","typing$","dockedToRightSide"],[1,"col-12","editor-large"],[3,"explanationChange","onModelPatch","readOnly","umlModel","diagramType","withExplanation","explanation","resizeOptions","savedStatus"],[1,"rg-bottom","text-lightgrey",3,"icon"],[3,"receiveSubmission","receiveSubmissionPatch","exerciseType","submissionObservable","submissionPatchObservable","participation"],[1,"col-8","editor-assessment"],[3,"selectionChanged","umlModel","resultFeedbacks","diagramType","maxScore","maxBonusPoints","readOnly","enablePopups","displayPoints","course","explanation"],[1,"col-4","pt-5","editor-assessment","overflow-auto"],["jhiTranslate","artemisApp.modelingSubmission.assessment.title"],["jhiTranslate","artemisApp.modelingSubmission.assessment.noAssessment"],["jhiTranslate","artemisApp.modelingSubmission.assessment.instructions"],["id","component-feedback-table",1,"table"],[1,"thead-light"],["jhiTranslate","artemisApp.modelingSubmission.assessment.element"],["jhiTranslate","artemisApp.modelingSubmission.assessment.score",1,"text-center"],[3,"hidden"],[1,"text-center"],[1,"text-primary"],[3,"ngClass"],[3,"innerHTML"],[1,"text-secondary",3,"icon","ngbTooltip"],[1,"row"],[1,"col-xl-8","mt-3","alert","unreferencedFeedback",3,"feedback","additional","course"],[1,"mt-2","alert","alert-info",3,"result"],[3,"exercise","participation","result"]],template:function(t,o){t&1&&(m(0,"div",0),i(1,`
    `),h(2,Ai,16,8)(3,ki,9,3)(4,$i,20,7),r(),i(5,`
`)),t&2&&(c("id","exercise-"+(o.modelingExercise==null?null:o.modelingExercise.id)),s(2),d(o.displayHeader?2:-1),s(),d(o.isFeedbackView&&o.showResultHistory?3:-1),s(),d(o.modelingExercise?4:-1))},dependencies:[ei,Ne,_e,Ye,si,oi,ni,di,X,He,ti,ci,je,he,ge,ai,ii,ri,be,Ve,qe],styles:[".submission-container[_ngcontent-%COMP%]{min-height:100vh}jhi-modeling-editor[_ngcontent-%COMP%]{width:100%}jhi-modeling-assessment[_ngcontent-%COMP%]{width:100%}.editor-large[_ngcontent-%COMP%]{min-height:100vh}.editor-assessment[_ngcontent-%COMP%]{max-width:70vw;height:100vh}.rg-bottom[_ngcontent-%COMP%]{align-self:center;cursor:row-resize}@media print{.submission-container[_ngcontent-%COMP%]{min-height:auto!important;height:auto!important;page-break-inside:avoid!important}}"]})}return n})();export{un as a};
//# sourceMappingURL=chunk-T4P5LSLH.js.map
