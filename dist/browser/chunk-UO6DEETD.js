import{a as H}from"./chunk-IYZATYZW.js";import{a as gt}from"./chunk-TOBAE4UH.js";import{a as Et}from"./chunk-6U46KDQO.js";import{a as Tt,b as At,c as It}from"./chunk-RJFCCH4I.js";import{a as Ft}from"./chunk-7OWNIVQU.js";import{b as oe}from"./chunk-3DNS47RB.js";import{a as ht}from"./chunk-QGGSPP32.js";import{a as ft}from"./chunk-H7UNTMXY.js";import{b as fe}from"./chunk-GGF54D4U.js";import{a as St}from"./chunk-GITU5WHL.js";import{a as Ct,g as xt}from"./chunk-VJKFYSDP.js";import{a as pt}from"./chunk-POPNQ63B.js";import{a as _t}from"./chunk-HPCUFM6M.js";import{a as le}from"./chunk-SLVT6IA5.js";import{e as ae,f as bt}from"./chunk-FAFORKWV.js";import{b as dt}from"./chunk-W3K7VYWC.js";import{b as ut}from"./chunk-22YQSX6Z.js";import{D as mt}from"./chunk-5AQXEKLE.js";import{b as K,j as re}from"./chunk-3JSWSN6W.js";import{k as lt,l as ct}from"./chunk-DXTZ4GAW.js";import{d as st}from"./chunk-6EYB5QBP.js";import{b as nt}from"./chunk-O26CMRR4.js";import{a as z}from"./chunk-PMK72D73.js";import{b as rt,c as ot,d as at}from"./chunk-DRMCDU75.js";import{b as et}from"./chunk-PUNMJFMR.js";import{a as it}from"./chunk-7VLYAOO4.js";import{u as Qe,v as Ge}from"./chunk-VZRSC3LP.js";import{K as Ve,i as Be,k as Ue,n as je}from"./chunk-WA5GEAJB.js";import{m as tt}from"./chunk-VK7JPHFE.js";import{c as Je}from"./chunk-BNDLMKXK.js";import{e as Ze}from"./chunk-5GXY5RYT.js";import{c as ie}from"./chunk-JXJXC4DZ.js";import{d as ne}from"./chunk-EDXSOKK5.js";import{a as w,b as $e}from"./chunk-R5BZWVRQ.js";import{p as te}from"./chunk-DID2YGL7.js";import{c as pe,f as He,k as Ye}from"./chunk-CXQURQM5.js";import{Cd as ze,Oc as Xe,Za as Ke,fa as qe}from"./chunk-Z4VHWOB5.js";import{a as se}from"./chunk-U54OSGNH.js";import{f as Me,h as Oe,i as Pe}from"./chunk-M6Z6DKZQ.js";import{c as We}from"./chunk-E2KBL4LX.js";import{i as we,n as Ne,t as ee}from"./chunk-IOA4DPXY.js";import{Cc as Q,Db as f,Dc as q,Ea as I,Ed as M,Ma as k,Mc as U,Na as L,Oc as x,Rc as Ie,Tb as V,Va as Te,Yc as $,Zb as E,Zc as Z,_c as J,cd as W,dd as c,ed as ve,kc as _,ld as De,md as ye,nd as ke,oa as he,qd as Le,ra as Y,rd as de,s as Ee,sc as R,sd as Re,x as ue,xb as Ae,xc as b,ya as Fe,yc as C,z as Se,zc as T}from"./chunk-5LC5EQRR.js";import{g as wt,j}from"./chunk-3E746U5Y.js";var ge=/[^a-zA-Z0-9]/,_e=/\s/,be=/[\r\n]/,vt=/\n\r?\n$/,Dt=/^\r?\n\r?\n/;var h=function(a){return a[a.DIFF_DELETE=-1]="DIFF_DELETE",a[a.DIFF_INSERT=1]="DIFF_INSERT",a[a.DIFF_EQUAL=0]="DIFF_EQUAL",a}(h||{});var Ce={};wt(Ce,{max:()=>Mt,min:()=>Nt});function Nt(a,t){return a<t?a:t}function Mt(a,t){return a>t?a:t}var N=Ce;var G=class{diffs=[];start1=0;start2=0;length1=0;length2=0;toString(){let t,e;this.length1===0?t=this.start1+",0":this.length1===1?t=this.start1+1:t=this.start1+1+","+this.length1,this.length2===0?e=this.start2+",0":this.length2===1?e=this.start2+1:e=this.start2+1+","+this.length2;let i=["@@ -"+t+" +"+e+` @@
`],n;for(let s=0;s<this.diffs.length;s++){switch(this.diffs[s][0]){case h.DIFF_INSERT:n="+";break;case h.DIFF_DELETE:n="-";break;case h.DIFF_EQUAL:n=" ";break}i[s+1]=n+encodeURI(this.diffs[s][1])+`
`}return i.join("").replace(/%20/g," ")}};var ce=class{diffTimeout=1;diffEditCost=4;matchThreshold=.5;matchDistance=1e3;patchDeleteThreshold=.5;patchMargin=4;matchMaxBits=32;diff_main(t,e,i,n){typeof n>"u"&&(this.diffTimeout<=0?n=Number.MAX_VALUE:n=Date.now()+this.diffTimeout*1e3);let s=n;if(t==null||e==null)throw new Error("Null input. (diff_main)");if(t===e)return t?[[h.DIFF_EQUAL,t]]:[];typeof i>"u"&&(i=!0);let r=i,o=this.diff_commonPrefix(t,e),l=t.substring(0,o);t=t.substring(o),e=e.substring(o),o=this.diff_commonSuffix(t,e);let m=t.substring(t.length-o);t=t.substring(0,t.length-o),e=e.substring(0,e.length-o);let u=this.diff_compute_(t,e,r,s);return l&&u.unshift([h.DIFF_EQUAL,l]),m&&u.push([h.DIFF_EQUAL,m]),this.diff_cleanupMerge(u),u}diff_commonPrefix(t,e){if(!t||!e||t.charAt(0)!==e.charAt(0))return 0;let i=0,n=N.min(t.length,e.length),s=n,r=0;for(;i<s;)t.substring(r,s)===e.substring(r,s)?(i=s,r=i):n=s,s=Math.floor((n-i)/2+i);return s}diff_commonSuffix(t,e){if(!t||!e||t.charAt(t.length-1)!==e.charAt(e.length-1))return 0;let i=0,n=N.min(t.length,e.length),s=n,r=0;for(;i<s;)t.substring(t.length-s,t.length-r)===e.substring(e.length-s,e.length-r)?(i=s,r=i):n=s,s=Math.floor((n-i)/2+i);return s}diff_cleanupSemantic(t){let e=!1,i=[],n=0,s=null,r=0,o=0,l=0,m=0,u=0;for(;r<t.length;)t[r][0]===h.DIFF_EQUAL?(i[n++]=r,o=m,l=u,m=0,u=0,s=t[r][1]):(t[r][0]===h.DIFF_INSERT?m+=t[r][1].length:u+=t[r][1].length,s&&s.length<=N.max(o,l)&&s.length<=N.max(m,u)&&(t.splice(i[n-1],0,[h.DIFF_DELETE,s]),t[i[n-1]+1][0]=h.DIFF_INSERT,n--,n--,r=n>0?i[n-1]:-1,o=0,l=0,m=0,u=0,s=null,e=!0)),r++;for(e&&this.diff_cleanupMerge(t),this.diff_cleanupSemanticLossless(t),r=1;r<t.length;){if(t[r-1][0]===h.DIFF_DELETE&&t[r][0]===h.DIFF_INSERT){let p=t[r-1][1],d=t[r][1],g=this.diff_commonOverlap_(p,d),A=this.diff_commonOverlap_(d,p);g>=A?(g>=p.length/2||g>=d.length/2)&&(t.splice(r,0,[h.DIFF_EQUAL,d.substring(0,g)]),t[r-1][1]=p.substring(0,p.length-g),t[r+1][1]=d.substring(g),r++):(A>=p.length/2||A>=d.length/2)&&(t.splice(r,0,[h.DIFF_EQUAL,p.substring(0,A)]),t[r-1][0]=h.DIFF_INSERT,t[r-1][1]=d.substring(0,d.length-A),t[r+1][0]=h.DIFF_DELETE,t[r+1][1]=p.substring(A),r++),r++}r++}}diff_cleanupSemanticLossless(t){let e=1;for(;e<t.length-1;){if(t[e-1][0]===h.DIFF_EQUAL&&t[e+1][0]===h.DIFF_EQUAL){let i=t[e-1][1],n=t[e][1],s=t[e+1][1],r=this.diff_commonSuffix(i,n);if(r){let p=n.substring(n.length-r);i=i.substring(0,i.length-r),n=p+n.substring(0,n.length-r),s=p+s}let o=i,l=n,m=s,u=this.diff_cleanupSemanticScore_(i,n)+this.diff_cleanupSemanticScore_(n,s);for(;n.charAt(0)===s.charAt(0);){i+=n.charAt(0),n=n.substring(1)+s.charAt(0),s=s.substring(1);let p=this.diff_cleanupSemanticScore_(i,n)+this.diff_cleanupSemanticScore_(n,s);p>=u&&(u=p,o=i,l=n,m=s)}t[e-1][1]!==o&&(o?t[e-1][1]=o:(t.splice(e-1,1),e--),t[e][1]=l,m?t[e+1][1]=m:(t.splice(e+1,1),e--))}e++}}diff_cleanupEfficiency(t){let e=!1,i=[],n=0,s=null,r=0,o=!1,l=!1,m=!1,u=!1;for(;r<t.length;)t[r][0]===h.DIFF_EQUAL?(t[r][1].length<this.diffEditCost&&(m||u)?(i[n++]=r,o=m,l=u,s=t[r][1]):(n=0,s=null),m=u=!1):(t[r][0]===h.DIFF_DELETE?u=!0:m=!0,s&&(o&&l&&m&&u||s.length<this.diffEditCost/2&&Number(o)+Number(l)+Number(m)+Number(u)===3)&&(t.splice(i[n-1],0,[h.DIFF_DELETE,s]),t[i[n-1]+1][0]=h.DIFF_INSERT,n--,s=null,o&&l?(m=u=!0,n=0):(n--,r=n>0?i[n-1]:-1,m=u=!1),e=!0)),r++;e&&this.diff_cleanupMerge(t)}diff_cleanupMerge(t){t.push([h.DIFF_EQUAL,""]);let e=0,i=0,n=0,s="",r="",o;for(;e<t.length;)switch(t[e][0]){case h.DIFF_INSERT:n++,r+=t[e][1],e++;break;case h.DIFF_DELETE:i++,s+=t[e][1],e++;break;case h.DIFF_EQUAL:i+n>1?(i!==0&&n!==0&&(o=this.diff_commonPrefix(r,s),o!==0&&(e-i-n>0&&t[e-i-n-1][0]===h.DIFF_EQUAL?t[e-i-n-1][1]+=r.substring(0,o):(t.splice(0,0,[h.DIFF_EQUAL,r.substring(0,o)]),e++),r=r.substring(o),s=s.substring(o)),o=this.diff_commonSuffix(r,s),o!==0&&(t[e][1]=r.substring(r.length-o)+t[e][1],r=r.substring(0,r.length-o),s=s.substring(0,s.length-o))),e-=i+n,t.splice(e,i+n),s.length&&(t.splice(e,0,[h.DIFF_DELETE,s]),e++),r.length&&(t.splice(e,0,[h.DIFF_INSERT,r]),e++),e++):e!==0&&t[e-1][0]===h.DIFF_EQUAL?(t[e-1][1]+=t[e][1],t.splice(e,1)):e++,n=0,i=0,s="",r="";break}t[t.length-1][1]===""&&t.pop();let l=!1;for(e=1;e<t.length-1;)t[e-1][0]===h.DIFF_EQUAL&&t[e+1][0]===h.DIFF_EQUAL&&(t[e][1].substring(t[e][1].length-t[e-1][1].length)===t[e-1][1]?(t[e][1]=t[e-1][1]+t[e][1].substring(0,t[e][1].length-t[e-1][1].length),t[e+1][1]=t[e-1][1]+t[e+1][1],t.splice(e-1,1),l=!0):t[e][1].substring(0,t[e+1][1].length)===t[e+1][1]&&(t[e-1][1]+=t[e+1][1],t[e][1]=t[e][1].substring(t[e+1][1].length)+t[e+1][1],t.splice(e+1,1),l=!0)),e++;l&&this.diff_cleanupMerge(t)}diff_xIndex(t,e){let i=0,n=0,s=0,r=0,o;for(o=0;o<t.length&&(t[o][0]!==h.DIFF_INSERT&&(i+=t[o][1].length),t[o][0]!==h.DIFF_DELETE&&(n+=t[o][1].length),!(i>e));o++)s=i,r=n;return t.length!==o&&t[o][0]===h.DIFF_DELETE?r:r+(e-s)}diff_prettyHtml(t){let e=[],i=/&/g,n=/</g,s=/>/g,r=/\n/g;for(let o=0;o<t.length;o++){let l=t[o][0],u=t[o][1].replace(i,"&amp;").replace(n,"&lt;").replace(s,"&gt;").replace(r,"&para;<br>");switch(l){case h.DIFF_INSERT:e[o]='<ins style="background:#e6ffe6;">'+u+"</ins>";break;case h.DIFF_DELETE:e[o]='<del style="background:#ffe6e6;">'+u+"</del>";break;case h.DIFF_EQUAL:e[o]="<span>"+u+"</span>";break}}return e.join("")}diff_text1(t){let e=[];for(let i=0;i<t.length;i++)t[i][0]!==h.DIFF_INSERT&&(e[i]=t[i][1]);return e.join("")}diff_text2(t){let e=[];for(let i=0;i<t.length;i++)t[i][0]!==h.DIFF_DELETE&&(e[i]=t[i][1]);return e.join("")}diff_levenshtein(t){let e=0,i=0,n=0;for(let s=0;s<t.length;s++){let r=t[s][0],o=t[s][1];switch(r){case h.DIFF_INSERT:i+=o.length;break;case h.DIFF_DELETE:n+=o.length;break;case h.DIFF_EQUAL:e+=N.max(i,n),i=0,n=0;break}}return e+=N.max(i,n),e}diff_toDelta(t){let e=[];for(let i=0;i<t.length;i++)switch(t[i][0]){case h.DIFF_INSERT:e[i]="+"+encodeURI(t[i][1]);break;case h.DIFF_DELETE:e[i]="-"+t[i][1].length;break;case h.DIFF_EQUAL:e[i]="="+t[i][1].length;break}return e.join("	").replace(/%20/g," ")}diff_fromDelta(t,e){let i=[],n=0,s=0,r=e.split(/\t/g);for(let o=0;o<r.length;o++){let l=r[o].substring(1);switch(r[o].charAt(0)){case"+":try{i[n++]=[h.DIFF_INSERT,decodeURI(l)]}catch{throw new Error("Illegal escape in diff_fromDelta: "+l)}break;case"-":case"=":let m=parseInt(l,10);if(isNaN(m)||m<0)throw new Error("Invalid number in diff_fromDelta: "+l);let u=t.substring(s,s+=m);r[o].charAt(0)==="="?i[n++]=[h.DIFF_EQUAL,u]:i[n++]=[h.DIFF_DELETE,u];break;default:if(r[o])throw new Error("Invalid diff operation in diff_fromDelta: "+r[o])}}if(s!==t.length)throw new Error("Delta length ("+s+") does not equal source text length ("+t.length+")");return i}diff_linesToChars(t,e){let i=[],n={};i[0]="";let s=this.diff_linesToCharsMunge_(t,i,n,4e4),r=this.diff_linesToCharsMunge_(e,i,n,65535);return{chars1:s,chars2:r,lineArray:i}}diff_charsToLines(t,e){for(let i=0;i<t.length;i++){let n=t[i][1],s=[];for(let r=0;r<n.length;r++)s[r]=e[n.charCodeAt(r)];t[i][1]=s.join("")}}match_main(t,e,i){if(t==null||e==null||i==null)throw new Error("Null input. (match_main)");return i=N.max(0,N.min(i,t.length)),t===e?0:t.length?t.substring(i,i+e.length)===e?i:this.match_bitap_(t,e,i):-1}patch_make(t,e,i){let n,s;if(typeof t=="string"&&typeof e=="string"&&typeof i>"u")n=t,s=this.diff_main(n,e,!0),s.length>2&&(this.diff_cleanupSemantic(s),this.diff_cleanupEfficiency(s));else if(t&&typeof t=="object"&&typeof e>"u"&&typeof i>"u")s=t,n=this.diff_text1(s);else if(typeof t=="string"&&e&&typeof e=="object"&&typeof i>"u")n=t,s=e;else if(typeof t=="string"&&typeof e=="string"&&i&&typeof i=="object")n=t,s=i;else throw new Error("Unknown call format to patch_make");if(s.length===0)return[];let r=[],o=new G,l=0,m=0,u=0,p=n,d=n;for(let g=0;g<s.length;g++){let A=s[g][0],S=s[g][1];switch(!l&&A!==h.DIFF_EQUAL&&(o.start1=m,o.start2=u),A){case h.DIFF_INSERT:o.diffs[l++]=s[g],o.length2+=S.length,d=d.substring(0,u)+S+d.substring(u);break;case h.DIFF_DELETE:o.length1+=S.length,o.diffs[l++]=s[g],d=d.substring(0,u)+d.substring(u+S.length);break;case h.DIFF_EQUAL:S.length<=2*this.patchMargin&&l&&s.length!==g+1?(o.diffs[l++]=s[g],o.length1+=S.length,o.length2+=S.length):S.length>=2*this.patchMargin&&l&&(this.patch_addContext_(o,p),r.push(o),o=new G,l=0,p=d,m=u);break}A!==h.DIFF_INSERT&&(m+=S.length),A!==h.DIFF_DELETE&&(u+=S.length)}return l&&(this.patch_addContext_(o,p),r.push(o)),r}patch_deepCopy(t){let e=[];for(let i=0;i<t.length;i++){let n=t[i],s=new G;for(let r=0;r<n.diffs.length;r++)s.diffs[r]=[n.diffs[r][0],n.diffs[r][1]];s.start1=n.start1,s.start2=n.start2,s.length1=n.length1,s.length2=n.length2,e[i]=s}return e}patch_apply(t,e){if(t.length===0)return[e,[]];t=this.patch_deepCopy(t);let i=this.patch_addPadding(t);e=i+e+i,this.patch_splitMax(t);let n=0,s=[];for(let r=0;r<t.length;r++){let o=t[r].start2+n,l=this.diff_text1(t[r].diffs),m,u=-1;if(l.length>this.matchMaxBits?(m=this.match_main(e,l.substring(0,this.matchMaxBits),o),m!==-1&&(u=this.match_main(e,l.substring(l.length-this.matchMaxBits),o+l.length-this.matchMaxBits),(u===-1||m>=u)&&(m=-1))):m=this.match_main(e,l,o),m===-1)s[r]=!1,n-=t[r].length2-t[r].length1;else{s[r]=!0,n=m-o;let p;if(u===-1?p=e.substring(m,m+l.length):p=e.substring(m,u+this.matchMaxBits),l===p)e=e.substring(0,m)+this.diff_text2(t[r].diffs)+e.substring(m+l.length);else{let d=this.diff_main(l,p,!1);if(l.length>this.matchMaxBits&&this.diff_levenshtein(d)/l.length>this.patchDeleteThreshold)s[r]=!1;else{this.diff_cleanupSemanticLossless(d);let g=0,A=0;for(let S=0;S<t[r].diffs.length;S++){let F=t[r].diffs[S];F[0]!==h.DIFF_EQUAL&&(A=this.diff_xIndex(d,g)),F[0]===h.DIFF_INSERT?e=e.substring(0,m+A)+F[1]+e.substring(m+A):F[0]===h.DIFF_DELETE&&(e=e.substring(0,m+A)+e.substring(m+this.diff_xIndex(d,g+F[1].length))),F[0]!==h.DIFF_DELETE&&(g+=F[1].length)}}}}}return e=e.substring(i.length,e.length-i.length),[e,s]}patch_addPadding(t){let e=this.patchMargin,i="";for(let r=1;r<=e;r++)i+=String.fromCharCode(r);for(let r=0;r<t.length;r++)t[r].start1+=e,t[r].start2+=e;let n=t[0],s=n.diffs;if(s.length===0||s[0][0]!==h.DIFF_EQUAL)s.unshift([h.DIFF_EQUAL,i]),n.start1-=e,n.start2-=e,n.length1+=e,n.length2+=e;else if(e>s[0][1].length){let r=e-s[0][1].length;s[0][1]=i.substring(s[0][1].length)+s[0][1],n.start1-=r,n.start2-=r,n.length1+=r,n.length2+=r}if(n=t[t.length-1],s=n.diffs,s.length===0||s[s.length-1][0]!==h.DIFF_EQUAL)s.push([h.DIFF_EQUAL,i]),n.length1+=e,n.length2+=e;else if(e>s[s.length-1][1].length){let r=e-s[s.length-1][1].length;s[s.length-1][1]+=i.substring(0,r),n.length1+=r,n.length2+=r}return i}patch_splitMax(t){let e=this.matchMaxBits;for(let i=0;i<t.length;i++){if(t[i].length1<=e)continue;let n=t[i];t.splice(i--,1);let s=n.start1,r=n.start2,o="";for(;n.diffs.length!==0;){let l=new G,m=!0;for(l.start1=s-o.length,l.start2=r-o.length,o!==""&&(l.length1=l.length2=o.length,l.diffs.push([h.DIFF_EQUAL,o]));n.diffs.length!==0&&l.length1<e-this.patchMargin;){let p=n.diffs[0][0],d=n.diffs[0][1];p===h.DIFF_INSERT?(l.length2+=d.length,r+=d.length,l.diffs.push(n.diffs.shift()),m=!1):p===h.DIFF_DELETE&&l.diffs.length===1&&l.diffs[0][0]===h.DIFF_EQUAL&&d.length>2*e?(l.length1+=d.length,s+=d.length,m=!1,l.diffs.push([p,d]),n.diffs.shift()):(d=d.substring(0,e-l.length1-this.patchMargin),l.length1+=d.length,s+=d.length,p===h.DIFF_EQUAL?(l.length2+=d.length,r+=d.length):m=!1,l.diffs.push([p,d]),d===n.diffs[0][1]?n.diffs.shift():n.diffs[0][1]=n.diffs[0][1].substring(d.length))}o=this.diff_text2(l.diffs),o=o.substring(o.length-this.patchMargin);let u=this.diff_text1(n.diffs).substring(0,this.patchMargin);u!==""&&(l.length1+=u.length,l.length2+=u.length,l.diffs.length!==0&&l.diffs[l.diffs.length-1][0]===h.DIFF_EQUAL?l.diffs[l.diffs.length-1][1]+=u:l.diffs.push([h.DIFF_EQUAL,u])),m||t.splice(++i,0,l)}}}patch_toText(t){let e=[];for(let i=0;i<t.length;i++)e[i]=t[i];return e.join("")}patch_fromText(t){let e=[];if(!t)return e;let i=t.split(`
`),n=0,s=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;for(;n<i.length;){let r=i[n].match(s);if(!r)throw new Error("Invalid patch string: "+i[n]);let o=new G;e.push(o),o.start1=parseInt(r[1],10),r[2]===""?(o.start1--,o.length1=1):r[2]==="0"?o.length1=0:(o.start1--,o.length1=parseInt(r[2],10)),o.start2=parseInt(r[3],10),r[4]===""?(o.start2--,o.length2=1):r[4]==="0"?o.length2=0:(o.start2--,o.length2=parseInt(r[4],10)),n++;let l,m,u;for(;n<i.length;){l=i[n].charAt(0),u=i[n].substring(1);try{m=decodeURI(u)}catch{throw new Error("Illegal escape in patch_fromText: "+u)}if(l==="-")o.diffs.push([h.DIFF_DELETE,m]);else if(l==="+")o.diffs.push([h.DIFF_INSERT,m]);else if(l===" ")o.diffs.push([h.DIFF_EQUAL,m]);else{if(l==="@")break;if(l!=="")throw new Error('Invalid patch mode "'+l+'" in: '+m)}n++}}return e}diff_compute_(t,e,i,n){let s;if(!t)return[[h.DIFF_INSERT,e]];if(!e)return[[h.DIFF_DELETE,t]];let r=t.length>e.length?t:e,o=t.length>e.length?e:t,l=r.indexOf(o);if(l!==-1)return s=[[h.DIFF_INSERT,r.substring(0,l)],[h.DIFF_EQUAL,o],[h.DIFF_INSERT,r.substring(l+o.length)]],t.length>e.length&&(s[0][0]=h.DIFF_DELETE,s[2][0]=h.DIFF_DELETE),s;if(o.length===1)return[[h.DIFF_DELETE,t],[h.DIFF_INSERT,e]];let m=this.diff_halfMatch_(t,e);if(m){let u=m[0],p=m[1],d=m[2],g=m[3],A=m[4],S=this.diff_main(u,d,i,n),F=this.diff_main(p,g,i,n);return S.concat([[h.DIFF_EQUAL,A]],F)}return i&&t.length>100&&e.length>100?this.diff_lineMode_(t,e,n):this.diff_bisect_(t,e,n)}diff_lineMode_(t,e,i){let n=this.diff_linesToChars(t,e);t=n.chars1,e=n.chars2;let s=n.lineArray,r=this.diff_main(t,e,!1,i);this.diff_charsToLines(r,s),this.diff_cleanupSemantic(r),r.push([h.DIFF_EQUAL,""]);let o=0,l=0,m=0,u="",p="";for(;o<r.length;){switch(r[o][0]){case h.DIFF_INSERT:m++,p+=r[o][1];break;case h.DIFF_DELETE:l++,u+=r[o][1];break;case h.DIFF_EQUAL:if(l>=1&&m>=1){r.splice(o-l-m,l+m),o=o-l-m;let d=this.diff_main(u,p,!1,i);for(let g=d.length-1;g>=0;g--)r.splice(o,0,d[g]);o=o+d.length}m=0,l=0,u="",p="";break}o++}return r.pop(),r}diff_bisect_(t,e,i){let n=t.length,s=e.length,r=Math.ceil((n+s)/2),o=r,l=2*r,m=new Array(l),u=new Array(l);for(let D=0;D<l;D++)m[D]=-1,u[D]=-1;m[o+1]=0,u[o+1]=0;let p=n-s,d=p%2!==0,g=0,A=0,S=0,F=0;for(let D=0;D<r&&!(Date.now()>i);D++){for(let y=-D+g;y<=D-A;y+=2){let O=o+y,v;y===-D||y!==D&&m[O-1]<m[O+1]?v=m[O+1]:v=m[O-1]+1;let P=v-y;for(;v<n&&P<s&&t.charAt(v)===e.charAt(P);)v++,P++;if(m[O]=v,v>n)A+=2;else if(P>s)g+=2;else if(d){let B=o+p-y;if(B>=0&&B<l&&u[B]!==-1){let X=n-u[B];if(v>=X)return this.diff_bisectSplit_(t,e,v,P,i)}}}for(let y=-D+S;y<=D-F;y+=2){let O=o+y,v;y===-D||y!==D&&u[O-1]<u[O+1]?v=u[O+1]:v=u[O-1]+1;let P=v-y;for(;v<n&&P<s&&t.charAt(n-v-1)===e.charAt(s-P-1);)v++,P++;if(u[O]=v,v>n)F+=2;else if(P>s)S+=2;else if(!d){let B=o+p-y;if(B>=0&&B<l&&m[B]!==-1){let X=m[B],Rt=o+X-B;if(v=n-v,X>=v)return this.diff_bisectSplit_(t,e,X,Rt,i)}}}}return[[h.DIFF_DELETE,t],[h.DIFF_INSERT,e]]}diff_bisectSplit_(t,e,i,n,s){let r=t.substring(0,i),o=e.substring(0,n),l=t.substring(i),m=e.substring(n),u=this.diff_main(r,o,!1,s),p=this.diff_main(l,m,!1,s);return u.concat(p)}diff_linesToCharsMunge_(t,e,i,n){let s="",r=0,o=-1,l=e.length;for(;o<t.length-1;){o=t.indexOf(`
`,r),o===-1&&(o=t.length-1);let m=t.substring(r,o+1);(i.hasOwnProperty?i.hasOwnProperty(m):i[m]!==void 0)?s+=String.fromCharCode(i[m]):(l===n&&(m=t.substring(r),o=t.length),s+=String.fromCharCode(l),i[m]=l,e[l++]=m),r=o+1}return s}diff_commonOverlap_(t,e){let i=t.length,n=e.length;if(i===0||n===0)return 0;i>n?t=t.substring(i-n):i<n&&(e=e.substring(0,i));let s=N.min(i,n);if(t===e)return s;let r=0,o=1;for(;;){let l=t.substring(s-o),m=e.indexOf(l);if(m===-1)return r;o+=m,(m===0||t.substring(s-o)===e.substring(0,o))&&(r=o,o++)}}diff_halfMatch_(t,e){if(this.diffTimeout<=0)return null;let i=t.length>e.length?t:e,n=t.length>e.length?e:t;if(i.length<4||n.length*2<i.length)return null;let s=this.diff_halfMatchI_(i,n,Math.ceil(i.length/4)),r=this.diff_halfMatchI_(i,n,Math.ceil(i.length/2)),o;if(!s&&!r)return null;r?s?o=s[4].length>r[4].length?s:r:o=r:o=s;let l,m,u,p,d=o[4];return t.length>e.length?(l=o[0],m=o[1],u=o[2],p=o[3]):(u=o[0],p=o[1],l=o[2],m=o[3]),[l,m,u,p,d]}diff_halfMatchI_(t,e,i){let n=t.substring(i,i+Math.floor(t.length/4)),s="",r,o,l,m,u=e.indexOf(n,0);for(;u!==-1;){let p=this.diff_commonPrefix(t.substring(i),e.substring(u)),d=this.diff_commonSuffix(t.substring(0,i),e.substring(0,u));s.length<d+p&&(s=e.substring(u-d,u)+e.substring(u,u+p),r=t.substring(0,i-d),o=t.substring(i+p),l=e.substring(0,u-d),m=e.substring(u+p)),u=e.indexOf(n,u+1)}return s.length*2>=t.length?[r,o,l,m,s]:null}diff_cleanupSemanticScore_(t,e){if(!t||!e)return 6;let i=t.charAt(t.length-1),n=e.charAt(0),s=i.match(ge),r=n.match(ge),o=s&&i.match(_e),l=r&&n.match(_e),m=o&&i.match(be),u=l&&n.match(be),p=m&&t.match(vt),d=u&&e.match(Dt);return p||d?5:m||u?4:s&&!o&&l?3:o||l?2:s||r?1:0}match_bitap_(t,e,i){if(e.length>this.matchMaxBits)throw new Error("Pattern too long for this browser");let n=this.match_alphabet_(e),s=this.matchThreshold,r=t.indexOf(e,i);r!==-1&&(s=N.min(this.match_bitapScore_(0,r,e,i),s),r=t.lastIndexOf(e,i+e.length),r!==-1&&(s=N.min(this.match_bitapScore_(0,r,e,i),s)));let o=1<<e.length-1;r=-1;let l,m,u=e.length+t.length,p;for(let d=0;d<e.length;d++){for(l=0,m=u;l<m;)this.match_bitapScore_(d,i+m,e,i)<=s?l=m:u=m,m=Math.floor((u-l)/2+l);u=m;let g=N.max(1,i-m+1),A=N.min(i+m,t.length)+e.length,S=Array(A+2);S[A+1]=(1<<d)-1;for(let F=A;F>=g;F--){let D=n[t.charAt(F-1)];if(d===0?S[F]=(S[F+1]<<1|1)&D:S[F]=(S[F+1]<<1|1)&D|((p[F+1]|p[F])<<1|1)|p[F+1],S[F]&o){let y=this.match_bitapScore_(d,F-1,e,i);if(y<=s)if(s=y,r=F-1,r>i)g=N.max(1,2*i-r);else break}}if(this.match_bitapScore_(d+1,i,e,i)>s)break;p=S}return r}match_bitapScore_(t,e,i,n){let s=t/i.length,r=Math.abs(n-e);return this.matchDistance?s+r/this.matchDistance:r?1:s}match_alphabet_(t){let e={};for(let i=0;i<t.length;i++)e[t.charAt(i)]=0;for(let i=0;i<t.length;i++)e[t.charAt(i)]|=1<<t.length-i-1;return e}patch_addContext_(t,e){if(e.length===0)return;if(t.start2==null)throw Error("patch not initialized");let i=e.substring(t.start2,t.start2+t.length1),n=0;for(;e.indexOf(i)!==e.lastIndexOf(i)&&i.length<this.matchMaxBits-this.patchMargin-this.patchMargin;)n+=this.patchMargin,i=e.substring(t.start2-n,t.start2+t.length1+n);n+=this.patchMargin;let s=e.substring(t.start2-n,t.start2);s&&t.diffs.unshift([h.DIFF_EQUAL,s]);let r=e.substring(t.start2+t.length1,t.start2+t.length1+n);r&&t.diffs.push([h.DIFF_EQUAL,r]),t.start1-=s.length,t.start2-=s.length,t.length1+=s.length+r.length,t.length2+=s.length+r.length}};var yt=(()=>{class a{activeModal=I(Qe);faBan=qe;faTimes=Xe;close(e){this.activeModal.close(e)}static \u0275fac=function(i){return new(i||a)};static \u0275cmp=V({type:a,selectors:[["jhi-feedback-suggestions-pending-confirmation-dialog"]],decls:33,vars:1,consts:[[1,"modal-header"],[1,"modal-title"],["jhiTranslate","artemisApp.assessment.suggestionPendingDialog.title"],["type","button","data-dismiss","modal","aria-hidden","true",1,"btn-close",3,"click"],[1,"modal-body"],["jhiTranslate","artemisApp.assessment.suggestionPendingDialog.description"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-secondary",3,"click"],[3,"icon"],["jhiTranslate","entity.action.cancel"],["type","submit","ngClass","btn btn-primary",3,"click"],["jhiTranslate","artemisApp.assessment.suggestionPendingDialog.discardAndSubmit"]],template:function(i,n){i&1&&(b(0,"form"),c(1,`
    `),b(2,"div",0),c(3,`
        `),b(4,"h4",1),c(5,`
            `),T(6,"span",2),c(7,`
        `),C(),c(8,`
        `),b(9,"button",3),U("click",function(){return n.close(!1)}),C(),c(10,`
    `),C(),c(11,`
    `),b(12,"div",4),c(13,`
        `),T(14,"p",5),c(15,`
    `),C(),c(16,`
    `),b(17,"div",6),c(18,`
        `),b(19,"button",7),U("click",function(){return n.close(!1)}),c(20,`
            `),T(21,"fa-icon",8),c(22,"\xA0"),T(23,"span",9),c(24,`
        `),C(),c(25,`
        `),b(26,"button",10),U("click",function(){return n.close(!0)}),c(27,`
            `),T(28,"span",11),c(29,`
        `),C(),c(30,`
    `),C(),c(31,`
`),C(),c(32,`
`)),i&2&&(f(21),_("icon",n.faBan))},dependencies:[Ve,je,Be,Ue,se,ne,Ne],encapsulation:2})}return a})();var Ot=(a,t)=>({points:a,bonusPoints:t}),kt=a=>[a],Pt=()=>[];function Bt(a,t){if(a&1&&(c(0,`
                `),b(1,"span"),c(2,`
                    `),T(3,"fa-icon",10),c(4,`
                    `),T(5,"span",11),c(6,`
                `),C(),c(7,`
            `)),a&2){let e=x(2);f(3),_("icon",e.faTimesCircle)}}function Ut(a,t){if(a&1&&(c(0,`
                `),b(1,"div"),c(2,`
                    `),T(3,"fa-icon",10),c(4,`
                    `),T(5,"span",12),c(6,`
                `),C(),c(7,`
            `)),a&2){let e=x(2);f(3),_("icon",e.faTimesCircle)}}function jt(a,t){if(a&1&&(c(0,`
    `),b(1,"nav",8),c(2,`
        `),b(3,"div",9),c(4,`
            `),E(5,Bt,8,1)(6,Ut,8,1),C(),c(7,`
    `),C(),c(8,`
`)),a&2){let e=x();f(5),R(e.participationCouldNotBeFetched?5:-1),f(),R(e.lockLimitReached?6:-1)}}function Vt(a,t){a&1&&Q(0)}function Qt(a,t){if(a&1&&(c(0,`
            `),E(1,Vt,1,0,"ng-container",13),c(2,`
        `)),a&2){x();let e=W(9);f(),_("ngTemplateOutlet",e)}}function Gt(a,t){a&1&&Q(0)}function Wt(a,t){if(a&1&&(c(0,`
            `),E(1,Gt,1,0,"ng-container",13),c(2,`
        `)),a&2){x();let e=W(12);f(),_("ngTemplateOutlet",e)}}function qt(a,t){a&1&&T(0,"div",2)}function Kt(a,t){a&1&&T(0,"div",3)}function Xt(a,t){a&1&&Q(0,4)}function zt(a,t){a&1&&T(0,"div",19)}function Ht(a,t){if(a&1){let e=q();c(0,`
            `),b(1,"jhi-code-editor-container",14),U("onUpdateFeedback",function(n){k(e);let s=x(2);return L(s.onUpdateFeedback(n))})("onAcceptSuggestion",function(n){k(e);let s=x(2);return L(s.removeSuggestion(n))})("onDiscardSuggestion",function(n){k(e);let s=x(2);return L(s.removeSuggestion(n))})("onFileLoad",function(n){k(e);let s=x(2);return L(s.highlightChangedLines(n))}),c(2,`
                `),E(3,qt,1,0,"div",15),c(4,`
                `),E(5,Kt,1,0,"div",16),c(6,`
                `),E(7,Xt,1,0,"ng-container",17),c(8,`
                `),E(9,zt,1,0,"div",18),c(10,`
            `),C(),c(11,`
        `)}if(a&2){x();let e=W(10),i=W(13),n=W(16),s=W(19),r=x();f(),_("editable",!1)("participation",r.participation)("feedbackSuggestions",r.feedbackSuggestions)("showEditorInstructions",r.showEditorInstructions)("isTutorAssessment",!0)("highlightFileChanges",!0)("readOnlyManualFeedback",r.readOnly())("highlightDifferences",r.highlightDifferences)("course",r.getCourseFromExercise(r.exercise)),f(2),_("ngTemplateOutlet",e),f(2),_("ngTemplateOutlet",i),f(2),_("ngTemplateOutlet",n),f(2),_("ngTemplateOutlet",s)}}function Yt(a,t){if(a&1&&(c(0,`
                        `),T(1,"jhi-included-in-score-badge",21),c(2,`
                    `)),a&2){let e=x(3);f(),_("includedInOverallScore",e.exercise.includedInOverallScore)}}function $t(a,t){if(a&1&&(c(0,`
            `),b(1,"span"),c(2,`
                `),b(3,"span"),c(4),C(),c(5,`
                `),T(6,"span",20),c(7,`
                `),b(8,"span"),c(9,`
                    `),E(10,Yt,3,1),C(),c(11,`
            `),C(),c(12,`
        `)),a&2){let e=x(2);f(4),ve(e.exercise==null?null:e.exercise.title),f(2),_("jhiTranslate",e.exercise.bonusPoints?"artemisApp.examParticipation.bonus":"artemisApp.examParticipation.points")("translateValues",Re(4,Ot,e.exercise.maxPoints,e.exercise.bonusPoints)),f(4),R(e.exercise.includedInOverallScore!==e.IncludedInOverallScore.INCLUDED_COMPLETELY?10:-1)}}function Zt(a,t){if(a&1&&(c(0,`
                `),b(1,"a",23),c(2,`
                    `),T(3,"fa-icon",24),c(4,`
                    `),T(5,"span",25),c(6,`
                `),C(),c(7,`
            `)),a&2){let e=x(3);f(),_("routerLink",e.localRepositoryLink),f(2),_("icon",e.faExternalLink)}}function Jt(a,t){if(a&1&&(c(0,`
                `),T(1,"a",26),c(2,`
            `)),a&2){let e=x(3);f(),Ie("href",e.participation==null?null:e.participation.userIndependentRepositoryUri,Ae)}}function ei(a,t){if(a&1&&(c(0,`
                `),T(1,"jhi-result",27),c(2,`
            `)),a&2){let e=x(3);f(),_("result",e.manualResult)("showUngradedResults",!0)("showBadge",!1)("isBuilding",!1)("participation",e.participation)("exercise",e.exercise)("short",!1)}}function ti(a,t){if(a&1&&(c(0,`
            `),c(1,`
            `),c(2,`
            `),E(3,Zt,8,2),T(4,"jhi-programming-assessment-repo-export",22),c(5,`
            `),E(6,Jt,3,1)(7,ei,3,7)),a&2){let e=x(2);f(3),R(e.isAtLeastEditor&&e.localVCEnabled&&!e.isTestRun?3:-1),f(),_("programmingExercises",de(6,kt,e.exercise))("singleParticipantMode",!0)("participationIdList",e.participation?de(8,kt,e.participation.id):Le(10,Pt)),f(2),R(e.isAtLeastEditor&&!e.localVCEnabled?6:-1),f(),R(e.participation?7:-1)}}function ii(a,t){if(a&1&&(c(0,`
                `),T(1,"jhi-assessment-instructions",28),c(2,`
            `)),a&2){let e=x(3);f(),_("exercise",e.exercise)("programmingParticipation",e.participation)("gradingCriteria",e.exercise.gradingCriteria)}}function ni(a,t){if(a&1&&(c(0,`
            `),E(1,ii,3,3)),a&2){let e=x(2);f(),R(e.exercise?1:-1)}}function si(a,t){if(a&1){let e=q();c(0,`
                    `),b(1,"jhi-unreferenced-feedback",30),ke("feedbacksChange",function(n){k(e);let s=x(3);return ye(s.unreferencedFeedback,n)||(s.unreferencedFeedback=n),L(n)}),U("feedbacksChange",function(){k(e);let n=x(3);return L(n.validateFeedback())})("onAcceptSuggestion",function(n){k(e);let s=x(3);return L(s.removeSuggestion(n))})("onDiscardSuggestion",function(n){k(e);let s=x(3);return L(s.removeSuggestion(n))}),C(),c(2,`
                `)}if(a&2){let e=x(3);f(),De("feedbacks",e.unreferencedFeedback),_("feedbackSuggestions",e.unreferencedFeedbackSuggestions)("readOnly",e.readOnly())("highlightDifferences",e.highlightDifferences)("resultId",e.manualResult.id)}}function ri(a,t){if(a&1&&(c(0,`
            `),b(1,"div",29),c(2,`
                `),E(3,si,3,5),C(),c(4,`
        `)),a&2){let e=x(2);f(3),R(e.manualResult&&e.manualResult.id?3:-1)}}function oi(a,t){if(a&1&&(c(0,`
        `),c(1,`
        `),c(2,`
        `),c(3,`
        `),c(4,`
        `),c(5,`
        `),c(6,`
        `),c(7,`
        `),E(8,Ht,12,13)(9,$t,13,7,"ng-template",null,2,M),c(11,`
        `),E(12,ti,8,11,"ng-template",null,3,M),c(14,`
        `),E(15,ni,2,1,"ng-template",null,4,M),c(17,`
        `),E(18,ri,5,1,"ng-template",null,5,M),c(20,`
    `)),a&2){let e=x();f(8),R(!e.loadingParticipation&&!e.participationCouldNotBeFetched?8:-1)}}function ai(a,t){if(a&1&&(c(0,`
            `),b(1,"div",31),c(2,`
                `),T(3,"p",32),c(4,`
                `),b(5,"a",33),c(6,`
                    `),T(7,"span",34),c(8,`
                `),C(),c(9,`
            `),C(),c(10,`
        `)),a&2){let e=x(2);f(5),_("routerLink",e.exerciseDashboardLink)}}function li(a,t){if(a&1&&(c(0,`
        `),E(1,ai,11,1)),a&2){let e=x();f(),R(e.loadingInitialSubmission?-1:1)}}var xe=(()=>{class a{manualResultService=I(ft);router=I(Oe);location=I(we);accountService=I($e);programmingSubmissionService=I(dt);domainService=I(Ct);complaintService=I(ht);route=I(Me);alertService=I(ie);structuredGradingCriterionService=I(St);repositoryFileService=I(xt);programmingExerciseService=I(le);profileService=I(Je);modalService=I(Ge);athenaService=I(_t);codeEditorContainer;ButtonSize=nt;PROGRAMMING=pe.PROGRAMMING;SUBMISSION_TYPE_ILLEGAL="ILLEGAL";diffMatchPatch=new ce;IncludedInOverallScore=He;getCourseFromExercise=Ye;paramSub;participation;exercise;submission;manualResult;userId;isTestRun=!1;saveBusy=!1;submitBusy=!1;cancelBusy=!1;nextSubmissionBusy=!1;isAssessor=!1;assessmentsAreValid=!1;complaint;cancelConfirmationText;acceptComplaintWithoutMoreScoreText;loadingParticipation=!1;participationCouldNotBeFetched=!1;showEditorInstructions=!0;hasAssessmentDueDatePassed;correctionRound;courseId;examId=0;exerciseId;exerciseGroupId;exerciseDashboardLink;localRepositoryLink;loadingInitialSubmission=!0;highlightDifferences=!1;localVCEnabled=!1;isAtLeastEditor=!1;unreferencedFeedback=[];referencedFeedback=[];automaticFeedback=[];feedbackSuggestions=[];totalScoreBeforeAssessment;isFirstAssessment=!1;lockLimitReached=!1;templateParticipation;templateFileSession={};onFeedbackLoaded=new Te;overrideNextSubmission=void 0;faTimesCircle=ze;faExternalLink=Ke;get unreferencedFeedbackSuggestions(){return this.feedbackSuggestions.filter(e=>!e.reference)}constructor(){let e=I(We);e.get("artemisApp.assessment.messages.confirmCancel").subscribe(i=>this.cancelConfirmationText=i),e.get("artemisApp.assessment.messages.acceptComplaintWithoutMoreScore").subscribe(i=>this.acceptComplaintWithoutMoreScoreText=i)}ngOnInit(){return j(this,null,function*(){this.accountService.identity().then(e=>{this.userId=e.id}),this.route.queryParamMap.subscribe(e=>{this.isTestRun=e.get("testRun")==="true",this.correctionRound=Number(e.get("correction-round"))}),this.paramSub=this.route.params.subscribe(e=>{this.loadingParticipation=!0,this.participationCouldNotBeFetched=!1,this.courseId=Number(e.courseId),this.exerciseId=Number(e.exerciseId);let i=e.examId;i&&(this.examId=Number(i),this.exerciseGroupId=Number(e.exerciseGroupId)),this.exerciseDashboardLink=ot(this.courseId,this.exerciseId,this.examId,this.isTestRun);let n=e.submissionId;(n==="new"?this.loadRandomSubmission(this.exerciseId):this.loadSubmission(Number(n))).pipe(Y({next:r=>j(this,null,function*(){yield this.onSubmissionReceived(n,r)}),error:r=>{this.handleErrorResponse(r)},complete:()=>this.loadingParticipation=!1}),he(()=>this.programmingExerciseService.findWithTemplateAndSolutionParticipation(this.exercise.id,!1,!0)),Y(r=>{let o=r.body;this.templateParticipation=o.templateParticipation,this.exercise.gradingCriteria=o.gradingCriteria,this.isAtLeastEditor=!!this.exercise.isAtLeastEditor}),he(()=>{this.domainService.setDomain([ae.PARTICIPATION,this.templateParticipation]);let r=this.repositoryFileService.getFilesWithContent();return this.domainService.setDomain([ae.PARTICIPATION,this.participation]),this.localRepositoryLink=at(this.courseId,this.exerciseId,bt.USER,this.participation.id,this.exerciseGroupId,this.examId),r}),Y(r=>{r&&(this.templateFileSession=r)})).subscribe()}),this.profileService.getProfileInfo().subscribe(e=>{this.localVCEnabled=e.activeProfiles.includes(tt)})})}ngOnDestroy(){this.paramSub&&this.paramSub.unsubscribe()}onSubmissionReceived(e,i){return j(this,null,function*(){if(!i){this.submission=i;return}if(yield this.handleReceivedSubmission(i).then(()=>this.validateFeedback()),e==="new"){let n=window.location.hash.replace("#","").replace("new",`${this.submission.id}`);this.location.go(n)}})}loadRandomSubmission(e){return this.programmingSubmissionService.getSubmissionWithoutAssessment(e,!0,this.correctionRound)}loadSubmission(e){return this.programmingSubmissionService.lockAndGetProgrammingSubmissionParticipation(e,this.correctionRound)}handleReceivedSubmission(e){return j(this,null,function*(){this.loadingInitialSubmission=!1,this.domainService.setDomain([ae.PARTICIPATION,e.participation]),this.submission=e,this.manualResult=et(this.submission),this.manualResult?.submission||(this.manualResult.submission=this.submission),this.participation=e.participation,this.exercise=this.participation.exercise,this.accountService.setAccessRightsForExercise(this.exercise),this.hasAssessmentDueDatePassed=!!this.exercise?.assessmentDueDate&&te(this.exercise.assessmentDueDate).isBefore(te()),this.checkPermissions(),this.handleFeedback(),this.getComplaint(),this.calculateTotalScore(),(this.manualResult?.feedbacks?.length??0)===this.automaticFeedback.length&&(yield this.loadFeedbackSuggestions())})}handleErrorResponse(e){this.loadingInitialSubmission=!1,this.participationCouldNotBeFetched=!0,e?.error?.errorKey==="lockedSubmissionsLimitReached"?this.lockLimitReached=!0:e?.error&&this.onError(e?.error?.detail||"Not Found")}loadFeedbackSuggestions(){return j(this,null,function*(){this.feedbackSuggestions=(yield ue(this.athenaService.getProgrammingFeedbackSuggestions(this.exercise,this.submission.id)))??[];let e=[...this.referencedFeedback,...this.unreferencedFeedback];this.feedbackSuggestions=this.feedbackSuggestions.filter(i=>e.every(n=>n.detailText!==i.detailText||n.reference!==i.reference))})}highlightChangedLines(e){if(e&&this.codeEditorContainer?.selectedFile)if(this.templateFileSession[e]){let i=this.diffMatchPatch.diff_linesToChars(this.templateFileSession[e],this.codeEditorContainer.getText()),n=i.chars1,s=i.chars2,r=i.lineArray,o=this.diffMatchPatch.diff_main(n,s,!1);this.diffMatchPatch.diff_charsToLines(o,r);let l=0;o.forEach(m=>{if(m[0]===0){let u=m[1].split(/\r?\n/);l+=u.length-1}if(m[0]===1){let u=m[1].split(/\r?\n/).filter(Boolean),p=l,d=l+u.length-1;this.highlightLines(p,d),l+=u.length}})}else{let i=this.codeEditorContainer.getNumberOfLines()-1;this.highlightLines(0,i)}}highlightLines(e,i){this.codeEditorContainer.highlightLines(e+1,i+1)}save(){this.saveBusy=!0,this.handleSaveOrSubmit(void 0,"artemisApp.textAssessment.saveSuccessful")}discardPendingSubmissionsWithConfirmation(){return j(this,null,function*(){if(this.feedbackSuggestions.length>0){let e=this.modalService.open(yt,{size:"lg",backdrop:"static",animation:!0});if(!(yield ue(e.closed)))return!1;this.feedbackSuggestions=[]}return!0})}submit(){return j(this,null,function*(){(yield this.discardPendingSubmissionsWithConfirmation())&&(this.submitBusy=!0,this.handleSaveOrSubmit(!0,"artemisApp.textAssessment.submitSuccessful"))})}handleSaveOrSubmit(e,i){this.avoidCircularStructure(),this.manualResultService.saveAssessment(this.participation.id,this.manualResult,e).subscribe({next:n=>this.handleSaveOrSubmitSuccessWithAlert(n,i),error:n=>this.onError(`error.${n?.error?.errorKey}`)})}cancel(){this.cancelBusy=!0,window.confirm(this.cancelConfirmationText)&&this.exercise&&this.submission&&this.manualResultService.cancelAssessment(this.submission.id).subscribe(()=>this.navigateBack()),this.cancelBusy=!1}nextSubmission(){this.loadingParticipation=!0,this.submission=void 0,this.programmingSubmissionService.getSubmissionWithoutAssessment(this.exercise.id,!0,this.correctionRound).subscribe({next:e=>{if(this.loadingParticipation=!1,!e){this.submission=void 0;return}if(this.overrideNextSubmission){this.overrideNextSubmission(e.id);return}let i=rt(pe.PROGRAMMING,this.courseId,this.exerciseId,e.participation?.id,e.id,this.examId,this.exerciseGroupId,void 0);this.router.navigate(i,{queryParams:{"correction-round":this.correctionRound}})},error:e=>{this.loadingParticipation=!1,e.error&&e.error.errorKey==="lockedSubmissionsLimitReached"?this.onError("artemisApp.submission.lockedSubmissionsLimitReached"):this.onError(e?.message)}})}onUpdateAssessmentAfterComplaint(e){if(this.validateFeedback(),!this.assessmentsAreValid){this.alertService.error("artemisApp.programmingAssessment.invalidAssessments"),e.onError();return}if(!this.checkFeedbackChangeForAcceptedComplaint(e)){e.onError();return}this.setFeedbacksForManualResult(),this.manualResultService.updateAfterComplaint(this.manualResult.feedbacks,e.complaintResponse,this.submission.id,this.manualResult.assessmentNote?.note).subscribe({next:i=>{e.onSuccess(),this.participation.results[0]=this.manualResult=i,this.alertService.closeAll(),this.alertService.success("artemisApp.assessment.messages.updateAfterComplaintSuccessful")},error:i=>{e.onError(),this.alertService.closeAll();let n=i.error;n&&n.errorKey&&n.errorKey==="complaintLock"?this.alertService.error(n.message,n.params):this.onError("artemisApp.assessment.messages.updateAfterComplaintFailed")}})}navigateBack(){Tt(this.location,this.router,this.exercise,this.submission,this.isTestRun)}get canOverride(){if(this.exercise){if(this.exercise.isAtLeastInstructor)return!0;if(this.complaint&&this.isAssessor)return!1;let e=!0;return this.exercise.assessmentDueDate&&(e=te().isBefore(this.exercise.assessmentDueDate)),this.isAssessor&&e}return!1}onUpdateFeedback(e){this.referencedFeedback=e.filter(i=>i.reference!=null&&i.type===K.MANUAL),this.validateFeedback()}removeSuggestion(e){this.feedbackSuggestions=this.feedbackSuggestions.filter(i=>i!==e)}onError(e){this.alertService.error(e),this.saveBusy=this.cancelBusy=this.submitBusy=this.nextSubmissionBusy=!1}validateFeedback(){if(this.calculateTotalScore(),this.exercise.allowComplaintsForAutomaticAssessments){this.assessmentsAreValid=!0;return}let e=re.haveCredits(this.referencedFeedback),i=re.haveCreditsAndComments(this.unreferencedFeedback);this.assessmentsAreValid=e&&this.unreferencedFeedback.length===0||i}readOnly(){return!At(this.isTestRun,this.isAssessor,this.hasAssessmentDueDatePassed,this.manualResult,this.complaint,this.exercise)}handleSaveOrSubmitSuccessWithAlert(e,i){this.participation.results||(this.participation.results=[]),this.participation.results[0]=this.manualResult=e.body,this.alertService.closeAll(),this.alertService.success(i),this.saveBusy=this.submitBusy=!1,this.checkPermissions()}checkPermissions(){this.manualResult?.assessor?this.isAssessor=this.manualResult.assessor.id===this.userId:this.isAssessor=!0}getComplaint(){this.submission&&this.complaintService.findBySubmissionId(this.submission.id).subscribe({next:e=>{e.body&&(this.complaint=e.body)},error:e=>{this.onError(e?.message)}})}handleFeedback(){let e=this.manualResult?.feedbacks??[];this.totalScoreBeforeAssessment=this.calculateTotalScoreOfFeedbacks(e),this.automaticFeedback=e.filter(i=>i.type===K.AUTOMATIC),e.length===this.automaticFeedback.length&&(this.isFirstAssessment=!0),this.unreferencedFeedback=e.filter(i=>i.reference==null&&i.type===K.MANUAL_UNREFERENCED),this.referencedFeedback=e.filter(i=>i.reference!=null&&i.type===K.MANUAL),this.onFeedbackLoaded.emit()}checkFeedbackChangeForAcceptedComplaint(e){if(!e.complaintResponse.complaint?.accepted)return!0;let i=[...this.referencedFeedback,...this.unreferencedFeedback,...this.automaticFeedback],n=this.calculateTotalScoreOfFeedbacks(i);return this.totalScoreBeforeAssessment>=n?window.confirm(this.acceptComplaintWithoutMoreScoreText):!0}setFeedbacksForManualResult(){this.manualResult.feedbacks=[...this.referencedFeedback,...this.unreferencedFeedback,...this.automaticFeedback]}setAttributesForManualResult(e){this.setFeedbacksForManualResult(),this.manualResult.rated=!0,this.isFirstAssessment=!1,this.manualResult.score=e/this.exercise.maxPoints*100,this.manualResult=Ze(this.manualResult)}avoidCircularStructure(){this.manualResult&&mt(this.manualResult)}calculateTotalScore(){let e=[...this.referencedFeedback,...this.unreferencedFeedback,...this.automaticFeedback],i=this.calculateTotalScoreOfFeedbacks(e);this.setAttributesForManualResult(i)}calculateTotalScoreOfFeedbacks(e){let i=ct(this.exercise),n=0,s=0,r={};return e.forEach(o=>{o.type===K.AUTOMATIC&&!re.isStaticCodeAnalysisFeedback(o)?s+=o.credits:o.gradingInstruction?n=this.structuredGradingCriterionService.calculateScoreForGradingInstructions(o,n,r):n+=o.credits}),s>i&&(s=i),n+=s,n=lt(n,i),n}static \u0275fac=function(i){return new(i||a)};static \u0275cmp=V({type:a,selectors:[["jhi-code-editor-tutor-assessment"]],viewQuery:function(i,n){if(i&1&&$(fe,5),i&2){let s;Z(s=J())&&(n.codeEditorContainer=s.first)}},inputs:{overrideNextSubmission:"overrideNextSubmission"},outputs:{onFeedbackLoaded:"onFeedbackLoaded"},decls:15,vars:22,consts:[["assessment",""],["noSubmission",""],["editorTitle",""],["editorToolbar",""],["editorSidebar",""],["editorBottom",""],[3,"id"],[3,"navigateBack","save","onSubmit","onCancel","nextSubmission","updateAssessmentAfterComplaint","isLoading","saveBusy","submitBusy","cancelBusy","nextSubmissionBusy","isTeamMode","isAssessor","isTestRun","exerciseDashboardLink","isIllegalSubmission","canOverride","result","assessmentsAreValid","complaint","exercise","submission","hasAssessmentDueDatePassed","correctionRound","isProgrammingExercise"],[1,"card"],[1,"card-body"],[1,"text-danger",3,"icon"],["jhiTranslate","artemisApp.editor.errors.participationNotFound"],["jhiTranslate","artemisApp.submission.lockedSubmissionsLimitReached"],[4,"ngTemplateOutlet"],[3,"onUpdateFeedback","onAcceptSuggestion","onDiscardSuggestion","onFileLoad","editable","participation","feedbackSuggestions","showEditorInstructions","isTutorAssessment","highlightFileChanges","readOnlyManualFeedback","highlightDifferences","course"],["editorTitle","",4,"ngTemplateOutlet"],["editorToolbar","",4,"ngTemplateOutlet"],["editorSidebar","",4,"ngTemplateOutlet"],["class","mt-3","editorBottom","",4,"ngTemplateOutlet"],["editorBottom","",1,"mt-3"],[3,"jhiTranslate","translateValues"],[3,"includedInOverallScore"],[3,"programmingExercises","singleParticipantMode","participationIdList"],["target","_blank","rel","noopener noreferrer",1,"btn","btn-secondary","btn-sm","me-2","open-repository-button",3,"routerLink"],[3,"icon"],["jhiTranslate","artemisApp.exerciseAssessmentDashboard.programmingExercise.goToRepo"],["target","_blank","rel","noopener noreferrer","jhiTranslate","artemisApp.exerciseAssessmentDashboard.programmingExercise.goToRepo",1,"ms-2","me-5",3,"href"],[1,"me-1","my-1",3,"result","showUngradedResults","showBadge","isBuilding","participation","exercise","short"],[1,"card-body","markdown-preview","instructions-wrapper__content","overflow-auto",3,"exercise","programmingParticipation","gradingCriteria"],[1,"row","mt-3"],[3,"feedbacksChange","onAcceptSuggestion","onDiscardSuggestion","feedbacks","feedbackSuggestions","readOnly","highlightDifferences","resultId"],["role","alert",1,"alert","alert-warning","text-center","mt-4"],["jhiTranslate","artemisApp.programmingAssessment.notFound"],[1,"btn","btn-info","btn-sm","me-1","mb-1","assessment-dashboard",3,"routerLink"],["jhiTranslate","entity.action.exerciseDashboard",1,"d-none","d-md-inline"]],template:function(i,n){if(i&1){let s=q();E(0,jt,9,2),b(1,"div",6),c(2,`
    `),b(3,"jhi-assessment-layout",7),U("navigateBack",function(){return k(s),L(n.navigateBack())})("save",function(){return k(s),L(n.save())})("onSubmit",function(){return k(s),L(n.submit())})("onCancel",function(){return k(s),L(n.cancel())})("nextSubmission",function(){return k(s),L(n.nextSubmission())})("updateAssessmentAfterComplaint",function(o){return k(s),L(n.onUpdateAssessmentAfterComplaint(o))}),c(4,`
        `),E(5,Qt,3,1)(6,Wt,3,1),C(),c(7,`

    `),E(8,oi,21,1,"ng-template",null,0,M),c(10,`

    `),E(11,li,2,1,"ng-template",null,1,M),c(13,`
`),C(),c(14,`
`)}i&2&&(R(n.participationCouldNotBeFetched||n.lockLimitReached?0:-1),f(),_("id","exercise-"+(n.exercise==null?null:n.exercise.id)),f(2),_("isLoading",n.loadingParticipation)("saveBusy",n.saveBusy)("submitBusy",n.submitBusy)("cancelBusy",n.cancelBusy)("nextSubmissionBusy",n.nextSubmissionBusy)("isTeamMode",!!(n.exercise!=null&&n.exercise.teamMode))("isAssessor",n.isAssessor)("isTestRun",n.isTestRun)("exerciseDashboardLink",n.exerciseDashboardLink)("isIllegalSubmission",!!n.submission&&n.submission.type===n.SUBMISSION_TYPE_ILLEGAL)("canOverride",n.canOverride)("result",n.manualResult)("assessmentsAreValid",n.assessmentsAreValid)("complaint",n.complaint)("exercise",n.exercise)("submission",n.submission)("hasAssessmentDueDatePassed",n.hasAssessmentDueDatePassed)("correctionRound",n.correctionRound)("isProgrammingExercise",!0),f(2),R(n.submission?5:6))},dependencies:[ne,se,It,ee,fe,pt,Pe,Et,ut,oe,Ft],encapsulation:2})}return a})();function ci(a,t){}var Lt=(()=>{class a{readOnly;programmingParticipation;exercise;static \u0275fac=function(i){return new(i||a)};static \u0275cmp=V({type:a,selectors:[["jhi-orion-assessment-instructions"]],inputs:{readOnly:"readOnly",programmingParticipation:"programmingParticipation",exercise:"exercise"},decls:7,vars:3,consts:[["overrideTitle",""],[3,"exercise","programmingParticipation","readOnly"]],template:function(i,n){i&1&&(c(0,`
        `),b(1,"jhi-assessment-instructions",1),c(2,`
            `),E(3,ci,0,0,"ng-template",null,0,M),c(5,`
        `),C(),c(6,`
    `)),i&2&&(f(),_("exercise",n.exercise)("programmingParticipation",n.programmingParticipation)("readOnly",n.readOnly))},dependencies:[oe],encapsulation:2})}return a})();function mi(a,t){a&1&&Q(0)}function ui(a,t){a&1&&Q(0)}function hi(a,t){if(a&1&&(c(0,`
            `),T(1,"jhi-orion-assessment-instructions",6),c(2,`
        `)),a&2){let e=x(),i=e.exercise,n=e.participation;f(),_("exercise",i)("programmingParticipation",n)}}function di(a,t){a&1&&Q(0)}function pi(a,t){if(a&1&&(c(0,`
        `),b(1,"div",3),c(2,`
            `),b(3,"h4",4),E(4,mi,1,0,"ng-container",5),C(),c(5,`
            `),E(6,ui,1,0,"ng-container",5),c(7,`
        `),C(),c(8,`
        `),E(9,hi,3,2)(10,di,1,0,"ng-container",5),c(11,`
    `)),a&2){let e=t.title,i=t.toolbar,n=t.exercise,s=t.feedback;f(4),_("ngTemplateOutlet",e),f(2),_("ngTemplateOutlet",i),f(3),R(n?9:-1),f(),_("ngTemplateOutlet",s)}}function fi(a,t){}var os=(()=>{class a{orionConnectorService=I(it);alertService=I(ie);orionAssessmentService=I(gt);container;constructor(){let e=this.orionConnectorService;e.activeAssessmentComponent=this}initializeFeedback(){this.orionConnectorService.initializeAssessment(this.container.submission?.id,this.container.referencedFeedback)}updateFeedback(e,i){e!==this.container.submission?.id?this.alertService.error("artemisApp.orion.assessment.submissionIdDontMatch"):this.container.onUpdateFeedback(i)}openNextSubmission(e){this.orionAssessmentService.sendSubmissionToOrionCancellable(this.container.exerciseId,e,this.container.correctionRound,this.container.isTestRun)}static \u0275fac=function(i){return new(i||a)};static \u0275cmp=V({type:a,selectors:[["jhi-orion-course-management-exercises"]],viewQuery:function(i,n){if(i&1&&$(xe,5),i&2){let s;Z(s=J())&&(n.container=s.first)}},decls:9,vars:1,consts:[["overrideCodeEditor",""],["overrideExportGoToRepository",""],[3,"onFeedbackLoaded","overrideNextSubmission"],[1,"d-flex","flex-wrap","align-items-center","m-2"],[1,"me-auto"],[4,"ngTemplateOutlet"],[1,"card-body","markdown-preview","instructions-wrapper__content","overflow-auto",3,"exercise","programmingParticipation"]],template:function(i,n){if(i&1){let s=q();b(0,"jhi-code-editor-tutor-assessment",2),U("onFeedbackLoaded",function(){return k(s),L(n.initializeFeedback())}),c(1,`
    `),E(2,pi,12,4,"ng-template",null,0,M),c(4,`
    `),E(5,fi,0,0,"ng-template",null,1,M),c(7,`
`),C(),c(8,`
`)}i&2&&_("overrideNextSubmission",n.openNextSubmission.bind(n))},dependencies:[xe,ee,Lt],encapsulation:2})}return a})();var ps=(()=>{class a{service=I(le);resolve(e){let i=e.params.exerciseId?e.params.exerciseId:void 0;return i?this.service.find(i,!0).pipe(Se(n=>n.body)):Ee(new st(void 0,void 0))}static \u0275fac=function(i){return new(i||a)};static \u0275prov=Fe({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();var Cs=[{path:"",loadComponent:()=>import("./repository-view.component-IW5SQGDE.js").then(a=>a.RepositoryViewComponent),data:{authorities:[w.ADMIN,w.INSTRUCTOR,w.EDITOR,w.TA],pageTitle:"artemisApp.repository.title"},canActivate:[z,H]},{path:"commit-history",loadComponent:()=>import("./commit-history.component-HKFBOI33.js").then(a=>a.CommitHistoryComponent),data:{authorities:[w.ADMIN,w.INSTRUCTOR,w.EDITOR,w.TA],pageTitle:"artemisApp.repository.title"},canActivate:[z,H]},{path:"commit-history/:commitHash",loadComponent:()=>import("./commit-details-view.component-ASSFRGHA.js").then(a=>a.CommitDetailsViewComponent),data:{authorities:[w.ADMIN,w.INSTRUCTOR,w.EDITOR,w.TA],pageTitle:"artemisApp.repository.title"},canActivate:[z,H]},{path:"vcs-access-log",loadComponent:()=>import("./vcs-repository-access-log-view.component-S5EV2WZH.js").then(a=>a.VcsRepositoryAccessLogViewComponent),data:{authorities:[w.ADMIN,w.INSTRUCTOR],pageTitle:"artemisApp.repository.title"},canActivate:[z,H]}];export{xe as a,os as b,ps as c,Cs as d};
//# sourceMappingURL=chunk-UO6DEETD.js.map
