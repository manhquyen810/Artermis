import{a as X,b as Y,c as Z}from"./chunk-XUG3TIT6.js";import{a as Q}from"./chunk-5M3YV54C.js";import{B as J,C as K}from"./chunk-5AQXEKLE.js";import{f as H,k as z}from"./chunk-CT44YL7Q.js";import{K as F,o as V,p as G,q as M,r as B,s as j}from"./chunk-VZRSC3LP.js";import{a as L}from"./chunk-K3W6YFKH.js";import{c as $}from"./chunk-JXJXC4DZ.js";import{d as W}from"./chunk-EDXSOKK5.js";import{c as E,k as U}from"./chunk-CXQURQM5.js";import{cc as O}from"./chunk-Z4VHWOB5.js";import{a as q}from"./chunk-U54OSGNH.js";import{Db as d,Dc as P,Ea as R,Ma as C,Mc as b,Na as T,Oc as m,Rc as N,Tb as D,Zb as A,dd as s,kc as S,sc as v,xc as p,yc as l,yd as k,zc as x,zd as I}from"./chunk-5LC5EQRR.js";function ie(o,n){if(o&1){let e=P();s(0,`
    `),p(1,"div",0),s(2,`
        `),p(3,"button",1),s(4,`
            `),x(5,"fa-icon",2),s(6,`
            `),x(7,"span",3),s(8,`
        `),l(),s(9,`
        `),p(10,"div",4),s(11,`
            `),p(12,"button",5),b("click",function(){C(e);let t=m();return T(t.exportResults(!1,!1))}),l(),s(13,`
            `),p(14,"button",6),k(15,"artemisTranslate"),b("click",function(){C(e);let t=m();return T(t.exportResults(!0,!1))}),l(),s(16,`
            `),p(17,"button",7),k(18,"artemisTranslate"),b("click",function(){C(e);let t=m();return T(t.exportResults(!0,!0))}),s(19,`
                With test cases`),x(20,"br"),s(21,`and feedback
            `),l(),s(22,`
        `),l(),s(23,`
    `),l(),s(24,`
`)}if(o&2){let e=m();d(5),S("icon",e.faDownload),d(9),N("ngbTooltip",I(15,3,"artemisApp.exercise.export.results.withTestCasesTooltip")),d(3),N("ngbTooltip",I(18,5,"artemisApp.exercise.export.results.withTestCasesAndFeedbackTooltip"))}}function se(o,n){if(o&1){let e=P();s(0,`
    `),p(1,"button",8),b("click",function(){C(e);let t=m();return T(t.exportResults(!1,!1))}),s(2,`
        `),x(3,"fa-icon",2),s(4,`
        `),x(5,"span",3),s(6,`
    `),l(),s(7,`
`)}if(o&2){let e=m();d(3),S("icon",e.faDownload)}}var Te=(()=>{class o{resultService=R(Q);alertService=R($);exercises=[];exercise;isProgrammingExerciseResults=!1;faDownload=O;ngOnInit(){this.isProgrammingExerciseResults=this.exercises.concat(this.exercise).every(e=>e?.type===E.PROGRAMMING)}exportResults(e,i){this.exercises.length===0&&this.exercise!==void 0&&(this.exercises=this.exercises.concat(this.exercise)),this.exercises.forEach(t=>this.constructCSV(t,e,i))}constructCSV(e,i,t){this.resultService.getResultsWithPointsPerGradingCriterion(e).subscribe(r=>{let c=r.body||[];if(c.length===0){this.alertService.warning("artemisApp.exercise.export.results.emptyError",{exercise:e.title}),z();return}let a=!!c[0].result.participation.team,u=o.sortedGradingCriteria(e),w,_;if(i){let f=J(c);w=h.keys(e,a,u,f),_=c.map(g=>{let ee=g.result.participation,te=K(g,f,t);return new h(e,u,ee,g,te).build()})}else w=h.keys(e,a,u),_=c.map(f=>{let g=f.result.participation;return new h(e,u,g,f).build()});let y=e.shortName??e.title?.split(/\s+/).join("_");t?o.exportAsCsv(`${y}-results-scores`,w,_,","):o.exportAsCsv(`${y}-results-scores`,w,_)})}static exportAsCsv(e,i,t,r=";"){let a=X({fieldSeparator:r,quoteStrings:!0,quoteCharacter:'"',decimalSeparator:"locale",showLabels:!0,showTitle:!1,filename:e,useTextFile:!1,useBom:!0,columnHeaders:i}),u=Y(a)(t);Z(a)(u)}static sortedGradingCriteria(e){return e.gradingCriteria?.sort((i,t)=>i.title<t.title?-1:i.title>t.title?1:0)||[]}static \u0275fac=function(i){return new(i||o)};static \u0275cmp=D({type:o,selectors:[["jhi-exercise-scores-export-button"]],inputs:{exercises:"exercises",exercise:"exercise"},decls:2,vars:2,consts:[["ngbDropdown","",1,"d-inline"],["id","export-results-dropdown","ngbDropdownToggle","",1,"btn","btn-info","btn-sm","me-1"],[3,"icon"],["jhiTranslate","artemisApp.exercise.export.results.title",1,"d-none","d-md-inline"],["ngbDropdownMenu","export-results-dropdown"],["ngbDropdownItem","","jhiTranslate","artemisApp.exercise.export.results.withoutTestCases",3,"click"],["placement","left","ngbDropdownItem","","jhiTranslate","artemisApp.exercise.export.results.withTestCases",3,"click","ngbTooltip"],["placement","left","ngbDropdownItem","","jhiTranslate","artemisApp.exercise.export.results.withTestCasesAndFeedback",3,"click","ngbTooltip"],[1,"btn","btn-info","btn-sm","me-1",3,"click"]],template:function(i,t){i&1&&A(0,ie,25,7)(1,se,8,1),i&2&&(v(t.isProgrammingExerciseResults?0:-1),d(),v(t.isProgrammingExerciseResults?-1:1))},dependencies:[j,B,W,q,M,G,V,F,L],encapsulation:2})}return o})(),h=class{exercise;gradingCriteria;participation;resultWithPoints;testCaseResults;csvRow={};constructor(n,e,i,t,r){this.exercise=n,this.gradingCriteria=e,this.participation=i,this.resultWithPoints=t,this.testCaseResults=r}build(){this.setName();let n=H(this.resultWithPoints.result.score,U(this.exercise));return this.set("Score",n),this.set("Points",this.resultWithPoints.totalPoints),this.setGradingCriteriaPoints(),this.setProgrammingExerciseInformation(),this.setTeamInformation(),this.testCaseResults&&this.setTestCaseResults(),this.csvRow}set(n,e){this.csvRow[n]=e??""}setName(){this.participation.team?(this.set("Team Name",this.participation.participantName),this.set("Team Short Name",this.participation.participantIdentifier)):(this.set("Name",this.participation.participantName),this.set("Username",this.participation.participantIdentifier))}setGradingCriteriaPoints(){let n=1;this.gradingCriteria.forEach(e=>{let i=this.resultWithPoints.pointsPerCriterion,t=i instanceof Map?i.get(e.id)||0:+(i[e.id]||0);e.title?this.set(e.title,t):(this.set(`Unnamed Criterion ${n}`,t),n+=1)})}setProgrammingExerciseInformation(){if(this.exercise.type===E.PROGRAMMING){let n=this.participation.repositoryUri;this.set("Repo Link",n)}}setTeamInformation(){if(this.participation.team){let n=`${this.participation.team?.students?.map(e=>e.name).join(", ")}`;this.set("Students",n)}}setTestCaseResults(){this.testCaseResults.forEach(n=>{this.set(n.testName,n.testResult)})}static keys(n,e,i,t){let r=[];e?r.push("Team Name","Team Short Name"):r.push("Name","Username"),r.push("Score","Points");let c=1;return i.forEach(a=>{a.title?r.push(a.title):(r.push(`Unnamed Criterion ${c}`),c+=1)}),n.type===E.PROGRAMMING&&r.push("Repo Link"),e&&r.push("Students"),t?.forEach(a=>{r.push(a)}),r}};export{Te as a};
//# sourceMappingURL=chunk-UOBRSA3T.js.map
