import{a as P,m as W}from"./chunk-CJVQ2B7U.js";import{c as O,d as j}from"./chunk-AR57MWOI.js";import{a as R}from"./chunk-HQ6UGNQX.js";import{c as G}from"./chunk-5MVJAZRV.js";import{e as w}from"./chunk-5GXY5RYT.js";import{c as E}from"./chunk-JXJXC4DZ.js";import{a as M}from"./chunk-U54OSGNH.js";import{f as L,g as A,h as I}from"./chunk-M6Z6DKZQ.js";import{n as U}from"./chunk-IOA4DPXY.js";import{Db as c,Dc as D,Ea as s,Id as x,Ma as v,Mc as y,Na as b,Oc as C,Tb as _,Zb as h,aa as p,dd as t,f as T,kc as m,pa as l,rd as F,sc as g,xc as u,yc as n,z as d,zc as S}from"./chunk-5LC5EQRR.js";var N=r=>({"sidebar-collapsed":r});function V(r,f){if(r&1){let e=D();t(0,`
            `),u(1,"div",3),t(2,`
                `),u(3,"router-outlet",4),y("deactivate",function(){v(e);let i=C(2);return b(i.onSubRouteDeactivate())}),n(),t(4,`
            `),n(),t(5,`
        `)}}function Y(r,f){r&1&&(t(0,`
            `),u(1,"div",5),t(2,`
                `),S(3,"div",6),t(4,`
            `),n(),t(5,`
        `))}function k(r,f){if(r&1&&(t(0,`
        `),u(1,"div",1),t(2,`
            `),S(3,"jhi-sidebar",2),t(4,`
        `),n(),t(5,`

        `),h(6,V,6,0)(7,Y,6,0)),r&2){let e=C();c(),m("ngClass",F(7,N,e.isCollapsed)),c(2),m("itemSelected",e.tutorialGroupSelected)("courseId",e.courseId)("sidebarData",e.sidebarData)("collapseState",e.DEFAULT_COLLAPSE_STATE)("sidebarItemAlwaysShow",e.DEFAULT_SHOW_ALWAYS),c(3),g(e.tutorialGroupSelected?6:7)}}var B={registered:{entityData:[]},further:{entityData:[]},all:{entityData:[]}},z={registered:!1,all:!0,further:!0},q={registered:!1,all:!1,further:!1},de=(()=>{class r{router=s(I);courseStorageService=s(R);courseManagementService=s(j);tutorialGroupService=s(O);route=s(L);alertService=s(E);cdr=s(x);courseOverviewService=s(P);ngUnsubscribe=new T;tutorialGroups=[];courseId;course;configuration;isLoading=!1;tutorialGroupFreeDays=[];isCollapsed=!1;tutorialGroupSelected=!0;sidebarData;sortedTutorialGroups=[];accordionTutorialGroupsGroups=B;DEFAULT_COLLAPSE_STATE=z;DEFAULT_SHOW_ALWAYS=q;sidebarTutorialGroups=[];get registeredTutorialGroups(){return this.course?.isAtLeastTutor?this.tutorialGroups.filter(e=>e.isUserTutor):this.tutorialGroups.filter(e=>e.isUserRegistered)}ngOnInit(){this.isCollapsed=this.courseOverviewService.getSidebarCollapseStateFromStorage("tutorialGroup"),this.route.parent?.paramMap.pipe(l(this.ngUnsubscribe)).subscribe(e=>{this.courseId=Number(e.get("courseId")),this.courseId&&(this.setCourse(),this.setTutorialGroups(),this.prepareSidebarData(),this.subscribeToCourseUpdates())}).add(()=>this.cdr.detectChanges())}navigateToTutorialGroup(){let e=this.courseOverviewService.getUpcomingTutorialGroup(this.tutorialGroups),o=this.getLastSelectedTutorialGroup(),i=this.route.firstChild?.snapshot.params.tutorialGroupId;!i&&o?(this.router.navigate([o],{relativeTo:this.route,replaceUrl:!0}),this.tutorialGroupSelected=!0):!i&&e?(this.router.navigate([e.id],{relativeTo:this.route,replaceUrl:!0}),this.tutorialGroupSelected=!0):this.tutorialGroupSelected=!!i}subscribeToCourseUpdates(){this.courseStorageService.subscribeToCourseUpdates(this.courseId).pipe(l(this.ngUnsubscribe)).subscribe(e=>{this.course=e,this.configuration=e?.tutorialGroupsConfiguration,this.setFreeDays(),this.setTutorialGroups(),this.prepareSidebarData()}).add(()=>this.cdr.detectChanges())}prepareSidebarData(){this.course?.tutorialGroups&&(this.sidebarTutorialGroups=this.courseOverviewService.mapTutorialGroupsToSidebarCardElements(this.tutorialGroups),this.accordionTutorialGroupsGroups=this.groupTutorialGroupsByRegistration(),this.updateSidebarData())}groupTutorialGroupsByRegistration(){let e=w(B),o,i=this.tutorialGroups.some(a=>a.isUserRegistered||a.isUserTutor);return this.tutorialGroups.forEach(a=>{let H=this.courseOverviewService.mapTutorialGroupToSidebarCardElement(a);i?o=a.isUserTutor||a.isUserRegistered?"registered":"further":o="all",e[o].entityData.push(H)}),e}updateSidebarData(){this.sidebarData={groupByCategory:!0,storageId:"tutorialGroup",groupedData:this.accordionTutorialGroupsGroups,ungroupedData:this.sidebarTutorialGroups}}toggleSidebar(){this.isCollapsed=!this.isCollapsed,this.courseOverviewService.setSidebarCollapseState("tutorialGroup",this.isCollapsed),this.cdr.detectChanges()}getLastSelectedTutorialGroup(){return sessionStorage.getItem("sidebar.lastSelectedItem.tutorialGroup.byCourse."+this.courseId)}setFreeDays(){this.course?.tutorialGroupsConfiguration?.tutorialGroupFreePeriods?this.tutorialGroupFreeDays=this.course.tutorialGroupsConfiguration.tutorialGroupFreePeriods:this.tutorialGroupFreeDays=[]}setTutorialGroups(){this.loadTutorialGroupsFromCache()||this.loadTutorialGroupsFromServer(),this.navigateToTutorialGroup()}setCourse(){this.loadCourseFromCache()||this.loadCourseFromServer()}loadCourseFromCache(){let e=this.courseStorageService.getCourse(this.courseId);return e===void 0?!1:(this.course=e,this.configuration=this.course?.tutorialGroupsConfiguration,this.setFreeDays(),!0)}loadTutorialGroupsFromCache(){let e=this.courseStorageService.getCourse(this.courseId)?.tutorialGroups;return e===void 0?!1:(this.tutorialGroups=e,!0)}updateCachedTutorialGroups(){let e=this.courseStorageService.getCourse(this.courseId);e&&(e.tutorialGroups=this.tutorialGroups,this.courseStorageService.updateCourse(e))}loadTutorialGroupsFromServer(){this.isLoading=!0,this.tutorialGroupService.getAllForCourse(this.courseId).pipe(d(e=>e.body),p(()=>{this.isLoading=!1}),l(this.ngUnsubscribe)).subscribe({next:e=>{this.tutorialGroups=e??[],this.updateCachedTutorialGroups()},error:e=>G(this.alertService,e)}).add(()=>this.cdr.detectChanges())}loadCourseFromServer(){this.isLoading=!0,this.courseManagementService.find(this.courseId).pipe(d(e=>e.body),p(()=>{this.isLoading=!1}),l(this.ngUnsubscribe)).subscribe({next:e=>{this.course=e,this.configuration=this.course?.tutorialGroupsConfiguration,this.setFreeDays()},error:e=>G(this.alertService,e)}).add(()=>this.cdr.detectChanges())}onSubRouteDeactivate(){this.route.firstChild||this.navigateToTutorialGroup()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}static \u0275fac=function(o){return new(o||r)};static \u0275cmp=_({type:r,selectors:[["jhi-course-tutorial-groups"]],decls:4,vars:1,consts:[[1,"d-flex","justify-content-between"],[3,"ngClass"],[3,"itemSelected","courseId","sidebarData","collapseState","sidebarItemAlwaysShow"],[1,"vw-100","module-bg","rounded-3"],[3,"deactivate"],[1,"vw-100","module-bg","rounded-3","p-3","d-flex","justify-content-between"],["jhiTranslate","artemisApp.courseOverview.tutorialGroups.selectTutorialGroup",1,"col-12","text-center","my-auto"]],template:function(o,i){o&1&&(u(0,"div",0),t(1,`
    `),h(2,k,8,9),n(),t(3,`
`)),o&2&&(c(2),g(i.course?2:-1))},dependencies:[U,W,A,M],encapsulation:2,changeDetection:0})}return r})();export{de as a};
//# sourceMappingURL=chunk-FC6XZEXF.js.map
