import{J as C,Y as b,aa as O,d as A,f as w,ha as E,k as S,ra as P,s as v}from"./chunk-5LC5EQRR.js";var c=class{};var g=class extends c{constructor(){super(...arguments),this.cachePairs=[]}add(e,r,t){this.cachePairs.push(e)}addMany(e){this.cachePairs=e}updateAtIndex(e,r){let t=this.cachePairs[e];Object.assign(t,r)}update(e,r){let t=this.cachePairs[e];Object.assign(t,r)}getAll(){return this.cachePairs}removeAtIndex(e){this.cachePairs.splice(e,1)}remove(e){this.cachePairs.splice(e,1)}removeAll(){this.cachePairs.length=0}};var y=(a,e)=>JSON.stringify(a)===JSON.stringify(e),I=a=>a.map(e=>e!==void 0?JSON.parse(JSON.stringify(e)):e),n={storageStrategy:g,globalCacheKey:"CACHE_STORAGE",promiseImplementation:Promise};var x=class extends c{constructor(){if(super(),this.masterCacheKey=n.globalCacheKey,typeof localStorage>"u")throw new Error("Platform not supported.")}add(e,r){let t=this.getRawData();t[r]||(t[r]=[]),t[r].push(e),this.storeRawData(t)}addMany(e,r){let t=this.getRawData();t[r]||(t[r]=[]),t[r]=e,this.storeRawData(t)}getAll(e){return this.getRawData()[e]||[]}removeAtIndex(e,r){let t=this.getRawData();t[r]&&t[r].length&&t[r].splice(e,1),this.storeRawData(t)}remove(e,r,t){let s=this.getRawData();s[t]&&s[t].length&&s[t].splice(e,1),this.storeRawData(s)}updateAtIndex(e,r,t){let s=this.getRawData();s[t]&&s[t][e]&&(s[t][e]=r),this.storeRawData(s)}update(e,r,t){let s=this.getRawData();s[t]&&s[t][e]&&(s[t][e]=r),this.storeRawData(s)}removeAll(e){let r=this.getRawData();r[e]&&r[e].length&&(r[e].length=0),this.storeRawData(r)}getRawData(){let e=localStorage.getItem(this.masterCacheKey);try{return JSON.parse(e)||{}}catch(r){throw new Error(r)}}storeRawData(e){localStorage.setItem(this.masterCacheKey,JSON.stringify(e))}};var T=new w;function q(a={}){return function(e,r,t){let s=a.cacheKey||e.constructor.name+"#"+r,H=t.value;if(t&&t.value){let o=a.storageStrategy?new a.storageStrategy:new n.storageStrategy,m=[];a.cacheModifier&&a.cacheModifier.subscribe(d=>o.addMany(d(o.getAll(s,this)),s,this)),C(T.asObservable(),a.cacheBusterObserver?a.cacheBusterObserver:S()).subscribe(d=>{o.removeAll(s,this),m.length=0});let f=a.cacheResolver||n.cacheResolver;a.cacheResolver=f||y;let R=a.cacheHasher||n.cacheHasher;a.cacheHasher=R||I,t.value=function(...d){let h=o.getAll(s,this),u=a.cacheHasher(d),i=h.find(l=>a.cacheResolver(l.parameters,u)),D=m.find(l=>a.cacheResolver(l.parameters,u));if((a.maxAge||n.maxAge)&&i&&i.created&&(new Date().getTime()-new Date(i.created).getTime()>(a.maxAge||n.maxAge)?(o.remove?o.remove(h.indexOf(i),i,s,this):o.removeAtIndex(h.indexOf(i),s,this),i=null):(a.slidingExpiration||n.slidingExpiration)&&(i.created=new Date,o.update?o.update(h.indexOf(i),i,s,this):o.updateAtIndex(h.indexOf(i),i,s,this))),i){let l=v(i.response);return a.async?l.pipe(b(0)):l}else{if(D)return D.response;{let l=H.call(this,...d).pipe(O(()=>{let p=m.find(_=>a.cacheResolver(_.parameters,u));m.splice(m.indexOf(p),1)}),P(p=>{(!a.shouldCacheDecider||a.shouldCacheDecider(p))&&((!(a.maxCacheCount||n.maxCacheCount)||(a.maxCacheCount||n.maxCacheCount)===1||(a.maxCacheCount||n.maxCacheCount)&&(a.maxCacheCount||n.maxCacheCount)<h.length+1)&&(o.remove?o.remove(0,h[0],s,this):o.removeAtIndex(0,s,this)),o.add({parameters:u,response:p,created:a.maxAge||n.maxAge?new Date:null},s,this))}),E(1),A());return m.push({parameters:u,response:l,created:new Date}),l}}}}return t}}export{c as a,x as b,n as c,q as d};
//# sourceMappingURL=chunk-ZFM7LHJQ.js.map
