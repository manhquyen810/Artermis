import{a as k}from"./chunk-JCAGYDTX.js";import{b as F}from"./chunk-OI2L2OHD.js";import{b as o,f as l,g as S,j as s}from"./chunk-3JSWSN6W.js";import{t as h}from"./chunk-VK7JPHFE.js";import{c as b}from"./chunk-BNDLMKXK.js";import{O as m}from"./chunk-IOA4DPXY.js";import{Ea as u,oa as a,s as c,ya as E,z as p}from"./chunk-5LC5EQRR.js";var D=(()=>{class f{http=u(m);profileService=u(b);resourceUrl="api/athena";isEnabled(){return this.profileService.getProfileInfo().pipe(a(r=>c(r.activeProfiles.includes(h))))}getAvailableModules(r,n){return this.isEnabled().pipe(a(d=>d?this.http.get(`${this.resourceUrl}/courses/${r}/${n.type}-exercises/available-modules`,{observe:"response"}).pipe(a(e=>c(e.body))):c([])))}getFeedbackSuggestions(r,n){return r.feedbackSuggestionModule?this.isEnabled().pipe(a(d=>d?this.http.get(`${this.resourceUrl}/${r.type}-exercises/${r.id}/submissions/${n}/feedback-suggestions`,{observe:"response"}).pipe(a(e=>c(e.body))):c([]))):c([])}findGradingInstruction(r,n){for(let d of r.gradingCriteria??[])for(let e of d.structuredGradingInstructions)if(e.id==n)return e}getTextFeedbackSuggestions(r,n){return this.getFeedbackSuggestions(r,n.id).pipe(p(d=>d.map(e=>{let t=new s;if(t.credits=e.credits,t.text=S+e.title,t.detailText=e.description,e.structuredGradingInstructionId!=null&&(t.gradingInstruction=this.findGradingInstruction(r,e.structuredGradingInstructionId)),e.indexStart==null)return t.type=o.MANUAL_UNREFERENCED,t;t.type=o.MANUAL;let i=new F;return i.startIndex=e.indexStart,i.endIndex=e.indexEnd,i.setTextFromSubmission(n),t.reference=i.id,new k(i,t)})))}getProgrammingFeedbackSuggestions(r,n){return this.getFeedbackSuggestions(r,n).pipe(p(d=>d.map(e=>{let t=new s;return t.credits=e.credits,t.text=l+e.title,t.detailText=e.description,e.filePath!=null&&(e.lineEnd??e.lineStart)!=null?(t.type=o.MANUAL,t.reference=`file:${e.filePath}_line:${e.lineEnd??e.lineStart}`):(t.type=o.MANUAL_UNREFERENCED,t.reference=void 0),e.structuredGradingInstructionId!=null&&(t.gradingInstruction=this.findGradingInstruction(r,e.structuredGradingInstructionId)),t})))}getModelingFeedbackSuggestions(r,n){return this.getFeedbackSuggestions(r,n.id).pipe(p(d=>d.map((e,t)=>{let i=new s;i.id=t,i.credits=e.credits,i.positive=e.credits>=1;let A=e.reference?.split(":"),[T,I]=A||[];return I?(i.type=o.AUTOMATIC,i.text=e.description,i.reference=e.reference,i.referenceId=I,i.referenceType=T):(i.type=o.MANUAL_UNREFERENCED,i.text=`${l}${e.title}`,i.detailText=e.description),e.structuredGradingInstructionId&&(i.gradingInstruction=this.findGradingInstruction(r,e.structuredGradingInstructionId)),i})))}static \u0275fac=function(n){return new(n||f)};static \u0275prov=E({token:f,factory:f.\u0275fac,providedIn:"root"})}return f})();export{D as a};
//# sourceMappingURL=chunk-HPCUFM6M.js.map
