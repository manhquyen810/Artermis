import{a as F}from"./chunk-T77OIOZ4.js";import{K as W}from"./chunk-VZRSC3LP.js";import{x as A}from"./chunk-5GXY5RYT.js";import{c as N}from"./chunk-JXJXC4DZ.js";import{d as R}from"./chunk-EDXSOKK5.js";import{b as S}from"./chunk-R5BZWVRQ.js";import{p as d}from"./chunk-DID2YGL7.js";import{dd as $,eb as L}from"./chunk-Z4VHWOB5.js";import{a as g}from"./chunk-5ZXXURLP.js";import{a as v}from"./chunk-NOBD5HSR.js";import{n as M}from"./chunk-IOA4DPXY.js";import{Db as r,Ea as p,Oc as b,Rc as P,Tb as l,Va as T,Zb as h,dd as e,fd as I,kc as m,mc as y,rd as D,sa as f,sc as x,uc as C,vc as E,wc as w,xc as o,yc as s,z as _,zc as c}from"./chunk-5LC5EQRR.js";import{a as k,b as O}from"./chunk-3E746U5Y.js";function U(n){return n.submission!==void 0&&n.sender!==void 0}function j(n){return n.submissionPatch!==void 0&&n.sender!==void 0}var ut=(()=>{class n{accountService=p(S);teamSubmissionWebsocketService=p(g);alertService=p(N);THROTTLE_TIME=2e3;exerciseType;submissionObservable;submissionPatchObservable;participation;receiveSubmission=new T;receiveSubmissionPatch=new T;currentUser;websocketTopic;constructor(){this.accountService.identity().then(t=>this.currentUser=t)}ngOnInit(){this.websocketTopic=this.buildWebsocketTopic(""),this.teamSubmissionWebsocketService.subscribe(this.websocketTopic),this.setupReceiver(),this.setupSender()}setupReceiver(){this.teamSubmissionWebsocketService.receive(this.websocketTopic).subscribe({next:t=>{U(t)&&!this.isSelf(t.sender)?this.receiveSubmission.emit(t.submission):j(t)&&this.receiveSubmissionPatch.emit(t.submissionPatch)},error:t=>this.onError(t)})}setupSender(){this.submissionObservable?.pipe(f(this.THROTTLE_TIME,void 0,{leading:!0,trailing:!0})).subscribe({next:t=>{t.participation&&(t.participation.exercise=void 0,t.participation.submissions=[]),this.teamSubmissionWebsocketService.send(this.buildWebsocketTopic("/update"),t)},error:t=>this.onError(t)}),this.submissionPatchObservable?.subscribe({next:t=>{this.teamSubmissionWebsocketService.send(this.buildWebsocketTopic("/patch"),t)},error:t=>this.onError(t)})}isSelf(t){return this.currentUser.login===t.login}buildWebsocketTopic(t=""){return`/topic/participations/${this.participation.id}/team/${this.exerciseType}-submissions${t}`}onError(t){this.alertService.error(t)}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=l({type:n,selectors:[["jhi-team-submission-sync"]],inputs:{exerciseType:"exerciseType",submissionObservable:"submissionObservable",submissionPatchObservable:"submissionPatchObservable",participation:"participation"},outputs:{receiveSubmission:"receiveSubmission",receiveSubmissionPatch:"receiveSubmissionPatch"},decls:0,vars:0,template:function(i,a){},encapsulation:2})}return n})();var Y=n=>({online:n});function V(n,u){n&1&&(e(0,`
                        `),o(1,"div",5),e(2,`
                            `),c(3,"div",6),e(4,`
                            `),c(5,"div",7),e(6,`
                            `),c(7,"div",8),e(8,`
                        `),s(),e(9,`
                    `))}function z(n,u){if(n&1&&(e(0,`
                        `),c(1,"fa-icon",9),e(2,`
                    `)),n&2){let t=b(2);r(),m("icon",t.faCircle)}}function J(n,u){n&1&&(e(0,`
                        `),o(1,"span",10),e(2,"(you)"),s(),e(3,`
                    `))}function q(n,u){if(n&1&&(e(0,`
                    `),o(1,"span",11),e(2,`
                        `),o(3,"button",12),e(4,`
                            `),c(5,"fa-icon",13),e(6,`
                        `),s(),e(7,`
                    `),s(),e(8,`
                `)),n&2){let t=b().$implicit,i=b();r(),P("ngbTooltip",i.lastActionDate(t).fromNow()),r(4),m("icon",i.faHistory)}}function K(n,u){if(n&1&&(e(0,`
            `),o(1,"li",2),e(2,`
                `),o(3,"div",3),e(4,`
                    `),h(5,V,10,0)(6,z,3,1),s(),e(7,`
                `),o(8,"span",4),e(9),h(10,J,4,0),s(),e(11,`
                `),h(12,q,9,2),s(),e(13,`
        `)),n&2){let t=u.$implicit,i=b();r(),m("ngClass",D(5,Y,i.isOnline(t))),r(4),x(i.isOther(t)&&i.isTyping(t)?5:6),r(4),I("",t.name,`
                    `),r(),x(i.isSelf(t)?10:-1),r(2),x(i.isOther(t)&&i.lastActionDate(t)?12:-1)}}var B=(()=>{class n{accountService=p(S);websocketService=p(g);SHOW_TYPING_DURATION=2e3;SEND_TYPING_INTERVAL=this.SHOW_TYPING_DURATION/1.5;typing$;participation;currentUser;onlineTeamStudents=[];typingTeamStudents=[];websocketTopic;faCircle=L;faHistory=$;ngOnInit(){this.accountService.identity().then(t=>{this.currentUser=t,this.setupOnlineTeamStudentsReceiver(),this.setupTypingIndicatorSender()})}setupOnlineTeamStudentsReceiver(){this.websocketTopic=this.buildWebsocketTopic(),this.websocketService.subscribe(this.websocketTopic),this.websocketService.receive(this.websocketTopic).pipe(_(this.convertOnlineTeamStudentsFromServer)).subscribe({next:t=>{this.onlineTeamStudents=t,this.computeTypingTeamStudents()},error:t=>v(t)}),setTimeout(()=>{this.websocketService.send(this.buildWebsocketTopic("/trigger"),{})},700)}setupTypingIndicatorSender(){this.typing$&&this.typing$.pipe(f(this.SEND_TYPING_INTERVAL)).subscribe({next:()=>this.websocketService.send(this.buildWebsocketTopic("/typing"),{}),error:t=>v(t)})}ngOnDestroy(){this.websocketService.unsubscribe(this.websocketTopic)}get team(){return this.participation.team}get studentList(){return[...this.self?[this.self]:[],...A(this.otherStudents,["name"])]}get self(){return this.team.students?.find(this.isSelf)}get otherStudents(){return this.team.students?.filter(this.isOther)||[]}isSelf=t=>t.id===this.currentUser?.id;isOther=t=>!this.isSelf(t);isOnline=t=>this.onlineTeamStudents.map(i=>i.login).includes(t.login);lastActionDate=t=>this.onlineTeamStudents.find(i=>i.login===t.login)?.lastActionDate;isTyping=t=>this.typingTeamStudents.map(i=>i.login).includes(t.login);computeTypingTeamStudents(){if(this.typingTeamStudents=this.onlineTeamStudents.filter(t=>!!t.lastTypingDate?.isAfter(d().subtract(this.SHOW_TYPING_DURATION,"ms"))),this.typingTeamStudents.length>0){let t=this.typingTeamStudents.map(a=>a.lastTypingDate).filter(Boolean),i=d.min(t);if(i){let G=i.add(this.SHOW_TYPING_DURATION,"ms").diff(d());setTimeout(()=>this.computeTypingTeamStudents(),G)}}}convertOnlineTeamStudentsFromServer(t){return t.map(i=>O(k({},i),{lastTypingDate:i.lastTypingDate!==null?d(i.lastTypingDate):null,lastActionDate:i.lastActionDate!==null?d(i.lastActionDate):null}))}buildWebsocketTopic(t=""){return`/topic/participations/${this.participation.id}/team${t}`}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=l({type:n,selectors:[["jhi-team-students-online-list"]],inputs:{typing$:"typing$",participation:"participation"},decls:11,vars:0,consts:[[1,"fw-medium"],[1,"team-students-online-list"],[1,"student-item",3,"ngClass"],[1,"indicator"],[1,"student-name"],[1,"typing-indicator"],[1,"bounce1"],[1,"bounce2"],[1,"bounce3"],["size","sm",1,"student-status",3,"icon"],[1,"text-body-secondary"],["triggers","click:blur","position","top","tooltipClass","student-last-action-tooltip",3,"ngbTooltip"],[1,"student-last-action-trigger","ms-1"],[3,"icon"]],template:function(i,a){i&1&&(o(0,"div"),e(1,`
    `),o(2,"h5",0),e(3,"Team"),s(),e(4,`
    `),o(5,"ul",1),e(6,`
        `),E(7,K,14,7,null,null,C),s(),e(9,`
`),s(),e(10,`
`)),i&2&&(r(7),w(a.studentList))},dependencies:[M,R,W],styles:[`:host{display:block}.team-students-online-list{list-style:none;padding:0;margin:0}.team-students-online-list .student-item{display:flex;align-items:center;font-size:14px;font-weight:400}.team-students-online-list .student-item:not(:first-of-type){margin-top:5px}.team-students-online-list .indicator{margin-right:5px;display:flex;align-items:center}.team-students-online-list .student-status{display:inline-flex;color:var(--secondary);transition:.1s color ease-out}.online .team-students-online-list .student-status{transition:.05s color ease-in}.team-students-online-list .student-name{max-width:190px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;color:var(--secondary);transition:.1s color ease-out}.online .team-students-online-list .student-name{transition:.05s color ease-in}.team-students-online-list .online .student-status{color:var(--success)}.team-students-online-list .online .student-name{color:var(--bs-body-color)}.team-students-online-list .student-last-action-trigger{margin:-1px 0;opacity:.25;background:none;border:none}.team-students-online-list .student-last-action-trigger:hover{opacity:.75}.team-students-online-list .student-last-action-trigger:focus{opacity:1;outline:none}.team-students-online-list .student-last-action-tooltip{width:unset!important}.team-students-online-list .student-last-action-tooltip .tooltip-inner{min-width:unset!important}.typing-indicator{display:flex;width:18px;opacity:.6}.typing-indicator>div{width:6px;height:6px;border-radius:100%;-webkit-animation:bounce-delay 1.4s infinite ease-in-out both;animation:bounce-delay 1.4s infinite ease-in-out both;background:var(--bs-body-color)}.typing-indicator .bounce1{animation-delay:-.32s}.typing-indicator .bounce2{animation-delay:-.16s}@keyframes bounce-delay{0%,80%,to{transform:scale(0)}40%{transform:scale(1)}}
`],encapsulation:2})}return n})();var Ft=(()=>{class n{exercise;participation;stickyEnabled=!0;dockedToLeftSide=!1;dockedToRightSide=!1;typing$;static \u0275fac=function(i){return new(i||n)};static \u0275cmp=l({type:n,selectors:[["jhi-team-participate-info-box"]],inputs:{exercise:"exercise",participation:"participation",stickyEnabled:"stickyEnabled",dockedToLeftSide:"dockedToLeftSide",dockedToRightSide:"dockedToRightSide",typing$:"typing$"},decls:13,vars:8,consts:[[1,"team-participate-info-box"],[1,"sticky-box","bg-light"],[1,"d-flex","justify-content-end"],[1,"text-end"],[1,"mt-3",3,"participation","typing$"]],template:function(i,a){i&1&&(o(0,"div",0),e(1,`
    `),o(2,"div",1),e(3,`
        `),o(4,"div",2),e(5,`
            `),c(6,"jhi-connection-status",3),e(7,`
        `),s(),e(8,`
        `),c(9,"jhi-team-students-online-list",4),e(10,`
    `),s(),e(11,`
`),s(),e(12,`
`)),i&2&&(y("sticky-enabled",a.stickyEnabled),r(2),y("docked-to-left-side",a.dockedToLeftSide)("docked-to-right-side",a.dockedToRightSide),r(7),m("participation",a.participation)("typing$",a.typing$))},dependencies:[F,B],styles:[".team-participate-info-box[_ngcontent-%COMP%]{position:relative;right:-20px;min-width:250px}.team-participate-info-box.sticky-enabled[_ngcontent-%COMP%]{height:100%}.team-participate-info-box.sticky-enabled[_ngcontent-%COMP%]   .sticky-box[_ngcontent-%COMP%]{position:sticky;top:25px}.team-participate-info-box[_ngcontent-%COMP%]   .sticky-box[_ngcontent-%COMP%]{margin-top:2px;padding:18px 24px 20px;transition:.2s box-shadow;box-shadow:0 0 3px #00000014,0 0 14px #0000000d;border-radius:10px}.team-participate-info-box[_ngcontent-%COMP%]   .sticky-box.docked-to-left-side[_ngcontent-%COMP%]{border-top-left-radius:0;border-bottom-left-radius:0}.team-participate-info-box[_ngcontent-%COMP%]   .sticky-box.docked-to-right-side[_ngcontent-%COMP%]{border-top-right-radius:0;border-bottom-right-radius:0}"]})}return n})();export{ut as a,Ft as b};
//# sourceMappingURL=chunk-43HC4K73.js.map
