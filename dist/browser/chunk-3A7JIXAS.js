import{b as _}from"./chunk-EAC2ODNH.js";import{a as w}from"./chunk-SLVT6IA5.js";import{a as b}from"./chunk-QU4DXSXD.js";import{u as T}from"./chunk-VZRSC3LP.js";import{a as E}from"./chunk-U54OSGNH.js";import{Db as s,Ea as p,Mc as v,Oc as y,Pd as P,Rc as S,Rd as A,Tb as u,Va as g,Za as m,Zb as C,ab as h,dd as e,kc as x,sc as d,x as c,xc as o,ya as R,yc as a,zc as f}from"./chunk-5LC5EQRR.js";import{j as r}from"./chunk-3E746U5Y.js";var M=(()=>{class i{cachedRepositoryFilesChanged=new g;getCachedRepositoryFilesObservable(){return this.cachedRepositoryFilesChanged.asObservable()}emitCachedRepositoryFiles(t){this.cachedRepositoryFilesChanged.emit(t)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=R({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function I(i,F){if(i&1&&(e(0,`
            `),o(1,"div",4),e(2,`
                `),f(3,"jhi-git-diff-report",5),e(4,`
            `),a(),e(5,`
        `)),i&2){let t=y();s(3),x("report",t.report())("diffForTemplateAndSolution",t.diffForTemplateAndSolution())("templateFileContentByPath",t.leftCommitFileContentByPath())("solutionFileContentByPath",t.rightCommitFileContentByPath())}}function W(i,F){i&1&&(e(0,`
                `),o(1,"div",6),e(2,`
                    `),o(3,"span",7),e(4,`
                        `),o(5,"span",8),e(6,"Loading..."),a(),e(7,`
                    `),a(),e(8,`
                `),a(),e(9,`
            `))}function D(i,F){if(i&1&&(e(0,`
            `),C(1,W,10,0)),i&2){let t=y();s(),d(t.errorWhileFetchingRepos()?-1:1)}}function k(i,F){i&1&&(e(0,`
            `),o(1,"div"),e(2,`
                `),o(3,"div",9),e(4,`
                    `),f(5,"div",10),e(6,`
                `),a(),e(7,`
            `),a(),e(8,`
        `))}var Y=(()=>{class i{static WINDOW_CLASS="diff-view-modal";activeModal=p(T);programmingExerciseService=p(w);programmingExerciseParticipationService=p(b);cachedRepositoryFilesService=p(M);report=m.required();diffForTemplateAndSolution=m(!0);cachedRepositoryFiles=m(new Map);errorWhileFetchingRepos=h(!1);leftCommitFileContentByPath=h(void 0);rightCommitFileContentByPath=h(void 0);constructor(){A(()=>{this.report();let t=this.diffForTemplateAndSolution();P(()=>r(this,null,function*(){t?yield this.loadFilesForTemplateAndSolution():yield this.loadRepositoryFilesForParticipationsFromCacheIfAvailable()}))})}loadFilesForTemplateAndSolution(){return r(this,null,function*(){yield this.fetchTemplateRepoFiles(),yield this.fetchSolutionRepoFiles()})}fetchSolutionRepoFiles(){return r(this,null,function*(){try{let t=yield c(this.programmingExerciseService.getSolutionRepositoryTestFilesWithContent(this.report().programmingExercise.id));this.rightCommitFileContentByPath.set(t)}catch{this.errorWhileFetchingRepos.set(!0)}})}loadRepositoryFilesForParticipationsFromCacheIfAvailable(){return r(this,null,function*(){if(this.report().participationIdForLeftCommit){let t=this.report().leftCommitHash;this.cachedRepositoryFiles().has(t)?(this.leftCommitFileContentByPath.set(this.cachedRepositoryFiles().get(t)),yield this.loadParticipationRepoFilesAtRightCommitFromCacheIfAvailable()):yield this.fetchParticipationRepoFilesAtLeftCommit()}else yield this.loadTemplateRepoFilesFromCacheIfAvailable(),yield this.loadParticipationRepoFilesAtRightCommitFromCacheIfAvailable()})}fetchParticipationRepoFilesAtLeftCommit(){return r(this,null,function*(){try{let t=(yield c(this.programmingExerciseParticipationService.getParticipationRepositoryFilesWithContentAtCommit(this.report().participationIdForLeftCommit,this.report().leftCommitHash)))??new Map;this.leftCommitFileContentByPath.set(t),this.cachedRepositoryFiles().set(this.report().leftCommitHash,t),this.cachedRepositoryFilesService.emitCachedRepositoryFiles(this.cachedRepositoryFiles()),yield this.loadParticipationRepoFilesAtRightCommitFromCacheIfAvailable()}catch{this.errorWhileFetchingRepos.set(!0)}})}loadTemplateRepoFilesFromCacheIfAvailable(){return r(this,null,function*(){let t=this.calculateTemplateMapKey();this.cachedRepositoryFiles().has(t)?this.leftCommitFileContentByPath.set(this.cachedRepositoryFiles().get(t)):yield this.fetchTemplateRepoFiles()})}loadParticipationRepoFilesAtRightCommitFromCacheIfAvailable(){return r(this,null,function*(){let t=this.report().rightCommitHash;this.cachedRepositoryFiles().has(t)?this.rightCommitFileContentByPath.set(this.cachedRepositoryFiles().get(t)):yield this.fetchParticipationRepoFilesAtRightCommit()})}fetchTemplateRepoFiles(){return r(this,null,function*(){let t=this.calculateTemplateMapKey();try{let n=(yield c(this.programmingExerciseService.getTemplateRepositoryTestFilesWithContent(this.report().programmingExercise.id)))??new Map;this.leftCommitFileContentByPath.set(n),this.cachedRepositoryFiles().set(t,n),this.cachedRepositoryFilesService.emitCachedRepositoryFiles(this.cachedRepositoryFiles())}catch{this.errorWhileFetchingRepos.set(!0)}})}fetchParticipationRepoFilesAtRightCommit(){return r(this,null,function*(){try{let t=(yield c(this.programmingExerciseParticipationService.getParticipationRepositoryFilesWithContentAtCommit(this.report().participationIdForRightCommit,this.report().rightCommitHash)))??new Map;this.rightCommitFileContentByPath.set(t),this.cachedRepositoryFiles().set(this.report().rightCommitHash,t),this.cachedRepositoryFilesService.emitCachedRepositoryFiles(this.cachedRepositoryFiles())}catch{this.errorWhileFetchingRepos.set(!0)}})}close(){this.activeModal.dismiss()}calculateTemplateMapKey(){return this.report().programmingExercise.id+"-template"}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=u({type:i,selectors:[["jhi-git-diff-report-modal"]],inputs:{report:[1,"report"],diffForTemplateAndSolution:[1,"diffForTemplateAndSolution"],cachedRepositoryFiles:[1,"cachedRepositoryFiles"]},decls:16,vars:3,consts:[[1,"modal-header"],[1,"modal-title",3,"jhiTranslate"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"row","mb-2"],[3,"report","diffForTemplateAndSolution","templateFileContentByPath","solutionFileContentByPath"],[1,"text-center"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-lg"],[1,"sr-only"],[1,"alert","alert-danger"],["jhiTranslate","artemisApp.programmingExercise.diffReport.errorWhileFetchingRepos"]],template:function(n,l){n&1&&(o(0,"div"),e(1,`
    `),o(2,"div",0),e(3,`
        `),f(4,"h3",1),e(5,`
        `),o(6,"button",2),v("click",function(){return l.close()}),a(),e(7,`
    `),a(),e(8,`
    `),o(9,"div",3),e(10,`
        `),C(11,I,6,4)(12,D,2,1)(13,k,9,0),a(),e(14,`
`),a(),e(15,`
`)),n&2&&(s(4),S("jhiTranslate",l.diffForTemplateAndSolution()?"artemisApp.programmingExercise.diffReport.title":"artemisApp.programmingExercise.diffReport.titleForSubmissions"),s(7),d(l.leftCommitFileContentByPath()&&l.rightCommitFileContentByPath()?11:12),s(2),d(l.errorWhileFetchingRepos()?13:-1))},dependencies:[_,E],encapsulation:2,changeDetection:0})}return i})();export{M as a,Y as b};
//# sourceMappingURL=chunk-3A7JIXAS.js.map
