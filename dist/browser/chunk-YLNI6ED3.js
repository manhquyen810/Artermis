import{a as q,b as Q,c as V,d as w}from"./chunk-ZFM7LHJQ.js";import{b as W,c as H}from"./chunk-5YQ3ACZE.js";import{b as J}from"./chunk-R5BZWVRQ.js";import{e as k}from"./chunk-PZTBTDSR.js";import{O as M,u as F}from"./chunk-IOA4DPXY.js";import{Db as l,Ea as n,L,La as B,Oc as v,P as _,Tb as P,Va as N,Zb as z,_ as j,_a as G,b as x,c as h,dd as s,f as A,g as T,jc as C,m as u,n as o,oa as p,ra as d,s as S,sc as D,u as E,xb as f,ya as U,yd as O,z as b,zc as y,zd as I}from"./chunk-5LC5EQRR.js";var g=class extends q{mainCacheKey=V.globalCacheKey;constructor(){if(super(),sessionStorage==null)throw new Error("Platform not supported.")}add(a,t){let e=this.getRawData();e[t]||(e[t]=[]),e[t].push(a),this.storeRawData(e)}addMany(a,t){let e=this.getRawData();e[t]||(e[t]=[]),e[t]=a,this.storeRawData(e)}getAll(a){return this.getRawData()[a]||[]}removeAtIndex(a,t){this.remove(a,{},t)}remove(a,t,e){let r=this.getRawData();r[e]&&r[e].length&&r[e].splice(a,1),this.storeRawData(r)}updateAtIndex(a,t,e){this.update(a,t,e)}update(a,t,e){let r=this.getRawData();r[e]&&r[e][a]&&(r[e][a]=t),this.storeRawData(r)}removeAll(a){let t=this.getRawData();t[a]&&t[a].length&&(t[a].length=0),this.storeRawData(t)}getRawData(){let a=sessionStorage.getItem(this.mainCacheKey);try{return a?JSON.parse(a):{}}catch(t){throw new Error(t)}}storeRawData(a){sessionStorage.setItem(this.mainCacheKey,JSON.stringify(a))}};var R=new A,X=i=>typeof i=="string"?i.length<1e4:!1,c=class i{accountService=n(J);httpClient=n(M);userChangeSubscription;constructor(){this.init()}init(){this.userChangeSubscription=this.accountService.getAuthenticationState().pipe(j(),d(()=>R.next())).subscribe()}ngOnDestroy(){this.userChangeSubscription&&this.userChangeSubscription.unsubscribe()}loadCachedLocalStorage(a){return this.httpClient.get(a,{responseType:"blob"}).pipe(this.mapBlobToUrlString())}loadCachedSessionStorage(a){return this.httpClient.get(a,{responseType:"blob"}).pipe(this.mapBlobToUrlString())}loadWithoutCache(a){return this.httpClient.get(a,{responseType:"blob"}).pipe(this.mapBlobToUrlString())}mapBlobToUrlString=()=>x(p(H));static \u0275fac=function(t){return new(t||i)};static \u0275prov=U({token:i,factory:i.\u0275fac,providedIn:"root"})};u([w({storageStrategy:Q,cacheBusterObserver:R.asObservable(),maxCacheCount:30,shouldCacheDecider:X}),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",h)],c.prototype,"loadCachedLocalStorage",null);u([w({storageStrategy:g,cacheBusterObserver:R.asObservable(),maxCacheCount:100,shouldCacheDecider:X}),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",h)],c.prototype,"loadCachedSessionStorage",null);function Z(i,a){if(i&1&&(s(0,`
            `),y(1,"img",0),O(2,"async"),s(3,`
        `)),i&2){let t=v();l(),C("src",I(2,1,t.dataUrl),f)}}function $(i,a){if(i&1&&(s(0,`
            `),y(1,"img",1),O(2,"async"),s(3,`
        `)),i&2){let t=v();l(),C("src",I(2,1,t.dataUrl),f)}}var m=function(i){return i.LOCAL_STORAGE="LOCAL_STORAGE",i.SESSION_STORAGE="SESSION_STORAGE",i.NONE="NONE",i}(m||{}),vt=(()=>{class i{domSanitizer=n(k);cacheableImageService=n(c);element=n(G);mobileDragAndDrop=!1;src;cachingStrategy=m.SESSION_STORAGE;alt="";srcSubject;dataUrl;retryCounter=0;endLoadingProcess=new N;ngOnInit(){this.srcSubject=new T(this.src),this.dataUrl=this.srcSubject.pipe(L(t=>!!t),p(t=>this.loadImage(t)))}ngOnChanges(){this.srcSubject&&this.srcSubject.next(this.src)}retryLoadImage(){this.retryCounter=0,this.endLoadingProcess.emit("loading"),this.ngOnChanges()}loadImage(t){return S(void 0).pipe(p(()=>{let e;return this.cachingStrategy===m.SESSION_STORAGE?e=this.cacheableImageService.loadCachedSessionStorage(t):this.cachingStrategy===m.LOCAL_STORAGE?e=this.cacheableImageService.loadCachedLocalStorage(t):e=this.cacheableImageService.loadWithoutCache(t),E(e)?e:S(e)}),b(e=>W(e,"application/json")),b(e=>this.domSanitizer.bypassSecurityTrustUrl(URL.createObjectURL(e))),d(()=>{this.endLoadingProcess.emit("success")}),_(e=>{if(this.retryCounter===0)return this.retryCounter++,this.loadImage(t);throw this.endLoadingProcess.emit("error"),e}))}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["jhi-secured-image"]],inputs:{mobileDragAndDrop:"mobileDragAndDrop",src:"src",cachingStrategy:"cachingStrategy",alt:"alt"},outputs:{endLoadingProcess:"endLoadingProcess"},features:[B],decls:3,vars:2,consts:[["alt","alt"],["draggable","true","alt","alt","cdkDrag","",1,"dnd-drag-start"]],template:function(e,r){e&1&&(s(0,`
        `),z(1,Z,4,3)(2,$,4,3)),e&2&&(l(),D(r.mobileDragAndDrop?-1:1),l(),D(r.mobileDragAndDrop?2:-1))},dependencies:[F],encapsulation:2})}return i})();export{m as a,vt as b};
//# sourceMappingURL=chunk-YLNI6ED3.js.map
